{
  "id": "8459",
  "title": "\u0027invalid system disk\u0027 message",
  "isPinned": false,
  "isFirstTopic": false,
  "isLocked": false,
  "tags": [],
  "forumNotes": [
    {
      "id": "71942",
      "timestamp": "2009-07-17T05:24:48+00:00",
      "author": "wim sturkenboom",
      "content": "So this is the situation. My bootsequence is set so the system boots from USB first and next from HD. I\u0027ve done this so if I have a USB stick / harddisk with an OS and a bootloader in the mbr inserted in my PC, it will boot from it. However if there is no OS on it, I expect the POST to ignore the stick / disk.  \n\nAt this moment I have two USB memory sticks. When I leave the first one (1 GB sandisk cruzer, fat16) in while rebooting, the system boots to the OS on the HD; that is what I want. When I leave the second one (Verbatim store_n_go 4GB, fat32) in, the system attempts to boot from the usb disk which is NOT what I want.  \n\nfdisk for both disks shows that the bootable flag is not set and that each disk contains 1 partition.  \n\nI tried to fix the 4 GB by overwriting the MBR with 512 zeros. First of all this did not solve the issue and secondly ended in a little disaster as the OS (Ubuntu) did no longer pick it up automatically. Glad I made a backup of the MBR first.  \nReading a bit and found that I overwrote the partition table as well so that explained that problem. A retry with only 446 zeros also did not solve it (pretty obvious I think).  \n\nDoes anybody know if it\u0027s possible to prevent the POST from attempting to boot from the 4GB and if so, how. I like to **understand** on a low level (tell me which bit to flip or something like that; if you advise to format, please tell me why that would solve the problem etc)  \n\nSome points  \n\n* I don\u0027t want to change the boot sequence to HD first as that will prevent an external disk from booting without additional action.\n* I\u0027m running Ubuntu, so please don\u0027t advice on windows tools that can do the trick\n\n\u003cbr /\u003e\n\nI know I\u0027m not asking much in a first post ![:lol:](http://reboot.pro/public/style_emoticons/default/laugh.png)  \nThanks in advance, WimS  \n\nPS If additional data is required, please let me know. Quite new to this, so not sure what is relevant.   \n"
    },
    {
      "id": "71949",
      "timestamp": "2009-07-17T08:22:46+00:00",
      "author": "Icecube",
      "content": "Download boot_info_scrript: [http://sourceforge.n...foscript/files/](http://sourceforge.net/projects/bootinfoscript/files/ \"External link\")  \n\n```\n$ chmod +x ./boot_info_script032.sh \n\n$ sudo ./boot_info_script032.sh\n```\n\nAttach the RESLULTS.TXT file to your post. It will give us a bit more information.  \n\nYou can also try to reformat the whole stick.  \n\nReplace /dev/sdX with the right device for your USB device.  \nYou can get the right device name by:  \n\n* running: **sudo fdisk -l** \u003d\u003d\\\u003e look at the size of the diplayed devices\n* or by running: **dmesg \\| tail** right after you have inserted the USB stick.\n\n\u003cbr /\u003e\n\nUnmount your USB stick:  \n\n```\n$ umount /dev/sdX1 \u0026#40;replacing X with your drive letter\u0026#41;\n```\n\n\u003cbr /\u003e\n\nThen we first clear the first 10MB of the USB stick (backup the files from the USB stick first if you want to keep them).  \n\nBe sure that you replace /dev/sdX by the **correct** device, else your other hard disks or USB can be ruined!):  \n\n```\n$ sudo dd if\u003d/dev/zero of\u003d/dev/sdX bs\u003d1M count\u003d10\n```\n\n\u003cbr /\u003e\n\nNext we need to create the new partition:  \n\n```\n$sudo fdisk -l /dev/sdX\n```\n\n1. Type n to make a new partition  \n2. Type p to make this partition primary and press enter  \n3. Type 1 to make this the first partition and then press enter  \n4. Press enter to accept the default first cylinder  \n5. Press enter again to accept the default last cylinder  \n6. Type w to write the new partition information to the USB key  \n\nLastly we need to create the fat filesystem.  \n\n```\n$ mkfs.vfat -F 32 /dev/sdX1 \u0026#40;replacing X with your USB key drive letter\u0026#41;\n```\n\n\u003cbr /\u003e\n\n"
    },
    {
      "id": "71950",
      "timestamp": "2009-07-17T08:28:25+00:00",
      "author": "was_jaclaz",
      "content": "\u003e I tried to fix the 4 GB by overwriting the MBR with 512 zeros. First of all this did not solve the issue and secondly ended in a little disaster as the OS (Ubuntu) did no longer pick it up automatically. Glad I made a backup of the MBR first.  \n\u003e Reading a bit and found that I overwrote the partition table as well so that explained that problem. A retry with only 446 zeros also did not solve it (pretty obvious I think).\nYep, and in your first attempt you also overwrote the \"magic bytes signature\" of 55AA.  \n\nI guess your best option is to actually write to that stick a MBR that redirects to something else.  \n\nProblem is that the USB stick, if it is \"first booting device\" will be set by BIOS as \"first disk\" i.e. (hd0).  \n\nDepending on the Operating Systems you use/are booting, you may also need to \"exchange drive mapping\".  \n\nRead the docs of mbldr:  \n[http://mbldr.sourceforge.net](http://mbldr.sourceforge.net \"External link\")  \n\nParticularly:  \n[http://mbldr.sourcef...net/#Frequently](http://mbldr.sourceforge.net/#Frequently \"External link\") asked questions (FAQ)  \n\nFAQ#11, it is possible that your BIOS has a setting for \"Boot other Device\" that you have not set.  \n\nOtherwise you need a bootmanager, and mbldr is the \"right\" one, since it fits entirely in the 446 bytes of a \"standard MBR\", using \"Try to boot from next hard disk\" OR \"Skip boot attempt and try another device\" menu option.  \n\nIf you have no problems with a few more hidden sectors occupied and a couple hundreds of Kb occupied on the filesystem, then grub4dos may be another viable solution:  \n[http://www.boot-land...hp?showforum\u003d66](http://www.boot-land.net/forums/index.php?showforum\u003d66 \"External link\")  \n\nThere may be other solutions, but it mostly depends on the BIOS of your machine, you need to make some tests to see what works and want not.  \n\n![:lol:](http://reboot.pro/public/style_emoticons/default/laugh.png)  \n\njaclaz   \n"
    },
    {
      "id": "71990",
      "timestamp": "2009-07-17T14:29:14+00:00",
      "author": "wim sturkenboom",
      "content": "I\u0027ve tried to overwrite the bootsector of the *store_n_go* with the bootsector of the *cruzer* (first 446 bytes).  \nNo success.  \n\n\u003e Download boot_info_scrript: [http://sourceforge.n...foscript/files/](http://sourceforge.net/projects/bootinfoscript/files/ \"External link\")  \n\u003e\n\u003e ```\n\u003e $ chmod +x ./boot_info_script032.sh \n\u003e\n\u003e $ sudo ./boot_info_script032.sh\n\u003e ```\n\u003e\n\u003e Attach the RESLULTS.TXT file to your post. It will give us a bit more information.\n\u003e\n\u003e \u003cbr /\u003e\n\u003e\nThanks; information attached. Not ready yet to format (want to try other ways first.  \n\n#### Attached Files {#attach_wrap}\n\n* [![Attached File](http://reboot.pro/public/style_extra/mime_types/txt.gif)](http://reboot.pro/index.php?s\u003d883791ff170be2feed321cf7da24d734\u0026app\u003dcore\u0026module\u003dattach\u0026section\u003dattach\u0026attach_id\u003d8718 \"Download attachment\") [**RESULTS.store_n_go.txt**](http://reboot.pro/index.php?s\u003d883791ff170be2feed321cf7da24d734\u0026app\u003dcore\u0026module\u003dattach\u0026section\u003dattach\u0026attach_id\u003d8718 \"Download attachment\") **12.53KB** 440 downloads\n\n"
    },
    {
      "id": "71993",
      "timestamp": "2009-07-17T14:42:34+00:00",
      "author": "wim sturkenboom",
      "content": "Thanks. Some reading to do.  \n\n\u003e Yep, and in your first attempt you also overwrote the \"magic bytes signature\" of 55AA.\nI know but I\u0027m not quite crazy. I made a backup of the MBR first that I could put back ![:lol:](http://reboot.pro/public/style_emoticons/default/laugh.png)  \n\n\u003e I guess your best option is to actually write to that stick a MBR that redirects to something else.\nI have considered that, but that would be a work around and I want to understand the root cause of the problem.  \n\n\u003e Problem is that the USB stick, if it is \"first booting device\" will be set by BIOS as \"first disk\" i.e. (hd0).\nThat would imply that the other USB stick would behave the same. Or do I miss something?   \n"
    },
    {
      "id": "72030",
      "timestamp": "2009-07-18T07:19:11+00:00",
      "author": "wim sturkenboom",
      "content": "OK, It\u0027s getting more confusing for me.  \n\nI have three machines, a noname desktop, an Acer AspireOne 110 and a Fujitsu laptop.  \nThe behavior on the Acer is the same as earlier posted for the desktop. However on the Fujitsu, the BIOS attempts to boot from both disks and fails on both.  \n\n```\n+----------+--------------------------------+---------------------+\n\n|\t\t  | store_n_go\t\t\t\t\t | cruzer\t\t\t  |\n\n+----------+--------------------------------+---------------------+\n\n| desktop  | invalid system disk\t\t\t| boots from HD\t   |\n\n| acer\t | no bootable partition in table | boots from HD\t   |\n\n| fujitsu  | invalid system disk\t\t\t| invalid system disk |\n\n+----------+--------------------------------+---------------------+\n```\n\nThere is one other thing that catches the eye and that is that the Acer displays a different message on the store_n_go. This message can be found in the MBR of the store_n_go .  \nThis implies (in my opinion) that  \n\n* the Acer is the only system that actually executes the code in the MBR.\n* the other systems do not execute the MBR and access other information on the memory stick to determine that it is bootable.\n\nAny thoughts?  \n\nI think that it\u0027s the best for me if I\u0027m going to try to \u0027reverse engineer\u0027 the POST of the desktop to try to understand what is going one. Not sure if I\u0027m ever able to do so due to time and due to the fact that my only reverse engineering experience dates from 15 years ago.   \n"
    },
    {
      "id": "72035",
      "timestamp": "2009-07-18T09:26:09+00:00",
      "author": "was_jaclaz",
      "content": "Welcome to the \"real\" world. :wink:  \n\nDifferent BIOS behave differently, and this is the cause of, say a good 2/3 of all booting problems. ![:lol:](http://reboot.pro/public/style_emoticons/default/laugh.png)  \n\nSee my as usual semi-random thoughts on the other thread:  \n[http://www.boot-land...?...ic\u003d8458\\\u0026hl\u003d](http://www.boot-land.net/forums/index.php?showtopic\u003d8458\u0026hl\u003d \"External link\")  \n\n\u003e \u003cbr /\u003e\n\u003e\n\u003e \u003e Problem is that the USB stick, if it is \"first booting device\" will be set by BIOS as \"first disk\" i.e. (hd0).\n\u003e That would imply that the other USB stick would behave the same. Or do I miss something?  \n\u003e\n\u003e \u003cbr /\u003e\n\u003e\n\u003cbr /\u003e\n\nThat would imply that if the non-bootable device is seen as (hd0), the internal hard disk will be seen as (hd1), something that may not \"go well\" with:  \n\n* DOS\n* paths/entries in BOOT.INI\n* hardcoded paths in grub/grub4dos or similar bootloaders\n* possibly BOOTMGR entries :wink:\n\n\u003cbr /\u003e\n\nIf this happens, the (eventual) workaround of a re-directing MBR should also re-map BIOS drives.  \nSome reference:  \n[http://www.boot-land...?...c\u003d2568\\\u0026st\u003d5](http://www.boot-land.net/forums/index.php?showtopic\u003d2568\u0026st\u003d5 \"External link\")  \n[http://www.boot-land...?...\u003d8330\\\u0026st\u003d24](http://www.boot-land.net/forums/index.php?showtopic\u003d8330\u0026st\u003d24 \"External link\")  \n\nMaybe a stupid suggestion, that you already tried, but what if you have a \"normal\" booting MBR on the stick but no Active (please read \"bootable\") partitions on the device? (i.e. ALL partition entries without the 80 Hex/128 Dec booting flag)  \n\nIn any case, being apparently more pragmatical than you are :wink:, I would try the mbldr workaround, and, should it work, keep it as an option if a \"proper\" solution cannot be found.  \n\n:wink:  \n\njaclaz   \n"
    }
  ]
}