{
  "id": "19677",
  "title": "Question: fastest way to install win7 and have a multi purpose vhd/ or pe",
  "isPinned": false,
  "isFirstTopic": false,
  "isLocked": false,
  "tags": [],
  "forumNotes": [
    {
      "id": "183091",
      "timestamp": "2014-03-30T19:30:04+00:00",
      "author": "mcwilli4",
      "content": "I want to make something to install windows a little faster but I\u0027m not sure what\u0027s the fastest way. I\u0027m walking into a setup that uses a litetouch mdt2013 on pe5 to install a vanilla windows 7x64 that then loads into audit mode and from the unattend it installs either office \\\u0026 av (if it\u0027s a desktop) or office \\\u0026 av \\\u0026 fde encryption if it\u0027s a laptop (usually I have about 30 different models to work on, so a sql server is up that has all the models in it to query and dism injects some drivers) and then from the end of the unattend, I djoin and setup the user accounts. Problem is, is that it takes around 45 minutes - an hour to load all of that. I\u0027d like to boot to a vhd (easier to modify or install things to versus pe, right?) then use qemu to load parted magic (for disk wiping), along with some quick diagnostic tools (seatools, prime95), use USMT on offline drives, and instead of using mdt ... maybe take snapshots of the base, inject extra drivers using dpinst.. then convert the vhd to wim and then dism it over to the internal drive. I\u0027d probably make HTA\u0027s of the complicated-ish code.Currently my base vhd is around 17gb, (I took out MSOCache, but didn\u0027t mess with the winsxs backup) .. I\u0027d like to use vhd_compact, but I keep getting diskpart errors. Anyway, any recommendations would help. I don\u0027t have a pxe setup or sccm. I feel like while the project sounds a little complicated once it\u0027s up it\u0027ll save me tons of time.\n\n"
    },
    {
      "id": "183092",
      "timestamp": "2014-03-30T20:46:46+00:00",
      "author": "steve6375",
      "content": "What you are doing sounds pretty close to the factory install method I developed for my old company. We installed over 200,000 PCs and notebooks a year.\n\nOn of the things about the install was that the base Windows 7 image was installed (using ImageX from the server) and then Application install folders were added + a script that would install them all. No network connection was required during the App and driver install phase once the system had booted and started Audit mode.\n\nWhat this meant was that if a customer had scrambled their hard disk, we could quickly re-stream a new one for the same serial number (using any one of 20 bare-bone systems we had available) which was never actually booted, and then send him the new hard disk. When he got the hard disk, it would begin the \u0027Setup\u0027 phase automatically and install all drivers and applications etc. that he had before. We did not need the identical hardware at the factory. This meant we could quickly re-stream drives and it was the customer who waited 1-2 hours for it to finish installing and not us!\n\nIf you need to join the domain though to register user accounts, this approach would not work for you - unless you script it to only run if the correct network domain can be seen on boot up\n\nWe used to use partition images, but the maintenance of them was a full time job.A simple change often meant we had to then change 30+ images, plus build and test them all again to check - a nightmare.\n\nHaving the systems \u0027build themselves\u0027 in the factory also meant that the customer would not find a problem if they re-installed the OS again themselves. Many large companies use disk imaging - whilst very fast, it does not necessarily mean that the customer won\u0027t hit a problem if he tries a DVD or network install himself.\n\nThinking ahead, you have Win8 and 9 to come. Any method you devise now will need to be replicated for these new OS\u0027s too. The advantage with a \u0027modular\u0027 install is that you only need to change the base OS (from Win7 to Win 8) and the \u0027application modules\u0027 should install themselves as they did in Win7.\n\nSo I would ask why installation+test time is so important to you, are these known good, new systems or are you building new systems from parts or what? If the process was automated, does it matter if the system is sitting on a shelf for 8 hours testing and installing itself?\n\nYou need to think about UEFI and GPT and even bitlocker or truecrypt compatibility too. Maybe not now, but maybe next year... Using Diskpart and ImageX/DISM in your process gives you a future proof path (as long as you stick with Windows).\n\nThere are issues using DISM/ImageX to replicate a fully installed Windows OS. MS do not recommend it and you need to watch it does not break symbolic links. DISM\\\\ImageX should only be used on a base sysprepped Windows image (i.e. OS+updates+SPacks+drivers but no apps).\n\nI have found that shortcuts like injecting drivers can lead to problems too - you can find certain hardware combinations don\u0027t work or the chip model/revision may change next week and the driver you inject is actually now using the wrong INF file.\n\nIt really depends on how many systems you are installing a day, why does it need to be quick, how important is it that the systems are fault free (testing 8GB of RAM takes hours alone), how many different hardware and software combinations you have and what will happen in the future.\n\nAny installation system you pick needs to be made as simple as possible (and I don\u0027t mean using complicated scripts, I mean using a simple scripting language and very small scripts for each stage!). If you are the only one that understands your system, then that is a real risk to your company and when you leave the company, your nice fancy system will probably be discarded as no one can understand it or get it to work!\n\nHTH\n\nSteve\n\n\u003cbr /\u003e\n\n"
    },
    {
      "id": "183094",
      "timestamp": "2014-03-30T22:03:05+00:00",
      "author": "mcwilli4",
      "content": "The speed issue is usually, uh oh, McAfee FDE started decrypting but you rebooted and ran chkdsk and 1/2 of sys32 is in found.001 as well as your user profiles. So for a break-fix sort of way I\u0027d like to be able to reimage faster. Currently I\u0027ve been killing uefi and sticking to mbr and installing Checkpoint FDE (no more McAfee!!), for Windows 7x64 .. I think I\u0027m stuck on it until 2020 (when extended support stops). I have maybe 1200 folks I have to support, with an additional err... 300 in satellite offices. I can djoin offline if I write it into the script, but usually the folks I\u0027m working with have a hard enough time finding the Start button on the screen..So I usually don\u0027t let them go through any OOBE process. If I did want them to.. I guess I could set it up in all the customsettings and oobesettings files. I\u0027m getting tempted to just inject a bunch of drivers into a vhd and try to use the MS Complete System Image restore to perform bare-metal restores.Not sure if that\u0027ll work, but I\u0027d just have two images to maintain.. that\u0027d be simpler, maybe..Haven\u0027t seen the driver issue yet... well not on Windows (aside from 4k drives, which is an easy fix). I have SUSE systems that won\u0027t detect my e1000e, but I think I\u0027ll be able to patch the initrd .. just don\u0027t have the time/ usually I don\u0027t have to worry about the linux systems.\n\nOh, I love rmprepusb. I use it to make freedos usb\u0027s for bios updates.I didn\u0027t know linux images on usb needed to be contiguous until I read about it on your site.\n\n"
    },
    {
      "id": "183095",
      "timestamp": "2014-03-30T22:12:45+00:00",
      "author": "steve6375",
      "content": "So do you build these systems with a recovery partition (like in [Tutorial 89](http://www.rmprepusb.com/tutorials/clonezilla \"External link\"))?\n\nIf you only have two images then imaging is def. the way to go as testing won\u0027t take do long after each change.\n\nWhat method you use is up to you.\n\n"
    }
  ]
}