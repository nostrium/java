{
  "id": "19363",
  "title": "efibootmgr not changing boot order permanently",
  "isPinned": false,
  "isFirstTopic": false,
  "isLocked": false,
  "tags": [],
  "forumNotes": [
    {
      "id": "180240",
      "timestamp": "2013-12-05T13:00:25+00:00",
      "author": "Holmes.Sherlock",
      "content": "So, here\u0027s the story...  \n\nAn HP laptop with Windows 7 and Ubuntu 12.04 (Precise Pangolin) dual-booted by GRUB2 is the central character. My friend handed me over saying that one fine morning \u0027she\u0027 found it to boot directly to Windows 7 without offering the usual OS selection (Windows 7, Ubuntu 12.04) menu. Also she was confident that she did absolutely \"nothing\" which could the reason be. With my limited knowledge, unless at least a single bit changes on HD, it is impossible. Promising to try to fix it up, I turned the laptop on. To my desperation, I found it to be one with stupid UEFI firmware. Pressing F9 leads to one firmware menu listing out EFI boot images. Ubuntu was present there. Selecting that one could boot Ubuntu as usual. From within Ubuntu, I tried using **fdisk -l** and was reported that fdisk was unable to read GPT partition table. So, I used GParted instead. There was one EFI partition of \\~400MB as usual. That partition gets automatically mounted under **/boot** . Examining the contents inside, I found nothing unusual. AFAICR, it should be a VFAT filesystem. Also first 446 bytes of MBR was zero-filled. I googled and found something \u0027magical\u0027 called [**efibootmgr**](http://linux.die.net/man/8/efibootmgr \"External link\"), the magic wand to play with EFI system. Now, the pain begins.  \n\n**efibootmgr -v** prints out the EFI boot images where both Windows 7 and Ubuntu were there alongwith other options, as expected.  \n**efibootmgr -n** switch is supposed to change the default boot loader for the next boot ONLY. I set BootNext field to Ubuntu and GRUB2 menu appeared in the next boot!  \n**efibootmgr -o X, Y** switch is supposed to change the default boot loader permanently. Delighted with the previous success, I changed the boot order Ubuntu follwed by Windows 7. **efibootmgr -v** confirmed that the changes took place as expected. But, to my surprise, laptop booted to Windows 7 directly on next boot!!!  \n\nThereafter, I did a lot of tinkering with the laptop with no success. I tried using bcdedit, EasyBCD etc. and even more which I am too lazy to type unless asked specifically. All the attempts were in vain. Suddenly, I got this [google hit](http://ubuntuforums.org/showthread.php?t\u003d2173267 \"External link\")  \n\u003e Issue #1 On HP laptop I cannot change the default boot OS in the BIOS, But when I used the F9 option at boot I can boot to ubuntu.\n\u003e\n\u003e Issue #2 When I use efibootmgr -o command as seen below to change the boot order. During boot the laptop revert back to the the old boot order before the change. interstingly the -n option works (i,e modify boot order for the next boot only). I would like to avoid placing efibootmgr -n ... in my rc.local.\n\n.\n\nAny idea how to make **efibootmgr** change the boot order permanently? Since the laptop was dual-booting earlier, so there must be \"something\" to bypass this quirk.\n\n\u003cbr /\u003e\n\n"
    },
    {
      "id": "180244",
      "timestamp": "2013-12-05T15:58:01+00:00",
      "author": "Wonko the Sane",
      "content": "From this thread (linked in one of the posts in the thread you posted):\n\n[http://h30434.www3.h...tu/td-p/2503733](http://h30434.www3.hp.com/t5/Notebook-Operating-Systems-and-Software/Changing-Boot-Order-on-Dual-Boot-Windows-8-and-Ubuntu/td-p/2503733 \"External link\")\n\n[http://h30434.www3.h...ht/true#M142143](http://h30434.www3.hp.com/t5/Notebook-Operating-Systems-and-Software/Changing-Boot-Order-on-Dual-Boot-Windows-8-and-Ubuntu/m-p/2808629/highlight/true#M142143 \"External link\")\n\nit seems like \\*somehow\\* that stupid\\^2 (that is stupid to the power of two, being EFI ***and*** HP) setup is \"hardcoded\" to load bootmgfw.efi.\n\nThe idea of renaming grubx64.efi to bootmgfw.efi is not that bad IMHO (at least to see if this is the issue).\n\n![:cheers:](http://reboot.pro/public/style_emoticons/default/cheers.gif)\n\nWonko\n\n"
    },
    {
      "id": "180245",
      "timestamp": "2013-12-05T16:27:36+00:00",
      "author": "cdob",
      "content": "\u003e I tried using bcdedit,\nLet\u0027s analyse first.  \n\nRun  \n\n```\nbcdedit /enum firmware\n```\n\nPost the output.  \n\nDoes firmware list displayorder {bootmgr} first?  \nThen try a work around [http://askubuntu.com...lt-boot-manager](http://askubuntu.com/questions/235567/windows-8-removes-grub-as-default-boot-manager \"External link\")  \n\n```\nbcdedit /set {bootmgr} path \\EFI\\ubuntu\\grubx64.efi\n```\n\n\u003cbr /\u003e\n\n"
    },
    {
      "id": "180247",
      "timestamp": "2013-12-05T18:03:29+00:00",
      "author": "Agent47",
      "content": "Hi\n\nThe great project**Boot Repair Disk** will auto fix both Legacy**GRUB** and**GRUB EFI**(even if \"Secureboot\" enabled ). You should give it a try.\n\n[http://sourceforge.n...ts/boot-repair/](http://sourceforge.net/projects/boot-repair/ \"External link\")\n\n"
    },
    {
      "id": "180248",
      "timestamp": "2013-12-05T18:36:23+00:00",
      "author": "Wonko the Sane",
      "content": "There is IMNSHO a word for describing a 520 Mb .iso which is meant to repair a boot setup of GRUB2, the word is \"bloat\", to which you can add as attributes \"huge, senseless\" ![:w00t:](http://reboot.pro/public/style_emoticons/default/w00t.gif) ![:ph34r:](http://reboot.pro/public/style_emoticons/default/scared9.gif)\n\nCannot say if it is \"great\", but surely it is \"large\".\n\nI wonder why exactly they have not made downloadable files for just the boot-repair tool, which should run alright under Ubuntu ![:dubbio:](http://reboot.pro/public/style_emoticons/default/dubbio.gif) and force people to download the big .iso. ![:unsure:](http://reboot.pro/public/style_emoticons/default/unsure.png)\n\n![:cheers:](http://reboot.pro/public/style_emoticons/default/cheers.gif)\n\nWonko\n\n"
    },
    {
      "id": "180264",
      "timestamp": "2013-12-06T04:19:27+00:00",
      "author": "Agent47",
      "content": "\u003e I wonder why exactly they have not made downloadable files for just the boot-repair tool, which should run alright under Ubuntu ![:dubbio:](http://reboot.pro/public/style_emoticons/default/dubbio.gif) and force people to download the big .iso. ![:unsure:](http://reboot.pro/public/style_emoticons/default/unsure.png)\n\nIndeed you can install it under Ubuntu.Here is how - [https://help.ubuntu....ity/Boot-Repair](https://help.ubuntu.com/community/Boot-Repair \"External link\")\n\nIt saved my ass a couple of times and certainly it is not a bloat. Perhaps, advanced users like you may not find any use of it but average users like me who don\u0027t have advanced Linux command line skills will surely call it ***great***.\n\n"
    },
    {
      "id": "180265",
      "timestamp": "2013-12-06T06:40:20+00:00",
      "author": "Holmes.Sherlock",
      "content": "Here\u0027s the output for a series of commands:.\n\nSpoiler  \n\u003e\n\u003e \\\u003e\\\u003e efibootmgr -v  \n\u003e BootNext: 0001  \n\u003e BootCurrent: 0001  \n\u003e Timeout: 0 seconds  \n\u003e BootOrder: 3001,3000,3002,3003,2001,2002,2003  \n\u003e Boot0000\\* Ubuntu HD(2,c8800,82000,7de35876-07ea-42a1-805b-649ec94760a4)File(\\\\EFI\\\\ubuntu\\\\grubx64.efi)RC  \n\u003e Boot0001\\* Windows Boot Manager HD(2,c8800,82000,7de35876-07ea-42a1-805b-649ec94760a4)File(\\\\EFI\\\\Microsoft\\\\Boot\\\\bootmgfw.efi)RC  \n\u003e Boot0002\\* Ubuntu HD(2,c8800,82000,7de35876-07ea-42a1-805b-649ec94760a4)File(\\\\EFI\\\\ubuntu\\\\grubx64.efi)RC  \n\u003e Boot0003\\* Ubuntu HD(2,c8800,82000,7de35876-07ea-42a1-805b-649ec94760a4)File(\\\\EFI\\\\ubuntu\\\\grubx64.efi)RC  \n\u003e Boot2001\\* USB Drive (UEFI) RC  \n\u003e Boot2002\\* Internal CD/DVD ROM Drive (UEFI) RC  \n\u003e Boot3000\\* Internal Hard Disk RC  \n\u003e Boot3001\\* Internal Hard Disk RC  \n\u003e Boot3002\\* Internal Hard Disk RC  \n\u003e Boot3003\\* Internal Hard Disk RC  \n\u003e --------------------------------------------------------------------------------------------------------------------  \n\u003e \\\u003e\\\u003e efibootmgr -n 0  \n\u003e BootNext: 0000  \n\u003e BootCurrent: 0001  \n\u003e Timeout: 0 seconds  \n\u003e BootOrder: 3001,3000,3002,3003,2001,2002,2003  \n\u003e Boot0000\\* Ubuntu  \n\u003e Boot0001\\* Windows Boot Manager  \n\u003e Boot0002\\* Ubuntu  \n\u003e Boot0003\\* Ubuntu  \n\u003e Boot2001\\* USB Drive (UEFI)  \n\u003e Boot2002\\* Internal CD/DVD ROM Drive (UEFI)  \n\u003e Boot3000\\* Internal Hard Disk  \n\u003e Boot3001\\* Internal Hard Disk  \n\u003e Boot3002\\* Internal Hard Disk  \n\u003e Boot3003\\* Internal Hard Disk  \n\u003e --------------------------------------------------------------------------------------------------------------------  \n\u003e \\\u003e\\\u003e efibootmgr -v  \n\u003e BootNext: 0000  \n\u003e BootCurrent: 0001  \n\u003e Timeout: 0 seconds  \n\u003e BootOrder: 3001,3000,3002,3003,2001,2002,2003  \n\u003e Boot0000\\* Ubuntu HD(2,c8800,82000,7de35876-07ea-42a1-805b-649ec94760a4)File(\\\\EFI\\\\ubuntu\\\\grubx64.efi)RC  \n\u003e Boot0001\\* Windows Boot Manager HD(2,c8800,82000,7de35876-07ea-42a1-805b-649ec94760a4)File(\\\\EFI\\\\Microsoft\\\\Boot\\\\bootmgfw.efi)RC  \n\u003e Boot0002\\* Ubuntu HD(2,c8800,82000,7de35876-07ea-42a1-805b-649ec94760a4)File(\\\\EFI\\\\ubuntu\\\\grubx64.efi)RC  \n\u003e Boot0003\\* Ubuntu HD(2,c8800,82000,7de35876-07ea-42a1-805b-649ec94760a4)File(\\\\EFI\\\\ubuntu\\\\grubx64.efi)RC  \n\u003e Boot2001\\* USB Drive (UEFI) RC  \n\u003e Boot2002\\* Internal CD/DVD ROM Drive (UEFI) RC  \n\u003e Boot3000\\* Internal Hard Disk RC  \n\u003e Boot3001\\* Internal Hard Disk RC  \n\u003e Boot3002\\* Internal Hard Disk RC  \n\u003e Boot3003\\* Internal Hard Disk RC  \n\u003e --------------------------------------------------------------------------------------------------------------------  \n\u003e \\\u003e\\\u003e efibootmgr -o 0,1  \n\u003e BootNext: 0000  \n\u003e BootCurrent: 0001  \n\u003e Timeout: 0 seconds  \n\u003e BootOrder: 0000,0001  \n\u003e Boot0000\\* Ubuntu  \n\u003e Boot0001\\* Windows Boot Manager  \n\u003e Boot0002\\* Ubuntu  \n\u003e Boot0003\\* Ubuntu  \n\u003e Boot2001\\* USB Drive (UEFI)  \n\u003e Boot2002\\* Internal CD/DVD ROM Drive (UEFI)  \n\u003e Boot3000\\* Internal Hard Disk  \n\u003e Boot3001\\* Internal Hard Disk  \n\u003e Boot3002\\* Internal Hard Disk  \n\u003e Boot3003\\* Internal Hard Disk  \n\u003e --------------------------------------------------------------------------------------------------------------------  \n\u003e \\\u003e\\\u003e efibootmgr -v  \n\u003e BootNext: 0000  \n\u003e BootCurrent: 0001  \n\u003e Timeout: 0 seconds  \n\u003e BootOrder: 0000,0001  \n\u003e Boot0000\\* Ubuntu HD(2,c8800,82000,7de35876-07ea-42a1-805b-649ec94760a4)File(\\\\EFI\\\\ubuntu\\\\grubx64.efi)RC  \n\u003e Boot0001\\* Windows Boot Manager HD(2,c8800,82000,7de35876-07ea-42a1-805b-649ec94760a4)File(\\\\EFI\\\\Microsoft\\\\Boot\\\\bootmgfw.efi)RC  \n\u003e Boot0002\\* Ubuntu HD(2,c8800,82000,7de35876-07ea-42a1-805b-649ec94760a4)File(\\\\EFI\\\\ubuntu\\\\grubx64.efi)RC  \n\u003e Boot0003\\* Ubuntu HD(2,c8800,82000,7de35876-07ea-42a1-805b-649ec94760a4)File(\\\\EFI\\\\ubuntu\\\\grubx64.efi)RC  \n\u003e Boot2001\\* USB Drive (UEFI) RC  \n\u003e Boot2002\\* Internal CD/DVD ROM Drive (UEFI) RC  \n\u003e Boot3000\\* Internal Hard Disk RC  \n\u003e Boot3001\\* Internal Hard Disk RC  \n\u003e Boot3002\\* Internal Hard Disk RC  \n\u003e Boot3003\\* Internal Hard Disk RC\n\nAlso, what surprising is, every time I boot into Windows, one more entry for **Ubuntu** gets added. Already you can see three such entries are there which I marked **RED**. Below is the F9 menu corresponding to **efibootmgr -v** command\u0027s output.\n\nSpoiler  \n![63ml.jpg](http://img577.imageshack.us/img577/7171/63ml.jpg)\n\n"
    },
    {
      "id": "180266",
      "timestamp": "2013-12-06T06:45:35+00:00",
      "author": "Holmes.Sherlock",
      "content": "\u003e it seems like \\*somehow\\* that stupid\\^2 (that is stupid to the power of two, being EFI ***and*** HP) setup is \"hardcoded\" to load bootmgfw.efi.\n\u003e\n\u003e The idea of renaming grubx64.efi to bootmgfw.efi is not that bad IMHO (at least to see if this is the issue).\n\nIt works. I found this solution even before posting. But I wonder whether this laptop, with its earlier \\*working\\* configuration, had a copy of grubx64 .efi renamed as bootmgfw.efi which, got somehow got replaced by Windows 7 boot loader transparently.\n\nNow, the problem is I can\u0027t boot into Windows from F9 menu as it points to renamed bootmgfw.efi internally.\n\n"
    },
    {
      "id": "180275",
      "timestamp": "2013-12-06T11:36:17+00:00",
      "author": "Wonko the Sane",
      "content": "\u003e Indeed you can install it under Ubuntu.Here is how - [https://help.ubuntu....ity/Boot-Repair](https://help.ubuntu.com/community/Boot-Repair \"External link\")\n\nWhich is very good :smile:, still I don\u0027t understand why it is not by itself on the Sourceforge page and \"common\" users are \"forced\" to download (senselessly) a 520 Mb .iso (the bloat is referred to the .iso not to the tool in itself).\n\nIMNSHO if this is a \"generic\" tool, it is good to have it easily installable in \"generic\" Linuxes, if it is a \"self-standing recovery tool\", it should be part of a VERY MINIMAL .iso.\n\n@Holmes.Sherlock\n\nSure, the point is whether you are doing archeological ![:w00t:](http://reboot.pro/public/style_emoticons/default/w00t.gif) or forensic research or if the goal is to have the stupid HP working ***now*** (no matter how it worked before and what exactly changed this behaviour).\n\nIf the former, that\u0027s good. :smile:\n\nIs it possible that one of the automagic updates of WIndows 7 have replaced bootmgfw.efi?\n\nIs it possible that when the Ubuntu was originally installed the same workaround has been used (either manually or by the Ubuntu setup)?\n\nCan\u0027 tyou ask your friend what she remembers of the original Ubuntu install?\n\nWhat happens if you image that PC, and then re-install Ubuntu?\n\n![:cheers:](http://reboot.pro/public/style_emoticons/default/cheers.gif)\n\nWonko\n\n"
    },
    {
      "id": "180289",
      "timestamp": "2013-12-07T02:29:00+00:00",
      "author": "Holmes.Sherlock",
      "content": "\u003e Sure, the point is whether you are doing archeological ![:w00t:](http://reboot.pro/public/style_emoticons/default/w00t.gif) or forensic research...\n\n\u003cbr /\u003e\n\nActually it\u0027s like that... ![:dubbio:](http://reboot.pro/public/style_emoticons/default/dubbio.gif)  \n\u003e Can\u0027 t you ask your friend what she remembers of the original Ubuntu install?\n\n\u003e Girl- Which computer do you have?  \n\u003e\n\u003e Boy- I have a computer with Intel core i7 processor at 3.3 ghz, Windows 7, 64 bit, 8GB RAM \\\u0026 Nvidia GTX 560 graphics card.  \n\u003e\n\u003e Boy- Which computer do you have???  \n\u003e\n\u003e Girl- A PINK ONE !!\n\n\u003e What happens if you image that PC, and then re-install Ubuntu?\n\n\u003cbr /\u003e\n\nI don\u0027t have HD to store \\~500 GB of image data.\n\nBut, I found something interesting once again. When I am trying to boot Windows from GRUB2 menu (Not from F9 menu offered by the firmware), GRUB2 is not being able to find the **drivemap** command and the boot fails. Exactly the same problem as described [here](http://askubuntu.com/questions/265962/ubuntu-windows-8-pro-dual-boot-grub-cant-find-command-drive-map \"External link\").\n\n"
    },
    {
      "id": "180297",
      "timestamp": "2013-12-07T12:28:56+00:00",
      "author": "Holmes.Sherlock",
      "content": "\u003e Let\u0027s analyse first.  \n\u003e\n\u003e Run\n\u003e\n\u003e ```\n\u003e bcdedit /enum firmware\n\u003e ```\n\u003e\n\u003e Post the output.  \n\u003e\n\u003e Does firmware list displayorder {bootmgr} first?\n\nHere\u0027s the output.\n\nSpoiler  \nFirmware Boot Manager  \n---------------------  \nidentifier {fwbootmgr}  \ndisplayorder {bootmgr}  \n{087f3d25-5972-11e3-beb1-806e6f6e6963}  \n{3bcdfe9b-598c-11e3-bebb-806e6f6e6963}  \n{2f9b67c3-5995-11e3-bec4-bc8556cd5fc6}  \n{b77ea3c9-5e57-11e3-bec5-806e6f6e6963}  \n{254abf36-5f3a-11e3-bec6-806e6f6e6963}  \n{d12c4d0f-5112-11e2-9de2-e499e81e691d}  \n{d12c4d10-5112-11e2-9de2-e499e81e691d}  \ntimeout 0  \nWindows Boot Manager  \n--------------------  \nidentifier {bootmgr}  \ndevice partition\u003d\\\\Device\\\\HarddiskVolume2  \npath \\\\EFI\\\\ubuntu\\\\grubx64.efi  \ndescription Windows Boot Manager  \nlocale en-US  \ninherit {globalsettings}  \nintegrityservices Enable  \ndefault {bootmgr}  \nresumeobject {d12c4d15-5112-11e2-9de2-e499e81e691d}  \ndisplayorder {current}  \ntoolsdisplayorder {memdiag}  \ntimeout 30  \ndisplaybootmenu No  \nFirmware Application (101fffff)  \n-------------------------------  \nidentifier {087f3d24-5972-11e3-beb1-806e6f6e6963}  \ndevice partition\u003d\\\\Device\\\\HarddiskVolume2  \npath \\\\EFI\\\\Microsoft\\\\Boot\\\\bootmgfw.efi  \ndescription Windows Boot Manager  \nFirmware Application (101fffff)  \n-------------------------------  \nidentifier {087f3d25-5972-11e3-beb1-806e6f6e6963}  \ndescription Internal Hard Disk  \nFirmware Application (101fffff)  \n-------------------------------  \nidentifier {254abf35-5f3a-11e3-bec6-806e6f6e6963}  \ndevice partition\u003d\\\\Device\\\\HarddiskVolume2  \npath \\\\EFI\\\\ubuntu\\\\grubx64.efi  \ndescription Ubuntu  \nFirmware Application (101fffff)  \n-------------------------------  \nidentifier {254abf36-5f3a-11e3-bec6-806e6f6e6963}  \ndescription Internal Hard Disk  \nFirmware Application (101fffff)  \n-------------------------------  \nidentifier {2f9b67c2-5995-11e3-bec4-bc8556cd5fc6}  \ndevice partition\u003d\\\\Device\\\\HarddiskVolume2  \npath \\\\EFI\\\\ubuntu\\\\grubx64.efi  \ndescription Ubuntu  \nFirmware Application (101fffff)  \n-------------------------------  \nidentifier {2f9b67c3-5995-11e3-bec4-bc8556cd5fc6}  \ndescription Internal Hard Disk  \nFirmware Application (101fffff)  \n-------------------------------  \nidentifier {3bcdfe9a-598c-11e3-bebb-806e6f6e6963}  \ndevice partition\u003d\\\\Device\\\\HarddiskVolume2  \npath \\\\EFI\\\\ubuntu\\\\grubx64.efi  \ndescription Ubuntu  \nFirmware Application (101fffff)  \n-------------------------------  \nidentifier {3bcdfe9b-598c-11e3-bebb-806e6f6e6963}  \ndescription Internal Hard Disk  \nFirmware Application (101fffff)  \n-------------------------------  \nidentifier {b77ea3c8-5e57-11e3-bec5-806e6f6e6963}  \ndevice partition\u003d\\\\Device\\\\HarddiskVolume2  \npath \\\\EFI\\\\ubuntu\\\\grubx64.efi  \ndescription Ubuntu  \nFirmware Application (101fffff)  \n-------------------------------  \nidentifier {b77ea3c9-5e57-11e3-bec5-806e6f6e6963}  \ndescription Internal Hard Disk  \nFirmware Application (101fffff)  \n-------------------------------  \nidentifier {d12c4d0f-5112-11e2-9de2-e499e81e691d}  \ndescription USB Drive (UEFI)  \nFirmware Application (101fffff)  \n-------------------------------  \nidentifier {d12c4d10-5112-11e2-9de2-e499e81e691d}  \ndescription Internal CD/DVD ROM Drive (UEFI)\n\n"
    },
    {
      "id": "180298",
      "timestamp": "2013-12-07T14:17:56+00:00",
      "author": "cdob",
      "content": "\u003e Here\u0027s the output.\nIt\u0027s strange currently.  \n\nSome cleanup to delete double entries  \n\n```\nBCDedit.exe /delete {254abf35-5f3a-11e3-bec6-806e6f6e6963} /cleanup /f\nBCDedit.exe /delete {254abf36-5f3a-11e3-bec6-806e6f6e6963} /cleanup /f\nBCDedit.exe /delete {2f9b67c2-5995-11e3-bec4-bc8556cd5fc6} /cleanup /f\nBCDedit.exe /delete {2f9b67c3-5995-11e3-bec4-bc8556cd5fc6} /cleanup /f\nBCDedit.exe /delete {3bcdfe9a-598c-11e3-bebb-806e6f6e6963} /cleanup /f\nBCDedit.exe /delete {3bcdfe9b-598c-11e3-bebb-806e6f6e6963} /cleanup /f\nBCDedit.exe /delete {b77ea3c8-5e57-11e3-bec5-806e6f6e6963} /cleanup /f\nBCDedit.exe /delete {b77ea3c9-5e57-11e3-bec5-806e6f6e6963} /cleanup /f\n```\n\n\u003cbr /\u003e\n\nWhich files matches the filenames  \n\\\\EFI\\\\Microsoft\\\\Boot\\\\bootmgfw.efi  \n\\\\EFI\\\\ubuntu\\\\grubx64.efi  \nThe original ones, or renamed ones?  \n\n\u003e When I am trying to boot Windows from GRUB2 menu (Not from F9 menu offered by the firmware), GRUB2 is not being able to find the **drivemap** command and the boot fails.\nWhich grub.cfg do you use?  \n\nAt evelated permissions  \n\n```\nmountvol.exe S: /s\nstart notepad.exe S:\\EFI\\ubuntu\\grub.cfg\n```\n\n\u003cbr /\u003e\n\nGrub 2 and Windows loader are at the same partition, hence try a simple entry  \n\n```\nmenuentry \"Windows\" {\n  chainloader /EFI/Microsoft/Boot/bootmgfw.efi\n}\n```\n\n\u003cbr /\u003e\n\n"
    },
    {
      "id": "180306",
      "timestamp": "2013-12-08T02:08:33+00:00",
      "author": "Holmes.Sherlock",
      "content": "\u003e Is it possible that one of the automagic updates of WIndows 7 have replaced bootmgfw.efi?\n\u003e\n\u003e Is it possible that when the Ubuntu was originally installed the same workaround has been used (either manually or by the Ubuntu setup)?\n\nProbably you are right. There are plenty of threads over Internet saying that Ubuntu overwriting Microsoft boot files to workaround bugs in some UEFI implementations. Here is the output of **find /boot.efi -name \\*.efi -ls \\| sort --key\u003d7,7**. Can you find something interesting?\n\nSpoiler  \n252 120 -rwxr-xr-x 1 root root 119296 Nov 30 13:26 /boot/efi/EFI/Microsoft/Boot/bootmgfwU.efi  \n296 120 -rwxr-xr-x 1 root root 119296 Jul 20 10:21 /boot/efi/EFI/Microsoft/Boot/bootx64.efi  \n40 120 -rwxr-xr-x 1 root root 119296 Jul 20 10:21 /boot/efi/EFI/Boot/bootx64.efi  \n46 120 -rwxr-xr-x 1 root root 119296 Nov 30 13:26 /boot/efi/EFI/ubuntu/grubx64.efi  \n1115 1236 -rwxr-xr-x 1 root root 1263856 Jul 25 2012 /boot/efi/EFI/HP/EFI/Microsoft/Boot/memtest.efi  \n143 1236 -rwxr-xr-x 1 root root 1263856 Jul 25 2012 /boot/efi/EFI/HP/boot/memtest.efi  \n300 1236 -rwxr-xr-x 1 root root 1263856 Jul 26 2012 /boot/efi/EFI/Microsoft/Boot/memtest.efi  \n299 1320 -rwxr-xr-x 1 root root 1350888 Sep 20 2012 /boot/efi/EFI/Microsoft/Boot/bootmgr.efi  \n142 1320 -rwxr-xr-x 1 root root 1350896 Jul 25 2012 /boot/efi/EFI/HP/boot/bootmgr.efi  \n298 1324 -rwxr-xr-x 1 root root 1354472 Sep 20 2012 /boot/efi/EFI/Microsoft/Boot/bootmgfw.efi  \n1078 1324 -rwxr-xr-x 1 root root 1354480 Jul 25 2012 /boot/efi/EFI/HP/EFI/Boot/bootx64.efi  \n139 1324 -rwxr-xr-x 1 root root 1354480 Jul 25 2012 /boot/efi/EFI/HP/boot/bootmgfw.efi  \n294 1324 -rwxr-xr-x 1 root root 1354480 Jul 25 2012 /boot/efi/EFI/Microsoft/Boot/bkpbootmgfw.efi  \n39 1324 -rwxr-xr-x 1 root root 1354480 Jul 25 2012 /boot/efi/EFI/Boot/bkpbootx64.efi  \n45 1328 -rwxr-xr-x 1 root root 1357480 Jul 20 21:10 /boot/efi/EFI/ubuntu/shimx64.efi  \n192 2316 -rwxr-xr-x 1 root root 2370688 Jul 5 2012 /boot/efi/EFI/HP/SystemDiags/SystemDiags32.efi  \n186 2472 -rwxr-xr-x 1 root root 2527424 Jul 5 2012 /boot/efi/EFI/HP/SystemDiags/SystemDiags.efi  \n170 256 -rwxr-xr-x 1 root root 259072 Feb 23 2012 /boot/efi/EFI/HP/BIOSUpdate/CryptRSA32.efi  \n196 256 -rwxr-xr-x 1 root root 259072 Feb 23 2012 /boot/efi/EFI/HP/SystemDiags/CryptRSA32.efi  \n165 436 -rwxr-xr-x 1 root root 443904 Feb 23 2012 /boot/efi/EFI/HP/BIOSUpdate/CryptRSA.efi  \n190 436 -rwxr-xr-x 1 root root 443904 Feb 23 2012 /boot/efi/EFI/HP/SystemDiags/CryptRSA.efi  \n166 812 -rwxr-xr-x 1 root root 829888 Apr 26 2012 /boot/efi/EFI/HP/BIOSUpdate/HpBiosUpdate32.efi  \n161 832 -rwxr-xr-x 1 root root 848512 Apr 26 2012 /boot/efi/EFI/HP/BIOSUpdate/HpBiosUpdate.efi\n\nbootmgfwU.efi is renamed grubx64.efi.\n\n"
    },
    {
      "id": "180307",
      "timestamp": "2013-12-08T05:17:23+00:00",
      "author": "Holmes.Sherlock",
      "content": "\u003e It\u0027s strange currently.  \n\u003e\n\u003e Some cleanup to delete double entries\n\u003e\n\u003e ```\n\u003e BCDedit.exe /delete {254abf35-5f3a-11e3-bec6-806e6f6e6963} /cleanup /f\n\u003e BCDedit.exe /delete {254abf36-5f3a-11e3-bec6-806e6f6e6963} /cleanup /f\n\u003e BCDedit.exe /delete {2f9b67c2-5995-11e3-bec4-bc8556cd5fc6} /cleanup /f\n\u003e BCDedit.exe /delete {2f9b67c3-5995-11e3-bec4-bc8556cd5fc6} /cleanup /f\n\u003e BCDedit.exe /delete {3bcdfe9a-598c-11e3-bebb-806e6f6e6963} /cleanup /f\n\u003e BCDedit.exe /delete {3bcdfe9b-598c-11e3-bebb-806e6f6e6963} /cleanup /f\n\u003e BCDedit.exe /delete {b77ea3c8-5e57-11e3-bec5-806e6f6e6963} /cleanup /f\n\u003e BCDedit.exe /delete {b77ea3c9-5e57-11e3-bec5-806e6f6e6963} /cleanup /f\n\u003e ```\n\n\u003cbr /\u003e\n\nActually it corresponds to the problem as stated [here](http://reboot.pro/topic/19363-efibootmgr-not-changing-boot-order-permanently/#entry180265 \"\"). Already there are 16 such entries got added. Is there any means to rebuild BCD?**bootrec /rebuildbcd** does not work from elevated command prompt.  \n\u003e Also, what surprising is, every time I boot into Windows, one more entry for Ubuntu gets added. Already you can see three such entries are there which I marked RED. Below is the F9 menu corresponding to efibootmgr -v command\u0027s output.\n\n\u003e Which files matches the filenames  \n\u003e \\\\EFI\\\\Microsoft\\\\Boot\\\\bootmgfw.efi  \n\u003e \\\\EFI\\\\ubuntu\\\\grubx64.efi  \n\u003e The original ones, or renamed ones?\n\n\u003cbr /\u003e\n\nTo solve the problem, I did as follows:\n\n* Renamed \\\\EFI\\\\Microsoft\\\\Boot\\\\bootmgfw.efi to \\\\EFI\\\\Microsoft\\\\Boot\\\\bootmgfw_old.efi\n* Copied \\\\EFI\\\\ubuntu\\\\grubx64. as \\\\EFI\\\\Microsoft\\\\Boot\\\\bootmgfw.efi\n\nThis is what my ESP (EFI System Partition) contains at present.  \n\u003e Which grub.cfg do you use?  \n\u003e\n\u003e At evelated permissions\n\u003e\n\u003e ```\n\u003e mountvol.exe S: /s\n\u003e start notepad.exe S:\\EFI\\ubuntu\\grub.cfg\n\u003e ```\n\n\u003cbr /\u003e\n\n**\\\\EFI\\\\ubuntu\\\\grub.cfg** contains the following:\n\n```\nsearch.fs_uuid c629b400-fdfe-4c3e-bd68-81bbb2a917c0 root \nset prefix\u003d($root)/boot/grub\nconfigfile $prefix/grub.cfg\n```\n\nAlso let me extract out relevant entries from **/boot/grub/grub.cfg** after running **update-grub** :  \n\u003e ### BEGIN /etc/grub.d/25_custom ###  \n\u003e **menuentry \"Windows UEFI bkpbootmgfw.efi\" {**  \n\u003e **search --fs-uuid --no-floppy --set\u003droot D692-2CA0**  \n\u003e **chainloader (${root})/EFI/Microsoft/Boot/bkpbootmgfw.efi**  \n\u003e **}**  \n\u003e\n\u003e **menuentry \"Windows Boot UEFI loader\" {**  \n\u003e **search --fs-uuid --no-floppy --set\u003droot D692-2CA0**  \n\u003e **chainloader (${root})/EFI/Boot/bkpbootx64.efi**  \n\u003e **}**  \n\u003e\n\u003e **menuentry \"Windows - (hd0,gpt2)\" {**   \n\u003e **chainloader (hd0,gpt2)/efi/Microsoft/Boot/bkpbootmgfw.efi**  \n\u003e **}**  \n\u003e ### END /etc/grub.d/25_custom ###  \n\u003e\n\u003e ### BEGIN /etc/grub.d/30_os-prober ###  \n\u003e **menuentry \"Windows 8 (loader) (on /dev/sda4)\" --class windows --class os {**   \n\u003e **insmod part_gpt**   \n\u003e **insmod ntfs**   \n\u003e **set root\u003d\u0027(hd0,gpt4)\u0027**   \n\u003e **search --no-floppy --fs-uuid --set\u003droot 38707C48707C0F3E**   \n\u003e **drivemap -s (hd0) ${root}**   \n\u003e **chainloader +1**   \n\u003e **}**   \n\u003e ### END /etc/grub.d/30_os-prober ###\n\n\u003cbr /\u003e\n\n**GREEN** entries are added by update-grub boot fine.  \n**PURPLE** entry is the one which I added myself and does NOT *boot* . It complains about not being able to find **\\\\EFI\\\\Microsoft\\\\Boot\\\\BCD** with error# **0xc0000001** . Why?  \n**RED** entry is added by update-grub and does *NOT* boot. Most probably it\u0027s because of [Bug#1024383](https://bugs.launchpad.net/ubuntu/+source/grub2/+bug/1024383/comments/7 \"External link\").  \n\nNow some additional information which can be helpful in finding reason behind error# **0xc000001** :  \n\nOutput of **ls -l /dev/disk/by-uuid/**   \nSpoiler  \n\ntotal 0  \nlrwxrwxrwx 1 root root 10 Dec 8 09:18 38707C48707C0F3E -\\\u003e ../../sda4  \nlrwxrwxrwx 1 root root 10 Dec 8 09:18 403A688C3A6880B0 -\\\u003e ../../sda6  \nlrwxrwxrwx 1 root root 10 Dec 8 09:25 5A33-E6FA -\\\u003e ../../sdb1  \nlrwxrwxrwx 1 root root 10 Dec 8 09:18 5fa36f1c-d6ec-4f5a-aedb-98e9f5caa863 -\\\u003e ../../sda7  \nlrwxrwxrwx 1 root root 10 Dec 8 09:25 78A1-28A0 -\\\u003e ../../sdb2  \nlrwxrwxrwx 1 root root 10 Dec 8 09:18 AC0A159E0A15669C -\\\u003e ../../sda5  \nlrwxrwxrwx 1 root root 10 Dec 8 09:18 c629b400-fdfe-4c3e-bd68-81bbb2a917c0 -\\\u003e ../../sda8  \nlrwxrwxrwx 1 root root 10 Dec 8 09:18 D692-2CA0 -\\\u003e ../../sda2  \nlrwxrwxrwx 1 root root 10 Dec 8 09:18 EE2E6A562E6A183B -\\\u003e ../../sda1  \n\n\u003cbr /\u003e\n\nOutput of **blkid**   \nSpoiler  \n\n/dev/sda1: LABEL\u003d\"WINRE\" UUID\u003d\"EE2E6A562E6A183B\" TYPE\u003d\"ntfs\"   \n/dev/sda2: UUID\u003d\"D692-2CA0\" TYPE\u003d\"vfat\"   \n/dev/sda4: UUID\u003d\"38707C48707C0F3E\" TYPE\u003d\"ntfs\"   \n/dev/sda5: LABEL\u003d\"Data\" UUID\u003d\"AC0A159E0A15669C\" TYPE\u003d\"ntfs\"   \n/dev/sda6: LABEL\u003d\"RECOVERY\" UUID\u003d\"403A688C3A6880B0\" TYPE\u003d\"ntfs\"   \n/dev/sda7: UUID\u003d\"5fa36f1c-d6ec-4f5a-aedb-98e9f5caa863\" TYPE\u003d\"swap\"   \n/dev/sda8: UUID\u003d\"c629b400-fdfe-4c3e-bd68-81bbb2a917c0\" TYPE\u003d\"ext4\"   \n/dev/sdb1: LABEL\u003d\"DIPANJAN\" UUID\u003d\"5A33-E6FA\" TYPE\u003d\"vfat\"   \n/dev/sdb2: LABEL\u003d\"RECOVERY\" UUID\u003d\"78A1-28A0\" TYPE\u003d\"vfat  \n\n\u003cbr /\u003e\n\nOutput of **parted --\\\u003e print partition**   \nSpoiler  \n\nGNU Parted 2.3  \nUsing /dev/sda  \nWelcome to GNU Parted! Type \u0027help\u0027 to view a list of commands.  \n(parted) print partitions  \nModel: ATA ST500LT012-9WS14 (scsi)  \nDisk /dev/sda: 500GB  \nSector size (logical/physical): 512B/4096B  \nPartition Table: gpt  \n\nNumber Start End Size File system Name Flags  \n1 1049kB 420MB 419MB ntfs Basic data partition hidden, diag  \n2 420MB 693MB 273MB fat32 EFI system partition boot  \n3 693MB 827MB 134MB Microsoft reserved partition msftres  \n4 827MB 176GB 175GB ntfs Basic data partition  \n5 176GB 388GB 212GB ntfs Basic data partition  \n7 388GB 394GB 5887MB linux-swap(v1)  \n8 394GB 472GB 78.0GB ext4  \n6 472GB 500GB 28.4GB ntfs Basic data partition hidden  \n\n\u003cbr /\u003e\n\nHere\u0027s the graphical drive geometry:  \n\n![epql.png](http://img801.imageshack.us/img801/290/epql.png)  \n\n\u003cbr /\u003e\n\nAlso there is **bootx64.efi.grb** file (zero bytes) lying in ESP.\n\n"
    },
    {
      "id": "180331",
      "timestamp": "2013-12-09T09:18:44+00:00",
      "author": "Icecube",
      "content": "\u003e **PURPLE** entry is the one which I added myself and does NOT *boot* . It complains about not being able to find **\\\\EFI\\\\Microsoft\\\\Boot\\\\BCD** with error# **0xc0000001**. Why?\n\u003e\nThe **0xc000001** error is very likely caused by the fact that not the right boot drive and partition number is passed to the loader.\n\nTry this:\n\n```\nmenuentry \"Windows - (search root)\" {\nsearch --fs-uuid --no-floppy --set\u003droot D692-2CA0\nchainloader (${root})/efi/Microsoft/Boot/bkpbootmgfw.efi\n}\n\nmenuentry \"Windows - (hd0,gpt2)\" {\nset root\u003d\u0027(hd0,gpt2)\u0027\nchainloader (hd0,gpt2)/efi/Microsoft/Boot/bkpbootmgfw.efi\n}\n```\n\n\u003cbr /\u003e\n\n"
    },
    {
      "id": "180332",
      "timestamp": "2013-12-09T09:22:04+00:00",
      "author": "Holmes.Sherlock",
      "content": "\u003e The **0xc000001** error is very likely caused by the fact that not the right boot drive and partition number is passed to the loader.\n\nI understand, that\u0027s why **GREEN** entries work. But my ESP is **(hd0,gpt2)** partition. That\u0027s why I surprise that why hard-coding the same doesn\u0027t work.\n\n"
    },
    {
      "id": "180333",
      "timestamp": "2013-12-09T09:47:50+00:00",
      "author": "Icecube",
      "content": "\u003e I understand, that\u0027s why **GREEN** entries work. But my ESP is **(hd0,gpt2)** partition. That\u0027s why I surprise that why hard-coding the same doesn\u0027t work.\n\nYou didn\u0027t set the root with:\n\n```\nset root\u003d\u0027(hd0,gpt2)\u0027\n```\n\n\u003cbr /\u003e\n\n"
    },
    {
      "id": "180334",
      "timestamp": "2013-12-09T09:50:12+00:00",
      "author": "Holmes.Sherlock",
      "content": "\u003e You didn\u0027t set the root with:\n\u003e\n\u003e ```\n\u003e set root\u003d\u0027(hd0,gpt2)\u0027\n\u003e ```\n\nI have set root in the entry\n\n\u003e menuentry \"Windows - (hd0,gpt2)\" {  \n\u003e **set root\u003d\u0027(hd0,gpt2)\u0027**  \n\u003e chainloader (hd0,gpt2)/efi/Microsoft/Boot/bkpbootmgfw.efi  \n\u003e }\n\n"
    },
    {
      "id": "180354",
      "timestamp": "2013-12-09T17:00:45+00:00",
      "author": "cdob",
      "content": "What a mess  \n[http://ubuntuforums....d.php?t\u003d2147295](http://ubuntuforums.org/showthread.php?t\u003d2147295 \"External link\")  \n\nAnd: What Does Boot-Repair Get Wrong?[http://www.rodsbooks...bootrepair.html](http://www.rodsbooks.com/efi-bootloaders/bootrepair.html \"External link\")  \n\u003e Although it often works, its user interface is intentionally very simple, and it therefore often does more than is necessary.  \n\u003e\n\u003e The main problem with this approach is that it\u0027s blind. Many EFI boot problems are not caused by buggy firmware that can\u0027t remember NVRAM settings. In such cases, adding three extra boot loader files to the ESP just adds clutter that makes it harder for a human to figure out what\u0027s going on.\nIt\u0027s difficult to debug, if a tool changes to much.  \n\n\u003e PURPLE entry is the one which I added myself and does NOT boot. It complains about not being able to find \\\\EFI\\\\Microsoft\\\\Boot\\\\BCD with error# 0xc0000001. Why?\n\\\\EFI\\\\ubuntu\\\\grub.cfg set root to sda8. Bootmgr seems to trigger this and can\u0027t find \\\\Boot\\\\BCD at sda8.  \nSet root to efi partition first.  \n\n\u003e Already there are 16 such entries got added.\nThat\u0027s a strange behaviour.  \nThere is a compatbility error at firmware, efibootmgr and bootmgr  \nThe true issue is unknown.  \n\nDoes used hardware require the renamed files?  \nCan you check at used hardware?  \n\nA idea:  \ntry OS default setting  \n\ndelete Renamed \\\\EFI\\\\Microsoft\\\\Boot\\\\bootmgfw.efi  \nRenamed \\\\EFI\\\\Microsoft\\\\Boot\\\\bootmgfw_old.efi to \\\\EFI\\\\Microsoft\\\\Boot\\\\bootmgfw.efi  \n\n```\nmenuentry \"Windows - (search root)\" {\nsearch --fs-uuid --no-floppy --set\u003droot D692-2CA0\nchainloader (${root})/efi/Microsoft/Boot/bootmgfw.efi\n}\n```\n\n\u003cbr /\u003e\n\nAnd set firmware at bcdedit  \n\n```\n@ECHO OFF\nRem add UEFI grub2\n\nbcdedit /set {bootmgr} path \\EFI\\Microsoft\\Boot\\bootmgfw.efi\n\nfor /f \"tokens\u003d2 delims\u003d{}\" %%a in (\u0027BCDedit.exe /copy {bootmgr} /d \"Grub2\"\u0027) do set guid\u003d{%%a}\nBCDedit.exe /set %guid% path \\EFI\\ubuntu\\grubx64.efi\n\nBCDedit.exe /enum firmware\n```\n\n\u003cbr /\u003e\n\nAdjust the boot order, set grub2 first:  \nrun bcdedit /enum firmware. Remember displayorder and adjust displayorder  \n\n```\nbcdedit /set {fwbootmgr} displayorder {guid1} {bootmgr} {guid2} {guid3}\n```\n\nReplace guid? with local numbers.   \n"
    }
  ]
}