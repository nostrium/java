{
  "id": "21838",
  "title": "Boot multiple windows (7/10) installers",
  "isPinned": false,
  "isFirstTopic": false,
  "isLocked": false,
  "tags": [],
  "forumNotes": [
    {
      "id": "207685",
      "timestamp": "2018-08-31T12:01:19+00:00",
      "author": "spajak",
      "content": "Hi,\n\nI have my custom USB device with grub 2.02 and syslinux as bootloaders. Now I wonder If there is any chance to also have the bootable Windows 7 and Windows 10 installers on the same device (as grub or syslinux menu items).\n\nMy question is: Is it possible to do it without any all-in-one builders like WinSetupFromUSB or YUMI, just with grub or syslinux and maybe some other low level tools. If yes, how it is done technically? I don\u0027t need a detailed guide, just the big picture.\n\nI know I can boot Windows bootmgr from grub or syslinux, but what next? How to have both Windows installers on the same partition?\n\n\u003cbr /\u003e\n\n"
    },
    {
      "id": "207686",
      "timestamp": "2018-08-31T16:10:31+00:00",
      "author": "cdob",
      "content": "\u003e I know I can boot Windows bootmgr from grub or syslinux, but what next? How to have both Windows installers on the same partition?\n.  \nCan you clarify the boot conditions?  \nBIOS, UEFI without secure boot, UEFI with secure boot  \n\nCan you use Windows 10 (1703 and up prefered) to include the Windows parts?  \n\nCore approach:  \nsetup.exe searches the local folder for .\\\\sources\\\\install.wim or .\\\\install.wim.  \nThis can be a sub directory. The Vista and up setup.exe does this.  \n\\\\Win7_x64\\\\setup.exe finds file \\\\Win7_x64\\\\sources\\\\install.wim.  \n\nAs for testing:  \nCopy files to USB  \n\\\\Win10_1809_x64\\\\setup.exe  \n\\\\Win10_1809_x64\\\\sources\\\\  \n\\\\Win7_x64\\\\setup.exe  \n\\\\Win7_x64\\\\sources\\\\  \n\\\\Win7_x86\\\\setup.exe  \n\\\\Win7_x86\\\\sources\\\\  \n\nchainload bootmgr, boot a boot.wim/boot.sdi  \npress shift F10  \nchange directory to a USB setup.exe  \nand run setup.exe  \n\nA old archived example (the batches are at localhost)  \n[https://web.archive....\u003d0](https://web.archive.org/web/20160505014141/http://www.911cd.net/forums//index.php?showtopic\u003d26046\u0026st\u003d0\u0026#entry176525 \"External link\")   \n"
    },
    {
      "id": "207688",
      "timestamp": "2018-08-31T18:51:36+00:00",
      "author": "spajak",
      "content": "\u003e Can you clarify the boot conditions?  \n\u003e BIOS, UEFI without secure boot, UEFI with secure boot\n\nBIOS boot\n\n\u003e As for testing:  \n\u003e Copy files to USB  \n\u003e \\\\Win10_1809_x64\\\\setup.exe  \n\u003e \\\\Win10_1809_x64\\\\sources\\\\  \n\u003e \\\\Win7_x64\\\\setup.exe  \n\u003e \\\\Win7_x64\\\\sources\\\\  \n\u003e \\\\Win7_x86\\\\setup.exe  \n\u003e \\\\Win7_x86\\\\sources\\\\\n\nAre there directories names important? Can I name them differently?\n\n\u003e chainload bootmgr, boot a boot.wim/boot.sdi  \n\u003e press shift F10  \n\u003e change directory to a USB setup.exe  \n\u003e and run setup.exe\n\nWhen I try to chainload Windows 10 bootmrg from grub I get this error:\n\n\"Error: invalid signature\" 32/64 bit issue? I think I should add here that bootmgr partition is actually NTFS formatted 3rd partition on the disk. Maybe this is important here?\n\nMy grub entry is:\n\n```\nmenuentry \"Windows Setup\" {\n    search --no-floppy --file --set /boot/bootmgr\n    chainloader /boot/bootmgr\n}\n```\n\n\u003cbr /\u003e\n\n**Edited by spajak, 31 August 2018 - 07:14 PM.**\n"
    },
    {
      "id": "207689",
      "timestamp": "2018-08-31T20:17:03+00:00",
      "author": "cdob",
      "content": "\u003e Are there directories names important? Can I name them differently?\nChoose any directories names you like, however within reasons.  \nEven Unicode names should work.  \nHowever I\u0027m using and support ASCII chars without spaces only.  \n\n\u003e actually NTFS formatted 3rd partition on the disk.\nBootmgr finds /boot/bcd at certain contions only. Should be a primary active parttion.  \nA 3rd partition may fail.  \nCopy /boot/ at primary active and /sources/ at 3rd NTFS partition.  \n\nWhich USB device do you use? USB hard disk or USB flash?  \n\nntldr does chainlaod bootmgr.  \n\n```\nmenuentry \"$bootmode: Windows\" {\nif [ \"$grub_platform\" \u003d \"pc\" ]; then\n  ntldr /bootmgr\nelse\n  chainloader /efi/microsoft/bootx64.efi\nfi\n}\n```\n\n\u003cbr /\u003e\n\n"
    },
    {
      "id": "207691",
      "timestamp": "2018-09-01T10:55:29+00:00",
      "author": "spajak",
      "content": "I use USB Hard Disk. I test it on VirtualBox.\n\nNow I have (on blue screen):\n\n\u003e Recovery\n\u003e\n\u003e Your PC/Device needs to be repaired\n\u003e\n\u003e A required device isn\u0027t connected or can\u0027t be accessed\n\n**Edited by spajak, 01 September 2018 - 11:08 AM.**\n"
    },
    {
      "id": "207692",
      "timestamp": "2018-09-01T11:10:37+00:00",
      "author": "Wonko the Sane",
      "content": "\u003e I use USB Hard Disk.\n\u003e\n\u003e Now I have (on blue screen):\n\nYep :smile:, but you should, besides reporting the symptom (the BSOD) also describe the exact setup you are using, \"now\".\n\n![:duff:](http://reboot.pro/public/style_emoticons/default/duff.gif)\n\nWonko\n\n"
    },
    {
      "id": "207695",
      "timestamp": "2018-09-01T15:36:41+00:00",
      "author": "cdob",
      "content": "\u003e Now I have (on blue screen):\nThat\u0027s goot, bootmgr is chainloaded.  \nAs indicated already, describe more details. Hard disks layout, do not use  \n\nAs for testing purposes, make small steps.  \nTry the basic configuration first:  \none windows default files at a primary active partition.  \nIs grub stored at a primary active partition? Add one windows installation files to this partition, use default folder names. Do not use grub search.  \nIf this works, start to change the layout.   \n"
    },
    {
      "id": "207697",
      "timestamp": "2018-09-01T16:56:28+00:00",
      "author": "spajak",
      "content": "Yes grub2 is installed on the first active partition.\n\nAfter changes my current disk layout is:\n\n1. Primary partition NTFS, active, grub2, windows 10 sources\n\n2. Primary partition EXT4, debian\n\n3. Primary partition NTFS, data\n\nAs I mentioned earlier this is 500GB HDD in USB case.\n\nI\u0027m using Windows 10 Pro (1709) sources.\n\nI was able to execute the Windows installer under Qemu (VirtualBox crashed when loading the installer, don\u0027t know why?). I didn\u0027t test the whole installation process though, I\u0027ve stopped at the step of selecting the language to install.\n\nVirtualBox crash while loading windows installer:\n\n\u003e The I/O cache encountered an error while updating data in medium \"ahci-0-0\" (rc\u003dVERR_ACCESS_DENIED). Make sure there is enough free space on the disk and that the disk is working properly. Operation can be resumed afterwards.\n\n.\n\n**Edited by spajak, 01 September 2018 - 04:56 PM.**\n"
    },
    {
      "id": "207698",
      "timestamp": "2018-09-01T18:22:42+00:00",
      "author": "cdob",
      "content": "\u003e 1. Primary partition NTFS, active, grub2, windows 10 sources  \n\u003e 2. Primary partition EXT4, debian  \n\u003e 3. Primary partition NTFS, data  \n\u003e\n\u003e As I mentioned earlier this is 500GB HDD in USB case.\n.  \nWhich partition sizes do you use?  \nThere are BIOS missing 48bit LBA at USB boot.  \nHence the first 128 GiB are available at BIOS level.  \nThe whole 500GB HDD may be available at given hardware, has to be verified.  \nA classic approach limits boot/installation files within first 128 GiB at HDD.  \n\nAt which partition do you like to store the windows installation files finally?  \n/boot/bcd should reside at primary active partition at last.  \n/boot/bcd can be edited, boot.sdi and boot.wim mapped to other partitions.   \n"
    },
    {
      "id": "207699",
      "timestamp": "2018-09-01T18:27:37+00:00",
      "author": "spajak",
      "content": "First partition is about 100GB, so there should be no problem.\n\nI can have everything under this first partition, both grub and Windows bootloader and Windows sources.\n\n"
    },
    {
      "id": "207700",
      "timestamp": "2018-09-01T21:14:38+00:00",
      "author": "cdob",
      "content": "That\u0027s good. Time to add other setup.exe and sources folder. Compare post #2.  \nBoot to current active windows install, press shift F10 and run setup.exe.  \nDoes Windows 7 and Windows 10 setup works so far?  \n\n\u003cbr /\u003e\n\nAttached a AIO_directory.zip.  \nExpand this to a internal hard disk at Windows 10.  \nThis edits boot.wim and adds entries to \\\\boot\\\\bcd.  \nOS default tools are used (e.g. dism.exe), no third party tools.  \n\nCopy Windows installation files to USB device first, example layout:  \n\\\\boot\\\\boot.sdi  \n\\\\W7_x86\\\\setup.exe  \n\\\\W7_x86\\\\sources\\\\  \n\\\\W7_x64\\\\setup.exe  \n\\\\W7_x64\\\\sources\\\\  \n\\\\W8_x86\\\\setup.exe  \n\\\\W8_x86\\\\sources\\\\  \n\\\\W8_x64\\\\setup.exe  \n\\\\W8_x64\\\\sources\\\\  \n\\\\W10_x86\\\\setup.exe  \n\\\\W10_x86\\\\sources\\\\  \n\\\\W10_x64\\\\setup.exe  \n\\\\W10_x64\\\\sources\\\\  \n\\\\W10_x86_1809\\\\setup.exe  \n\\\\W10_x86_1809\\\\sources\\\\  \n\\\\W10_x64_1809\\\\setup.exe  \n\\\\W10_x64_1809\\\\sources\\\\  \n\nGiven a USB hard disk with a primay active 100 GB partiton U:  \nRun at elevated permissions.  \nmake_boot_wim.cmd U:\\\\  \n\n\u003cbr /\u003e\n\nAnother example (Windos 10 and up mounts two partitons at USB flash):  \nGiven a USB flash with one FAT32 EFI partition S: and another NTFS datat partiton U:  \nmake_boot_wim.cmd U:\\\\ S:  \n\n#### Attached Files {#attach_wrap}\n\n* [![Attached File](http://reboot.pro/public/style_extra/mime_types/zip.gif)](http://reboot.pro/index.php?s\u003dedc7a438832c333cc0cb6ee49087f42e\u0026app\u003dcore\u0026module\u003dattach\u0026section\u003dattach\u0026attach_id\u003d16137 \"Download attachment\") [**AIO_directory.zip**](http://reboot.pro/index.php?s\u003dedc7a438832c333cc0cb6ee49087f42e\u0026app\u003dcore\u0026module\u003dattach\u0026section\u003dattach\u0026attach_id\u003d16137 \"Download attachment\") **4.28KB** 302 downloads\n\n**Edited by cdob, 02 September 2018 - 06:40 AM.**\n"
    },
    {
      "id": "207701",
      "timestamp": "2018-09-02T12:07:07+00:00",
      "author": "spajak",
      "content": "\u003e That\u0027s good. Time to add other setup.exe and sources folder. Compare post #2.  \n\u003e Boot to current active windows install, press shift F10 and run setup.exe.  \n\u003e Does Windows 7 and Windows 10 setup works so far?\n\nI don\u0027t understand this. When to press shift F10?\n\nExecuting make_boot_wim.cmd finished without errors.\n\nAfter boot in Qemu I get \"Your PC/Device needs to be repaired\" again, but with an option to try different os (F9), which immediately starts windows 10 installer. Installer hangs with error: \"setup.exe not found\" (setup_to_search path looks OK).\n\n**Edited by spajak, 02 September 2018 - 12:08 PM.**\n"
    },
    {
      "id": "207702",
      "timestamp": "2018-09-02T13:45:23+00:00",
      "author": "spajak",
      "content": "I\u0027ve just tested in on a real PC and the result is that windows 10 setup.exe is found and is starting. But earlier BSOD is the same...\n\n"
    },
    {
      "id": "207703",
      "timestamp": "2018-09-02T14:24:28+00:00",
      "author": "Wonko the Sane",
      "content": "\u003e I don\u0027t understand this. When to press shift F10?\n\nThe \"normal\" boot.wim from a Windows 7+ install has hardcoded to autostart a shell that allows to install the system (or repair it) when you see that you press SHIFT+F10 and you get a CMD prompt open instead, see:\n\n[https://www.tenforum...ndows-10-a.html](https://www.tenforums.com/tutorials/2880-open-command-prompt-boot-windows-10-a.html \"External link\")\n\n![:duff:](http://reboot.pro/public/style_emoticons/default/duff.gif)\n\nWonko\n\n"
    },
    {
      "id": "207704",
      "timestamp": "2018-09-02T15:21:45+00:00",
      "author": "cdob",
      "content": "\u003e I\u0027ve just tested in on a real PC and the result is that windows 10 setup.exe is found and is starting.\n\n\u003e But earlier BSOD is the same...\nIs there a default entry at \\\\boot\\\\bcd referencing \\\\sources\\\\boot.wim still. Does the error matches to this entry or to another entry?  \n\nDelete the default entry, if you don\u0027t use \\\\sources\\\\boot.wim.  \nOr delete \\\\boot\\\\bcd and run make_boot_wim.cmd again.   \n"
    },
    {
      "id": "207705",
      "timestamp": "2018-09-02T17:03:36+00:00",
      "author": "spajak",
      "content": "I\u0027ve removed the default entry from \\\\boot\\\\bcd and now it works fine. Now I have a choice between Windows 7 and 10 installations. I haven\u0027t tested the whole installation process though.\n\nThank you very much for your help!!\n\nAs of VirtualBox issue, didn\u0027t you have similar issue? I suspect it has something to do with NTFS filesystem.. Similar crash also happened when i tried to mount NTFS partition under Linux.\n\n"
    },
    {
      "id": "207706",
      "timestamp": "2018-09-02T18:10:58+00:00",
      "author": "cdob",
      "content": "\u003e Now I have a choice between Windows 7 and 10 installations.\nThanks for report.  \n\n\u003e I haven\u0027t tested the whole installation process though.\nRemember there are no USB 3.0 drivers at a default Windows 7.  \nA default Windows 7 won\u0027t find the USB hard disk at a USB 3.0 port.  \n\n-use a USB 2.0 port,  \n-or include USB 3.0 drivers,  \n-or copy a Windows 10 entry and call the Windows 7 setup: use \u0027bcdedit /set {GUID} loadoptions SETUP\u003d\\\\Win7_x64\\\\setup.exe\u0027.  \nThe Windows 10 boot.wim is launched and setup.vbs calls \\\\Win7_x64\\\\setup.exe.  \n\n\u003e As of VirtualBox issue\nSorry, I haven\u0027t used USB boot at VirtualBox in years.   \n"
    },
    {
      "id": "207717",
      "timestamp": "2018-09-09T16:26:46+00:00",
      "author": "BlackDragon",
      "content": "I Have A question, A friend Of Mine Was Trying to Setup Grub4Dos On My Dell (We Got It working With Three Different OS\u0027s It took some time but worked.) The problem we encountered was that we also wanted to encrypt said drive with bestcrypt, we found out that bestcrypt gave us a generic error \"Missing Helper\" No Addition Information, I want encryption on the drive and also want Grub4dos Is there a way to get these two to work in concert with each other?\n\n"
    },
    {
      "id": "207718",
      "timestamp": "2018-09-09T18:34:02+00:00",
      "author": "Wonko the Sane",
      "content": "\u003e I Have A question, A friend Of Mine Was Trying to Setup Grub4Dos On My Dell (We Got It working With Three Different OS\u0027s It took some time but worked.) The problem we encountered was that we also wanted to encrypt said drive with bestcrypt, we found out that bestcrypt gave us a generic error \"Missing Helper\" No Addition Information, I want encryption on the drive and also want Grub4dos Is there a way to get these two to work in concert with each other?\n\nIt depends on how (EXACTLY) you installed the grub4dos, the Bestcrypt and which EXACT commands you used in grub4dos.\n\nSee:\n\n[http://reboot.pro/to...record/?p\u003d40910](http://reboot.pro/topic/5274-how-to-install-into-the-partition-boot-record/?p\u003d40910 \"\")\n\n![:duff:](http://reboot.pro/public/style_emoticons/default/duff.gif)\n\nWonko\n\n"
    }
  ]
}