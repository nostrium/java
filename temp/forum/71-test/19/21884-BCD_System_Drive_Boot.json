{
  "id": "21884",
  "title": "BCD System Drive Boot",
  "isPinned": false,
  "isFirstTopic": false,
  "isLocked": false,
  "tags": [],
  "forumNotes": [
    {
      "id": "208169",
      "timestamp": "2018-11-08T21:54:57+00:00",
      "author": "LostNspace",
      "content": "I have a UEFI drive that I use to boot two of my PEs for loading images and such. Lots of times the computer will reboot when the image is done installing and will boot back to my USB drive instead of the C drive. I want to add a 3rd default timed entry to the BCD menu that says \"1. Boot To System HD\" but I can\u0027t seem to get the entries right in the BCD to do so. How should the entries in the BCD look to accomplish booting to the system HD from my UEFI BCD menu instead of one of my PE choices?\n\n"
    },
    {
      "id": "208172",
      "timestamp": "2018-11-09T04:33:20+00:00",
      "author": "cdob",
      "content": "bcdboot adds boot entries.  \n\nE: refers to the USB EFI boot partition  \n\n```\nbcdboot C:\\Windows /s E: /f UEFI /p /d\n```\n\n.  \n[https://docs.microso...ions-techref-di](https://docs.microsoft.com/en-us/windows-hardware/manufacture/desktop/bcdboot-command-line-options-techref-di \"External link\")   \n"
    },
    {
      "id": "208174",
      "timestamp": "2018-11-09T14:09:28+00:00",
      "author": "LostNspace",
      "content": "\u003e bcdboot adds boot entries.  \n\u003e\n\u003e E: refers to the USB EFI boot partition\n\u003e\n\u003e ```\n\u003e bcdboot C:\\Windows /s E: /f UEFI /p /d\n\u003e ```\n\u003e\n\u003e .  \n\u003e [https://docs.microso...ions-techref-di](https://docs.microsoft.com/en-us/windows-hardware/manufacture/desktop/bcdboot-command-line-options-techref-di \"External link\")\n\u003e\ncdob, thanks so much! You\u0027ve always been super helpful over the years. The /p /d command is what I was missing. I have been out of the boot game for 5 years or so, so I \u0027m a little rusty coming back into things.\n\nThanks again!\n\n"
    },
    {
      "id": "208176",
      "timestamp": "2018-11-09T15:03:21+00:00",
      "author": "LostNspace",
      "content": "cdob,\n\nIs there something more global to boot the system drive from the BCD? Let me explain\n\nI use WinNTSetup from my Mini10PE to load my images and I have reboot turned on in my ini. These new laptops no matter how I set the boot stuff in bios will always boot to the USB again and I have stepped away to come back to Windows 10 not being setup yet and has booted into my PE again. The code I used above worked great on the computer I ran the command from. What I mean is I can boot the HD from the BCD menu on the computer I ran the command from, but I assume those BCD entries as specific to that machine. I need entries in the BCD that would boot any Win 10 drive from the BCD.\n\n"
    },
    {
      "id": "208177",
      "timestamp": "2018-11-09T18:02:22+00:00",
      "author": "Wonko the Sane",
      "content": "IMHO you should think the other way round.\n\nI.e. have the \"default\" boot on the USB stick to always (if no user intervention happens) go back to boot the hard disk, and you should be able to do that easily if you add (say) GRUB2 as your \"main\" USB stick boot manager.\n\nAnother entry (if manually selected) will chainload the BOOTMGR.EFI on the same USB stick.\n\n![:duff:](https://reboot.pro/public/style_emoticons/default/duff.gif)\n\nWonko\n\n"
    },
    {
      "id": "208179",
      "timestamp": "2018-11-09T18:27:28+00:00",
      "author": "LostNspace",
      "content": "\u003e IMHO you should think the other way round.\n\u003e\n\u003e I.e. have the \"default\" boot on the USB stick to always (if no user intervention happens) go back to boot the hard disk, and you should be able to do that easily if you add (say) GRUB2 as your \"main\" USB stick boot manager.\n\u003e\n\u003e Another entry (if manually selected) will chainload the BOOTMGR.EFI on the same USB stick.\n\u003e\n\u003e ![:duff:](https://reboot.pro/public/style_emoticons/default/duff.gif)\n\u003e\n\u003e Wonko\n\nI think we are talking about the same thing. In my BCD I would have \"Boot To System HD\" as the default entry so when the secure boot UEFI laptop boots to the USB drive the default choice would boot the system drive so when I return from whatever I am doing, the load process would be complete. Less user interaction. I will need to read up on Grub2 and secure boot. Like I said been out of the boot game for a long time. I was hoping it would be just a simple entry I could make in the BCD to accomplish this.\n\nIf I use the command cdob, posted above this allows me to boot the system drive from my BCD menu but only on that computer I ran the command from.\n\n"
    },
    {
      "id": "208180",
      "timestamp": "2018-11-09T20:04:21+00:00",
      "author": "misty",
      "content": "@**LostNspace**   \n\nI\u0027m not sure if what you are proposing is possible with the Windows boot manager (bootmgr and UEFI variants).  \n\nSee [here](http://mistyprojects.co.uk/documents/BCDEdit/index.html \"External link\") for my attempts at documenting BCDEdit and the BCD store.  \n\nMaybe look into the Locate device type ([here](http://mistyprojects.co.uk/documents/BCDEdit/files/device_locate.htm \"External link\")) and in particular the [Using the Locate Device in Multiboot Setups](http://mistyprojects.co.uk/documents/BCDEdit/files/device_locate.htm#4 \"External link\") section of this page and do some experiments. Instead of using a tag file, simply use a file that is likely to be present on the HDD and not present on the USB device you are booting from.  \n\n![:cheers:](https://reboot.pro/public/style_emoticons/default/cheers.gif)  \n\nMisty   \n"
    },
    {
      "id": "208181",
      "timestamp": "2018-11-09T20:34:10+00:00",
      "author": "911CD.net",
      "content": "**LostNspace** you can boot your USB grub2 menu on a Secure Boot EFI system if you follow the steps I posted here:\n\n[http://reboot.pro/to...e-4#entry207893](http://reboot.pro/topic/18182-uefi-multi-make-multi-boot-usb-drive/page-4#entry207893 \"\") about a month ago.\n\n"
    },
    {
      "id": "208182",
      "timestamp": "2018-11-09T20:35:18+00:00",
      "author": "LostNspace",
      "content": "Here is what my BCD looks like. This works if I boot the system drive from my USB if its the computer I ran the\n\nbcdboot C:\\\\Windows /s E: /f UEFI /p /d command from but fails with a light blue screen saying\n\nwindows\\\\system32\\\\winload.efi couldn\u0027t be found\n\nThe first pic is the System Drive Boot option\n\n[![gbZvdL.jpg](https://imagizer.imageshack.com/v2/xq90/922/gbZvdL.jpg)](https://imageshack.com/i/pmgbZvdLj \"External link\")\n\nSecond pic is Windows Boot Manager option\n\n[![vEllu7.jpg](https://imagizer.imageshack.com/v2/xq90/921/vEllu7.jpg)](https://imageshack.com/i/plvEllu7j \"External link\")\n\n**Edited by LostNspace, 09 November 2018 - 08:41 PM.**\n"
    },
    {
      "id": "208183",
      "timestamp": "2018-11-09T20:47:32+00:00",
      "author": "cdob",
      "content": "\u003e look into the Locate device type\nYes, locate works at USB UEFI too.  \n\n```\ncd /d E:\\EFI\\Microsoft\\Boot\nbcdedit.exe /store bcd\n```\n\ncopy the Boot to Sytstem HD GUID  \n.  \n\n```\nbcdedit.exe /store bcd /set {GUID}   device locate\u003dcustom:12000002\nbcdedit.exe /store bcd /set {GUID} osdevice locate\u003dcustom:12000002\n```\n\nPaste the appropiate GUID number.  \n\nThe tag file \"\\\\Windows\\\\system32\\\\winload.exe\" is used in both.   \n"
    },
    {
      "id": "208184",
      "timestamp": "2018-11-09T21:58:46+00:00",
      "author": "LostNspace",
      "content": "\u003e Yes, locate works at USB UEFI too.\n\u003e\n\u003e ```\n\u003e cd /d E:\\EFI\\Microsoft\\Bootbcdedit.exe /store bcd\n\u003e ```\n\u003e\n\u003e copy the Boot to Sytstem HD GUID  \n\u003e .  \n\u003e\n\u003e ```\n\u003e bcdedit.exe /store bcd /set {GUID}   device locate\u003dcustom:12000002bcdedit.exe /store bcd /set {GUID} osdevice locate\u003dcustom:12000002\n\u003e ```\n\u003e\n\u003e Paste the appropiate GUID number.  \n\u003e\n\u003e The tag file \"\\\\Windows\\\\system32\\\\winload.exe\" is used in both.\n\n\u003cbr /\u003e\n\nI must be missing a step. This is my BCD store after I run the command lines below  \n\n```\nWindows Boot Manager\n--------------------\nidentifier              {bootmgr}\ndevice                  unknown\npath                    \\EFI\\Microsoft\\Boot\\bootmgfw.efi\ndescription             Windows Boot Manager\nlocale                  en-us\ninherit                 {globalsettings}\ndefault                 {default}\nresumeobject            {84abc965-e405-11e8-afa7-7c8bca0118e9}\ndisplayorder            {default}\n                        {7619dcc9-fafe-11d9-b411-000476eba25f}\n                        {8a3b5fab-daeb-11e8-a321-0026832ea037}\ntoolsdisplayorder       {memdiag}\ntimeout                 10\ndisplaybootmenu         Yes\n\n\nWindows Boot Loader\n-------------------\nidentifier              {7619dcc9-fafe-11d9-b411-000476eba25f}\ndevice                  ramdisk\u003d[boot]\\sources\\LaddsMini10.wim,{7619dcc8-fafe-11d9-b411-000476eba25f}\npath                    \\windows\\system32\\boot\\winload.efi\ndescription             2. Ladd\u0027s Mini10PE (Use First)\nlocale                  en-US\ninherit                 {bootloadersettings}\nisolatedcontext         Yes\nosdevice                ramdisk\u003d[boot]\\sources\\LaddsMini10.wim,{7619dcc8-fafe-11d9-b411-000476eba25f}\nsystemroot              \\windows\nbootmenupolicy          Legacy\ndetecthal               Yes\nwinpe                   Yes\nems                     No\n\n\nWindows Boot Loader\n-------------------\nidentifier              {default}\ndevice                  locate\u003d\\windows\\system32\\winload.efi\npath                    \\windows\\system32\\winload.efi\ndescription             1. Boot To System Drive\nlocale                  en-us\ninherit                 {bootloadersettings}\nisolatedcontext         Yes\nallowedinmemorysettings 0x15000075\nosdevice                locate\u003d\\windows\\system32\\winload.efi\nsystemroot              \\windows\nresumeobject            {84abc965-e405-11e8-afa7-7c8bca0118e9}\nnx                      OptIn\nbootmenupolicy          Standard\n\n\nWindows Boot Loader\n-------------------\nidentifier              {8a3b5fab-daeb-11e8-a321-0026832ea037}\ndevice                  ramdisk\u003d[boot]\\sources\\Hirens10PE.wim,{7619dcc8-fafe-11d9-b411-000476eba25f}\npath                    \\windows\\system32\\boot\\winload.efi\ndescription             3. Hiren\u0027s BootPE 1.0.1\nlocale                  en-US\nosdevice                ramdisk\u003d[boot]\\sources\\Hirens10PE.wim,{7619dcc8-fafe-11d9-b411-000476eba25f}\nsystemroot              \\Windows\ndetecthal               Yes\nwinpe                   Yes\nems                     No\n\n\nResume from Hibernate\n---------------------\nidentifier              {84abc965-e405-11e8-afa7-7c8bca0118e9}\ndevice                  unknown\npath                    \\windows\\system32\\winresume.efi\ndescription             Windows Resume Application\nlocale                  en-us\ninherit                 {resumeloadersettings}\nisolatedcontext         Yes\nallowedinmemorysettings 0x15000075\nfilepath                \\hiberfil.sys\nbootmenupolicy          Standard\n\n\nWindows Memory Tester\n---------------------\nidentifier              {memdiag}\ndevice                  unknown\npath                    \\EFI\\Microsoft\\Boot\\memtest.efi\ndescription             Windows Memory Diagnostic\nlocale                  en-us\ninherit                 {globalsettings}\nbadmemoryaccess         Yes\n\n\nEMS Settings\n------------\nidentifier              {emssettings}\nbootems                 No\n\n\nDebugger Settings\n-----------------\nidentifier              {dbgsettings}\ndebugtype               Serial\ndebugport               1\nbaudrate                115200\n\n\nRAM Defects\n-----------\nidentifier              {badmemory}\n\n\nGlobal Settings\n---------------\nidentifier              {globalsettings}\ninherit                 {dbgsettings}\n                        {emssettings}\n                        {badmemory}\n\n\nBoot Loader Settings\n--------------------\nidentifier              {bootloadersettings}\ninherit                 {globalsettings}\n                        {hypervisorsettings}\n\n\nHypervisor Settings\n-------------------\nidentifier              {hypervisorsettings}\ndescription             Hypervisor Settings\nhypervisordebugtype     Serial\nhypervisordebugport     1\nhypervisorbaudrate      115200\n\n\nResume Loader Settings\n----------------------\nidentifier              {resumeloadersettings}\ninherit                 {globalsettings}\n\n\nDevice options\n--------------\nidentifier              {7619dcc8-fafe-11d9-b411-000476eba25f}\nramdisksdidevice        boot\nramdisksdipath          \\boot\\boot.sdi\n\n```\n\n```\nbcdedit.exe /store bcd /set {84abc966-e405-11e8-afa7-7c8bca0118e9} device locate\u003dcustom:12000002\nbcdedit.exe /store bcd /set {84abc966-e405-11e8-afa7-7c8bca0118e9} osdevice locate\u003dcustom:12000002\n```\n\nBut I am still getting the light blue recovery screen if I use the \"Boot System Drive\" option\n\nThe winload.exe isn\u0027t there. Is that *[12000002](http://mistyprojects.co.uk/documents/BCDEdit/files/object_element_codes.htm#12000002 \"External link\") correct?*\n\n**Edited by LostNspace, 09 November 2018 - 10:31 PM.**\n"
    },
    {
      "id": "208193",
      "timestamp": "2018-11-10T18:36:55+00:00",
      "author": "LostNspace",
      "content": "\u003e **LostNspace** you can boot your USB grub2 menu on a Secure Boot EFI system if you follow the steps I posted here:\n\u003e\n\u003e [http://reboot.pro/to...e-4#entry207893](http://reboot.pro/topic/18182-uefi-multi-make-multi-boot-usb-drive/page-4#entry207893 \"\") about a month ago.\n\nThanks for the reply. I will look into this method as well. Just curious tho will grub2 boot in any secure boot situation? What I mean is the way I have my three boot options set up now I know this will always be secure boot compatible because it\u0027s legit Microsoft files. It\u0027s a shame I would have to use something like grub2 just to boot the system drive when my other two PE boots work so well from the BCD.\n\n"
    },
    {
      "id": "208196",
      "timestamp": "2018-11-11T04:38:35+00:00",
      "author": "LostNspace",
      "content": "I actually installed grub2 files from the secure boot Ubuntu as mentioned above by 911CD.net and added this to the grub.cfg and was able to successfully boot Win 10 on my secure boot laptop.\n\n```\nmenuentry \u0027Windows 10\u0027 {\n\nsearch --set\u003droot --file /EFI/Microsoft/Boot/bootmgfw.efi\nchainloader /EFI/Microsoft/Boot/bootmgfw.efi\n}\n```\n\nNow I just need to figure out how to boot my two Winpe from the grub.cfg menu\n\n"
    },
    {
      "id": "208198",
      "timestamp": "2018-11-11T13:32:30+00:00",
      "author": "wimb",
      "content": "On USB drive I have made with BOOTICE Professional mode a New entry for booting Local Harddisk with Windows 10\n\nI have added New Element **BootMenuPolicy** with value **Legacy**\n\n```\nWindows Boot Loader\n-------------------\nidentifier              {83891d32-cdd3-4301-b665-bdbd22baf78c}\ndevice                  boot\npath                    \\Windows\\system32\\winload.efi\ndescription             Windows 10 HDD\nlocale                  en-US\ninherit                 {6efb52bf-1766-41db-a6b3-0ee5eff72bd7}\n                        {7ea2e1ac-2e61-4728-aaa3-896d9d0a9f0e}\nosdevice                boot\nsystemroot              \\Windows\nresumeobject            {db2c7793-30a2-4711-aadf-61b056ab9d7d}\nbootmenupolicy          Legacy\n\n```\n\nThis entry was then modified with bcdedit in admin cmd window according to the description given by **cdob**\n\n```\nbcdedit.exe /store N:\\efi\\microsoft\\boot\\bcd /set {83891d32-cdd3-4301-b665-bdbd22baf78c} device locate\u003dcustom:12000002\nbcdedit.exe /store N:\\efi\\microsoft\\boot\\bcd /set {83891d32-cdd3-4301-b665-bdbd22baf78c} osdevice locate\u003dcustom:12000002\n\n\n```\n\nThen the entry for boooting local harddisk with windows 10 is looking like\n\n```\nWindows Boot Loader\n-------------------\nidentifier              {83891d32-cdd3-4301-b665-bdbd22baf78c}\ndevice                  locate\u003dcustom:12000002\npath                    \\Windows\\system32\\winload.efi\ndescription             Windows 10 HDD\nlocale                  en-US\ninherit                 {6efb52bf-1766-41db-a6b3-0ee5eff72bd7}\n                        {7ea2e1ac-2e61-4728-aaa3-896d9d0a9f0e}\nosdevice                locate\u003dcustom:12000002\nsystemroot              \\Windows\nresumeobject            {db2c7793-30a2-4711-aadf-61b056ab9d7d}\nbootmenupolicy          Legacy\n```\n\nThis entry selected from USB EFI Boot menu is working OK for UEFI Secure booting of Windows 10 from local harddisk.\n\n"
    },
    {
      "id": "208199",
      "timestamp": "2018-11-11T13:49:49+00:00",
      "author": "LostNspace",
      "content": "\u003e On USB drive I have made with BOOTICE Professional mode a New entry for booting Local Harddisk with Windows 10\n\u003e\n\u003e I have added New Element **BootMenuPolicy** with value **Legacy**\n\u003e\n\u003e ```\n\u003e Windows Boot Loader\n\u003e -------------------\n\u003e identifier              {83891d32-cdd3-4301-b665-bdbd22baf78c}\n\u003e device                  boot\n\u003e path                    \\Windows\\system32\\winload.efi\n\u003e description             Windows 10 HDD\n\u003e locale                  en-US\n\u003e inherit                 {6efb52bf-1766-41db-a6b3-0ee5eff72bd7}\n\u003e                         {7ea2e1ac-2e61-4728-aaa3-896d9d0a9f0e}\n\u003e osdevice                boot\n\u003e systemroot              \\Windows\n\u003e resumeobject            {db2c7793-30a2-4711-aadf-61b056ab9d7d}\n\u003e bootmenupolicy          Legacy\n\u003e\n\u003e ```\n\u003e\n\u003e This entry was then modified with bcdedit in admin cmd window according to the description given by **cdob**\n\u003e\n\u003e ```\n\u003e bcdedit.exe /store N:\\efi\\microsoft\\boot\\bcd /set {83891d32-cdd3-4301-b665-bdbd22baf78c} device locate\u003dcustom:12000002\n\u003e bcdedit.exe /store N:\\efi\\microsoft\\boot\\bcd /set {83891d32-cdd3-4301-b665-bdbd22baf78c} osdevice locate\u003dcustom:12000002\n\u003e\n\u003e\n\u003e ```\n\u003e\n\u003e Then the entry for boooting local harddisk with windows 10 is looking like\n\u003e\n\u003e ```\n\u003e Windows Boot Loader\n\u003e -------------------\n\u003e identifier              {83891d32-cdd3-4301-b665-bdbd22baf78c}\n\u003e device                  locate\u003dcustom:12000002\n\u003e path                    \\Windows\\system32\\winload.efi\n\u003e description             Windows 10 HDD\n\u003e locale                  en-US\n\u003e inherit                 {6efb52bf-1766-41db-a6b3-0ee5eff72bd7}\n\u003e                         {7ea2e1ac-2e61-4728-aaa3-896d9d0a9f0e}\n\u003e osdevice                locate\u003dcustom:12000002\n\u003e systemroot              \\Windows\n\u003e resumeobject            {db2c7793-30a2-4711-aadf-61b056ab9d7d}\n\u003e bootmenupolicy          Legacy\n\u003e ```\n\u003e\n\u003e This entry selected from USB EFI Boot menu is working OK for UEFI Secure booting of Windows 10 from local harddisk.\n\nThank you! I will give this a try. What Windows version are you using bcdedit from?\n\n"
    },
    {
      "id": "208200",
      "timestamp": "2018-11-11T14:11:04+00:00",
      "author": "wimb",
      "content": "\u003e Thank you! I will give this a try. What Windows version are you using bcdedit from?\n\nWindows 10 Home version 1803\n\n"
    },
    {
      "id": "208201",
      "timestamp": "2018-11-11T14:11:27+00:00",
      "author": "LostNspace",
      "content": "I\u0027m not exactly sure what I am doing wrong but I did as you suggested, wimb. This is how my entry looks after.\n\n```\nWindows Boot Loader\n-------------------\nidentifier              {3eb7af9b-a369-4cc6-ab3a-59e2c5e55e2b}\ndevice                  locate\u003d\\Windows\\system32\\winload.efi\npath                    \\Windows\\system32\\winload.efi\ndescription             Win10\nlocale                  en-US\ninherit                 {bootloadersettings}\nosdevice                locate\u003d\\Windows\\system32\\winload.efi\nsystemroot              \\Windows\nresumeobject            {b21f46df-401b-44b5-9ee6-28897fdd3319}\nbootmenupolicy          Legacy\n```\n\n\u003cbr /\u003e\n\n"
    },
    {
      "id": "208202",
      "timestamp": "2018-11-11T14:23:31+00:00",
      "author": "wimb",
      "content": "Your entry seems OK and corresponds well to mine.\n\nI have used **enum /v** so that the real values are visible instead of friendly names\n\n```\nbcdedit.exe /store N:\\efi\\microsoft\\boot\\bcd /enum /v\n```\n\nIs your entry still not working ?\n\nWhen I don\u0027t use /v then the entry is looking like\n\n```\nWindows Boot Loader\n-------------------\nidentifier              {83891d32-cdd3-4301-b665-bdbd22baf78c}\ndevice                  locate\u003d\\Windows\\system32\\winload.efi\npath                    \\Windows\\system32\\winload.efi\ndescription             Windows 10 HDD\nlocale                  en-US\ninherit                 {bootloadersettings}\n                        {globalsettings}\nosdevice                locate\u003d\\Windows\\system32\\winload.efi\nsystemroot              \\Windows\nresumeobject            {db2c7793-30a2-4711-aadf-61b056ab9d7d}\nbootmenupolicy          Legacy\n```\n\nThe difference with yours is that in my entry {globalsettings} are inherited as well, but I don\u0027t know if that is important ....\n\n"
    },
    {
      "id": "208203",
      "timestamp": "2018-11-11T14:31:54+00:00",
      "author": "LostNspace",
      "content": "\u003e Your entry seems OK and corresponds well to mine.\n\u003e\n\u003e I have used **enum /v** so that the real values are visible instead of friendly names\n\u003e\n\u003e ```\n\u003e bcdedit.exe /store N:\\efi\\microsoft\\boot\\bcd /enum /v\n\u003e ```\n\u003e\n\u003e Is your entry still not working ?\n\nUsing the /v switch Here is mine and still not working ![:(](https://reboot.pro/public/style_emoticons/default/sad.png)\n\n```\nWindows Boot Loader\n-------------------\nidentifier              {3eb7af9b-a369-4cc6-ab3a-59e2c5e55e2b}\ndevice                  locate\u003dcustom:12000002\npath                    \\Windows\\system32\\winload.efi\ndescription             Win10\nlocale                  en-US\ninherit                 {6efb52bf-1766-41db-a6b3-0ee5eff72bd7}\nosdevice                locate\u003dcustom:12000002\nsystemroot              \\Windows\nresumeobject            {b21f46df-401b-44b5-9ee6-28897fdd3319}\nbootmenupolicy          Legacy\n\n```\n\n\u003cbr /\u003e\n\n"
    },
    {
      "id": "208204",
      "timestamp": "2018-11-11T15:03:20+00:00",
      "author": "LostNspace",
      "content": "I tried it again from scratch.\n\nHere is the BCD entry:\n\n```\nWindows Boot Loader\n-------------------\nidentifier              {c22526af-340f-4d79-aa11-83e89ee79e16}\ndevice                  locate\u003dcustom:12000002\npath                    \\Windows\\system32\\winload.efi\ndescription             Boot System HD\nlocale                  en-US\ninherit                 {6efb52bf-1766-41db-a6b3-0ee5eff72bd7}\n                        {7ea2e1ac-2e61-4728-aaa3-896d9d0a9f0e}\nosdevice                locate\u003dcustom:12000002\nsystemroot              \\Windows\nresumeobject            {175f0d78-e811-4127-a28b-4d16dae5b68f}\nbootmenupolicy          Legacy\n\n```\n\nAnd this is the error I am getting. This is on a Dell Laptop (new) with secure boot on.\n\n[![gAcbDA.jpg](https://imagizer.imageshack.com/v2/xq90/921/gAcbDA.jpg)](https://imageshack.com/i/plgAcbDAj \"External link\")\n\n**Edited by LostNspace, 11 November 2018 - 03:09 PM.**\n"
    },
    {
      "id": "208205",
      "timestamp": "2018-11-11T15:23:56+00:00",
      "author": "wimb",
      "content": "Everything seems OK and I have no idea why it does not work for you ....\n\nWhat is the partitioning of your USB drive ? MBR or GPT with/without EFI partition ?\n\nI have portable SSD 250 GB and MBR partitioning with 1st partition 20 GB FAT32 Set Active and 2nd partition NTFS\n\nto be most compatible for booting on any hardware in BIOS or UEFI mode as described [here](http://reboot.pro/topic/21883-install-windows-10-from-usb-after-booting-with-wim-or-vhdx/?p\u003d208164 \"\")\n\n"
    },
    {
      "id": "208206",
      "timestamp": "2018-11-11T17:13:46+00:00",
      "author": "LostNspace",
      "content": "\u003e Everything seems OK and I have no idea why it does not work for you ....\n\u003e\n\u003e What is the partitioning of your USB drive ? MBR or GPT with/without EFI partition ?\n\u003e\n\u003e I have portable SSD 250 GB and MBR partitioning with 1st partition 20 GB FAT32 Set Active and 2nd partition NTFS\n\u003e\n\u003e to be most compatible for booting on any hardware in BIOS or UEFI mode as described [here](http://reboot.pro/topic/21883-install-windows-10-from-usb-after-booting-with-wim-or-vhdx/?p\u003d208164 \"\")\n\nI have no explanation for this but I booted into my WinPE because I had to re-image that laptop any way. I left the newly created entry as you suggested in my BCD with that \"Boot To System Drive\" as the default with a time out. WinNTSetup finished applying the image, the computer rebooted, booted to the USB drive as usually, my custom BCD menu came up and I let the timer go and it actually booted to the Win 10 machine. Everything seems to be working now. ![:blink:](https://reboot.pro/public/style_emoticons/default/blink.png)\n\n"
    },
    {
      "id": "208207",
      "timestamp": "2018-11-11T17:20:25+00:00",
      "author": "wimb",
      "content": "Nice to hear that the problem seems to be solved for you now ....\n\n![:cheers:](https://reboot.pro/public/style_emoticons/default/cheers.gif)\n\n"
    },
    {
      "id": "208208",
      "timestamp": "2018-11-11T20:12:54+00:00",
      "author": "LostNspace",
      "content": "\u003e Nice to hear that the problem seems to be solved for you now ....\n\u003e\n\u003e ![:cheers:](https://reboot.pro/public/style_emoticons/default/cheers.gif)\n\nWell I thought I was issue free. If I let the WinNTSetup finish and reboot, then boot the hard drive from the BCD on my USB setup starts as normal then about half way into the setup I get this:\n\n[![0lMPpu.jpg](https://imagizer.imageshack.com/v2/xq90/922/0lMPpu.jpg)](https://imageshack.com/i/pm0lMPpuj \"External link\")\n\nIf I pull the USB out while this message is up and the little circle is spinning, the circle will freeze like it\u0027s connected to the USB as far as the boot loader. If I unplug the USB before setup starts and let the system drive boot and finish the install and then boot the system drive from my bcd on the USB all is well. It\u0027s something that doesn\u0027t like the fact I booted the system drive from the bcd before the install could complete.\n\nI guess what I am saying is that as long as the OS is fully installed I can boot the system drive from my USB with no problems but on a reinstall the system doesn\u0027t like me booting the drive from my USB BCD.\n\n**Edited by LostNspace, 11 November 2018 - 08:18 PM.**\n"
    },
    {
      "id": "208209",
      "timestamp": "2018-11-11T20:32:17+00:00",
      "author": "wimb",
      "content": "\u003e Well I thought I was issue free. If I let the WinNTSetup finish and reboot, then boot the hard drive from the BCD on my USB setup starts as normal then about half way into the setup I get this:\n\u003e\n\u003e [![0lMPpu.jpg](https://imagizer.imageshack.com/v2/xq90/922/0lMPpu.jpg)](https://imageshack.com/i/pm0lMPpuj \"External link\")\n\u003e\n\u003e If I pull the USB out while this message is up and the little circle is spinning, the circle will freeze like it\u0027s connected to the USB as far as the boot loader. If I unplug the USB before setup starts and let the system drive boot and finish the install and then boot the system drive from my bcd on the USB all is well. It\u0027s something that doesn\u0027t like the fact I booted the system drive from the bcd before the install could complete.\n\u003e\n\u003e I guess what I am saying is that as long as the OS is fully installed I can boot the system drive from my USB with no problems but on a reinstall the system doesn\u0027t like me booting the drive from my USB BCD.\n\nI recognize this behaviour ....\n\n**During Install** of Windows 10 then an **EFI GPT partition for the efi boot files is required**.\n\nI get the same when installing Windows 10 in VHDX and using USB FAT32 drive as boot drive.\n\nI solved the problem by using the GPT EFI partition of my local GPT harddisk as boot drive during install in VHDX.\n\nAfter Install in VHDX I copy the VHDX to NTFS drive of portable SSD and can boot the VHDX using boot files located on MBR FAT32 partition of portable SSD.\n\n"
    },
    {
      "id": "208169",
      "timestamp": "2018-11-08T21:54:57+00:00",
      "author": "LostNspace",
      "content": "I have a UEFI drive that I use to boot two of my PEs for loading images and such. Lots of times the computer will reboot when the image is done installing and will boot back to my USB drive instead of the C drive. I want to add a 3rd default timed entry to the BCD menu that says \"1. Boot To System HD\" but I can\u0027t seem to get the entries right in the BCD to do so. How should the entries in the BCD look to accomplish booting to the system HD from my UEFI BCD menu instead of one of my PE choices?\n\n"
    },
    {
      "id": "208172",
      "timestamp": "2018-11-09T04:33:20+00:00",
      "author": "cdob",
      "content": "bcdboot adds boot entries.  \n\nE: refers to the USB EFI boot partition  \n\n```\nbcdboot C:\\Windows /s E: /f UEFI /p /d\n```\n\n.  \n[https://docs.microso...ions-techref-di](https://docs.microsoft.com/en-us/windows-hardware/manufacture/desktop/bcdboot-command-line-options-techref-di \"External link\")   \n"
    },
    {
      "id": "208174",
      "timestamp": "2018-11-09T14:09:28+00:00",
      "author": "LostNspace",
      "content": "\u003e bcdboot adds boot entries.  \n\u003e\n\u003e E: refers to the USB EFI boot partition\n\u003e\n\u003e ```\n\u003e bcdboot C:\\Windows /s E: /f UEFI /p /d\n\u003e ```\n\u003e\n\u003e .  \n\u003e [https://docs.microso...ions-techref-di](https://docs.microsoft.com/en-us/windows-hardware/manufacture/desktop/bcdboot-command-line-options-techref-di \"External link\")\n\u003e\ncdob, thanks so much! You\u0027ve always been super helpful over the years. The /p /d command is what I was missing. I have been out of the boot game for 5 years or so, so I \u0027m a little rusty coming back into things.\n\nThanks again!\n\n"
    },
    {
      "id": "208176",
      "timestamp": "2018-11-09T15:03:21+00:00",
      "author": "LostNspace",
      "content": "cdob,\n\nIs there something more global to boot the system drive from the BCD? Let me explain\n\nI use WinNTSetup from my Mini10PE to load my images and I have reboot turned on in my ini. These new laptops no matter how I set the boot stuff in bios will always boot to the USB again and I have stepped away to come back to Windows 10 not being setup yet and has booted into my PE again. The code I used above worked great on the computer I ran the command from. What I mean is I can boot the HD from the BCD menu on the computer I ran the command from, but I assume those BCD entries as specific to that machine. I need entries in the BCD that would boot any Win 10 drive from the BCD.\n\n"
    },
    {
      "id": "208177",
      "timestamp": "2018-11-09T18:02:22+00:00",
      "author": "Wonko the Sane",
      "content": "IMHO you should think the other way round.\n\nI.e. have the \"default\" boot on the USB stick to always (if no user intervention happens) go back to boot the hard disk, and you should be able to do that easily if you add (say) GRUB2 as your \"main\" USB stick boot manager.\n\nAnother entry (if manually selected) will chainload the BOOTMGR.EFI on the same USB stick.\n\n![:duff:](https://reboot.pro/public/style_emoticons/default/duff.gif)\n\nWonko\n\n"
    },
    {
      "id": "208179",
      "timestamp": "2018-11-09T18:27:28+00:00",
      "author": "LostNspace",
      "content": "\u003e IMHO you should think the other way round.\n\u003e\n\u003e I.e. have the \"default\" boot on the USB stick to always (if no user intervention happens) go back to boot the hard disk, and you should be able to do that easily if you add (say) GRUB2 as your \"main\" USB stick boot manager.\n\u003e\n\u003e Another entry (if manually selected) will chainload the BOOTMGR.EFI on the same USB stick.\n\u003e\n\u003e ![:duff:](https://reboot.pro/public/style_emoticons/default/duff.gif)\n\u003e\n\u003e Wonko\n\nI think we are talking about the same thing. In my BCD I would have \"Boot To System HD\" as the default entry so when the secure boot UEFI laptop boots to the USB drive the default choice would boot the system drive so when I return from whatever I am doing, the load process would be complete. Less user interaction. I will need to read up on Grub2 and secure boot. Like I said been out of the boot game for a long time. I was hoping it would be just a simple entry I could make in the BCD to accomplish this.\n\nIf I use the command cdob, posted above this allows me to boot the system drive from my BCD menu but only on that computer I ran the command from.\n\n"
    },
    {
      "id": "208180",
      "timestamp": "2018-11-09T20:04:21+00:00",
      "author": "misty",
      "content": "@**LostNspace**   \n\nI\u0027m not sure if what you are proposing is possible with the Windows boot manager (bootmgr and UEFI variants).  \n\nSee [here](http://mistyprojects.co.uk/documents/BCDEdit/index.html \"External link\") for my attempts at documenting BCDEdit and the BCD store.  \n\nMaybe look into the Locate device type ([here](http://mistyprojects.co.uk/documents/BCDEdit/files/device_locate.htm \"External link\")) and in particular the [Using the Locate Device in Multiboot Setups](http://mistyprojects.co.uk/documents/BCDEdit/files/device_locate.htm#4 \"External link\") section of this page and do some experiments. Instead of using a tag file, simply use a file that is likely to be present on the HDD and not present on the USB device you are booting from.  \n\n![:cheers:](https://reboot.pro/public/style_emoticons/default/cheers.gif)  \n\nMisty   \n"
    },
    {
      "id": "208181",
      "timestamp": "2018-11-09T20:34:10+00:00",
      "author": "911CD.net",
      "content": "**LostNspace** you can boot your USB grub2 menu on a Secure Boot EFI system if you follow the steps I posted here:\n\n[http://reboot.pro/to...e-4#entry207893](http://reboot.pro/topic/18182-uefi-multi-make-multi-boot-usb-drive/page-4#entry207893 \"\") about a month ago.\n\n"
    },
    {
      "id": "208182",
      "timestamp": "2018-11-09T20:35:18+00:00",
      "author": "LostNspace",
      "content": "Here is what my BCD looks like. This works if I boot the system drive from my USB if its the computer I ran the\n\nbcdboot C:\\\\Windows /s E: /f UEFI /p /d command from but fails with a light blue screen saying\n\nwindows\\\\system32\\\\winload.efi couldn\u0027t be found\n\nThe first pic is the System Drive Boot option\n\n[![gbZvdL.jpg](https://imagizer.imageshack.com/v2/xq90/922/gbZvdL.jpg)](https://imageshack.com/i/pmgbZvdLj \"External link\")\n\nSecond pic is Windows Boot Manager option\n\n[![vEllu7.jpg](https://imagizer.imageshack.com/v2/xq90/921/vEllu7.jpg)](https://imageshack.com/i/plvEllu7j \"External link\")\n\n**Edited by LostNspace, 09 November 2018 - 08:41 PM.**\n"
    },
    {
      "id": "208183",
      "timestamp": "2018-11-09T20:47:32+00:00",
      "author": "cdob",
      "content": "\u003e look into the Locate device type\nYes, locate works at USB UEFI too.  \n\n```\ncd /d E:\\EFI\\Microsoft\\Boot\nbcdedit.exe /store bcd\n```\n\ncopy the Boot to Sytstem HD GUID  \n.  \n\n```\nbcdedit.exe /store bcd /set {GUID}   device locate\u003dcustom:12000002\nbcdedit.exe /store bcd /set {GUID} osdevice locate\u003dcustom:12000002\n```\n\nPaste the appropiate GUID number.  \n\nThe tag file \"\\\\Windows\\\\system32\\\\winload.exe\" is used in both.   \n"
    },
    {
      "id": "208184",
      "timestamp": "2018-11-09T21:58:46+00:00",
      "author": "LostNspace",
      "content": "\u003e Yes, locate works at USB UEFI too.\n\u003e\n\u003e ```\n\u003e cd /d E:\\EFI\\Microsoft\\Bootbcdedit.exe /store bcd\n\u003e ```\n\u003e\n\u003e copy the Boot to Sytstem HD GUID  \n\u003e .  \n\u003e\n\u003e ```\n\u003e bcdedit.exe /store bcd /set {GUID}   device locate\u003dcustom:12000002bcdedit.exe /store bcd /set {GUID} osdevice locate\u003dcustom:12000002\n\u003e ```\n\u003e\n\u003e Paste the appropiate GUID number.  \n\u003e\n\u003e The tag file \"\\\\Windows\\\\system32\\\\winload.exe\" is used in both.\n\n\u003cbr /\u003e\n\nI must be missing a step. This is my BCD store after I run the command lines below  \n\n```\nWindows Boot Manager\n--------------------\nidentifier              {bootmgr}\ndevice                  unknown\npath                    \\EFI\\Microsoft\\Boot\\bootmgfw.efi\ndescription             Windows Boot Manager\nlocale                  en-us\ninherit                 {globalsettings}\ndefault                 {default}\nresumeobject            {84abc965-e405-11e8-afa7-7c8bca0118e9}\ndisplayorder            {default}\n                        {7619dcc9-fafe-11d9-b411-000476eba25f}\n                        {8a3b5fab-daeb-11e8-a321-0026832ea037}\ntoolsdisplayorder       {memdiag}\ntimeout                 10\ndisplaybootmenu         Yes\n\n\nWindows Boot Loader\n-------------------\nidentifier              {7619dcc9-fafe-11d9-b411-000476eba25f}\ndevice                  ramdisk\u003d[boot]\\sources\\LaddsMini10.wim,{7619dcc8-fafe-11d9-b411-000476eba25f}\npath                    \\windows\\system32\\boot\\winload.efi\ndescription             2. Ladd\u0027s Mini10PE (Use First)\nlocale                  en-US\ninherit                 {bootloadersettings}\nisolatedcontext         Yes\nosdevice                ramdisk\u003d[boot]\\sources\\LaddsMini10.wim,{7619dcc8-fafe-11d9-b411-000476eba25f}\nsystemroot              \\windows\nbootmenupolicy          Legacy\ndetecthal               Yes\nwinpe                   Yes\nems                     No\n\n\nWindows Boot Loader\n-------------------\nidentifier              {default}\ndevice                  locate\u003d\\windows\\system32\\winload.efi\npath                    \\windows\\system32\\winload.efi\ndescription             1. Boot To System Drive\nlocale                  en-us\ninherit                 {bootloadersettings}\nisolatedcontext         Yes\nallowedinmemorysettings 0x15000075\nosdevice                locate\u003d\\windows\\system32\\winload.efi\nsystemroot              \\windows\nresumeobject            {84abc965-e405-11e8-afa7-7c8bca0118e9}\nnx                      OptIn\nbootmenupolicy          Standard\n\n\nWindows Boot Loader\n-------------------\nidentifier              {8a3b5fab-daeb-11e8-a321-0026832ea037}\ndevice                  ramdisk\u003d[boot]\\sources\\Hirens10PE.wim,{7619dcc8-fafe-11d9-b411-000476eba25f}\npath                    \\windows\\system32\\boot\\winload.efi\ndescription             3. Hiren\u0027s BootPE 1.0.1\nlocale                  en-US\nosdevice                ramdisk\u003d[boot]\\sources\\Hirens10PE.wim,{7619dcc8-fafe-11d9-b411-000476eba25f}\nsystemroot              \\Windows\ndetecthal               Yes\nwinpe                   Yes\nems                     No\n\n\nResume from Hibernate\n---------------------\nidentifier              {84abc965-e405-11e8-afa7-7c8bca0118e9}\ndevice                  unknown\npath                    \\windows\\system32\\winresume.efi\ndescription             Windows Resume Application\nlocale                  en-us\ninherit                 {resumeloadersettings}\nisolatedcontext         Yes\nallowedinmemorysettings 0x15000075\nfilepath                \\hiberfil.sys\nbootmenupolicy          Standard\n\n\nWindows Memory Tester\n---------------------\nidentifier              {memdiag}\ndevice                  unknown\npath                    \\EFI\\Microsoft\\Boot\\memtest.efi\ndescription             Windows Memory Diagnostic\nlocale                  en-us\ninherit                 {globalsettings}\nbadmemoryaccess         Yes\n\n\nEMS Settings\n------------\nidentifier              {emssettings}\nbootems                 No\n\n\nDebugger Settings\n-----------------\nidentifier              {dbgsettings}\ndebugtype               Serial\ndebugport               1\nbaudrate                115200\n\n\nRAM Defects\n-----------\nidentifier              {badmemory}\n\n\nGlobal Settings\n---------------\nidentifier              {globalsettings}\ninherit                 {dbgsettings}\n                        {emssettings}\n                        {badmemory}\n\n\nBoot Loader Settings\n--------------------\nidentifier              {bootloadersettings}\ninherit                 {globalsettings}\n                        {hypervisorsettings}\n\n\nHypervisor Settings\n-------------------\nidentifier              {hypervisorsettings}\ndescription             Hypervisor Settings\nhypervisordebugtype     Serial\nhypervisordebugport     1\nhypervisorbaudrate      115200\n\n\nResume Loader Settings\n----------------------\nidentifier              {resumeloadersettings}\ninherit                 {globalsettings}\n\n\nDevice options\n--------------\nidentifier              {7619dcc8-fafe-11d9-b411-000476eba25f}\nramdisksdidevice        boot\nramdisksdipath          \\boot\\boot.sdi\n\n```\n\n```\nbcdedit.exe /store bcd /set {84abc966-e405-11e8-afa7-7c8bca0118e9} device locate\u003dcustom:12000002\nbcdedit.exe /store bcd /set {84abc966-e405-11e8-afa7-7c8bca0118e9} osdevice locate\u003dcustom:12000002\n```\n\nBut I am still getting the light blue recovery screen if I use the \"Boot System Drive\" option\n\nThe winload.exe isn\u0027t there. Is that *[12000002](http://mistyprojects.co.uk/documents/BCDEdit/files/object_element_codes.htm#12000002 \"External link\") correct?*\n\n**Edited by LostNspace, 09 November 2018 - 10:31 PM.**\n"
    },
    {
      "id": "208193",
      "timestamp": "2018-11-10T18:36:55+00:00",
      "author": "LostNspace",
      "content": "\u003e **LostNspace** you can boot your USB grub2 menu on a Secure Boot EFI system if you follow the steps I posted here:\n\u003e\n\u003e [http://reboot.pro/to...e-4#entry207893](http://reboot.pro/topic/18182-uefi-multi-make-multi-boot-usb-drive/page-4#entry207893 \"\") about a month ago.\n\nThanks for the reply. I will look into this method as well. Just curious tho will grub2 boot in any secure boot situation? What I mean is the way I have my three boot options set up now I know this will always be secure boot compatible because it\u0027s legit Microsoft files. It\u0027s a shame I would have to use something like grub2 just to boot the system drive when my other two PE boots work so well from the BCD.\n\n"
    },
    {
      "id": "208196",
      "timestamp": "2018-11-11T04:38:35+00:00",
      "author": "LostNspace",
      "content": "I actually installed grub2 files from the secure boot Ubuntu as mentioned above by 911CD.net and added this to the grub.cfg and was able to successfully boot Win 10 on my secure boot laptop.\n\n```\nmenuentry \u0027Windows 10\u0027 {\n\nsearch --set\u003droot --file /EFI/Microsoft/Boot/bootmgfw.efi\nchainloader /EFI/Microsoft/Boot/bootmgfw.efi\n}\n```\n\nNow I just need to figure out how to boot my two Winpe from the grub.cfg menu\n\n"
    },
    {
      "id": "208198",
      "timestamp": "2018-11-11T13:32:30+00:00",
      "author": "wimb",
      "content": "On USB drive I have made with BOOTICE Professional mode a New entry for booting Local Harddisk with Windows 10\n\nI have added New Element **BootMenuPolicy** with value **Legacy**\n\n```\nWindows Boot Loader\n-------------------\nidentifier              {83891d32-cdd3-4301-b665-bdbd22baf78c}\ndevice                  boot\npath                    \\Windows\\system32\\winload.efi\ndescription             Windows 10 HDD\nlocale                  en-US\ninherit                 {6efb52bf-1766-41db-a6b3-0ee5eff72bd7}\n                        {7ea2e1ac-2e61-4728-aaa3-896d9d0a9f0e}\nosdevice                boot\nsystemroot              \\Windows\nresumeobject            {db2c7793-30a2-4711-aadf-61b056ab9d7d}\nbootmenupolicy          Legacy\n\n```\n\nThis entry was then modified with bcdedit in admin cmd window according to the description given by **cdob**\n\n```\nbcdedit.exe /store N:\\efi\\microsoft\\boot\\bcd /set {83891d32-cdd3-4301-b665-bdbd22baf78c} device locate\u003dcustom:12000002\nbcdedit.exe /store N:\\efi\\microsoft\\boot\\bcd /set {83891d32-cdd3-4301-b665-bdbd22baf78c} osdevice locate\u003dcustom:12000002\n\n\n```\n\nThen the entry for boooting local harddisk with windows 10 is looking like\n\n```\nWindows Boot Loader\n-------------------\nidentifier              {83891d32-cdd3-4301-b665-bdbd22baf78c}\ndevice                  locate\u003dcustom:12000002\npath                    \\Windows\\system32\\winload.efi\ndescription             Windows 10 HDD\nlocale                  en-US\ninherit                 {6efb52bf-1766-41db-a6b3-0ee5eff72bd7}\n                        {7ea2e1ac-2e61-4728-aaa3-896d9d0a9f0e}\nosdevice                locate\u003dcustom:12000002\nsystemroot              \\Windows\nresumeobject            {db2c7793-30a2-4711-aadf-61b056ab9d7d}\nbootmenupolicy          Legacy\n```\n\nThis entry selected from USB EFI Boot menu is working OK for UEFI Secure booting of Windows 10 from local harddisk.\n\n"
    },
    {
      "id": "208199",
      "timestamp": "2018-11-11T13:49:49+00:00",
      "author": "LostNspace",
      "content": "\u003e On USB drive I have made with BOOTICE Professional mode a New entry for booting Local Harddisk with Windows 10\n\u003e\n\u003e I have added New Element **BootMenuPolicy** with value **Legacy**\n\u003e\n\u003e ```\n\u003e Windows Boot Loader\n\u003e -------------------\n\u003e identifier              {83891d32-cdd3-4301-b665-bdbd22baf78c}\n\u003e device                  boot\n\u003e path                    \\Windows\\system32\\winload.efi\n\u003e description             Windows 10 HDD\n\u003e locale                  en-US\n\u003e inherit                 {6efb52bf-1766-41db-a6b3-0ee5eff72bd7}\n\u003e                         {7ea2e1ac-2e61-4728-aaa3-896d9d0a9f0e}\n\u003e osdevice                boot\n\u003e systemroot              \\Windows\n\u003e resumeobject            {db2c7793-30a2-4711-aadf-61b056ab9d7d}\n\u003e bootmenupolicy          Legacy\n\u003e\n\u003e ```\n\u003e\n\u003e This entry was then modified with bcdedit in admin cmd window according to the description given by **cdob**\n\u003e\n\u003e ```\n\u003e bcdedit.exe /store N:\\efi\\microsoft\\boot\\bcd /set {83891d32-cdd3-4301-b665-bdbd22baf78c} device locate\u003dcustom:12000002\n\u003e bcdedit.exe /store N:\\efi\\microsoft\\boot\\bcd /set {83891d32-cdd3-4301-b665-bdbd22baf78c} osdevice locate\u003dcustom:12000002\n\u003e\n\u003e\n\u003e ```\n\u003e\n\u003e Then the entry for boooting local harddisk with windows 10 is looking like\n\u003e\n\u003e ```\n\u003e Windows Boot Loader\n\u003e -------------------\n\u003e identifier              {83891d32-cdd3-4301-b665-bdbd22baf78c}\n\u003e device                  locate\u003dcustom:12000002\n\u003e path                    \\Windows\\system32\\winload.efi\n\u003e description             Windows 10 HDD\n\u003e locale                  en-US\n\u003e inherit                 {6efb52bf-1766-41db-a6b3-0ee5eff72bd7}\n\u003e                         {7ea2e1ac-2e61-4728-aaa3-896d9d0a9f0e}\n\u003e osdevice                locate\u003dcustom:12000002\n\u003e systemroot              \\Windows\n\u003e resumeobject            {db2c7793-30a2-4711-aadf-61b056ab9d7d}\n\u003e bootmenupolicy          Legacy\n\u003e ```\n\u003e\n\u003e This entry selected from USB EFI Boot menu is working OK for UEFI Secure booting of Windows 10 from local harddisk.\n\nThank you! I will give this a try. What Windows version are you using bcdedit from?\n\n"
    },
    {
      "id": "208200",
      "timestamp": "2018-11-11T14:11:04+00:00",
      "author": "wimb",
      "content": "\u003e Thank you! I will give this a try. What Windows version are you using bcdedit from?\n\nWindows 10 Home version 1803\n\n"
    },
    {
      "id": "208201",
      "timestamp": "2018-11-11T14:11:27+00:00",
      "author": "LostNspace",
      "content": "I\u0027m not exactly sure what I am doing wrong but I did as you suggested, wimb. This is how my entry looks after.\n\n```\nWindows Boot Loader\n-------------------\nidentifier              {3eb7af9b-a369-4cc6-ab3a-59e2c5e55e2b}\ndevice                  locate\u003d\\Windows\\system32\\winload.efi\npath                    \\Windows\\system32\\winload.efi\ndescription             Win10\nlocale                  en-US\ninherit                 {bootloadersettings}\nosdevice                locate\u003d\\Windows\\system32\\winload.efi\nsystemroot              \\Windows\nresumeobject            {b21f46df-401b-44b5-9ee6-28897fdd3319}\nbootmenupolicy          Legacy\n```\n\n\u003cbr /\u003e\n\n"
    },
    {
      "id": "208202",
      "timestamp": "2018-11-11T14:23:31+00:00",
      "author": "wimb",
      "content": "Your entry seems OK and corresponds well to mine.\n\nI have used **enum /v** so that the real values are visible instead of friendly names\n\n```\nbcdedit.exe /store N:\\efi\\microsoft\\boot\\bcd /enum /v\n```\n\nIs your entry still not working ?\n\nWhen I don\u0027t use /v then the entry is looking like\n\n```\nWindows Boot Loader\n-------------------\nidentifier              {83891d32-cdd3-4301-b665-bdbd22baf78c}\ndevice                  locate\u003d\\Windows\\system32\\winload.efi\npath                    \\Windows\\system32\\winload.efi\ndescription             Windows 10 HDD\nlocale                  en-US\ninherit                 {bootloadersettings}\n                        {globalsettings}\nosdevice                locate\u003d\\Windows\\system32\\winload.efi\nsystemroot              \\Windows\nresumeobject            {db2c7793-30a2-4711-aadf-61b056ab9d7d}\nbootmenupolicy          Legacy\n```\n\nThe difference with yours is that in my entry {globalsettings} are inherited as well, but I don\u0027t know if that is important ....\n\n"
    },
    {
      "id": "208203",
      "timestamp": "2018-11-11T14:31:54+00:00",
      "author": "LostNspace",
      "content": "\u003e Your entry seems OK and corresponds well to mine.\n\u003e\n\u003e I have used **enum /v** so that the real values are visible instead of friendly names\n\u003e\n\u003e ```\n\u003e bcdedit.exe /store N:\\efi\\microsoft\\boot\\bcd /enum /v\n\u003e ```\n\u003e\n\u003e Is your entry still not working ?\n\nUsing the /v switch Here is mine and still not working ![:(](https://reboot.pro/public/style_emoticons/default/sad.png)\n\n```\nWindows Boot Loader\n-------------------\nidentifier              {3eb7af9b-a369-4cc6-ab3a-59e2c5e55e2b}\ndevice                  locate\u003dcustom:12000002\npath                    \\Windows\\system32\\winload.efi\ndescription             Win10\nlocale                  en-US\ninherit                 {6efb52bf-1766-41db-a6b3-0ee5eff72bd7}\nosdevice                locate\u003dcustom:12000002\nsystemroot              \\Windows\nresumeobject            {b21f46df-401b-44b5-9ee6-28897fdd3319}\nbootmenupolicy          Legacy\n\n```\n\n\u003cbr /\u003e\n\n"
    },
    {
      "id": "208204",
      "timestamp": "2018-11-11T15:03:20+00:00",
      "author": "LostNspace",
      "content": "I tried it again from scratch.\n\nHere is the BCD entry:\n\n```\nWindows Boot Loader\n-------------------\nidentifier              {c22526af-340f-4d79-aa11-83e89ee79e16}\ndevice                  locate\u003dcustom:12000002\npath                    \\Windows\\system32\\winload.efi\ndescription             Boot System HD\nlocale                  en-US\ninherit                 {6efb52bf-1766-41db-a6b3-0ee5eff72bd7}\n                        {7ea2e1ac-2e61-4728-aaa3-896d9d0a9f0e}\nosdevice                locate\u003dcustom:12000002\nsystemroot              \\Windows\nresumeobject            {175f0d78-e811-4127-a28b-4d16dae5b68f}\nbootmenupolicy          Legacy\n\n```\n\nAnd this is the error I am getting. This is on a Dell Laptop (new) with secure boot on.\n\n[![gAcbDA.jpg](https://imagizer.imageshack.com/v2/xq90/921/gAcbDA.jpg)](https://imageshack.com/i/plgAcbDAj \"External link\")\n\n**Edited by LostNspace, 11 November 2018 - 03:09 PM.**\n"
    },
    {
      "id": "208205",
      "timestamp": "2018-11-11T15:23:56+00:00",
      "author": "wimb",
      "content": "Everything seems OK and I have no idea why it does not work for you ....\n\nWhat is the partitioning of your USB drive ? MBR or GPT with/without EFI partition ?\n\nI have portable SSD 250 GB and MBR partitioning with 1st partition 20 GB FAT32 Set Active and 2nd partition NTFS\n\nto be most compatible for booting on any hardware in BIOS or UEFI mode as described [here](http://reboot.pro/topic/21883-install-windows-10-from-usb-after-booting-with-wim-or-vhdx/?p\u003d208164 \"\")\n\n"
    },
    {
      "id": "208206",
      "timestamp": "2018-11-11T17:13:46+00:00",
      "author": "LostNspace",
      "content": "\u003e Everything seems OK and I have no idea why it does not work for you ....\n\u003e\n\u003e What is the partitioning of your USB drive ? MBR or GPT with/without EFI partition ?\n\u003e\n\u003e I have portable SSD 250 GB and MBR partitioning with 1st partition 20 GB FAT32 Set Active and 2nd partition NTFS\n\u003e\n\u003e to be most compatible for booting on any hardware in BIOS or UEFI mode as described [here](http://reboot.pro/topic/21883-install-windows-10-from-usb-after-booting-with-wim-or-vhdx/?p\u003d208164 \"\")\n\nI have no explanation for this but I booted into my WinPE because I had to re-image that laptop any way. I left the newly created entry as you suggested in my BCD with that \"Boot To System Drive\" as the default with a time out. WinNTSetup finished applying the image, the computer rebooted, booted to the USB drive as usually, my custom BCD menu came up and I let the timer go and it actually booted to the Win 10 machine. Everything seems to be working now. ![:blink:](https://reboot.pro/public/style_emoticons/default/blink.png)\n\n"
    },
    {
      "id": "208207",
      "timestamp": "2018-11-11T17:20:25+00:00",
      "author": "wimb",
      "content": "Nice to hear that the problem seems to be solved for you now ....\n\n![:cheers:](https://reboot.pro/public/style_emoticons/default/cheers.gif)\n\n"
    },
    {
      "id": "208208",
      "timestamp": "2018-11-11T20:12:54+00:00",
      "author": "LostNspace",
      "content": "\u003e Nice to hear that the problem seems to be solved for you now ....\n\u003e\n\u003e ![:cheers:](https://reboot.pro/public/style_emoticons/default/cheers.gif)\n\nWell I thought I was issue free. If I let the WinNTSetup finish and reboot, then boot the hard drive from the BCD on my USB setup starts as normal then about half way into the setup I get this:\n\n[![0lMPpu.jpg](https://imagizer.imageshack.com/v2/xq90/922/0lMPpu.jpg)](https://imageshack.com/i/pm0lMPpuj \"External link\")\n\nIf I pull the USB out while this message is up and the little circle is spinning, the circle will freeze like it\u0027s connected to the USB as far as the boot loader. If I unplug the USB before setup starts and let the system drive boot and finish the install and then boot the system drive from my bcd on the USB all is well. It\u0027s something that doesn\u0027t like the fact I booted the system drive from the bcd before the install could complete.\n\nI guess what I am saying is that as long as the OS is fully installed I can boot the system drive from my USB with no problems but on a reinstall the system doesn\u0027t like me booting the drive from my USB BCD.\n\n**Edited by LostNspace, 11 November 2018 - 08:18 PM.**\n"
    },
    {
      "id": "208209",
      "timestamp": "2018-11-11T20:32:17+00:00",
      "author": "wimb",
      "content": "\u003e Well I thought I was issue free. If I let the WinNTSetup finish and reboot, then boot the hard drive from the BCD on my USB setup starts as normal then about half way into the setup I get this:\n\u003e\n\u003e [![0lMPpu.jpg](https://imagizer.imageshack.com/v2/xq90/922/0lMPpu.jpg)](https://imageshack.com/i/pm0lMPpuj \"External link\")\n\u003e\n\u003e If I pull the USB out while this message is up and the little circle is spinning, the circle will freeze like it\u0027s connected to the USB as far as the boot loader. If I unplug the USB before setup starts and let the system drive boot and finish the install and then boot the system drive from my bcd on the USB all is well. It\u0027s something that doesn\u0027t like the fact I booted the system drive from the bcd before the install could complete.\n\u003e\n\u003e I guess what I am saying is that as long as the OS is fully installed I can boot the system drive from my USB with no problems but on a reinstall the system doesn\u0027t like me booting the drive from my USB BCD.\n\nI recognize this behaviour ....\n\n**During Install** of Windows 10 then an **EFI GPT partition for the efi boot files is required**.\n\nI get the same when installing Windows 10 in VHDX and using USB FAT32 drive as boot drive.\n\nI solved the problem by using the GPT EFI partition of my local GPT harddisk as boot drive during install in VHDX.\n\nAfter Install in VHDX I copy the VHDX to NTFS drive of portable SSD and can boot the VHDX using boot files located on MBR FAT32 partition of portable SSD.\n\n"
    },
    {
      "id": "208210",
      "timestamp": "2018-11-11T20:43:23+00:00",
      "author": "LostNspace",
      "content": "\u003e I recognize this behaviour ....\n\u003e\n\u003e **During Install** of Windows 10 then an **EFI GPT partition for the efi boot files is required**.\n\u003e\n\u003e I get the same when installing Windows 10 in VHDX and using USB FAT32 drive as boot drive.\n\u003e\n\u003e I solved the problem by using the GPT EFI partition of my local GPT harddisk as boot drive during install in VHDX.\n\u003e\n\u003e After Install in VHDX I copy the VHDX to NTFS drive of portable SSD and can boot the VHDX using boot files located on MBR FAT32 partition of portable SSD.\n\nWell it looks like I will have to script a vbs message saying to unplug the USB before reboot after WinNT does its thing. Doesn\u0027t look like this is going to be an easy solution or a practical one for no more than I need it for. I got grub2 to boot the system drive but then I\u0027m not sure how to boot my PE wims from the grub2 or the grub cfg menu so it\u0027s a no win either way. Thank you for replies to this issue, wimb and everyone else as well! :smile:\n\n"
    }
  ]
}