{
  "id": "14179",
  "title": "How to prep a USB stick for booting and which formats to use for best performance?",
  "isPinned": false,
  "isFirstTopic": false,
  "isLocked": false,
  "tags": [],
  "forumNotes": [
    {
      "id": "125736",
      "timestamp": "2011-03-26T18:50:14+00:00",
      "author": "pajenn",
      "content": "I tried to boot an 8 GB Windows 7 VHD file from a USB 2.0 flash drive and it was too slow to be practical. The same file boots fine (fairly fast) from my laptop\u0027s hard drive. I also tried the same thing with the contents of that VHD copied directly onto the USB stick followed by the required boot fix adjustments (master boot code update to nt60, bcdedit, size change fix, ...) but it was even slower. On the other hand, I have small (\\~500 MB) versions of BartXPE installed on other USB sticks (either directly or in ISO form), and they boot fine. Small VHD and IMG file version of Windows XP work fine too on my laptop (less well on older computers).  \n\nAnyway, in terms of performance, what format should be used for flash drives (FAT, FAT32, NTFS)? (and does it matter whether I use Win7 diskpart, HP USB Disk Storage Format Tool, or some other utility to do the formatting?)  \nDoes the number of partitions matter? (e.g. would be a good idea to create a separate boot partition on the flash drive?)  \nIs it better to transfer the WinPE or Windows files directly onto the flash drive, or to load it from a VHD, IMG or some other file placed on the USB stick? (What about using WinToFlash or similar utility?)  \nDoes the choice of master boot code (nt52, nt60, grub or something else) impact the performance of systems loaded from VHD or similar files?  \n\nIn the case of my Win7-VHD boot attempt from USB, I updated the USB stick\u0027s MBR to nt52 and copied WinXP boot files to it (ntldr, boot.ini, and additionally grub4dos and vboot files that could be accessed from boot.ini). That was the easiest (most familiar) way for me because that\u0027s how I have it set up on my local hard disk (WinXP). But I was wondering if that was a bad way to do it? I could have used nt60 instead or grub directly I suppose? Compatibility issues aside, what\u0027s best in terms of USB performance and speed?   \n"
    },
    {
      "id": "126348",
      "timestamp": "2011-04-06T08:09:18+00:00",
      "author": "pajenn",
      "content": "**update:** I still don\u0027t know what\u0027s the best way to do things, but I was able to use wimb\u0027s IMG_XP tool\u0027s VHD_W7_Compact.exe with a little help from EasyBCD to boot a 2 GB win7-VHD from a USB flash drive reasonably fast (comparable to booting off a local partition), however, I can only boot it once at the moment. On reboot I get BSOD... But in any case it\u0027s clearly possible to run win7 off a USB 2.0 drive at reasonable speeds.  \n\nHere\u0027s the setup I used to get this far:  \n**Flash drive:** 16 GB Kingston DataTraveler R500 (with *advertised* read/write speeds of 30/20 MB/s)  \n**Format:** NTFS (active primary partition) using win7\u0027s [diskpart](http://www.ehow.com/how_7153030_make-bootable-ntfs-usb.html \"External link\")  \n**Source:** 32-bit Windows 7 Ultimate installed on a 10 GB VHD and compacted with IMG_XP onto the flash drive (the original install to 10 GB VHD was done using vboot, but I removed the vboot driver before using VHD_W7_Compact to avoid conflict)  \n**Boot code:** I copied bootmgr and boot folder from the source to the flash drive and then edited its BCD with EasyBCD (I deleted the old boot entry, then Add New Entry -\\\u003e Virtual Disk -\\\u003e NeoSmart VHD Image entry with Win7-1.VHD selected from the flash drive and force portability option checked).  \n\nNote: You probably shouldn\u0027t need EasyBCD in addition to IMG_XP, but I had some trouble getting the compacted image to boot:  \n![Posted Image](http://i141.photobucket.com/albums/r47/End_game__/easybcd2.jpg)  \n\n![Posted Image](http://i141.photobucket.com/albums/r47/End_game__/easybcd1.jpg)   \n\n**Edited by pajenn, 06 April 2011 - 08:10 AM.**\n"
    },
    {
      "id": "126352",
      "timestamp": "2011-04-06T13:44:12+00:00",
      "author": "pajenn",
      "content": "edit: sorry posted the wrong pic above (the second one - it\u0027s too late to edit the actual post). The proper NeoSmart VHD Image entry looks as follows:  \n![Posted Image](http://i141.photobucket.com/albums/r47/End_game__/easybcd10.jpg)  \nEntry #2 is how it looks right after I\u0027ve added it. Entry #1 is how it looks once I\u0027ve booted with it and run EasyBCD from the 2 GB Windows 7.   \n\n**Edited by pajenn, 06 April 2011 - 01:45 PM.**\n"
    },
    {
      "id": "126360",
      "timestamp": "2011-04-06T15:45:02+00:00",
      "author": "amalux",
      "content": "OK, FWIW and at the risk of sounding like a broken record... having tried all of the above and many other approaches, most ending in failure, too much complexity (success must be repeatable, easily and quickly) or unacceptable performance; I keep coming back to the following conclusion. UFD\u0027s are too slow and limited for anything but PE\u0027s (IMO), better to stick with USB hard drives, however, everything below also works with UFD, just keep the images lite using vLite etc. Similary, VHD adds another level of complexity and the performance hit is unacceptable for my needs.  \n\n1) Start with external USB hard drive; partition a smallish (30-40GB) primary/active (NTFS) and partition the remainder for backup.  \n\n2) Use Acronis, Macrium Reflect, Drive Image, Ghost etc. to restore your favorite backup image to the primary partition of the USB (formatting/partitioning can be done on the fly if supported by your imaging SW). The source image needs to be created on real hardware with a matching architecture to the machines you want to boot but otherwise, no special setup is required (other than the following patch).  \n\n3) After restoring image to USB (from PE or regular windows), apply PWBoot patch from here \u003chttp://reboot.pro/6851/\u003e and boot to the USB drive. That\u0027s it!  \n\nYou could use SysPrep or other for a more \u0027universal\u0027 image but I prefer to just keep a few images to restore as needed (32/64bit, XP/W7 etc.) for faster/easier setup time. Tested successfully on a variety of hardware, below is full Win7x64sp1 booting on different hardware than created. There is also a variety of PE\u0027s (LiveXP, Win7PE_SE, Rescue Media etc.) available at boot menu if needed because they were there (on the source machine) at image creation so no additional/special setup needed on USB drive and performance is virtually indistinguishable from internal boot.  \n\n[![Posted Image](http://www2.mediafire.com/imgbnc.php/6b625c8dfffc88591f6f9970e80909604ea32bf0ed5f567538c1e7cb2e8b97b95g.jpg)](http://www.mediafire.com/imageview.php?quickkey\u003dejgvmy2qy25fnao\u0026thumb\u003d4 \"External link\")   \n"
    }
  ]
}