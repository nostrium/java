{
  "id": "18654",
  "title": "How can I load more than one driver using XP txtsetup.oem?",
  "isPinned": false,
  "isFirstTopic": false,
  "isLocked": false,
  "tags": [],
  "forumNotes": [
    {
      "id": "173980",
      "timestamp": "2013-06-24T01:05:08+00:00",
      "author": "steve6375",
      "content": "Hi\n\nI have been experimenting with chenall\u0027s DPMS code which creates a virtual F6 floppy containing the correct mass storage driver for whatever hardware it is being run on.\n\nI want to add the FiraDisk and WinvBlock drivers to the txtsetup.oem file that is created by DPMS. I have modified the code and can now make a virtual floppy with the firadisk and winvblock drivers on it and modify the txtsetup.oem file.\n\nThe problem is I am not sure how to add more than one driver to the txtsetup.oem so that they are all loaded automatically without pressing F6.\n\nI have tried adding multiple lines to the Files section e.g.\n\n\\[Files.scsi.iastor3\\]\n\ninf\u003dd1,firadisk.inf\n\ninf\u003dd1,WinVBlk.Inf\n\ncatalog\u003dd1,WinVBlk.Cat\n\ncatalog\u003dd1,WinVBlk.Cat  \ndriver\u003dd1,firadisk.sys,firadisk  \ndriver\u003dd1,WVBlk32.Sys,WinVBlock\n\ndriver\u003dd1,iastor3.sys,iastor3\n\ninf\u003dd1,iaahciinf\n\ncatalog\u003dd1,iaAHCI.cat\n\nbut this does not seem to work in that the AHCI driver is not loaded. If I omit the firadisk and winvblock lines, then it does load the AHCI driver.\n\nIs it possible to load more than one driver from txtsetup.oem??? Any ideas?\n\n\u003cbr /\u003e\n\n"
    },
    {
      "id": "173982",
      "timestamp": "2013-06-24T01:44:44+00:00",
      "author": "steve6375",
      "content": "[http://support.microsoft.com/kb/885756](http://support.microsoft.com/kb/885756 \"External link\")\n\nSeems to imply it can\u0027t be done!\n\n"
    },
    {
      "id": "173983",
      "timestamp": "2013-06-24T03:47:07+00:00",
      "author": "wimb",
      "content": "\u003e Create multiple sections in Txtsetup.oem. Create one section for each required driver file. Instruct the user to install multiple drivers from the driver disk. If the drivers must be loaded in a specific order, make sure that you tell the user.\n\nSeems to imply that it can be done .... (probably only by pressing F6)\n\nAnother approach without pressing F6 is working in any case:\n\nStep 1. Use DPsBase.exe for Integrating in your XP Setup source DriverPack MassStorage with TXT Mode Enabled.  \n[http://driverpacks.net/downloads](http://driverpacks.net/downloads \"External link\")\n\nStep 2. All MassStorage drivers are available from XP Setup Source and can be used combined with WinVBlock driver from Virtual Floppy\n\n[http://reboot.pro/to...7-vhd-xp-setup/](http://reboot.pro/topic/18547-vhd-xp-setup/ \"\")\n\n"
    },
    {
      "id": "173985",
      "timestamp": "2013-06-24T04:41:23+00:00",
      "author": "wimb",
      "content": "May be something like this by pressing F6 with **multiple sections** can work ..... (does not work for me)  \n\n\u003e \\[Disks\\]  \n\u003e disk1 \u003d \"FiraDisk Installation Disk\",\\\\firadisk.inf,\\\\  \n\u003e disk1 \u003d \"WinVBlock Driver Disk\",\\\\WinVBlk.inf,\\\\  \n\u003e disk1 \u003d \"Intel® Rapid Storage Technology Driver\", iaStor3.sys, \\\\  \n\u003e \\[Defaults\\]  \n\u003e scsi \u003d WinVBlock32  \n\u003e \\[SCSI\\]  \n\u003e firadiskx86\u003d\"FiraDisk Driver x86\"  \n\u003e WinVBlock32 \u003d \"WinVBlock Bus (32-bit)\"  \n\u003e iastor3 \u003d \"\"Intel® IaStor3 SATA AHCI Controller\"  \n\u003e \\[Files.scsi.firadiskx86\\]  \n\u003e driver\u003ddisk1,firadisk.sys,FiraDisk  \n\u003e inf\u003ddisk1,firadisk.inf  \n\u003e catalog\u003ddisk1,firadisk.cat  \n\u003e \\[HardwareIds.scsi.firadiskx86\\]  \n\u003e id\u003d\"detected\\\\firadisk\",\"FiraDisk\"  \n\u003e \\[Config.FiraDisk\\]  \n\u003e \\[Files.scsi.WinVBlock32\\]  \n\u003e driver \u003d disk1,WVBlk32.Sys,WinVBlock  \n\u003e inf \u003d disk1,WinVBlk.Inf  \n\u003e catalog \u003d disk1,WinVBlk.Cat  \n\u003e \\[Config.WinVBlock\\]  \n\u003e value\u003d\"\",TxtSetupInstalled,REG_DWORD,1  \n\u003e \\[HardwareIds.scsi.WinVBlock32\\]  \n\u003e id\u003d\"ROOT\\\\WINVBLOCK\",\"WinVBlock\"  \n\u003e id\u003d\"Detected\\\\WinVBlock\",\"WinVBlock\"  \n\u003e \\[Files.scsi.iastor3\\]  \n\u003e driver\u003ddisk1,iastor3.sys,iaStor  \n\u003e inf\u003ddisk1,iaahci.inf  \n\u003e catalog\u003ddisk1,iaAHCI.cat  \n\u003e \\[Config.iaStor\\]  \n\u003e value \u003d \"\", tag, REG_DWORD, 1b  \n\u003e value \u003d \"\", ErrorControl, REG_DWORD, 1  \n\u003e value \u003d \"\", Group, REG_SZ, \"SCSI Miniport\"  \n\u003e value \u003d \"\", Start, REG_DWORD, 0  \n\u003e value \u003d \"\", Type, REG_DWORD, 1  \n\u003e \\[HardwareIds.scsi.iastor3\\]  \n\u003e id \u003d \"PCI\\\\VEN_8086\\\u0026DEV_2922\\\u0026CC_0106\",\"iaStor\"  \n......... and all the other id  \n\n"
    },
    {
      "id": "173987",
      "timestamp": "2013-06-24T08:01:34+00:00",
      "author": "Wonko the Sane",
      "content": "@wimb\n\nThe \"multiple\" sections has been already talked about here (just for the record):\n\n[http://reboot.pro/to...t-ahci-drivers/](http://reboot.pro/topic/12043-choosing-best-ahci-drivers/ \"\")\n\n[http://reboot.pro/to...-plop/?p\u003d122941](http://reboot.pro/topic/13912-grub4dos-and-plop/?p\u003d122941 \"\")\n\n[http://reboot.pro/to...e-4#entry121275](http://reboot.pro/topic/13731-full-universal-xpvhd-run-from-usb-finally-work-for-me-maybe-for-you-too/page-4#entry121275 \"\")\n\n![:cheers:](http://reboot.pro/public/style_emoticons/default/cheers.gif)\n\nWonko\n\n"
    },
    {
      "id": "173989",
      "timestamp": "2013-06-24T10:37:28+00:00",
      "author": "steve6375",
      "content": "multiple defaults looks promising! I will try that.\n\nI have got install direct from ISOs with DPMS auto-detect working now, but you have to choose the AHCI driver (there is only one in the list), then Firadisk driver and/or winvblock driver.\n\nIt would be nice if this was automatic...\n\n"
    },
    {
      "id": "173992",
      "timestamp": "2013-06-24T14:58:14+00:00",
      "author": "steve6375",
      "content": "hmmm...\n\nI tried the multiple \\[Defaults\\] section as described. It does not seem to work in that no driver is installed by default.\n\nI can use F6 and manually pick the drivers but that is not the point - I want it to be automatic!\n\nthe generated txtsetup.oem (that doesn\u0027t work) is attached. I have three consecutive entries and they have different disks. Anyone see anything wrong or that conflicts with the other post [here](http://www.msfn.org/board/topic/72125-txtsetupoem-multiple-oem-mass-storage-drivers-defaults-section/page__view__findpost__p__549271 \"External link\") ?\n\nthanks  \n\n#### Attached Files {#attach_wrap}\n\n* [![Attached File](http://reboot.pro/public/style_extra/mime_types/zip.gif)](http://reboot.pro/index.php?s\u003d4955fa22cf512ede7f0fc64aec2dfab4\u0026app\u003dcore\u0026module\u003dattach\u0026section\u003dattach\u0026attach_id\u003d14364 \"Download attachment\") [**txtsetup.zip**](http://reboot.pro/index.php?s\u003d4955fa22cf512ede7f0fc64aec2dfab4\u0026app\u003dcore\u0026module\u003dattach\u0026section\u003dattach\u0026attach_id\u003d14364 \"Download attachment\") **1.38KB** 499 downloads\n\n"
    },
    {
      "id": "174004",
      "timestamp": "2013-06-25T05:07:26+00:00",
      "author": "wimb",
      "content": "\u003e I tried the multiple \\[Defaults\\] section as described. It does not seem to work in that no driver is installed by default.  \n\u003e\n\u003e I can use F6 and manually pick the drivers but that is not the point - I want it to be automatic!\n\nMy multiple sections proposal (which does NOT work yet for me) has only one entry in the \\[Defaults\\] section.\n\nI think the multiple sections approach is not automatic for more drivers and will require to use F6 to select drivers.\n\nI have scsi \u003d WinVBlock32 as Default which is working automatic OK, but when I use F6 to select\n\nthen the driver files in the Virtual Floppy are not found in the TXT-mode copy proces.\n\nAlso FiraDisk does not work this way for me.\n\nA good working automatic solution is Integrating MassStorage and Chipset DriverPacks in XP Setup Source and making new ISO file.\n\nThen WinVBlock driver in Virtual Floppy can be used with that ISO file to Install XP in VHD on any hardware.\n\n[http://reboot.pro/to...7-vhd-xp-setup/](http://reboot.pro/topic/18547-vhd-xp-setup/ \"\")\n\n![:cheers:](http://reboot.pro/public/style_emoticons/default/cheers.gif)\n\n"
    },
    {
      "id": "174052",
      "timestamp": "2013-06-26T13:29:07+00:00",
      "author": "steve6375",
      "content": "Well, I have \\***almost**\\* got it working buy using two F6 floppies!\n\nBoth virtual floppies are identical but the txtsetup.oem has default\u003diastor on one and on the other I have default\u003dfiradisk.\n\n(fd0) default\u003dfiradisk\n\n(fd1) default\u003diastor\n\nboth disks have all driver files for firadisk and ahci and both disks have a disk0 and disk1 empty file used as a diskid file.\n\nNow I do not need to use F6! When XP Setup loads, the firadisk driver is loaded without pressing F6 (if it wasn\u0027t I would get a BSOD).\n\nWhen I press F8 to accept the EULA, I can now see both the USB drive **and** the HDD listed (so I know that the AHCI driver has been loaded)\n\nSo it seems to have loaded both drivers automatically. ![:clap:](http://reboot.pro/public/style_emoticons/default/clap.gif)\n\nHowever, the problem is that immediately after formatting the HDD and then going into the text-mode copyfiles stage, it stops with a \u0027Please insert disk \"xxxx\" into Drive A:\"\n\nI have been trying various things for ages to get past this but I seem to be stuck! Once (and only once!) I got it to work but I could not repeat it even though I know what I did ![:frusty:](http://reboot.pro/public/style_emoticons/default/frusty.gif) !\n\nI tried it on a VM (using ICH9) and a real nbook (using ICH7) - both give identical behaviour, so it is not a VM problem.\n\nAny ideas?\n\n"
    },
    {
      "id": "174078",
      "timestamp": "2013-06-26T21:33:57+00:00",
      "author": "steve6375",
      "content": "SUCCESS!!!\n\nI can load 1 AHCI driver and 1 RamDisk driver (e.g. Firadisk) automatically by using two virtual F6 floppies! ![:clap:](http://reboot.pro/public/style_emoticons/default/clap.gif)\n\nSo now I can install from a bootable USB containing an unmodified XP ISO and install to an AHCI target system without needing to hit F6 during Setup and use chenalls (heavily) modified DPMS.bat to select the correct AHCI driver!\n\nphew! ![:suda:](http://reboot.pro/public/style_emoticons/default/suda.gif)\n\n"
    },
    {
      "id": "174110",
      "timestamp": "2013-06-27T09:56:38+00:00",
      "author": "Wonko the Sane",
      "content": "\u003e SUCCESS!!!\n\u003e\n\u003e I can load 1 AHCI driver and 1 RamDisk driver (e.g. Firadisk) automatically by using two virtual F6 floppies! ![:clap:](http://reboot.pro/public/style_emoticons/default/clap.gif)\n\u003e\n\u003e So now I can install from a bootable USB containing an unmodified XP ISO and install to an AHCI target system without needing to hit F6 during Setup and use chenalls (heavily) modified DPMS.bat to select the correct AHCI driver!\n\u003e\n\u003e phew! ![:suda:](http://reboot.pro/public/style_emoticons/default/suda.gif)\n\nCare to provide in this thread the actual result that is successful?\n\n![:cheers:](http://reboot.pro/public/style_emoticons/default/cheers.gif)\n\nWonko\n\n"
    },
    {
      "id": "174119",
      "timestamp": "2013-06-27T11:56:54+00:00",
      "author": "steve6375",
      "content": "I was just doing some more investigating. I think I have a grip on things now!\n\nIt seems the problem in the copyfiles stage (after formatting) is that it expects the \u0027current\u0027 floppy drive A: to have the correct driver files.\n\nThe \u0027current\u0027 drive A: is whatever was accessed last after selecting the drivers using F6 + S and then it loading the drivers before getting to the EULA screen.\n\ne.g.\n\nWe have two disks fd0 and fd1\n\nfd0 \u0027disk0\u0027 tag file txtsetup.oem has firadisk as default\n\nfd1 \u0027disk1\u0027 tag file txtsetup.oem has iastor as default\n\nIn F6 we load iastor and firadisk and then the drivers are loaded (not sure what order..) so we can see the internal hard disk to format it.\n\nNow in copy-files textmode stage after formatting has taken place, it tries to find the drivers so it can copy them over to the hard disk. So it looks for a disk0 tag file on the current drive A: - if present it copies over the sys/inf/cat files (if not present it stops and asks you to insert the correct disk).\n\nIf the disk0 tag was present and the file copy was successful, it now looks for the disk1 tag on the current drive - it does not find it so it asks you to insert the correct disk!\n\nSo the problem seems to be that **at the Copyfiles stage, XP does not have any concept of floppies A: and B:** - just the current \u0027drive A:\u0027!!!\n\nSo the way I got round this was:\n\n1. fd0 and fd1 have identical files on them. The tag file is identical (e.g. disk1) and the other driver files are identical\n\n2. The **only**difference is that one txtsetup.oem has a \\[Defaults\\] section for firadisk and the other txtsetup.oem file has a \\[Defaults\\] section for iastor\n\nSo that \u0027advice\u0027 about having separate disk tag files was wrong, it actually makes things worse (unless you have all the tag files on both floppies)!\n\nAlso, for txtsetup.oem, I found that you can have as many \\[xxxxx\\] sections as you like and in any order you like! It will just read them all. The only exception is you should have only one \\[Defaults\\] section. This makes making hybrid txtsetup.oem F6 files really easy! Just concatenate all the oemsetup.inf files together in one big file!\n\nOnly the first entry in the \\[Defaults\\] section is valid.\n\nYou can have only one driver\u003ddisk.filename entry in the \\[Files.scs.ID\\] section any others will be ignored (so multiple drivers are not possible).\n\nDuring the development of this, I found lots of bugs in chenalls dpms.bat (one of which fails to copy the .sys file to the floppy so that it fails in GUI-mode!).\n\nphew! ![:dubbio:](http://reboot.pro/public/style_emoticons/default/dubbio.gif) ![:cold:](http://reboot.pro/public/style_emoticons/default/cold.gif) ![:clap:](http://reboot.pro/public/style_emoticons/default/clap.gif)\n\nThis took me **days** to work out (1 day wasted due to me breaking my working code and not realising it! ![:frusty:](http://reboot.pro/public/style_emoticons/default/frusty.gif) ) so I hope this helps somebody else!\n\ncheers\n\nSteve\n\n\u003cbr /\u003e\n\n"
    },
    {
      "id": "174120",
      "timestamp": "2013-06-27T12:13:25+00:00",
      "author": "Wonko the Sane",
      "content": "\u003e This took me **days** to work out (1 day wasted due to me breaking my working code and not realising it! ![:frusty:](http://reboot.pro/public/style_emoticons/default/frusty.gif) ) **so I hope this helps somebody else!**\n\nYes :smile:, as hinted before, IMHO **it will** ![:thumbup:](http://reboot.pro/public/style_emoticons/default/thumbup.gif) when you will post additionally something \"definite\" (possibly a final, working set of examples).\n\nBut take your time, no hurry whatsoever ![:fine:](http://reboot.pro/public/style_emoticons/default/ok.gif).\n\n![:cheers:](http://reboot.pro/public/style_emoticons/default/cheers.gif)\n\nWonko\n\n"
    },
    {
      "id": "174131",
      "timestamp": "2013-06-27T20:45:11+00:00",
      "author": "steve6375",
      "content": "OK, well it looks like there is still a problem!\n\nchenall\u0027s DPMS.bat parses the DriverPack.ini file for a PCI match, a section for 8086_3B29 looks like this (simplified)\n\n```\n[I7]\n; 11.2.0.1006\nms_count\u003d1\nms_1_deviceName\u003d\"Intel ICH9/ICH10 SATA AHCI/RAID RST 11.2\"\nms_1_tag\u003d\"iastor7\"\nms_1_sysFile\u003d\"iastor7.sys\"\nms_1_hwids\u003d\"PCI\\VEN_8086\u0026DEV_3B29\u0026CC_0106\"\nms_1_isBusExtender\u003dfalse\nms_1_exc_disableIfOS\u003d\"w2k\"\n```\n\nFrom this chenalls DPMS.bat (now heavily modified!) make up a txtsetup.oem like this:\n\n\\[Disks\\]  \nd1\u003d\"DPMS Installation Disk by chenall(diskd)\",\\\\disk1,\\\\\n\n\\[scsi\\]  \niastor7\u003d\"Intel ICH9/ICH10 SATA AHCI/RAID RST 11.2\"\n\n\\[Files.scsi.iastor7\\]  \ninf\u003dd1,iaAHCI.inf  \ncatalog\u003dd1,iaAHCI.cat  \ndriver\u003dd1,**iastor7.sys**,iastor\n\n\\[HardwareIds.scsi.iastor7\\]  \nid\u003d\"PCI\\\\VEN_8086\\\u0026DEV_3B29\\\u0026CC_0106\",\"**iastor7**\"\n\n\\[Defaults\\]  \nscsi\u003diastor7\n\nand this works fine for text-mode setup. Inside the Intel standard iaahci.inf file it calls for the iastor.sys driver.\n\nHowever, when we get to GUI-mode setup, the install stops with a \u0027**can\u0027t find iastor.sys in C:\\\\Windows\\\\OEMDir**\" message. Sure enough the iastor.sys file (which was present on the F6 floppy) had not been copied across in text mode. After all, why would it be copied over when it is not mentioned in the txtsetup.oem file?\n\nThis seems a major flaw with DPMS and the whole driverpack.ini file setup! ![:dubbio:](http://reboot.pro/public/style_emoticons/default/dubbio.gif) The driverpack folder has both iastor7.sys and iastor.sys, but textmode setup will only copy across iastor7.sys and you cannot have multiple **driver\u003d**lines in txtsetup.oem as the extra one are just ignored!\n\nSo I thought that all I need to do was change the name of the driver in the txtsetup.oem file to iastor.sys and all would be well. We can just ignore iastor7.sys.\n\nHowever, I (***eventually***!) found after much head scratching that I also need to change the \u0027service\u0027 name (in **bold red** above) which MUST match the driver.sys name or XP will just not load the driver!\n\nAnyway, bottom line is I can now install all the way through both text-mode and GUI mode without needing to press F6 (using FiraDisk only) and all from a vanilla ISO. The user still has to reboot back to the USB drive for the 2nd step, as it is still a 2-step process.\n\n"
    },
    {
      "id": "174134",
      "timestamp": "2013-06-27T23:10:01+00:00",
      "author": "ilko",
      "content": "I\u0027ve reported that issue a while ago and PM-ed Chenall as well, but it seems DPMS work is stalled for now:\n\n[http://code.google.c...es/detail?id\u003d21](http://code.google.com/p/grubutils/issues/detail?id\u003d21 \"External link\")\n\nAs an ugly workaround I\u0027ve manually edited driverpack.ini to get rid of iastorX and the similar entries, there are a few other entries like iastor.\n\nA few lines of code were also included to add pnpinterface\u003d5 which is (most likely) required for some drivers. Detection is made by presence of the string scsiport.sys or storport.sys in the sys file.\n\nIf you want to compare, here is a modded DPMS, in \\\\files\\\\DPMS\\\\:\n\n[http://code.google.c...-0-beta9_rc4.7z](http://code.google.com/p/winsetupfromusb/downloads/detail?name\u003dWinSetupFromUSB_1-0-beta9_rc4.7z \"External link\")\n\n"
    },
    {
      "id": "174135",
      "timestamp": "2013-06-27T23:21:26+00:00",
      "author": "steve6375",
      "content": "Thanks, but I have it all working now (I think!).\n\nI now look at each INF file that is in the driver folder and use the sys driver that is mentioned in the proper matching inf file.\n\nThere were quite a few issues with chenall\u0027s DPMS, e.g. using wrong driver (the one in the driverpack.ini is not always correct - there may be 3 or 4 infs and drivers in one driver folder), only testing for a match on 3 characters of the device ID (i.e. 8086 292\\*) and several others I have forgotten about at the moment! Oh yes, the floppies that he made had a bad BPB parameter and if you look at them they have weird files listed in them - this was due to \\\\x9 that should have been \\\\x09.\n\n(I did email him with the bugs and did have one reply of thanks).\n\nIf you want to use my DPMS.bat (with firadisk and winvblock) when I am finished you are welcome. My code is not as \u0027nice\u0027 as chenalls but it seems to work! I don\u0027t have any special scsi code in it though....\n\n"
    },
    {
      "id": "174136",
      "timestamp": "2013-06-28T00:30:05+00:00",
      "author": "steve6375",
      "content": "\u003e Yes :smile:, as hinted before, IMHO **it will** ![:thumbup:](http://reboot.pro/public/style_emoticons/default/thumbup.gif) when you will post additionally something \"definite\" (possibly a final, working set of examples).\n\u003e\n\u003e But take your time, no hurry whatsoever ![:fine:](http://reboot.pro/public/style_emoticons/default/ok.gif).\n\u003e\n\u003e ![:cheers:](http://reboot.pro/public/style_emoticons/default/cheers.gif)\n\u003e\n\u003e Wonko\n\nDoes [this](http://rmprepusb.blogspot.co.uk/2013/06/txtsetupoem-files-for-f6-floppy-disks.html \"External link\") help?\n\n"
    },
    {
      "id": "174149",
      "timestamp": "2013-06-28T12:13:53+00:00",
      "author": "steve6375",
      "content": "I have now added support for Config sections in my version. What I do is look for a \\[Config section with a \u0027value\u0027 and a PnPInstance string in the **txtsetup.oem**file that is in the driver pack folder.\n\nI use the first section that I find.\n\nNT4 sections don\u0027t seem to use PnPInstance.\n\nThe only thing is if there is more than one section with PNPInstance in, then I only the use first one as I don\u0027t really know which hardware ID it belongs to..\n\n"
    },
    {
      "id": "174153",
      "timestamp": "2013-06-28T14:33:56+00:00",
      "author": "Wonko the Sane",
      "content": "I spent some time looking around on the matter.\n\nOnly questions and guesses ![:(](http://reboot.pro/public/style_emoticons/default/sad.png).\n\nSome very wild ![:ph34r:](http://reboot.pro/public/style_emoticons/default/scared9.gif), some hopefully \"educated\" ![:dubbio:](http://reboot.pro/public/style_emoticons/default/dubbio.gif)\n\nSteve, the file you posted on #7 seems like having a \"queer\" disk numbering scheme in \\[Disks\\].\n\nAs well, Wimb\u0027s posted example has all disks being \"disk1\"\n\nMaybe this is connected? ![:unsure:](http://reboot.pro/public/style_emoticons/default/unsure.png)\n\nWhy not trying following EXACTLY the given example on MSDN?\n\n[http://msdn.microsof...f544738(v\u003dvs.85](http://msdn.microsoft.com/en-us/library/windows/hardware/ff544738(v\u003dvs.85 \"External link\")).aspx\n\n[http://msdn.microsof...f541068(v\u003dvs.85](http://msdn.microsoft.com/en-us/library/windows/hardware/ff541068(v\u003dvs.85 \"External link\")).aspx\n\netc.\n\nWhat happens if one uses the \"Computer\" component instead of the \"scsi\" one?\n\nCannot somehting \\*like\\* this:\n\n[http://board.vitalig...hment.php?aid\u003d9](http://board.vitaligraf.de/attachment.php?aid\u003d9 \"External link\")\n\nbe used?\n\nOr is it \"triggered\" by the actual PNP or PCI\\\\VEN?\n\nOT, but not much, see how the good Intel guys use an EFI ramdisk :wink::\n\n[http://downloadmirro...lease_notes.txt](http://downloadmirror.intel.com/7571/eng/ramdriver1.1_release_notes.txt \"External link\")\n\nAs always, the MS docs are \"strange\", seemingly NT4 allowed \"Display\" as \"component\":\n\n[http://support.micro...kb/166028/en-us](http://support.microsoft.com/kb/166028/en-us \"External link\")\n\nand also more \"components\":\n\n[http://ifsc2.ifsc.us...k1/TXTSETUP.OEM](http://ifsc2.ifsc.usp.br/drivers/Scanner/DeskScanII/disk1/TXTSETUP.OEM \"External link\")\n\n\u003e # \\\u003ccomponent_name\\\u003e is one of computer, display, keyboard, mouse,  \n\u003e # \"keyboard layout\", or scsi.\n\nWhat happens if we \"fake\" that firadisk is (say) a \"display\" and winvblock is (still say) a \"mouse\"? ![:unsure:](http://reboot.pro/public/style_emoticons/default/unsure.png)\n\nOr possibly this changed with XP? (it is seemingly still valid for 2K):\n\n[http://downloadmirro.../eng/readme.txt](http://downloadmirror.intel.com/8878/eng/readme.txt \"External link\")\n\nBut then some info around is obsolete:  \n[http://www.reasonco....64/txtsetup.oem](http://www.reasonco.com/support/drivers/Tyan%20-%20Guidant/SAS/LSI1068E_driver_1211500/1211500/StorPort/lsi_sas/xp_x64/txtsetup.oem \"External link\")\n\nI.e. what if there is only one \"default\" ***but one for each component***?\n\n![:cheers:](http://reboot.pro/public/style_emoticons/default/cheers.gif)\n\nWonko\n\n"
    },
    {
      "id": "174156",
      "timestamp": "2013-06-28T14:44:54+00:00",
      "author": "steve6375",
      "content": "As I said, I have this all working now with one driver per disk (\u003d2), thanks anyway.\n\nThe problem with the file I posted was just that there were multiple defaults which Setup won\u0027t accept.\n\n"
    },
    {
      "id": "174160",
      "timestamp": "2013-06-28T14:59:13+00:00",
      "author": "Wonko the Sane",
      "content": "\u003e As I said, I have this all working now with one driver per disk (\u003d2), thanks anyway.\n\u003e\n\u003e The problem with the file I posted was just that there were multiple defaults which Setup won\u0027t accept.\n\nSure, but if I got it right the original idea was to have the possibility of three or more of them drivers. ![:unsure:](http://reboot.pro/public/style_emoticons/default/unsure.png) (or maybe that was just wimb\u0027s idea ![:dubbio:](http://reboot.pro/public/style_emoticons/default/dubbio.gif)).\n\nIf you prefer, I was wondering if there were other ways to skin that cat. :wink:\n\nIf you could post your \"final\" setup, would anyway be of use, (or a link to your site where this \"final\" version is).\n\n![:cheers:](http://reboot.pro/public/style_emoticons/default/cheers.gif)\n\nWonko\n\n"
    },
    {
      "id": "174175",
      "timestamp": "2013-06-28T22:39:11+00:00",
      "author": "steve6375",
      "content": "I am still running into problems where an inf file refers to more than one driver but I can only specify one driver line, so only one driver is copied across by text-mode setup....\n\nAll I need to do is make the oemsetup.txt file cause Setup to copy the driver.sys file over...\n\nThen it occurred to me that I can have multiple catalog entries in the txtsetup.oem file but AFAIK XP textmode doesn\u0027t use them, in fact it probably does not even care what the files are... they need not even be cat files... they could be any file like .sys files for instance... ![:dubbio:](http://reboot.pro/public/style_emoticons/default/dubbio.gif)\n\nSo for every driver file present on the F6 disk, I have added a catalog line (even if the driver.sys is already in the driver line), e.g.\n\n```\n[Files.scsi.iastor3]\ndriver\u003ddisk1,iastor3.sys,iaStor\ninf\u003ddisk1,iaahci.inf\ncatalog\u003ddisk1,iaAHCI.cat\ncatalog\u003ddisk1,iastor3.sys\ncatalog\u003ddisk1,iastor.sys\n```\n\nand the result is.....\n\n![:1st:](http://reboot.pro/public/style_emoticons/default/1st.gif) ![:happy_dance2:](http://reboot.pro/public/style_emoticons/default/celebrate3.gif) ![:happy_dance2:](http://reboot.pro/public/style_emoticons/default/celebrate3.gif) ![:happy_dance2:](http://reboot.pro/public/style_emoticons/default/celebrate3.gif) ![:happy_dance2:](http://reboot.pro/public/style_emoticons/default/celebrate3.gif) IT WORKS! ![:happy_dance2:](http://reboot.pro/public/style_emoticons/default/celebrate3.gif)\n\n\u003cbr /\u003e\n\n"
    },
    {
      "id": "174185",
      "timestamp": "2013-06-29T08:15:34+00:00",
      "author": "steve6375",
      "content": "Attached are the two txtsetup.oem files and directory listings for a VBox system with a SCSI controller (needs symmpiv driver (not lsi_scsi driver).\n\nThis allows an ISO boot from an XP Setup ISO without the need to press F6 to load the firadisk and symmpiv drivers.\n\nThere are duplicated lines (caused by the logic in my dpms.bat script) but these don\u0027t matter.\n\nWhen running E2B Install from XP, it runs my DPMS script and finds two OEM drivers, lsi_scsi (W2K) and symmpiv (WXP), it then asks the user which one they want to load as the default. If you choose lsi_scsi then you get an \u0027lsi_scsi.sys could not be found\u0027 message (though it is there!), if you choose the symmpiv driver then it installs XP just fine.  \n\n#### Attached Files {#attach_wrap}\n\n* [![Attached File](http://reboot.pro/public/style_extra/mime_types/zip.gif)](http://reboot.pro/index.php?s\u003d4955fa22cf512ede7f0fc64aec2dfab4\u0026app\u003dcore\u0026module\u003dattach\u0026section\u003dattach\u0026attach_id\u003d14389 \"Download attachment\") [**DPMS2_F6_Floppies.zip**](http://reboot.pro/index.php?s\u003d4955fa22cf512ede7f0fc64aec2dfab4\u0026app\u003dcore\u0026module\u003dattach\u0026section\u003dattach\u0026attach_id\u003d14389 \"Download attachment\") **1.7KB** 454 downloads\n\n"
    },
    {
      "id": "174188",
      "timestamp": "2013-06-29T08:51:37+00:00",
      "author": "Wonko the Sane",
      "content": "\u003e Attached are the two txtsetup.oem files and directory listings for a VBox system with a SCSI controller (needs symmpiv driver (not lsi_scsi driver).\n\u003e\n\u003e This allows an ISO boot from an XP Setup ISO without the need to press F6 to load the firadisk and symmpiv drivers.\n\nI don\u0027t get it.\n\nToday I am probably a bit more retarded than usual, but I don\u0027t understand, could you better explain?\n\nThe two .txt\u0027s contain (each) 4 (four) drivers:\n\n1. lsi_scsi\u003d\"LSI Logic Ultra320 SCSI RAID/2000/VMWare LSI (W2K3)\"\n2. symmpiv\u003d\"LSI Logic SAS 3000 / VMWare v10 (WXP)\"\n3. firadisk\u003dFiraDisk_Driver\n4. WinVBlk\u003dWinVBlock_Driver\n\nOne has scsi\u003dsymmpiv as \"default\", the other one has scsi\u003dfiradisk.\n\nWhen you have them on (I presume) first and second floppy, what happens?\n\nYou are prompted to choose between two options (lsi_scsi and symmpiv ) of which one won\u0027 t work (and as such it is not an option) and you have to choose symmpiv anyway? ![:unsure:](http://reboot.pro/public/style_emoticons/default/unsure.png)\n\nThen which drivers are installed?\n\n1. All four of them.\n2. Only symmpiv and firadisk.\n3. Only symmpiv, firadisk and WinVBlk\n\n![:cheers:](http://reboot.pro/public/style_emoticons/default/cheers.gif)\n\nWonko\n\n"
    },
    {
      "id": "174190",
      "timestamp": "2013-06-29T09:04:59+00:00",
      "author": "steve6375",
      "content": "When **DPMS.bat**runs, if there is more than one OEM driver, it will prompt the user to choose which one you want for floppy 1 (floppy 0 must be either firadisk or winvblock)\n\nThe \\[Defaults\\] section defines which will be loaded by Setup if F6 is not pressed - so firadisk and symmpiv will be loaded automatically.\n\nXP does not prompt unless you press F6.\n\nSo in this case, winvblock is ignored (unless the user presses F6 and chooses it).\n\nAny files mentioned in the symmpiv section will be copied across\n\n```\n[Files.scsi.symmpiv]\ninf\u003dd1,lsi_scsi.inf\ninf\u003dd1,lsi_scsi.inf\ncatalog\u003dd1,lsi_scsi.cat\ninf\u003dd1,symmpi.inf\ninf\u003dd1,symmpi.inf\ncatalog\u003dd1,mpixp32.cat\ndriver\u003dd1,symmpi.sys,symmpiv\ncatalog\u003dd1,lsi_scsi.sys\ncatalog\u003dd1,symmpi.sys\n```\n\nlsi_scsi.sys and lsi_scsi.inf and lsi_scsi.cat will be copied over and XP will attempt to auto-install them in GUI-mode (all inf\u003d will be evaluated with PnP in GUI-mode).\n\nBut the only driver loaded in text-mode (forced by the Defaults section) will be symmpi.sys (and firadisk),\n\nIn fact, in this case, lsi_scsi is actually a W2K driver and so is ignored by XP.\n\n"
    },
    {
      "id": "173980",
      "timestamp": "2013-06-24T01:05:08+00:00",
      "author": "steve6375",
      "content": "Hi\n\nI have been experimenting with chenall\u0027s DPMS code which creates a virtual F6 floppy containing the correct mass storage driver for whatever hardware it is being run on.\n\nI want to add the FiraDisk and WinvBlock drivers to the txtsetup.oem file that is created by DPMS. I have modified the code and can now make a virtual floppy with the firadisk and winvblock drivers on it and modify the txtsetup.oem file.\n\nThe problem is I am not sure how to add more than one driver to the txtsetup.oem so that they are all loaded automatically without pressing F6.\n\nI have tried adding multiple lines to the Files section e.g.\n\n\\[Files.scsi.iastor3\\]\n\ninf\u003dd1,firadisk.inf\n\ninf\u003dd1,WinVBlk.Inf\n\ncatalog\u003dd1,WinVBlk.Cat\n\ncatalog\u003dd1,WinVBlk.Cat  \ndriver\u003dd1,firadisk.sys,firadisk  \ndriver\u003dd1,WVBlk32.Sys,WinVBlock\n\ndriver\u003dd1,iastor3.sys,iastor3\n\ninf\u003dd1,iaahciinf\n\ncatalog\u003dd1,iaAHCI.cat\n\nbut this does not seem to work in that the AHCI driver is not loaded. If I omit the firadisk and winvblock lines, then it does load the AHCI driver.\n\nIs it possible to load more than one driver from txtsetup.oem??? Any ideas?\n\n\u003cbr /\u003e\n\n"
    },
    {
      "id": "173982",
      "timestamp": "2013-06-24T01:44:44+00:00",
      "author": "steve6375",
      "content": "[http://support.microsoft.com/kb/885756](http://support.microsoft.com/kb/885756 \"External link\")\n\nSeems to imply it can\u0027t be done!\n\n"
    },
    {
      "id": "173983",
      "timestamp": "2013-06-24T03:47:07+00:00",
      "author": "wimb",
      "content": "\u003e Create multiple sections in Txtsetup.oem. Create one section for each required driver file. Instruct the user to install multiple drivers from the driver disk. If the drivers must be loaded in a specific order, make sure that you tell the user.\n\nSeems to imply that it can be done .... (probably only by pressing F6)\n\nAnother approach without pressing F6 is working in any case:\n\nStep 1. Use DPsBase.exe for Integrating in your XP Setup source DriverPack MassStorage with TXT Mode Enabled.  \n[http://driverpacks.net/downloads](http://driverpacks.net/downloads \"External link\")\n\nStep 2. All MassStorage drivers are available from XP Setup Source and can be used combined with WinVBlock driver from Virtual Floppy\n\n[http://reboot.pro/to...7-vhd-xp-setup/](http://reboot.pro/topic/18547-vhd-xp-setup/ \"\")\n\n"
    },
    {
      "id": "173985",
      "timestamp": "2013-06-24T04:41:23+00:00",
      "author": "wimb",
      "content": "May be something like this by pressing F6 with **multiple sections** can work ..... (does not work for me)  \n\n\u003e \\[Disks\\]  \n\u003e disk1 \u003d \"FiraDisk Installation Disk\",\\\\firadisk.inf,\\\\  \n\u003e disk1 \u003d \"WinVBlock Driver Disk\",\\\\WinVBlk.inf,\\\\  \n\u003e disk1 \u003d \"Intel® Rapid Storage Technology Driver\", iaStor3.sys, \\\\  \n\u003e \\[Defaults\\]  \n\u003e scsi \u003d WinVBlock32  \n\u003e \\[SCSI\\]  \n\u003e firadiskx86\u003d\"FiraDisk Driver x86\"  \n\u003e WinVBlock32 \u003d \"WinVBlock Bus (32-bit)\"  \n\u003e iastor3 \u003d \"\"Intel® IaStor3 SATA AHCI Controller\"  \n\u003e \\[Files.scsi.firadiskx86\\]  \n\u003e driver\u003ddisk1,firadisk.sys,FiraDisk  \n\u003e inf\u003ddisk1,firadisk.inf  \n\u003e catalog\u003ddisk1,firadisk.cat  \n\u003e \\[HardwareIds.scsi.firadiskx86\\]  \n\u003e id\u003d\"detected\\\\firadisk\",\"FiraDisk\"  \n\u003e \\[Config.FiraDisk\\]  \n\u003e \\[Files.scsi.WinVBlock32\\]  \n\u003e driver \u003d disk1,WVBlk32.Sys,WinVBlock  \n\u003e inf \u003d disk1,WinVBlk.Inf  \n\u003e catalog \u003d disk1,WinVBlk.Cat  \n\u003e \\[Config.WinVBlock\\]  \n\u003e value\u003d\"\",TxtSetupInstalled,REG_DWORD,1  \n\u003e \\[HardwareIds.scsi.WinVBlock32\\]  \n\u003e id\u003d\"ROOT\\\\WINVBLOCK\",\"WinVBlock\"  \n\u003e id\u003d\"Detected\\\\WinVBlock\",\"WinVBlock\"  \n\u003e \\[Files.scsi.iastor3\\]  \n\u003e driver\u003ddisk1,iastor3.sys,iaStor  \n\u003e inf\u003ddisk1,iaahci.inf  \n\u003e catalog\u003ddisk1,iaAHCI.cat  \n\u003e \\[Config.iaStor\\]  \n\u003e value \u003d \"\", tag, REG_DWORD, 1b  \n\u003e value \u003d \"\", ErrorControl, REG_DWORD, 1  \n\u003e value \u003d \"\", Group, REG_SZ, \"SCSI Miniport\"  \n\u003e value \u003d \"\", Start, REG_DWORD, 0  \n\u003e value \u003d \"\", Type, REG_DWORD, 1  \n\u003e \\[HardwareIds.scsi.iastor3\\]  \n\u003e id \u003d \"PCI\\\\VEN_8086\\\u0026DEV_2922\\\u0026CC_0106\",\"iaStor\"  \n......... and all the other id  \n\n"
    },
    {
      "id": "173987",
      "timestamp": "2013-06-24T08:01:34+00:00",
      "author": "Wonko the Sane",
      "content": "@wimb\n\nThe \"multiple\" sections has been already talked about here (just for the record):\n\n[http://reboot.pro/to...t-ahci-drivers/](http://reboot.pro/topic/12043-choosing-best-ahci-drivers/ \"\")\n\n[http://reboot.pro/to...-plop/?p\u003d122941](http://reboot.pro/topic/13912-grub4dos-and-plop/?p\u003d122941 \"\")\n\n[http://reboot.pro/to...e-4#entry121275](http://reboot.pro/topic/13731-full-universal-xpvhd-run-from-usb-finally-work-for-me-maybe-for-you-too/page-4#entry121275 \"\")\n\n![:cheers:](http://reboot.pro/public/style_emoticons/default/cheers.gif)\n\nWonko\n\n"
    },
    {
      "id": "173989",
      "timestamp": "2013-06-24T10:37:28+00:00",
      "author": "steve6375",
      "content": "multiple defaults looks promising! I will try that.\n\nI have got install direct from ISOs with DPMS auto-detect working now, but you have to choose the AHCI driver (there is only one in the list), then Firadisk driver and/or winvblock driver.\n\nIt would be nice if this was automatic...\n\n"
    },
    {
      "id": "173992",
      "timestamp": "2013-06-24T14:58:14+00:00",
      "author": "steve6375",
      "content": "hmmm...\n\nI tried the multiple \\[Defaults\\] section as described. It does not seem to work in that no driver is installed by default.\n\nI can use F6 and manually pick the drivers but that is not the point - I want it to be automatic!\n\nthe generated txtsetup.oem (that doesn\u0027t work) is attached. I have three consecutive entries and they have different disks. Anyone see anything wrong or that conflicts with the other post [here](http://www.msfn.org/board/topic/72125-txtsetupoem-multiple-oem-mass-storage-drivers-defaults-section/page__view__findpost__p__549271 \"External link\") ?\n\nthanks  \n\n#### Attached Files {#attach_wrap}\n\n* [![Attached File](http://reboot.pro/public/style_extra/mime_types/zip.gif)](http://reboot.pro/index.php?s\u003dd063cba449c37a0e9ac1e415b6e5c569\u0026app\u003dcore\u0026module\u003dattach\u0026section\u003dattach\u0026attach_id\u003d14364 \"Download attachment\") [**txtsetup.zip**](http://reboot.pro/index.php?s\u003dd063cba449c37a0e9ac1e415b6e5c569\u0026app\u003dcore\u0026module\u003dattach\u0026section\u003dattach\u0026attach_id\u003d14364 \"Download attachment\") **1.38KB** 499 downloads\n\n"
    },
    {
      "id": "174004",
      "timestamp": "2013-06-25T05:07:26+00:00",
      "author": "wimb",
      "content": "\u003e I tried the multiple \\[Defaults\\] section as described. It does not seem to work in that no driver is installed by default.  \n\u003e\n\u003e I can use F6 and manually pick the drivers but that is not the point - I want it to be automatic!\n\nMy multiple sections proposal (which does NOT work yet for me) has only one entry in the \\[Defaults\\] section.\n\nI think the multiple sections approach is not automatic for more drivers and will require to use F6 to select drivers.\n\nI have scsi \u003d WinVBlock32 as Default which is working automatic OK, but when I use F6 to select\n\nthen the driver files in the Virtual Floppy are not found in the TXT-mode copy proces.\n\nAlso FiraDisk does not work this way for me.\n\nA good working automatic solution is Integrating MassStorage and Chipset DriverPacks in XP Setup Source and making new ISO file.\n\nThen WinVBlock driver in Virtual Floppy can be used with that ISO file to Install XP in VHD on any hardware.\n\n[http://reboot.pro/to...7-vhd-xp-setup/](http://reboot.pro/topic/18547-vhd-xp-setup/ \"\")\n\n![:cheers:](http://reboot.pro/public/style_emoticons/default/cheers.gif)\n\n"
    },
    {
      "id": "174052",
      "timestamp": "2013-06-26T13:29:07+00:00",
      "author": "steve6375",
      "content": "Well, I have \\***almost**\\* got it working buy using two F6 floppies!\n\nBoth virtual floppies are identical but the txtsetup.oem has default\u003diastor on one and on the other I have default\u003dfiradisk.\n\n(fd0) default\u003dfiradisk\n\n(fd1) default\u003diastor\n\nboth disks have all driver files for firadisk and ahci and both disks have a disk0 and disk1 empty file used as a diskid file.\n\nNow I do not need to use F6! When XP Setup loads, the firadisk driver is loaded without pressing F6 (if it wasn\u0027t I would get a BSOD).\n\nWhen I press F8 to accept the EULA, I can now see both the USB drive **and** the HDD listed (so I know that the AHCI driver has been loaded)\n\nSo it seems to have loaded both drivers automatically. ![:clap:](http://reboot.pro/public/style_emoticons/default/clap.gif)\n\nHowever, the problem is that immediately after formatting the HDD and then going into the text-mode copyfiles stage, it stops with a \u0027Please insert disk \"xxxx\" into Drive A:\"\n\nI have been trying various things for ages to get past this but I seem to be stuck! Once (and only once!) I got it to work but I could not repeat it even though I know what I did ![:frusty:](http://reboot.pro/public/style_emoticons/default/frusty.gif) !\n\nI tried it on a VM (using ICH9) and a real nbook (using ICH7) - both give identical behaviour, so it is not a VM problem.\n\nAny ideas?\n\n"
    },
    {
      "id": "174078",
      "timestamp": "2013-06-26T21:33:57+00:00",
      "author": "steve6375",
      "content": "SUCCESS!!!\n\nI can load 1 AHCI driver and 1 RamDisk driver (e.g. Firadisk) automatically by using two virtual F6 floppies! ![:clap:](http://reboot.pro/public/style_emoticons/default/clap.gif)\n\nSo now I can install from a bootable USB containing an unmodified XP ISO and install to an AHCI target system without needing to hit F6 during Setup and use chenalls (heavily) modified DPMS.bat to select the correct AHCI driver!\n\nphew! ![:suda:](http://reboot.pro/public/style_emoticons/default/suda.gif)\n\n"
    },
    {
      "id": "174110",
      "timestamp": "2013-06-27T09:56:38+00:00",
      "author": "Wonko the Sane",
      "content": "\u003e SUCCESS!!!\n\u003e\n\u003e I can load 1 AHCI driver and 1 RamDisk driver (e.g. Firadisk) automatically by using two virtual F6 floppies! ![:clap:](http://reboot.pro/public/style_emoticons/default/clap.gif)\n\u003e\n\u003e So now I can install from a bootable USB containing an unmodified XP ISO and install to an AHCI target system without needing to hit F6 during Setup and use chenalls (heavily) modified DPMS.bat to select the correct AHCI driver!\n\u003e\n\u003e phew! ![:suda:](http://reboot.pro/public/style_emoticons/default/suda.gif)\n\nCare to provide in this thread the actual result that is successful?\n\n![:cheers:](http://reboot.pro/public/style_emoticons/default/cheers.gif)\n\nWonko\n\n"
    },
    {
      "id": "174119",
      "timestamp": "2013-06-27T11:56:54+00:00",
      "author": "steve6375",
      "content": "I was just doing some more investigating. I think I have a grip on things now!\n\nIt seems the problem in the copyfiles stage (after formatting) is that it expects the \u0027current\u0027 floppy drive A: to have the correct driver files.\n\nThe \u0027current\u0027 drive A: is whatever was accessed last after selecting the drivers using F6 + S and then it loading the drivers before getting to the EULA screen.\n\ne.g.\n\nWe have two disks fd0 and fd1\n\nfd0 \u0027disk0\u0027 tag file txtsetup.oem has firadisk as default\n\nfd1 \u0027disk1\u0027 tag file txtsetup.oem has iastor as default\n\nIn F6 we load iastor and firadisk and then the drivers are loaded (not sure what order..) so we can see the internal hard disk to format it.\n\nNow in copy-files textmode stage after formatting has taken place, it tries to find the drivers so it can copy them over to the hard disk. So it looks for a disk0 tag file on the current drive A: - if present it copies over the sys/inf/cat files (if not present it stops and asks you to insert the correct disk).\n\nIf the disk0 tag was present and the file copy was successful, it now looks for the disk1 tag on the current drive - it does not find it so it asks you to insert the correct disk!\n\nSo the problem seems to be that **at the Copyfiles stage, XP does not have any concept of floppies A: and B:** - just the current \u0027drive A:\u0027!!!\n\nSo the way I got round this was:\n\n1. fd0 and fd1 have identical files on them. The tag file is identical (e.g. disk1) and the other driver files are identical\n\n2. The **only**difference is that one txtsetup.oem has a \\[Defaults\\] section for firadisk and the other txtsetup.oem file has a \\[Defaults\\] section for iastor\n\nSo that \u0027advice\u0027 about having separate disk tag files was wrong, it actually makes things worse (unless you have all the tag files on both floppies)!\n\nAlso, for txtsetup.oem, I found that you can have as many \\[xxxxx\\] sections as you like and in any order you like! It will just read them all. The only exception is you should have only one \\[Defaults\\] section. This makes making hybrid txtsetup.oem F6 files really easy! Just concatenate all the oemsetup.inf files together in one big file!\n\nOnly the first entry in the \\[Defaults\\] section is valid.\n\nYou can have only one driver\u003ddisk.filename entry in the \\[Files.scs.ID\\] section any others will be ignored (so multiple drivers are not possible).\n\nDuring the development of this, I found lots of bugs in chenalls dpms.bat (one of which fails to copy the .sys file to the floppy so that it fails in GUI-mode!).\n\nphew! ![:dubbio:](http://reboot.pro/public/style_emoticons/default/dubbio.gif) ![:cold:](http://reboot.pro/public/style_emoticons/default/cold.gif) ![:clap:](http://reboot.pro/public/style_emoticons/default/clap.gif)\n\nThis took me **days** to work out (1 day wasted due to me breaking my working code and not realising it! ![:frusty:](http://reboot.pro/public/style_emoticons/default/frusty.gif) ) so I hope this helps somebody else!\n\ncheers\n\nSteve\n\n\u003cbr /\u003e\n\n"
    },
    {
      "id": "174120",
      "timestamp": "2013-06-27T12:13:25+00:00",
      "author": "Wonko the Sane",
      "content": "\u003e This took me **days** to work out (1 day wasted due to me breaking my working code and not realising it! ![:frusty:](http://reboot.pro/public/style_emoticons/default/frusty.gif) ) **so I hope this helps somebody else!**\n\nYes :smile:, as hinted before, IMHO **it will** ![:thumbup:](http://reboot.pro/public/style_emoticons/default/thumbup.gif) when you will post additionally something \"definite\" (possibly a final, working set of examples).\n\nBut take your time, no hurry whatsoever ![:fine:](http://reboot.pro/public/style_emoticons/default/ok.gif).\n\n![:cheers:](http://reboot.pro/public/style_emoticons/default/cheers.gif)\n\nWonko\n\n"
    },
    {
      "id": "174131",
      "timestamp": "2013-06-27T20:45:11+00:00",
      "author": "steve6375",
      "content": "OK, well it looks like there is still a problem!\n\nchenall\u0027s DPMS.bat parses the DriverPack.ini file for a PCI match, a section for 8086_3B29 looks like this (simplified)\n\n```\n[I7]\n; 11.2.0.1006\nms_count\u003d1\nms_1_deviceName\u003d\"Intel ICH9/ICH10 SATA AHCI/RAID RST 11.2\"\nms_1_tag\u003d\"iastor7\"\nms_1_sysFile\u003d\"iastor7.sys\"\nms_1_hwids\u003d\"PCI\\VEN_8086\u0026DEV_3B29\u0026CC_0106\"\nms_1_isBusExtender\u003dfalse\nms_1_exc_disableIfOS\u003d\"w2k\"\n```\n\nFrom this chenalls DPMS.bat (now heavily modified!) make up a txtsetup.oem like this:\n\n\\[Disks\\]  \nd1\u003d\"DPMS Installation Disk by chenall(diskd)\",\\\\disk1,\\\\\n\n\\[scsi\\]  \niastor7\u003d\"Intel ICH9/ICH10 SATA AHCI/RAID RST 11.2\"\n\n\\[Files.scsi.iastor7\\]  \ninf\u003dd1,iaAHCI.inf  \ncatalog\u003dd1,iaAHCI.cat  \ndriver\u003dd1,**iastor7.sys**,iastor\n\n\\[HardwareIds.scsi.iastor7\\]  \nid\u003d\"PCI\\\\VEN_8086\\\u0026DEV_3B29\\\u0026CC_0106\",\"**iastor7**\"\n\n\\[Defaults\\]  \nscsi\u003diastor7\n\nand this works fine for text-mode setup. Inside the Intel standard iaahci.inf file it calls for the iastor.sys driver.\n\nHowever, when we get to GUI-mode setup, the install stops with a \u0027**can\u0027t find iastor.sys in C:\\\\Windows\\\\OEMDir**\" message. Sure enough the iastor.sys file (which was present on the F6 floppy) had not been copied across in text mode. After all, why would it be copied over when it is not mentioned in the txtsetup.oem file?\n\nThis seems a major flaw with DPMS and the whole driverpack.ini file setup! ![:dubbio:](http://reboot.pro/public/style_emoticons/default/dubbio.gif) The driverpack folder has both iastor7.sys and iastor.sys, but textmode setup will only copy across iastor7.sys and you cannot have multiple **driver\u003d**lines in txtsetup.oem as the extra one are just ignored!\n\nSo I thought that all I need to do was change the name of the driver in the txtsetup.oem file to iastor.sys and all would be well. We can just ignore iastor7.sys.\n\nHowever, I (***eventually***!) found after much head scratching that I also need to change the \u0027service\u0027 name (in **bold red** above) which MUST match the driver.sys name or XP will just not load the driver!\n\nAnyway, bottom line is I can now install all the way through both text-mode and GUI mode without needing to press F6 (using FiraDisk only) and all from a vanilla ISO. The user still has to reboot back to the USB drive for the 2nd step, as it is still a 2-step process.\n\n"
    },
    {
      "id": "174134",
      "timestamp": "2013-06-27T23:10:01+00:00",
      "author": "ilko",
      "content": "I\u0027ve reported that issue a while ago and PM-ed Chenall as well, but it seems DPMS work is stalled for now:\n\n[http://code.google.c...es/detail?id\u003d21](http://code.google.com/p/grubutils/issues/detail?id\u003d21 \"External link\")\n\nAs an ugly workaround I\u0027ve manually edited driverpack.ini to get rid of iastorX and the similar entries, there are a few other entries like iastor.\n\nA few lines of code were also included to add pnpinterface\u003d5 which is (most likely) required for some drivers. Detection is made by presence of the string scsiport.sys or storport.sys in the sys file.\n\nIf you want to compare, here is a modded DPMS, in \\\\files\\\\DPMS\\\\:\n\n[http://code.google.c...-0-beta9_rc4.7z](http://code.google.com/p/winsetupfromusb/downloads/detail?name\u003dWinSetupFromUSB_1-0-beta9_rc4.7z \"External link\")\n\n"
    },
    {
      "id": "174135",
      "timestamp": "2013-06-27T23:21:26+00:00",
      "author": "steve6375",
      "content": "Thanks, but I have it all working now (I think!).\n\nI now look at each INF file that is in the driver folder and use the sys driver that is mentioned in the proper matching inf file.\n\nThere were quite a few issues with chenall\u0027s DPMS, e.g. using wrong driver (the one in the driverpack.ini is not always correct - there may be 3 or 4 infs and drivers in one driver folder), only testing for a match on 3 characters of the device ID (i.e. 8086 292\\*) and several others I have forgotten about at the moment! Oh yes, the floppies that he made had a bad BPB parameter and if you look at them they have weird files listed in them - this was due to \\\\x9 that should have been \\\\x09.\n\n(I did email him with the bugs and did have one reply of thanks).\n\nIf you want to use my DPMS.bat (with firadisk and winvblock) when I am finished you are welcome. My code is not as \u0027nice\u0027 as chenalls but it seems to work! I don\u0027t have any special scsi code in it though....\n\n"
    },
    {
      "id": "174136",
      "timestamp": "2013-06-28T00:30:05+00:00",
      "author": "steve6375",
      "content": "\u003e Yes :smile:, as hinted before, IMHO **it will** ![:thumbup:](http://reboot.pro/public/style_emoticons/default/thumbup.gif) when you will post additionally something \"definite\" (possibly a final, working set of examples).\n\u003e\n\u003e But take your time, no hurry whatsoever ![:fine:](http://reboot.pro/public/style_emoticons/default/ok.gif).\n\u003e\n\u003e ![:cheers:](http://reboot.pro/public/style_emoticons/default/cheers.gif)\n\u003e\n\u003e Wonko\n\nDoes [this](http://rmprepusb.blogspot.co.uk/2013/06/txtsetupoem-files-for-f6-floppy-disks.html \"External link\") help?\n\n"
    },
    {
      "id": "174149",
      "timestamp": "2013-06-28T12:13:53+00:00",
      "author": "steve6375",
      "content": "I have now added support for Config sections in my version. What I do is look for a \\[Config section with a \u0027value\u0027 and a PnPInstance string in the **txtsetup.oem**file that is in the driver pack folder.\n\nI use the first section that I find.\n\nNT4 sections don\u0027t seem to use PnPInstance.\n\nThe only thing is if there is more than one section with PNPInstance in, then I only the use first one as I don\u0027t really know which hardware ID it belongs to..\n\n"
    },
    {
      "id": "174153",
      "timestamp": "2013-06-28T14:33:56+00:00",
      "author": "Wonko the Sane",
      "content": "I spent some time looking around on the matter.\n\nOnly questions and guesses ![:(](http://reboot.pro/public/style_emoticons/default/sad.png).\n\nSome very wild ![:ph34r:](http://reboot.pro/public/style_emoticons/default/scared9.gif), some hopefully \"educated\" ![:dubbio:](http://reboot.pro/public/style_emoticons/default/dubbio.gif)\n\nSteve, the file you posted on #7 seems like having a \"queer\" disk numbering scheme in \\[Disks\\].\n\nAs well, Wimb\u0027s posted example has all disks being \"disk1\"\n\nMaybe this is connected? ![:unsure:](http://reboot.pro/public/style_emoticons/default/unsure.png)\n\nWhy not trying following EXACTLY the given example on MSDN?\n\n[http://msdn.microsof...f544738(v\u003dvs.85](http://msdn.microsoft.com/en-us/library/windows/hardware/ff544738(v\u003dvs.85 \"External link\")).aspx\n\n[http://msdn.microsof...f541068(v\u003dvs.85](http://msdn.microsoft.com/en-us/library/windows/hardware/ff541068(v\u003dvs.85 \"External link\")).aspx\n\netc.\n\nWhat happens if one uses the \"Computer\" component instead of the \"scsi\" one?\n\nCannot somehting \\*like\\* this:\n\n[http://board.vitalig...hment.php?aid\u003d9](http://board.vitaligraf.de/attachment.php?aid\u003d9 \"External link\")\n\nbe used?\n\nOr is it \"triggered\" by the actual PNP or PCI\\\\VEN?\n\nOT, but not much, see how the good Intel guys use an EFI ramdisk :wink::\n\n[http://downloadmirro...lease_notes.txt](http://downloadmirror.intel.com/7571/eng/ramdriver1.1_release_notes.txt \"External link\")\n\nAs always, the MS docs are \"strange\", seemingly NT4 allowed \"Display\" as \"component\":\n\n[http://support.micro...kb/166028/en-us](http://support.microsoft.com/kb/166028/en-us \"External link\")\n\nand also more \"components\":\n\n[http://ifsc2.ifsc.us...k1/TXTSETUP.OEM](http://ifsc2.ifsc.usp.br/drivers/Scanner/DeskScanII/disk1/TXTSETUP.OEM \"External link\")\n\n\u003e # \\\u003ccomponent_name\\\u003e is one of computer, display, keyboard, mouse,  \n\u003e # \"keyboard layout\", or scsi.\n\nWhat happens if we \"fake\" that firadisk is (say) a \"display\" and winvblock is (still say) a \"mouse\"? ![:unsure:](http://reboot.pro/public/style_emoticons/default/unsure.png)\n\nOr possibly this changed with XP? (it is seemingly still valid for 2K):\n\n[http://downloadmirro.../eng/readme.txt](http://downloadmirror.intel.com/8878/eng/readme.txt \"External link\")\n\nBut then some info around is obsolete:  \n[http://www.reasonco....64/txtsetup.oem](http://www.reasonco.com/support/drivers/Tyan%20-%20Guidant/SAS/LSI1068E_driver_1211500/1211500/StorPort/lsi_sas/xp_x64/txtsetup.oem \"External link\")\n\nI.e. what if there is only one \"default\" ***but one for each component***?\n\n![:cheers:](http://reboot.pro/public/style_emoticons/default/cheers.gif)\n\nWonko\n\n"
    },
    {
      "id": "174156",
      "timestamp": "2013-06-28T14:44:54+00:00",
      "author": "steve6375",
      "content": "As I said, I have this all working now with one driver per disk (\u003d2), thanks anyway.\n\nThe problem with the file I posted was just that there were multiple defaults which Setup won\u0027t accept.\n\n"
    },
    {
      "id": "174160",
      "timestamp": "2013-06-28T14:59:13+00:00",
      "author": "Wonko the Sane",
      "content": "\u003e As I said, I have this all working now with one driver per disk (\u003d2), thanks anyway.\n\u003e\n\u003e The problem with the file I posted was just that there were multiple defaults which Setup won\u0027t accept.\n\nSure, but if I got it right the original idea was to have the possibility of three or more of them drivers. ![:unsure:](http://reboot.pro/public/style_emoticons/default/unsure.png) (or maybe that was just wimb\u0027s idea ![:dubbio:](http://reboot.pro/public/style_emoticons/default/dubbio.gif)).\n\nIf you prefer, I was wondering if there were other ways to skin that cat. :wink:\n\nIf you could post your \"final\" setup, would anyway be of use, (or a link to your site where this \"final\" version is).\n\n![:cheers:](http://reboot.pro/public/style_emoticons/default/cheers.gif)\n\nWonko\n\n"
    },
    {
      "id": "174175",
      "timestamp": "2013-06-28T22:39:11+00:00",
      "author": "steve6375",
      "content": "I am still running into problems where an inf file refers to more than one driver but I can only specify one driver line, so only one driver is copied across by text-mode setup....\n\nAll I need to do is make the oemsetup.txt file cause Setup to copy the driver.sys file over...\n\nThen it occurred to me that I can have multiple catalog entries in the txtsetup.oem file but AFAIK XP textmode doesn\u0027t use them, in fact it probably does not even care what the files are... they need not even be cat files... they could be any file like .sys files for instance... ![:dubbio:](http://reboot.pro/public/style_emoticons/default/dubbio.gif)\n\nSo for every driver file present on the F6 disk, I have added a catalog line (even if the driver.sys is already in the driver line), e.g.\n\n```\n[Files.scsi.iastor3]\ndriver\u003ddisk1,iastor3.sys,iaStor\ninf\u003ddisk1,iaahci.inf\ncatalog\u003ddisk1,iaAHCI.cat\ncatalog\u003ddisk1,iastor3.sys\ncatalog\u003ddisk1,iastor.sys\n```\n\nand the result is.....\n\n![:1st:](http://reboot.pro/public/style_emoticons/default/1st.gif) ![:happy_dance2:](http://reboot.pro/public/style_emoticons/default/celebrate3.gif) ![:happy_dance2:](http://reboot.pro/public/style_emoticons/default/celebrate3.gif) ![:happy_dance2:](http://reboot.pro/public/style_emoticons/default/celebrate3.gif) ![:happy_dance2:](http://reboot.pro/public/style_emoticons/default/celebrate3.gif) IT WORKS! ![:happy_dance2:](http://reboot.pro/public/style_emoticons/default/celebrate3.gif)\n\n\u003cbr /\u003e\n\n"
    },
    {
      "id": "174185",
      "timestamp": "2013-06-29T08:15:34+00:00",
      "author": "steve6375",
      "content": "Attached are the two txtsetup.oem files and directory listings for a VBox system with a SCSI controller (needs symmpiv driver (not lsi_scsi driver).\n\nThis allows an ISO boot from an XP Setup ISO without the need to press F6 to load the firadisk and symmpiv drivers.\n\nThere are duplicated lines (caused by the logic in my dpms.bat script) but these don\u0027t matter.\n\nWhen running E2B Install from XP, it runs my DPMS script and finds two OEM drivers, lsi_scsi (W2K) and symmpiv (WXP), it then asks the user which one they want to load as the default. If you choose lsi_scsi then you get an \u0027lsi_scsi.sys could not be found\u0027 message (though it is there!), if you choose the symmpiv driver then it installs XP just fine.  \n\n#### Attached Files {#attach_wrap}\n\n* [![Attached File](http://reboot.pro/public/style_extra/mime_types/zip.gif)](http://reboot.pro/index.php?s\u003dd063cba449c37a0e9ac1e415b6e5c569\u0026app\u003dcore\u0026module\u003dattach\u0026section\u003dattach\u0026attach_id\u003d14389 \"Download attachment\") [**DPMS2_F6_Floppies.zip**](http://reboot.pro/index.php?s\u003dd063cba449c37a0e9ac1e415b6e5c569\u0026app\u003dcore\u0026module\u003dattach\u0026section\u003dattach\u0026attach_id\u003d14389 \"Download attachment\") **1.7KB** 454 downloads\n\n"
    },
    {
      "id": "174188",
      "timestamp": "2013-06-29T08:51:37+00:00",
      "author": "Wonko the Sane",
      "content": "\u003e Attached are the two txtsetup.oem files and directory listings for a VBox system with a SCSI controller (needs symmpiv driver (not lsi_scsi driver).\n\u003e\n\u003e This allows an ISO boot from an XP Setup ISO without the need to press F6 to load the firadisk and symmpiv drivers.\n\nI don\u0027t get it.\n\nToday I am probably a bit more retarded than usual, but I don\u0027t understand, could you better explain?\n\nThe two .txt\u0027s contain (each) 4 (four) drivers:\n\n1. lsi_scsi\u003d\"LSI Logic Ultra320 SCSI RAID/2000/VMWare LSI (W2K3)\"\n2. symmpiv\u003d\"LSI Logic SAS 3000 / VMWare v10 (WXP)\"\n3. firadisk\u003dFiraDisk_Driver\n4. WinVBlk\u003dWinVBlock_Driver\n\nOne has scsi\u003dsymmpiv as \"default\", the other one has scsi\u003dfiradisk.\n\nWhen you have them on (I presume) first and second floppy, what happens?\n\nYou are prompted to choose between two options (lsi_scsi and symmpiv ) of which one won\u0027 t work (and as such it is not an option) and you have to choose symmpiv anyway? ![:unsure:](http://reboot.pro/public/style_emoticons/default/unsure.png)\n\nThen which drivers are installed?\n\n1. All four of them.\n2. Only symmpiv and firadisk.\n3. Only symmpiv, firadisk and WinVBlk\n\n![:cheers:](http://reboot.pro/public/style_emoticons/default/cheers.gif)\n\nWonko\n\n"
    },
    {
      "id": "174190",
      "timestamp": "2013-06-29T09:04:59+00:00",
      "author": "steve6375",
      "content": "When **DPMS.bat**runs, if there is more than one OEM driver, it will prompt the user to choose which one you want for floppy 1 (floppy 0 must be either firadisk or winvblock)\n\nThe \\[Defaults\\] section defines which will be loaded by Setup if F6 is not pressed - so firadisk and symmpiv will be loaded automatically.\n\nXP does not prompt unless you press F6.\n\nSo in this case, winvblock is ignored (unless the user presses F6 and chooses it).\n\nAny files mentioned in the symmpiv section will be copied across\n\n```\n[Files.scsi.symmpiv]\ninf\u003dd1,lsi_scsi.inf\ninf\u003dd1,lsi_scsi.inf\ncatalog\u003dd1,lsi_scsi.cat\ninf\u003dd1,symmpi.inf\ninf\u003dd1,symmpi.inf\ncatalog\u003dd1,mpixp32.cat\ndriver\u003dd1,symmpi.sys,symmpiv\ncatalog\u003dd1,lsi_scsi.sys\ncatalog\u003dd1,symmpi.sys\n```\n\nlsi_scsi.sys and lsi_scsi.inf and lsi_scsi.cat will be copied over and XP will attempt to auto-install them in GUI-mode (all inf\u003d will be evaluated with PnP in GUI-mode).\n\nBut the only driver loaded in text-mode (forced by the Defaults section) will be symmpi.sys (and firadisk),\n\nIn fact, in this case, lsi_scsi is actually a W2K driver and so is ignored by XP.\n\n"
    },
    {
      "id": "174193",
      "timestamp": "2013-06-29T09:19:55+00:00",
      "author": "Wonko the Sane",
      "content": "It is still not fully clear but much better, thanks ![:thumbup:](https://reboot.pro/public/style_emoticons/default/thumbup.gif).\n\nFurther questions ![:ph34r:](https://reboot.pro/public/style_emoticons/default/scared9.gif):\n\nHave you tried adding a \"Computer\" component - besides the \"scsi\" one?\n\nOne can have through grub4dos more than 2 (virtual) floppies, right?\n\nWould the \"third\" one be read by the thingy?\n\n![:cheers:](https://reboot.pro/public/style_emoticons/default/cheers.gif)\n\nWonko\n\n"
    },
    {
      "id": "174246",
      "timestamp": "2013-06-30T23:19:02+00:00",
      "author": "steve6375",
      "content": "\u003e One can have through grub4dos more than 2 (virtual) floppies, right?  \n\u003e\n\u003e Would the \"third\" one be read by the thingy?\n\nNo - I made a single (fd2) and set map --floppies\u003d3 and XP Setup did not see it ![:cold:](https://reboot.pro/public/style_emoticons/default/cold.gif) - good idea though...\n\nerrrm - just spotted I forgot to set floppies to 3! - retesting now...\n\nOh Pooh ![:hammer:](https://reboot.pro/public/style_emoticons/default/hammer.gif) - grub4dos only accepts 0 1 or 2 as parameter for map --floppies\u003d !!!\n\n"
    },
    {
      "id": "174259",
      "timestamp": "2013-07-01T11:09:41+00:00",
      "author": "steve6375",
      "content": "It was all going so well - I can auto-install AHCI+Firadisk or AHCI+WinVblock.\n\nBut afer a LOT of head scratching, I realise I have just hit a small snag with WinVBlock!\n\nMy grub4dos menu needs to allow for the user to be able to choose either FiraDisk or WinVBlock using F6 (as well as not pressing F6).\n\nNow FiraDisk need a small floppy created so it can get the ISO file details and mount it at the \u0027Setup is starting Windows\u0027 phase (pmode kernel switch).\n\ni.e. map --mem (md)0x800+4 (99)\n\nWithout device added, when firadisk is loaded and the AHCI driver, you get a BSOD 0x7B error when Setup loads Windows very early on.\n\nNow if the user uses F6 and selects the AHCI driver + WinVBlock, we get a problem.\n\nAfter the HDD format and after the \u0027Checking drive C:\u0027 stage we get to the \u0027Creating list of files to be copied\u0027 message.\n\nAt this point Setup stops with a **\u0027The disk or CD you inserted may be damaged\u0027**message.\n\nThis is because WinVBlock has changed the \u0027current\u0027 floppy to be device (99) which presumably it did because it was searching for it\u0027s own #!GRUB4DOS string on all floppy devices\n\nSo having the firadisk (99) device and running WinVBlock are mutually incompatible!\n\nThe easy fix is to ask the user which one they want to use and if WinVBlock then don\u0027t map the Firadisk (99) device - the problem is if the user used F6 and selects WinVblock instead.\n\nI have PM\u0027s Sha0 to ask for a fix...\n\n"
    },
    {
      "id": "174261",
      "timestamp": "2013-07-01T13:10:16+00:00",
      "author": "steve6375",
      "content": "Anyone know of a really good description of XP Setup install stages from CD\n\nWhat stages are, what happens in each stage (what drivers are loaded when, etc.) , what happens at each T-xx minutes stage, what errors you might get at each stage, etc.?\n\n"
    },
    {
      "id": "174262",
      "timestamp": "2013-07-01T15:38:23+00:00",
      "author": "cdob",
      "content": "\u003e Now FiraDisk need a small floppy created so it can get the ISO file details\nChenall writes firadisk StartOptions to txtsetup.oem too. A addional small floppy is not required.  \n[http://www.chenall.net/post/ntboot/](http://www.chenall.net/post/ntboot/ \"External link\")  \n\n[http://www.msfn.org/...le/page__st__64](http://www.msfn.org/board/topic/149675-install-xp-from-a-iso-file/page__st__64 \"External link\") set XPISO\u003dXP.ISO  \n\u003e set fira.opt\u003dcdrom,vmem\u003dfind:/images/%XPISO%;  \n\u003e ...  \n\u003e write --offset\u003d%offset% (fd0)/TXTSETUP.OEM value\u003dParameters,StartOptions,REG_SZ,\"%fira.opt%\"\\\\r\\\\n\n\n"
    },
    {
      "id": "174263",
      "timestamp": "2013-07-01T16:55:48+00:00",
      "author": "steve6375",
      "content": "Thanks! ![:clap:](https://reboot.pro/public/style_emoticons/default/clap.gif) That has avoided the problem! I did see that before but completely forgot about it!\n\nI have added this in now and I think it is all working with Auto-DPMS selection of AHCI/SCSI driver and boot from ISO using either Fira or WinVBlock.\n\n"
    },
    {
      "id": "174264",
      "timestamp": "2013-07-01T17:32:24+00:00",
      "author": "Wonko the Sane",
      "content": "\u003e Anyone know of a really good description of XP Setup install stages from CD\n\u003e\n\u003e What stages are, what happens in each stage (what drivers are loaded when, etc.) , what happens at each T-xx minutes stage, what errors you might get at each stage, etc.?\n\nI presume there is not anything more \"accurate/detailed\" than these ![:unsure:](https://reboot.pro/public/style_emoticons/default/unsure.png) :\n\n[http://unattended.ms...xp/view/web/13/](http://unattended.msfn.org/unattended.xp/view/web/13/ \"External link\")\n\n[http://technet.micro...7(v\u003dws.10).aspx](http://technet.microsoft.com/en-us/library/cc758337(v\u003dws.10).aspx \"External link\")\n\n![:cheers:](https://reboot.pro/public/style_emoticons/default/cheers.gif)\n\nWonko\n\n"
    },
    {
      "id": "174292",
      "timestamp": "2013-07-02T19:51:56+00:00",
      "author": "steve6375",
      "content": "I have tested about 8 or so XP x86 Mass Storage PCI IDs/drivers with my new DPMS code, but there are so many drivers that I cannot hope to test them all.\n\nTherefore, if you could give me the PCI ID (or driverpack folder name - e.g. /D/M/I3 if you don\u0027t know the IDs), then I can pre-test the parser before I release it.\n\nThe PCI IDs can be real or VM IDs.\n\nHere are the ones I have tested so far (not all tested with XP, but at least the parser seems to run OK and make the correct F6 disk and txtsetup.oem).\n\n```\n:: ------------------ TEST SECTION (uncomment one line to force a specific ID) -----\n::: ****  FORCE ICH7\n::echo \"PCI\\VEN_8086\u0026DEV_3B29\u0026CC_0106\"\u003d\"iastor7\" ; D/M/I7 \"iastor7.sys\" \"Intel ICH7\" \u003e (8)/chkpci.pci\n:: ***** FORCE I4 (multiple Config lines)\n::echo \"PCI\\VEN_8086\u0026DEV_1D02\u0026CC_0106\"\u003d\"iastorA\" ; D/M/I4 \"iastorA.sys\" \"Intel C60\" \u003e (8)/chkpci.pci\n:: ***** FORCE I4 (multiple Config lines)\n::echo \"PCI\\VEN_8086\u0026DEV_1D60\u0026CC_0106\"\u003d\"iastorS\" ; D/M/I4 \"iastorS.sys\" \"Intel C60 SATA MODE\" \u003e (8)/chkpci.pci\n:: *** NO OEM DRIVER **\n::echo -n \u003e (8)/chkpci.pci\n:: VMWARE SCSI with [Config.VMSCSI] section (note: PCI ID is not in txtsetup.oem!)\n::echo \"PCI\\VEN_104B\u0026DEV_1040\"\u003d\"VMSCSI\" ; D/M/V \"VMSCSI.sys\" \"VMWARE SCSI\" \u003e (8)/chkpci.pci\n:: IT2 with two config lines\n::echo \"PCI\\VEN_1283\u0026DEV_8212\"\u003d\"ITEATAPI\" ; D/M/IT \"iteatapi.sys\" \"ITE IT8211 ATA ATAPI\" \u003e (8)/chkpci.pci\n:: AM8\n::echo \"PCI\\VEN_1022\u0026DEV_7801\u0026CC_0106\"\u003d\"ahcix80x\"    ; D/M/AM8 \"ahcix868.sys\" \"AMD AHCI Compatible RAID SB8xx (WXP)\" \u003e (8)/chkpci.pci\n:: SS\n::echo \"PCI\\VEN_1039\u0026DEV_1182\"\u003d\"SISRAID2\" ; D/M/SS \"SISRAID2.sys\" \"SIS 182/1182 RAID\" \u003e (8)/chkpci.pci\n```\n\n\u003cbr /\u003e\n\n"
    },
    {
      "id": "174307",
      "timestamp": "2013-07-03T13:43:04+00:00",
      "author": "steve6375",
      "content": "P.S. Noticed a small bug in inifile (grub4dos program)\n\nIt does not output cr+lf when outputting a whole section, it only uses lf (0x0a) - so when a file is viewed in Notepad, the lines appear joined!\n\nHere is a new version which is fixed.\n\n#### Attached Files {#attach_wrap}\n\n* [![Attached File](http://reboot.pro/public/style_extra/mime_types/zip.gif)](http://reboot.pro/index.php?s\u003d6f04be337f383039cccfcfed193edb11\u0026app\u003dcore\u0026module\u003dattach\u0026section\u003dattach\u0026attach_id\u003d14407 \"Download attachment\") [**inifile.zip**](http://reboot.pro/index.php?s\u003d6f04be337f383039cccfcfed193edb11\u0026app\u003dcore\u0026module\u003dattach\u0026section\u003dattach\u0026attach_id\u003d14407 \"Download attachment\") **1.19KB** 377 downloads\n\n"
    },
    {
      "id": "174708",
      "timestamp": "2013-07-12T20:48:48+00:00",
      "author": "ilko",
      "content": "Perfect job Steve, thanks.\n\nA few remarks if I may:\n\n1)\n\u003e I have now added support for Config sections in my version. What I do is look for a \\[Config section with a \u0027value\u0027 and a PnPInstance string in the **txtsetup.oem**file that is in the driver pack folder.\n\u003e\n\u003e I use the first section that I find.\n\u003e\n\u003e NT4 sections don\u0027t seem to use PnPInstance.\n\u003e\n\u003e The only thing is if there is more than one section with PNPInstance in, then I only the use first one as I don\u0027t really know which hardware ID it belongs to..\n\nThere are folders which do not include txtsetup.oem, but the driver most likely needs the PnP entry and would bluescreen without it, example is \\\\M\\\\N\\\\.\n\nThe only reliable way I could find to determine if that entry should be used, is to search the found INF file for the string \"Parameters\\\\PnpInterface\". In some inf files there are spaces on that row, hence the string. I could not find any commented out such lines in all inf files, so it should be safe to search in the whole inf file for that string.\n\nMind you, some drivers, such as symmpi.sys list it in the inf file, but work just fine without it, meaning they support both legacy and pnp mode, unlike some other which would require that line:\n\n[http://forum.driverp...id\u003d19997#p19997](http://forum.driverpacks.net/viewtopic.php?pid\u003d19997#p19997 \"External link\")\n\n[http://forum.driverp...c.php?pid\u003d30325](http://forum.driverpacks.net/viewtopic.php?pid\u003d30325 \"External link\")\n\n2) Is creating blank config section expected behaviour? Seems to not cause problems though. Got such when testing in VirtualBox with SCSI adapter (symmpi.\\*)\n\n3) Maybe give user slightly more time (15?) to select default driver when several are found, that\u0027s a lot of info on screen for regular user to read and decide.\n\n4)\n\u003e ::If DriverPack.ini file description has not WXP and has W2K/W2K3 then skip it\n\u003e\nI think the proper way is to check for ms_X_exc_disableIfOS and ms_X_exc_skipIfOS values if possible. Many XP drivers do not include \"WXP\" in their description.\n\nMaybe a good enhancement would be a switch to DPMS to include only drivers for particular OS, i.e. \"DPMS.bat 2 WXP\", or \"DPMS.bat 1 W2K3\".\n\n5) TestDPMS2.g4b :\n\n```\nset TESTCASE\u003d\"PCI\\VEN_1095\u0026DEV_3132\"\u003d\"3132R5C\" ; D/M/SC \"SI3132R5.sys\" \"Silicon Image 3132 SoftRaid5 for BIOS 7223\"\necho CHECK SI3132R5.sys driver present\ncall :testit\n```\n\nNote 3132R5C and SI3132R5.\n\nThis results in:\n\n```\ndefault\u003dreboot\n```\n\nAnother one:\n\n```\nset TESTCASE\u003d\"PCI\\VEN_11AB\u0026DEV_6440\"\u003d\"SI3132B5\" ; D/M/SB5 \"SI31322.sys\" \"Silicon Image 3132 SATALink for BIOS 7405\"\necho CHECK SI31322 driver present\ncall :testit\n```\n\nHere seems to be driver/service name mismatch as above.\n\nTesting with DP MS 12.09 and dpms2.g4b 1.00 2013-07-04.\n\n"
    },
    {
      "id": "174710",
      "timestamp": "2013-07-12T21:07:42+00:00",
      "author": "steve6375",
      "content": "Thanks\n\nI will check it out\n\nCan you just double-check - this entry ?? 11AB 6440 is M4 folder, SB5 folder is 1095 3132???\n\n```\nset TESTCASE\u003d\"PCI\\VEN_11AB\u0026DEV_6440\"\u003d\"SI3132B5\" ; D/M/SB5 \"SI31322.sys\" \"Silicon Image 3132 SATALink for BIOS 7405\"\necho CHECK SI31322 driver present\ncall :testit\n```\n\n\u003cbr /\u003e\n\n"
    },
    {
      "id": "174712",
      "timestamp": "2013-07-12T21:13:10+00:00",
      "author": "ilko",
      "content": "\u003e Can you just double-check - this entry ?? 11AB 6440 is M4 folder, SB5 folder is 1095 3132???\n\nYep, sorry, forgot to update hwid, should be \"PCI\\\\VEN_1095\\\u0026DEV_3132\", SB5. Still results in a different service/driver names.\n\n"
    },
    {
      "id": "174713",
      "timestamp": "2013-07-12T21:25:54+00:00",
      "author": "steve6375",
      "content": "different service driver names is not a problem. The bits that must match are highlighted [here](http://rmprepusb.blogspot.co.uk/2013/06/txtsetupoem-files-for-f6-floppy-disks.html \"External link\").\n\nThe only problem I see is the defaults section is set to scsi\u003d(none) for PCI\\\\VEN_1095\\\u0026DEV_3132 ???\n\nEdit: and also the file SilSupp.cpl is not copied across....\n\n"
    },
    {
      "id": "174714",
      "timestamp": "2013-07-12T22:32:53+00:00",
      "author": "steve6375",
      "content": "The problem with the Parameters\\\\PnPInterface was that some INF files had entries for both NT4 and NT5 and it is difficult to tell which entry is the one to use.\n\nAlso, I reasoned that if there is no txtsetup.oem and it needs one (and a Config section too) then surely that is a DriverPack problem/deficiency and should be fixed in the driverpack?\n\nre. blank Config sections - it is only a problem if there was something in the driverpack txtsetup.oem which was not carried through into the DPMS2 F6 txtsetup.oem file - I think in one of the test cases there was a section which had lots of commented out lines in the DriverPack txtsetup.oem..??\n\nre. W2K3 v XP - that is not in scope (for now :-)\n\nre. looking for XP in the name, what does \u0027skipifOS\u0027 \u0027replaceIfOS\u0027 and \u0027disableIfOS\u0027 mean? Not all entries have these - e.g. \\[AM\\] \\[AU\\]\n\nA revised DPMS2 is attached which fixes a few issues mentioned.  \nHave you tried any of these for \u0027real\u0027 yet?  \ncheers  \nSteve  \nP.S. Just spotted that your second test case has a large Config section which got cut short due to typo bug - now fixed in v 1.01a!  \n\n#### Attached Files {#attach_wrap}\n\n* [![Attached File](http://reboot.pro/public/style_extra/mime_types/zip.gif)](http://reboot.pro/index.php?s\u003d6f04be337f383039cccfcfed193edb11\u0026app\u003dcore\u0026module\u003dattach\u0026section\u003dattach\u0026attach_id\u003d14440 \"Download attachment\") [**dpms2_V1.01aBeta.zip**](http://reboot.pro/index.php?s\u003d6f04be337f383039cccfcfed193edb11\u0026app\u003dcore\u0026module\u003dattach\u0026section\u003dattach\u0026attach_id\u003d14440 \"Download attachment\") **9.59KB** 364 downloads\n\n"
    },
    {
      "id": "174716",
      "timestamp": "2013-07-12T23:40:09+00:00",
      "author": "ilko",
      "content": "\u003e different service driver names is not a problem\n\nReading the comments in the bat file I thought you were after iastor7.sys from DP.ini--\\\u003e iastor service name from the inf file, must have taken it wrongly.\n\n\u003e The problem with the Parameters\\\\PnPInterface was that some INF files had entries for both NT4 and NT5 and it is difficult to tell which entry is the one to use.\n\nDid you come across such reg entry which is present for NT4 and not for NT5?!\n\nI will try to dig some more in the inf files. Do you recall an example file?\n\n\u003e Also, I reasoned that if there is no txtsetup.oem and it needs one (and a Config section too) then surely that is a DriverPack problem/deficiency and should be fixed in the driverpack?\n\nAFAIK DP and their DP_base do not deal with txtsetup.oem at all. I doubt proper support for txtsetup.oem.\n\n\u003e re. blank Config sections - it is only a problem if there was something in the driverpack txtsetup.oem which was not carried through into the DPMS2 F6 txtsetup.oem file - I think in one of the test cases there was a section which had lots of commented out lines in the DriverPack txtsetup.oem..??\n\nGot this in VirtualBox machine, disks attached to SCSI controller, PCI\\\\VEN_1000\\\u0026DEV_0030, \\\\M\\\\L\\\\ folder. None of the txtsetup(xxxx).oem files, if used at all, have that hwid, so wondered if there should be config section at all, since inf files are not searched for such entries.\n\n\u003e re. looking for XP in the name, what does \u0027skipifOS\u0027 \u0027replaceIfOS\u0027 and \u0027disableIfOS\u0027 mean?\n\u003e\n[http://driverpacks.n...ack-massstorage](http://driverpacks.net/docs/miscellaneous-guides/altering-driverpack-massstorage \"External link\") :\n\n\u003e Q:What does the entry \"ms_1_exc_skipIfOS\" mean?  \n\u003e A:The \"ms_1_exc_skipIfOS\" entry represents the operating system to which the driver(s) will not be slipstreamed.\n\u003e\n\u003e For example:  \n\u003e ms_1_exc_skipIfOS\u003d \"w2k\"  \n\u003e In this example the entry will prevent the specified driver from being slipstreamed into Windows 2000.\n\u003e\n\u003e Q:What does the entry \"ms_1_exc_disableIfOS\" mean?  \n\u003e A:The \"ms_1_exc_skipIfOS\" entry represents the operating system in which the driver should not be included during textmode setup.\n\u003e\n\u003e For example:  \n\u003e Ms_1_exc_disableIfOS\u003d \"w2k\"\n\u003e\n\u003e In this example the entry will prevent the specified driver from being loaded into memory during textmode setup when the OS is Windows 2000. After the slipstream completes the driver will be present in txtsetup.sif and dosnet.inf but the entry will be prefixed by a semi-colon which will cause setup to ignore that line and therefore the driver on that line.\n\u003e\n\u003e Excluding a driver to be loaded during textmode setup can be quite useful. Windows 2000, for example, is very limited in the amount of memory that can be allocated for loading textmode drivers. So we can easily select some rarely used drivers to be \"on hold\" for text mode but still available to plug and play in windows afterwards. So far we have only needed to do this for windows 2000 and it is technically only supported for windows 2000, however, it is only a matter of time until this limit becomes a factor for XP and eventually 2003.\n\u003e\n\u003e Q:What does the entry \"ms_1_exc_replaceIfOS\" mean?  \n\u003e A:The \"ms_1_exc_replaceIfOS\" entry represents the operating system in which the specified driver should replace an already existing driver.  \n\u003e Some operating systems already contain drivers for textmode setup by default.\n\u003e\n\u003e For example:  \n\u003e Windows XP contains a driver called \"Mylex AcceleRAID 160 Disk Array Controller\".  \n\u003e This driver can be found in the I386 folder and it is named dac2w2k.sy_. If you want to overwrite this driver with a newer version you can use the following entry to tell the DPs_Base to overwrite the existing dac2w2k driver:  \n\u003e ms_1_exc_replaceIfOS\u003d \"wxp\"\n\u003e\n\u003e A revised DPMS2 is attached which fixes a few issues mentioned.\n\nGoing to play with it next few days, thanks.\n\n\u003e Have you tried any of these for \u0027real\u0027 yet?\n\nTested complete XP setup in VirtualBox and Text mode until partition screen on two Dell machines- iastor2 and iastor7.\n\n"
    }
  ]
}