{
  "id": "18734",
  "title": "Looking for a way to detect an IDE drive from a bootloader",
  "isPinned": false,
  "isFirstTopic": false,
  "isLocked": false,
  "tags": [],
  "forumNotes": [
    {
      "id": "174910",
      "timestamp": "2013-07-19T19:34:18+00:00",
      "author": "nitro2k01",
      "content": "Today\u0027s tricky boot scenario. I have bought a HDD caddy for a laptop, which allows me to use a hard drive in place of the (IDE) optical drive. As I predicted, the BIOS does not detect that this drive exists. That would be ok, since any modern OS doesn\u0027t care about what BIOS is saying and can detect the drive anyway. But then there\u0027s the actual boot process.\n\nMy current setup consists of Windows 7+GRUB4DOS on the primary disk (ie the the one that is detected \"normally\") and a Linux install on the secondary one. I can already boot the Linux installation by moving the kernel and initrd to a place that GRUB4DOS can read it. However, that means manual work every time there\u0027s a kernel update or similar. My goal is to detect the secondary drive in some way so that it\u0027s accessible in the boot land and can be chainloaded. So for example something like:\n\nmagicallydetect (hd1)\n\nrootnoverify (hd1)\n\nchainloader (hd1)+1\n\nI *have* done similar things before, on a very old laptop (Pentium 100 MHz era) where the HDD caddy was missing and was using some non-standard connector (like most laptops at the time) but the CD-ROM drive was using a standard mini IDE footprint. For that laptop, there was obviously no HDD that the BIOS could detect, so my solution was a floppy with OnTrack boot manager which would enable access to the HDD, which I could then boot to using whatever method. Before I try mucking around with OnTrack, I\u0027d like to know whether there\u0027s a simple way to just tell G4D (or another appropriate bootloader) about the existing disk.\n\nAnd yes, I somewhat do this for the sport of it. :smile:\n\n"
    },
    {
      "id": "174911",
      "timestamp": "2013-07-19T19:44:25+00:00",
      "author": "Wonko the Sane",
      "content": "Is that a USB connected external case?\n\nYou will probably need PLoP (as it has an \"own\" USB stack):\n\n[http://www.plop.at/e...otmanagers.html](http://www.plop.at/en/bootmanagers.html \"External link\")\n\n![:cheers:](http://reboot.pro/public/style_emoticons/default/cheers.gif)\n\nWonko\n\n"
    },
    {
      "id": "174912",
      "timestamp": "2013-07-19T19:48:56+00:00",
      "author": "nitro2k01",
      "content": "Read the post again. I\u0027ve replaced the laptop\u0027s optical IDE drive with a HDD, so it\u0027s no a USB drive, just an IDE drive that the BIOS can\u0027t detect. On the contrary, this laptop can boot from USB just fine.\n\nMaybe PLoP will still work, though. I\u0027ll give it a try.\n\n"
    },
    {
      "id": "174929",
      "timestamp": "2013-07-20T09:16:55+00:00",
      "author": "Wonko the Sane",
      "content": "\u003e Read the post again. I\u0027ve replaced the laptop\u0027s optical IDE drive with a HDD, so it\u0027s no a USB drive, just an IDE drive that the BIOS can\u0027t detect. On the contrary, this laptop can boot from USB just fine.\n\u003e\n\u003e Maybe PLoP will still work, though. I\u0027ll give it a try.\n\nHmmm, my bad :blush: However PLoP is worth a test anyway, it\u0027s possible that it may work, but cannot say.\n\nSince it has an \"extension\" that adds CD/DVD booting (IDE) to laptops:\n\n* CD/DVD boot without BIOS support (IDE)\n\nis \"something\", but if it is the \"device\" that is not recognized at all, then it will need a change of some kind.\n\nOn the other hand, if the \"device\" is seen by BIOS but it is seen as \"CD/DVD\", then a Hybrid solution may work.\n\nSee:\n\n[http://reboot.pro/to...os-isohybrided/](http://reboot.pro/topic/9916-grub4dos-isohybrided/ \"\")\n\nmaybe there is something of use in it.\n\nWhat happens if you boot the laptop to grub4dos (any 0.4.5c \"Featured version\", please) without the \"caddy\" connected and what happens with it is connected when at the grub4dos grub\\\u003c prompt you type find ( \\[TAB\\]?\n\n![:cheers:](http://reboot.pro/public/style_emoticons/default/cheers.gif)\n\nWonko\n\n"
    },
    {
      "id": "174941",
      "timestamp": "2013-07-20T19:19:32+00:00",
      "author": "nitro2k01",
      "content": "Thank you. I\u0027ve managed to do what I wanted using OnTrack, but I feel there should be a different, more direct way, of achieving this. Here\u0027s the hilarious chain of bootloaders I\u0027m currently using:\n\nWindows 7 loads boot loader loads G4D. G4D loads a floppy image with OnTrack DDO. This bootdisk also contains another copy of G4D which is loaded. This in turn runs rootnoverify (hd1);chainloader +1 which finally chains into the Linux installation\u0027s GRUB2 which loads its kernel.\n\n"
    },
    {
      "id": "174944",
      "timestamp": "2013-07-20T19:34:32+00:00",
      "author": "Wonko the Sane",
      "content": "\u003e Windows 7 loads boot loader loads G4D. G4D loads a floppy image with OnTrack DDO. This bootdisk also contains another copy of G4D which is loaded. This in turn runs rootnoverify (hd1);chainloader +1 which finally chains into the Linux installation\u0027s GRUB2 which loads its kernel.\n\nWell, far from \"optimal\" ![:(](http://reboot.pro/public/style_emoticons/default/sad.png), but nothing prevents you to have:\n\nGrub4dos as \"main loader\" (installed to the MBR - OPTIONAL if for any reason you don\u0027t want to fiddle with the MBR of the hard disk you can leave it alone)\n\nLoad from grub4dos the Ontrack floppy image.\n\nFrom the grub4dos on the Ontrack floppy image directly load the Linux Kernel installations.\n\n(one or two less steps)\n\nIf the Ontrack DDO works, maybe there are other friendly tools that can be used.\n\nDo you have a \"specific name\" for that diskette/is it available for free download?\n\nI would be curious to see what it does and see if it can be replicated \"somehow\", as well, if you could post some output of the mentioned commands (basically list of available disks in grub4dos) I may understand what happens.\n\n![:cheers:](http://reboot.pro/public/style_emoticons/default/cheers.gif)\n\nWonko\n\n"
    },
    {
      "id": "174947",
      "timestamp": "2013-07-20T23:04:40+00:00",
      "author": "nitro2k01",
      "content": "Well, the Linux installation (Xubuntu currently) is using a different file name for each kernel version. This is why I\u0027m insisting on booting via the secondary disk\u0027s bootloader, so that the everything works automatically over kernel upgrades. I could skip one step and boot the kernel directly from the boot disk G4D, but that requires manual work on each kernel upgrade and then I could just as well skip the whole extra step and copy the kernel+initrd over to the primary disk on each boot, which was my original solution.\n\nI don\u0027t know if it\u0027s allowed by the forum rules to upload the OnTrack disk image as an attachment on this forum, but searching for DM957.img should give you a relevant download. I guess you the situation is similar to a BIOS where you can manually configure the disks, and you change the setting of the secondary disk from \"auto\" or \"manual\" to \"none\". But instead it\u0027s always \"none\" because this BIOS doesn\u0027t expect a HDD in the optical drive bay. But this is only a problem for the bootloader (and DOS/Windows 9x if you would use that. :tongue: ) OnTrack/DDO fills in the missing information in memory.\n\nI guess another option might be to install DDO to the MBR of the primary disk.\n\n**Edited by nitro2k01, 20 July 2013 - 11:05 PM.**\n"
    },
    {
      "id": "174955",
      "timestamp": "2013-07-21T08:40:39+00:00",
      "author": "Wonko the Sane",
      "content": "\u003e Well, the Linux installation (Xubuntu currently) is using a different file name for each kernel version. This is why I\u0027m insisting on booting via the secondary disk\u0027s bootloader, so that the everything works automatically over kernel upgrades. I could skip one step and boot the kernel directly from the boot disk G4D, but that requires manual work on each kernel upgrade and then I could just as well skip the whole extra step and copy the kernel+initrd over to the primary disk on each boot, which was my original solution.\nWell, JFYI, this can be \"automated\" as well, it is not particularly difficult to write a grub4dos batch script that parses the grub.cfg of the GRUB2.  \nBut still is the \"initial part\" of the booting that should be \"simplified\" to get a \"real\" advantage.  \n\n\u003cbr /\u003e\n\n\u003cbr /\u003e\n\n\u003cbr /\u003e\n\n\u003e I don\u0027t know if it\u0027s allowed by the forum rules to upload the OnTrack disk image as an attachment on this forum, but searching for DM957.img should give you a relevant download. I guess you the situation is similar to a BIOS where you can manually configure the disks, and you change the setting of the secondary disk from \"auto\" or \"manual\" to \"none\". But instead it\u0027s always \"none\" because this BIOS doesn\u0027t expect a HDD in the optical drive bay. But this is only a problem for the bootloader (and DOS/Windows 9x if you would use that. :tongue: ) OnTrack/DDO fills in the missing information in memory.  \n\u003e\n\u003e I guess another option might be to install DDO to the MBR of the primary disk.\nIs that the Ontrack **IBM** Disk Manager version 9.57?  \nIf yes, it is a \"known\" diskette:  \n[http://reboot.pro/to...virtual-floppy/](http://reboot.pro/topic/12255-need-help-with-virtual-floppy/ \"\")  \n\nCan you detail how exactly you are using it? (which modifications you made to the floppy, contents of Autoexec.bat/Config.sys, etc.)  \n\nAnd, again, can you please type:  \n\n```\nfind ( \n```\n\n\u003cbr /\u003e\n\nand press:  \n\\[TAB\\]  \nat the grub4dos prompt and report what is seen in three cases:\n\n* from a \"plain\" grub4dos (before loading the DDO) with the caddy hard disk connected.\n* from a \"plain\" grub4dos (before loading the DDO) without the caddy hard disk connected.\n* from the grub4dos (after loading the DDO) with the caddy hard disk connected\n\nI have to understand if the device is \\*somehow\\* seen by the plain grub4dos.  \nAfter having done #2 above, IF grub4dos sees NO (cd), device can you try running:  \n\n```\ncdrom --init\nmap --hook\n```\n\n\u003cbr /\u003e\n\nand re-do the   \n\n```\nfind ( \n```\n\n\\[TAB\\]  \nand post result.  \n![:cheers:](http://reboot.pro/public/style_emoticons/default/cheers.gif)  \nWonko   \n"
    },
    {
      "id": "174958",
      "timestamp": "2013-07-21T09:14:25+00:00",
      "author": "nitro2k01",
      "content": "Ah. I\u0027ve already tried those things. I do always RTFM before asking a question. :wink:\n\nNo (cd). No (hd1). cdrom --init tells me no CD drives were detected and doesn\u0027t add anything to the device list. I\u0027m assuming that it probes for an actual CD drive, which would respond to different ATA commands than a HDD. After DDO is loaded, the drive shows up as (hd1).\n\nNot the exact same floppy image I think, but yes, the same OnTrack/DDO.\n\n**Edited by nitro2k01, 21 July 2013 - 09:34 AM.**\n"
    },
    {
      "id": "174961",
      "timestamp": "2013-07-21T10:19:58+00:00",
      "author": "Wonko the Sane",
      "content": "\u003e Ah. I\u0027ve already tried those things.\nSure :smile:, and normally I wouldn\u0027t have asked you to explicit these info, but my crystal ball is in the shop for tuning, and Tarots and I-Ching are not accurate enough for this. :wink:  \n\n\u003cbr /\u003e\n\n\u003e I do always RTFM before asking a question. :wink:\nGood. ![:thumbsup:](http://reboot.pro/public/style_emoticons/default/thumbsup.gif).  \n\n\u003e No (cd). No (hd1). cdrom --init tells me no CD drives were detected and doesn\u0027t add anything to the device list. I\u0027m assuming that it probes for an actual CD drive, which would respond to different ATA commands than a HDD. After DDO is loaded, the drive shows up as (hd1).\nGood (meaning bad ![:(](http://reboot.pro/public/style_emoticons/default/sad.png)).  \nCan you please post how EXACTLY are you loading the DDO?   \n(another thing I cannot guess from a distance)  \n\nThe \"cdrom --init\" related code (which while still in grub4dos is considered \"obsolete\" by the developers) was at the time - at least partially and if I recall correctly - derived from the SBM boot manager code:  \n[http://sourceforge.net/projects/btmgr/](http://sourceforge.net/projects/btmgr/ \"External link\")  \n\nCan you try if through it the hard disk can be \"mapped\"/\"seen\"?  \nYou might find faster to use this floppy image:  \n[http://linux.simple.be/tools/sbm](http://linux.simple.be/tools/sbm \"External link\")  \n\nAnother question - maybe stupid - how big in size is that hard disk?  \n\n![:cheers:](http://reboot.pro/public/style_emoticons/default/cheers.gif)  \nWonko   \n"
    },
    {
      "id": "174963",
      "timestamp": "2013-07-21T11:17:44+00:00",
      "author": "nitro2k01",
      "content": "Like this:\n\n```\ntitle xubchain\n\tmap --mem /boot2/dm/DM957-boot.IMG (fd0)\n\tmap --rehook\n\tchainloader (fd0)+1\n\trootnoverify (fd0)\n\n```\n\nSo basically just floppy emulation. DM957-boot.img is a copy of the original file where I\u0027ve deleted some files to make room for grub.exe, and then I\u0027ve added the following to config.sys:\n\n```\ndevice\u003dgrub.exe --config-file\u003d\"rootnoverify (hd1);chainloader +1\"\n```\n\nThis is the download location for the exact file I\u0027m using: [http://www.airuanw.com/soft/146.html](http://www.airuanw.com/soft/146.html \"External link\")\n\nThe disk is 160 GB big. But the BIOS is from 2008, so much newer than 2001 meaning that the 137 GB limit should not be an issue at all.\n\nWill try SBM.\n\n**Edited by nitro2k01, 21 July 2013 - 11:18 AM.**\n"
    },
    {
      "id": "174965",
      "timestamp": "2013-07-21T12:01:46+00:00",
      "author": "Wonko the Sane",
      "content": "\u003e So basically just floppy emulation. DM957-boot.img is a copy of the original file where I\u0027ve deleted some files ...\n\nYep :smile:, if you could list the files that remain and also the whole config.sys and autoexec.bat, that would make it possible to attempt replicating it.  \nI see now that we were talking of completely different diskettes, the one you linked to is a sort of \"generic\" boot floppy with the OnTrack DDO, the one I was talking about is an IBM disk manager boot diskette.  \n\u003e The disk is 160 GB big. But the BIOS is from 2008, so much newer than 2001 meaning that the 137 GB limit should not be an issue at all.\n\nWell, at least with a few BIOS (even VERY recent), particularly on notebooks, the USB stack does have LBA28 limitations (and/or detection of USB connected drives is either faulty or non-existant), depending on the make/model of the stupid thingy (and consequently on the amount of stupidity of the BIOS developers) I wouldn\u0027t be surprised that they used for that \"IDE port\" an \"old\" BIOS module of some kind.\n\nA Disk Drive Overlay is often \"connected\" to disk size (and CHS/LBA limits) that\u0027s the reason why I was asking, I thought possible ![:unsure:](http://reboot.pro/public/style_emoticons/default/unsure.png) that the issue is \\*somehow\\* \"HD size\" related.\n\nBut I now understand that we are maybe inside a much trickier (lost in the midst of time) kind of thing, possibly not completely unlike:  \n[ftp://ftp.seagate.com/techsuppt/misc/dos5info.txt](ftp://ftp.seagate.com/techsuppt/misc/dos5info.txt \"External link\")  \n\u003e With DOS 4 and DOS 5, few conditions really REQUIRE Disk  \n\u003e Manager or any similar device driver. In general the following basic  \n\u003e rules apply:  \n\u003e\n\u003e a. Any XT system will not need Disk Manager.  \n\u003e b. Any SCSI drive will not need Disk Manager.  \n\u003e c. Most RLL and ESDI drives will not need Disk Manager.  \n\u003e d. AT systems with matching CMOS drive types will not need  \n\u003e Disk Manager.  \n\u003e e. AT systems with \"custom\" or \"user-definable\" CMOS drive  \n\u003e types will not need Disk Manager.  \n\u003e f. Seagate ST01/02, ST05X, ST11M/R, or ST21/22M/R  \n\u003e controllers and host adapters will not need Disk  \n\u003e Manager.  \n\u003e\n\u003e In other words, if you have an AT system with either an MFM or++**AT\n\u003e (ide) interface drive that is NOT supported in the CMOS drive type\n\u003e table and is without \"Custom\" drive types**++ , then the Disk Manager  \n\u003e program MAY be needed. In the case of the MFM drives, the ST22M 1 to  \n\u003e 1 16-bit controller with on-board bios is an inexpensive way to work  \n\u003e around the problem. Similar host adapter solutions with on-board BIOS  \n\u003e are available for the AT (ide) drives as well.\n\nAaaah ....the good ol\u0027 times when BIOSes were coded \"casually\" , no, wait ![:unsure:](http://reboot.pro/public/style_emoticons/default/unsure.png), besides your particular issue ![:(](http://reboot.pro/public/style_emoticons/default/sad.png), we are (or will soon be) back to the SAME kind of issues with EFI ![:whistling:](http://reboot.pro/public/style_emoticons/default/happy22.gif) ![:frusty:](http://reboot.pro/public/style_emoticons/default/frusty.gif)\n\n\u003e Will try SBM.\n\nGood. :smile:\n\nNow that maybe I have more clear the issue, there is also another thing to try/have a look at (possibly OT/unneeded/NOT suitable):\n\n[http://code.google.c...euniversalbios/](http://code.google.com/p/xtideuniversalbios/ \"External link\")\n\n[http://code.google.c...i/Manual_v2_0_0](http://code.google.com/p/xtideuniversalbios/wiki/Manual_v2_0_0 \"External link\")\n\nThough I have no idea if it can be of use and actually how to use it in practice ![:ph34r:](http://reboot.pro/public/style_emoticons/default/scared9.gif) (i.e. NOT using a add-on card and an EPROM), like chainloading/loading it as a \"module\" (or whatever) with grub4dos or GRUB2.  \n\n![:cheers:](http://reboot.pro/public/style_emoticons/default/cheers.gif)  \nWonko\n\n"
    }
  ]
}