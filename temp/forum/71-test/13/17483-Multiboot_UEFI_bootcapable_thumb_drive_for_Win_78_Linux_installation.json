{
  "id": "17483",
  "title": "Multiboot UEFI boot-capable thumb drive for Win 7/8 \u0026 Linux installation",
  "isPinned": false,
  "isFirstTopic": false,
  "isLocked": false,
  "tags": [],
  "forumNotes": [
    {
      "id": "160227",
      "timestamp": "2012-09-10T23:24:07+00:00",
      "author": "cyphersmith",
      "content": "Hi,  \n\nOk, I am trying to create a bootable thumb drive that will have the following features:\n\n* Boots in UEFI mode  \n  * I can get it to do this with an installation of GRUB (not GRUB-legacy)\n* Boots in standard BIOS mode (via the compatibility module in EFI)  \n  * This I can get GRUB to do\n* Can install multiple Linux distributions  \n  * Again, GRUB will do this, though I might have some problems with Fedora\n* Can install all versions of Windows 7 and 8  \n  * This is where I am running into problems\n  * Grub4Dos will not work for this, it runs in real mode, which I can\u0027t get into when in EFI mode\n  * I\u0027m not sure I can even get into Syslinux from GRUB, and I think it needs real mode as well\n  * Windows won\u0027t boot from a loop device, so I can\u0027t use loopback\n* Boot to a DOS prompt  \n  * I don\u0027t think this is possible, since a DOS prompt needs real mode\n\n\u003cbr /\u003e\n\nMy current thought is that I can get this working if I can find a way to mount the ISO\u0027s in a way that Windows can understand. This is what the thumb drive I currently use does, but it won\u0027t boot to UEFI since I am using Syslinux, which doesn\u0027t boot to UEFI (actually, I\u0027m technically using grub4dos and WinFira, with Syslinux being the bootloader).  \n\nI know that I can boot to a Windows installation if it\u0027s extracted to the root, but the problem with this is that only one Windows OS can be set up this way at a time, since it needs to be in the root. If GRUB had file manipulation capabilities, then I might be able to make this would work, but I don\u0027t think it does. Obviously, I could do this with a script in an OS, but I would rather not. This installation will be used by multiple people so I need to keep it as simple as I can.   \n"
    },
    {
      "id": "160336",
      "timestamp": "2012-09-13T16:49:22+00:00",
      "author": "sbaeder",
      "content": "Have you looked more at the [RMPrepUSB site](http://www.rmprepusb.com/ \"External link\")? He is also active here, but there are a lot of good tutorials on his site!!!  \n\nSee especially #43 [http://www.rmprepusb...ials/firawiniso](http://www.rmprepusb.com/tutorials/firawiniso \"External link\") While more oriented to grub4dos, you may be able to extrapolate and use the techniques with grub  \n\n![:cheers:](http://reboot.pro/public/style_emoticons/default/cheers.gif)  \nScott   \n"
    },
    {
      "id": "160338",
      "timestamp": "2012-09-13T17:06:07+00:00",
      "author": "Wonko the Sane",
      "content": "May I dare to ask WHY is actual UEFI booting needed?  \n\nAs a workaround (maybe useful, maybe not ![:unsure:](http://reboot.pro/public/style_emoticons/default/unsure.png)):  \n[http://xpcboot.weebly.com/](http://xpcboot.weebly.com/ \"External link\")  \n[http://pete.akeo.ie/...-usb-stick.html](http://pete.akeo.ie/2011/07/creating-bootable-uefi-duet-usb-stick.html \"External link\")  \nor use a hybrid GPT/MBR disk, like:  \n[http://www.rodsbooks.com/gdisk/](http://www.rodsbooks.com/gdisk/ \"External link\")  \n[http://www.rodsbooks...isk/hybrid.html](http://www.rodsbooks.com/gdisk/hybrid.html \"External link\")  \n\n![:cheers:](http://reboot.pro/public/style_emoticons/default/cheers.gif)  \nWonko   \n"
    },
    {
      "id": "160339",
      "timestamp": "2012-09-13T17:49:38+00:00",
      "author": "cyphersmith",
      "content": "\u003e Have you looked more at the [RMPrepUSB site](http://www.rmprepusb.com/ \"External link\")? He is also active here, but there are a lot of good tutorials on his site!!!  \n\u003e\n\u003e See especially #43 [http://www.rmprepusb...ials/firawiniso](http://www.rmprepusb.com/tutorials/firawiniso \"External link\") While more oriented to grub4dos, you may be able to extrapolate and use the techniques with grub  \n\u003e\n\u003e ![:cheers:](http://reboot.pro/public/style_emoticons/default/cheers.gif)  \n\u003e Scott  \n\nI actually have a thumb drive set up using those instructions, it\u0027s just not UEFI capable. The problem that I am running into is mounting a Windows ISO in GRUB. The tools for doing that all seem to require being in real mode, which is not available from GRUB in UEFI mode.  \n\n\u003e May I dare to ask WHY is actual UEFI booting needed?\n\nI work in a hardware validation lab at Intel. Specifically, we do platform compatibility validation. This means we are often installing OS\u0027s onto our systems. Because UEFI is becoming more prevalent (especially with the changes introduced in Windows 8), some of those installs MUST be done with UEFI enabled to ensure that everything works right. Putting all of the images onto one thumb drive that I can boot from would be really useful. I can do that right now, using the thumb drive I created with instructions from RMPrepUSB. Except that that thumb drive won\u0027t boot to UEFI, which means that I have to have separate media for UEFI, which kinda makes the thumb drive redundant since installation disks can be used for both standard installs and UEFI installs.  \n\n\u003e As a workaround (maybe useful, maybe not ![:unsure:](http://reboot.pro/public/style_emoticons/default/unsure.png)):  \n\u003e [http://xpcboot.weebly.com/](http://xpcboot.weebly.com/ \"External link\")  \n\u003e [http://pete.akeo.ie/...-usb-stick.html](http://pete.akeo.ie/2011/07/creating-bootable-uefi-duet-usb-stick.html \"External link\")  \n\u003e or use a hybrid GPT/MBR disk, like:  \n\u003e [http://www.rodsbooks.com/gdisk/](http://www.rodsbooks.com/gdisk/ \"External link\")  \n\u003e [http://www.rodsbooks...isk/hybrid.html](http://www.rodsbooks.com/gdisk/hybrid.html \"External link\")  \n\u003e\n\u003e ![:cheers:](http://reboot.pro/public/style_emoticons/default/cheers.gif)  \n\u003e Wonko  \n\nI\u0027ll take a look at those websites.   \n\n**Edited by cyphersmith, 13 September 2012 - 05:50 PM.**\n"
    },
    {
      "id": "160344",
      "timestamp": "2012-09-13T19:41:23+00:00",
      "author": "sbaeder",
      "content": "Sounds more like you might want to look at [ISOStick](http://reboot.pro/15475/ \"\")(or the [Zalman](http://reboot.pro/14006/ \"\")USB drive container), where they allow you to have a LOT of ISO\u0027s on the storage, and select one that then is emulated out on the USB as if it was a physical DVD/CD...  \n\nSeems like Intel could afford something like either of these...:smile:  \n\n![:cheers:](http://reboot.pro/public/style_emoticons/default/cheers.gif)  \nScott   \n"
    },
    {
      "id": "160353",
      "timestamp": "2012-09-13T20:53:40+00:00",
      "author": "cyphersmith",
      "content": "\u003e Sounds more like you might want to look at [ISOStick](http://reboot.pro/15475/ \"\")(or the [Zalman](http://reboot.pro/14006/ \"\")USB drive container), where they allow you to have a LOT of ISO\u0027s on the storage, and select one that then is emulated out on the USB as if it was a physical DVD/CD...  \n\u003e\n\u003e Seems like Intel could afford something like either of these... :smile:  \n\u003e\n\u003e ![:cheers:](http://reboot.pro/public/style_emoticons/default/cheers.gif)  \n\u003e Scott  \n\nI have to say that I was unaware of the ISOStick, or the Zalman case. I would prefer the ISOStick, personally, but I haven\u0027t finished that thread, so I don\u0027t know if it\u0027s generally available yet. I\u0027m looking into it.  \nEDIT: There is one other reason that I\u0027m looking into methods using GRUB. We just bought 64GB USB 3.0 thumb drives for the whole team. I would like to use those so that we don\u0027t have to purchase more equipment.   \n\n**Edited by cyphersmith, 13 September 2012 - 09:33 PM.**\n"
    },
    {
      "id": "160356",
      "timestamp": "2012-09-14T00:55:50+00:00",
      "author": "sbaeder",
      "content": "Good point, and it\u0027s always good to know if there are other ways to do the job...I\u0027m no \"grub\" expert, but will be interested to see what you came up with.   \n"
    },
    {
      "id": "160361",
      "timestamp": "2012-09-14T07:53:16+00:00",
      "author": "Wonko the Sane",
      "content": "Very good. :smile:  \n\nThe given answer translates nicely to \"I\u0027m doing this for fun and to learn new things\". ![:w00t:](http://reboot.pro/public/style_emoticons/default/w00t.gif)  \n(reasons that **Wonko** fully approves of ![:thumbup:](http://reboot.pro/public/style_emoticons/default/thumbup.gif))  \n\nI mean, the burden of having two different USB sticks is unbearable, not only if you have to carry them with you, but all the space they occupy in the lab.... ![:ph34r:](http://reboot.pro/public/style_emoticons/default/scared9.gif):wink:  \n![:rofl:](http://reboot.pro/public/style_emoticons/default/roll1.gif)  \n\n\u003cbr /\u003e\n\n\u003cbr /\u003e\n\nAnother thing, maybe useful or maybe not, that you could probably make use of is the grub24dos:  \n~~http://reboot.pro/13282/~~   \n~~https://sourceforge.net/projects/grub24dos~~   \n\nnow renamed/evolved to grub2win:  \n\u003chttp://reboot.pro/17454/\u003e   \n[http://sourceforge.n...jects/grub2win/](http://sourceforge.net/projects/grub2win/ \"External link\")  \n\nAs it may allow better \"interchange\" between the various pieces of the puzzle.  \n\n\u003cbr /\u003e\n\n![:cheers:](http://reboot.pro/public/style_emoticons/default/cheers.gif)  \nWonko   \n"
    },
    {
      "id": "160519",
      "timestamp": "2012-09-17T20:51:00+00:00",
      "author": "cyphersmith",
      "content": "\u003e Very good. :smile:  \n\u003e\n\u003e The given answer translates nicely to \"I\u0027m doing this for fun and to learn new things\". ![:w00t:](http://reboot.pro/public/style_emoticons/default/w00t.gif)  \n\u003e (reasons that **Wonko** fully approves of ![:thumbup:](http://reboot.pro/public/style_emoticons/default/thumbup.gif))  \n\u003e\n\u003e I mean, the burden of having two different USB sticks is unbearable, not only if you have to carry them with you, but all the space they occupy in the lab.... ![:ph34r:](http://reboot.pro/public/style_emoticons/default/scared9.gif) :wink:  \n\u003e ![:rofl:](http://reboot.pro/public/style_emoticons/default/roll1.gif)  \n\u003e\n\u003e \u003cbr /\u003e\n\u003e\n\u003e \u003cbr /\u003e\n\u003e\n\u003e Another thing, maybe useful or maybe not, that you could probably make use of is the grub24dos:  \n\u003e ~~\u003chttp://reboot.pro/13282/\u003e~~   \n\u003e ~~[https://sourceforge....jects/grub24dos](https://sourceforge.net/projects/grub24dos \"External link\")~~   \n\u003e\n\u003e now renamed/evolved to grub2win:  \n\u003e \u003chttp://reboot.pro/17454/\u003e  \n\u003e [http://sourceforge.n...jects/grub2win/](http://sourceforge.net/projects/grub2win/ \"External link\")  \n\u003e\n\u003e As it may allow better \"interchange\" between the various pieces of the puzzle.  \n\u003e\n\u003e \u003cbr /\u003e\n\u003e\n\u003e ![:cheers:](http://reboot.pro/public/style_emoticons/default/cheers.gif)  \n\u003e Wonko  \n\nWell, I took a look at grub4win, and I don\u0027t think I can get it to work. I think it works from the Windows bootloader, but I don\u0027t think that the Windows bootloader, but I\u0027m not sure that you can get the Windows bootloader on a thumb drive to actually have a proper BCD menu from a thumb drive that doesn\u0027t have its RMB flipped so it\u0027s not seen as a removable drive . And I don\u0027t know if you actually can flip the RMB bit on the drive I have (it\u0027s a Lexar Triton USB 3.0 drive). The only thread I saw about doing that with this drive wasn\u0027t very encouraging (the drive was made unuseable).   \n"
    },
    {
      "id": "160522",
      "timestamp": "2012-09-17T22:31:42+00:00",
      "author": "cdob",
      "content": "\u003e I work in a hardware validation lab at Intel.\nAsk your coworkers to integrate ISO file mount at BIOS/UEFI.  \nBoot a Intel motherboard and select a ISO file at a USB stick.  \n\nWell´next step would be a agreement at hardware and software manufacturer.  \nThat\u0027s a suggestion to all manufacturers.  \nAssume a config file /efi/boot/mount  \nThe UEFI writes ISO file name to config file /efi/boot/mount and OS read the config file.  \n\n\u003e but I\u0027m not sure that you can get the Windows bootloader on a thumb drive to actually have a proper BCD menu from a thumb drive that doesn\u0027t have its RMB flipped so it\u0027s not seen as a removable drive .\nThe BCD menu works fine at a removable drive, at least at BIOS.  \n\nShould work at UEFI too [Walkthrough: Boot Windows PE from a UEFI-based Hard Disk](http://technet.microsoft.com/en-us/library/hh265131(v\u003dws.10).aspx \"External link\")  \nTry it. Does BCD works at UEFI at a removable drive?   \n"
    },
    {
      "id": "160526",
      "timestamp": "2012-09-17T22:52:39+00:00",
      "author": "cyphersmith",
      "content": "\u003e Ask your coworkers to integrate ISO file mount at BIOS/UEFI.  \n\u003e Boot a Intel motherboard and select a ISO file at a USB stick.  \n\u003e\n\u003e Well´next step would be a agreement at hardware and software manufacturer.  \n\u003e That\u0027s a suggestion to all manufacturers.  \n\u003e Assume a config file /efi/boot/mount  \n\u003e The UEFI writes ISO file name to config file /efi/boot/mount and OS read the config file.  \n\u003e\n\u003e \u003cbr /\u003e\n\u003e\n\u003e The BCD menu works fine at a removable drive, at least at BIOS.  \n\u003e\n\u003e Should work at UEFI too [Walkthrough: Boot Windows PE from a UEFI-based Hard Disk](http://technet.microsoft.com/en-us/library/hh265131(v\u003dws.10).aspx \"External link\")  \n\u003e Try it. Does BCD works at UEFI at a removable drive?  \n\nIt\u0027s going to take me a bit to go through the information at that link. it looks like good information.  \nMounting the ISO from EFI would be nice. That should actually be doable. An EFI program should be able to be written which will do exactly that. In fact, a lot can be done in EFI before really even hitting the bootloarder. I just don\u0027t have the knowledge myself to write it. Shoot, it can probably be set up to let the user choose the ISO to mount, mount it, then hand things over to whichever disk is mounted. Windows would likely still require a driver such as FiraDisk to see the drive, but that can be integrated into the ISO. Though I wouldn\u0027t be able to do it for Win8 x64 (or probably Server 2012 x64) because of the change that MS did to the signing method with it.   \n"
    },
    {
      "id": "160532",
      "timestamp": "2012-09-18T04:33:58+00:00",
      "author": "cdob",
      "content": "\u003e Mounting the ISO from EFI would be nice.\n\nIs this a requirement? Do you require a ISO file?  \nCan you use another approach?   \n"
    },
    {
      "id": "160534",
      "timestamp": "2012-09-18T07:52:04+00:00",
      "author": "Wonko the Sane",
      "content": "\u003e ... but I don\u0027t think that the Windows bootloader, but I\u0027m not sure that you can get the Windows bootloader on a thumb drive to actually have a proper BCD menu from a thumb drive that doesn\u0027t have its RMB flipped so it\u0027s not seen as a removable drive .   \nWell, it works, besides USB sticks (Removable or FIxed) even from floppies:  \n[http://www.multiboot....uk/floppy.html](http://www.multibooters.co.uk/floppy.html \"External link\")  \n\nJust for the record, for MBR devices only Windows, and only NT based Windows AFAIK care about the Removable or Fixed status of a USB stick, and they ONLY do in the \"protected mode\" part, and the only issue is that only first partition (actually the partition which address is in first partition entry in the partition table) is mounted/mountale/accessed (unless you use a filter driver).  \nWhat happens with GPT is what you should actually test and know. ![:unsure:](http://reboot.pro/public/style_emoticons/default/unsure.png)  \n\n![:cheers:](http://reboot.pro/public/style_emoticons/default/cheers.gif)  \nWonko   \n"
    },
    {
      "id": "160552",
      "timestamp": "2012-09-18T17:12:14+00:00",
      "author": "cyphersmith",
      "content": "\u003e Is this a requirement? Do you require a ISO file?  \n\u003e Can you use another approach?  \n\nCertainly, but one of the problems with Windows is that the install must be in the root directory. This is not the case for an ISO.  \n\n\u003e Well, it works, besides USB sticks (Removable or FIxed) even from floppies:  \n\u003e [http://www.multiboot....uk/floppy.html](http://www.multibooters.co.uk/floppy.html \"External link\")  \n\u003e\n\u003e Just for the record, for MBR devices only Windows, and only NT based Windows AFAIK care about the Removable or Fixed status of a USB stick, and they ONLY do in the \"protected mode\" part, and the only issue is that only first partition (actually the partition which address is in first partition entry in the partition table) is mounted/mountale/accessed (unless you use a filter driver).  \n\u003e What happens with GPT is what you should actually test and know. ![:unsure:](http://reboot.pro/public/style_emoticons/default/unsure.png)  \n\u003e\n\u003e ![:cheers:](http://reboot.pro/public/style_emoticons/default/cheers.gif)  \n\u003e Wonko  \n\nI think you\u0027re right here. I hadn\u0027t thought of doing this using a GPT rather than an MBR. Since I don\u0027t think that an OS that can\u0027t recognize a GPT will be required, I could set up a GPT on the thumb drive and chainload each Windows OS install from its own partition. Assuming that Windows won\u0027t complain about that. A similar thing could be done for the various Linux distros, though they wouldn\u0027t need to have their own partitions. Of course, those can be ISOs (though some distros make that difficult).   \n"
    },
    {
      "id": "160553",
      "timestamp": "2012-09-18T17:39:35+00:00",
      "author": "Wonko the Sane",
      "content": "Well, for the record, we have by now several ways to boot (and install) Windows NT based systems from a .iso or from \"non-iso\", as well we have ways to have a multi-partitioned MBR working allright (by simply changing the parition order or anyway writing the partition table on-the-fly with grub4dos or similar tools) that is using BIOS.  \nBesides the several methods listed here:  \n[http://www.msfn.org/...ndows-from-usb/](http://www.msfn.org/board/forum/157-install-windows-from-usb/ \"External link\")  \n**Steve6375** has several tutorials on his site [http://www.rmprepusb.com/](http://www.rmprepusb.com/ \"External link\")  \n\nHow these method are \"portable\" to UEFI (and since I cannot say how grub4dos behaves with either UEFI or GPT) and to have them working with grub2 (or similar) is actually the object of this topic, what I can provide (at the most) is info on how to do these things on \"normal\" BIOS/MBR, but all the rest is up to you, only trying to help you follow Mikhail Kalashnikov\u0027s ![:w00t:](http://reboot.pro/public/style_emoticons/default/w00t.gif) advice ![:smiling9:](http://reboot.pro/public/style_emoticons/default/smiling9.gif):  \n\u003chttp://reboot.pro/15298/#entry136216\u003e  \n\n![:cheers:](http://reboot.pro/public/style_emoticons/default/cheers.gif)  \nWonko   \n"
    },
    {
      "id": "160588",
      "timestamp": "2012-09-19T20:57:28+00:00",
      "author": "cdob",
      "content": "\u003e but one of the problems with Windows is that the install must be in the root directory.\nRoot directory from which part?  \nUse several partitions and flip MBR data on the fly. No idea at EFI mode.  \n\nVHD images are supported out of the box.  \nYou may wrap installation files inside a VHD image.  \nAs for USB stick: there are several VHD files.  \nAs for windows install: root directory is used still.  \nA windows 7 example \u003chttp://reboot.pro/14755/#entry131133\u003e  \n\nHowever native VHD mounting requires a NTFS partition.  \nDoes EFI read NTFS partition? Most likely a addional FAT partiton is required.  \nBack to another multi partition approach. Should be possible at removable drive still.  \n\n\u003cbr /\u003e\n\n\u003e I hadn\u0027t thought of doing this using a GPT rather than an MBR. Since I don\u0027t think that an OS that can\u0027t recognize a GPT will be required, I could set up a GPT on the thumb drive and chainload each Windows OS install from its own partition.\nYes, GPT at USB would be another approach.  \n\nSample: Configure BIOS/MBR-Based Hard Disk Partitions by Using Windows PE and DiskPart  \n[http://technet.micro...y/hh825677.aspx](http://technet.microsoft.com/en-us/library/hh825677.aspx \"External link\")  \n\nSample: Configure UEFI/GPT-Based Hard Drive Partitions by Using Windows PE and DiskPart  \n[http://technet.micro...y/hh825686.aspx](http://technet.microsoft.com/en-us/library/hh825686.aspx \"External link\")  \n\nIdea:  \nAdd Windows and \\*nix to EFI System Partition  \nLet EFI bootmanger select between both. There is no need to chainload a bootmager.   \n"
    },
    {
      "id": "160690",
      "timestamp": "2012-09-22T10:32:13+00:00",
      "author": "cdob",
      "content": "\u003e However native VHD mounting requires a NTFS partition.  \n\u003e Does EFI read NTFS partition? Most likely a addional FAT partiton is required.  \n\u003e Back to another multi partition approach. Should be possible at removable drive still.\n\nWindows and EFI share first partition limitation.  \n\nGiven a removable USB stick at MBR mode: [http://en.wikipedia....ter_boot_record](http://en.wikipedia.org/wiki/Master_boot_record \"External link\")  \nFAT16 first partiton - MBR offset +446 - bootmgr and \\\\boot\\\\  \nNTFS second partiton - MBR offset +462 - VHD image  \n\nWindows mount first partiton only at a removable stick. \u003chttp://reboot.pro/16274/\u003e  \nException: a previous partition types 0x00 is ignored. The next partiton entry is mounted.  \nBootmgr dosn\u0027t detect \\\\boot\\\\bcd at 0x00 partition type.  \n\nUEFI searches first partition to auto-detect a OS loader. [http://en.wikipedia....mware_Interface](http://en.wikipedia.org/wiki/Unified_Extensible_Firmware_Interface \"External link\")  \nUEFI finds a file /EFI/BOOT/BOOTx64.EFI at a FAT 0x06 partiton type.  \nContrary a partition type 0x00 is ignored: file /EFI/BOOT/BOOTx64.EFI is not found  \n\n\u003cbr /\u003e\n\n\u003cbr /\u003e\n\nGiven a removable USB stick at MBR mode:  \nNTFS first partiton - MBR offset +446  \nFAT16 second partiton - MBR offset +462  \n\nFAT16 partiton type set to 0xEF  \n[http://en.wikipedia....ystem_partition](http://en.wikipedia.org/wiki/EFI_System_partition \"External link\")  \nAt EFI mode file /EFI/BOOT/BOOTx64.EFI is not found here. EFI boot is missing  \nEFI partiton type 0xEF is ignored.  \n\n\u003cbr /\u003e\n\nUEFI MBR mode and native VHD volumes are a riddle still.  \n\n\u003cbr /\u003e\n\nOr goto GPT at USB?   \n"
    },
    {
      "id": "160794",
      "timestamp": "2012-09-26T19:57:20+00:00",
      "author": "cyphersmith",
      "content": "\u003e Windows and EFI share first partition limitation.  \n\u003e\n\u003e Given a removable USB stick at MBR mode: [http://en.wikipedia....ter_boot_record](http://en.wikipedia.org/wiki/Master_boot_record \"External link\")  \n\u003e FAT16 first partiton - MBR offset +446 - bootmgr and boot  \n\u003e NTFS second partiton - MBR offset +462 - VHD image  \n\u003e\n\u003e Windows mount first partiton only at a removable stick. \u003chttp://reboot.pro/16274/\u003e  \n\u003e Exception: a previous partition types 0x00 is ignored. The next partiton entry is mounted.  \n\u003e Bootmgr dosn\u0027t detect bootbcd at 0x00 partition type.  \n\u003e\n\u003e UEFI searches first partition to auto-detect a OS loader. [http://en.wikipedia....mware_Interface](http://en.wikipedia.org/wiki/Unified_Extensible_Firmware_Interface \"External link\")  \n\u003e UEFI finds a file /EFI/BOOT/BOOTx64.EFI at a FAT 0x06 partiton type.  \n\u003e Contrary a partition type 0x00 is ignored: file /EFI/BOOT/BOOTx64.EFI is not found  \n\u003e\n\u003e \u003cbr /\u003e\n\u003e\n\u003e \u003cbr /\u003e\n\u003e\n\u003e Given a removable USB stick at MBR mode:  \n\u003e NTFS first partiton - MBR offset +446  \n\u003e FAT16 second partiton - MBR offset +462  \n\u003e\n\u003e FAT16 partiton type set to 0xEF  \n\u003e [http://en.wikipedia....ystem_partition](http://en.wikipedia.org/wiki/EFI_System_partition \"External link\")  \n\u003e At EFI mode file /EFI/BOOT/BOOTx64.EFI is not found here. EFI boot is missing  \n\u003e EFI partiton type 0xEF is ignored.  \n\u003e\n\u003e \u003cbr /\u003e\n\u003e\n\u003e UEFI MBR mode and native VHD volumes are a riddle still.  \n\u003e\n\u003e \u003cbr /\u003e\n\u003e\n\u003e Or goto GPT at USB?  \n\nSo I ran into a problem with using GPT on the thumb drive.Windows cannot boot to a GPT drive if you\u0027re using BIOS instead of EFI. I think, however, that I can get around this using Hybrid MBR\u0027s. Though I think that I might need to change partition order on the fly (since a removable disk is only supposed to have one partition).  \n\nI haven\u0027t done this yet, gonna try today, but here\u0027s what I\u0027m thinking will work. Boot to grub. In the menu, there should be the following choices:\n\n* EFI Windows 7 x64\n* EFI Windows 8 x64\n* Non-EFI Windows 7 x64\n* Non-EFI Windows 8 x64\n* Non-EFI Windows 7 x86\n* Non-EFI Windows 8 x86\n* Various linux distros\n\nTo do this, I will use GPT with hybrid MBR\u0027s. One for each of the 64-bit Windows installations, and one for the rest of the Windows installations. The Linux installations, I think, don\u0027t need to be in a hybrid MBR, though they can. The thing I am trying to figure out right now is how to set up the grub.cfg.   \n"
    },
    {
      "id": "165931",
      "timestamp": "2013-01-16T01:52:07+00:00",
      "author": "cyphersmith",
      "content": "\u003e So I ran into a problem with using GPT on the thumb drive.Windows cannot boot to a GPT drive if you\u0027re using BIOS instead of EFI. I think, however, that I can get around this using Hybrid MBR\u0027s. Though I think that I might need to change partition order on the fly (since a removable disk is only supposed to have one partition).  \n\u003e\n\u003e I haven\u0027t done this yet, gonna try today, but here\u0027s what I\u0027m thinking will work. Boot to grub. In the menu, there should be the following choices:\n\u003e\n\u003e * EFI Windows 7 x64\n\u003e * EFI Windows 8 x64\n\u003e * Non-EFI Windows 7 x64\n\u003e * Non-EFI Windows 8 x64\n\u003e * Non-EFI Windows 7 x86\n\u003e * Non-EFI Windows 8 x86\n\u003e * Various linux distros\n\u003e To do this, I will use GPT with hybrid MBR\u0027s. One for each of the 64-bit Windows installations, and one for the rest of the Windows installations. The Linux installations, I think, don\u0027t need to be in a hybrid MBR, though they can. The thing I am trying to figure out right now is how to set up the grub.cfg.\n\nThis didn\u0027t work for me. I couldn\u0027t get Windows to see the partitions. I am running out of ideas.\n\nIf I can modify the directory structure while I was in GRUB or possible before then, I could probably do it. Then I could have each Windows OS in a sub-directory, delete whatever is currently in the root and copy the version that is needed into the root. I could do this manually before doing the install, it\u0027s just less than elegant. Anyone know if this can be done by GRUB, or something else? I suspect it could be done within the EFI shell as a shell script, so it may be time to learn EFI shell scripting.\n\n"
    },
    {
      "id": "165932",
      "timestamp": "2013-01-16T02:07:07+00:00",
      "author": "Sha0",
      "content": "\u003e This didn\u0027t work for me. I couldn\u0027t get Windows to see the partitions. I am running out of ideas.\n\u003e\n\u003e If I can modify the directory structure while I was in GRUB or possible before then, I could probably do it. Then I could have each Windows OS in a sub-directory, delete whatever is currently in the root and copy the version that is needed into the root. I could do this manually before doing the install, it\u0027s just less than elegant. Anyone know if this can be done by GRUB, or something else? I suspect it could be done within the EFI shell as a shell script, so it may be time to learn EFI shell scripting.\n\nBy default, Windows will not provide the partitions for your USB flash storage device. You will need a filter driver, such as [**diskmod**](http://reboot.pro/topic/9461-page-file-in-usb-hard-disk/ \"\"). Hybrid MBR/GPT has some problems with older (U)EFI, so I\u0027d abandon that approach. For widest compatibility with (U)EFI and BIOS, I\u0027d suggest a plain MBR, with a **FAT** partition whose type code in the partition table is **0xEF**.\n\nIf you cannot use a disk filter driver, I\u0027d say you have to drop one of:\n\n* USB flash storage as the USB storage device\n* Multiple partitions on the USB storage device\n\n\u003cbr /\u003e\n\n"
    },
    {
      "id": "165935",
      "timestamp": "2013-01-16T05:59:31+00:00",
      "author": "wimb",
      "content": "UEFI Multiboot USB - Windows 8 and Linux Parted Magic  \n\n[http://reboot.pro/to...e-2#entry165182](http://reboot.pro/topic/17877-uefi-windows-8-bios-grub4dos-multiboot-usb-harddisk/page-2#entry165182 \"\")\n\nI used portable USB-harddisk with Standard MBR and FAT32 Boot + NTFS System partition\n\nAfter booting with Windows 8 from USB you can run WinNTSetup2\n\nand use R-mouse to mount Setup ISO and prepare drive for Install of Windows 7 or 8 or XP\n\n[http://www.msfn.org/...-winntsetup-v2/](http://www.msfn.org/board/topic/149612-winntsetup-v2/ \"External link\")\n\n[http://www.911cd.net...showtopic\u003d24424](http://www.911cd.net/forums//index.php?showtopic\u003d24424 \"External link\")\n\n\\[attachment\u003d14093:W8U-SetupW7.png\\]\n\n"
    },
    {
      "id": "165961",
      "timestamp": "2013-01-16T17:49:12+00:00",
      "author": "cyphersmith",
      "content": "\u003e By default, Windows will not provide the partitions for your USB flash storage device. You will need a filter driver, such as [**diskmod**](http://reboot.pro/topic/9461-page-file-in-usb-hard-disk/ \"\"). Hybrid MBR/GPT has some problems with older (U)EFI, so I\u0027d abandon that approach. For widest compatibility with (U)EFI and BIOS, I\u0027d suggest a plain MBR, with a **FAT** partition whose type code in the partition table is **0xEF**.\n\u003e\n\u003e If you cannot use a disk filter driver, I\u0027d say you have to drop one of:\n\u003e\n\u003e * USB flash storage as the USB storage device\n\u003e * Multiple partitions on the USB storage device\n\nI\u0027m not committed to multiple partitions, I\u0027m committed to multiple versions of Windows. If I can\u0027t boot them from ISO, which seems to be the case currently with UEFI, I have to find some other way to boot them. Multiple partitions was an idea because if the Windows ISO is extracted to a thumb drive it requires that it be in the root of the partition. Can the filter driver be loaded during install?\n\n\u003e UEFI Multiboot USB - Windows 8 and Linux Parted Magic  \n\u003e\n\u003e [http://reboot.pro/to...e-2#entry165182](http://reboot.pro/topic/17877-uefi-windows-8-bios-grub4dos-multiboot-usb-harddisk/page-2#entry165182 \"\")\n\u003e\n\u003e I used portable USB-harddisk with Standard MBR and FAT32 Boot + NTFS System partition\n\u003e\n\u003e After booting with Windows 8 from USB you can run WinNTSetup2 and use mounted ISO\n\u003e\n\u003e to prepare drive for Install of Windows 7 or 8 or XP\n\u003e\n\u003e [http://www.msfn.org/...-winntsetup-v2/](http://www.msfn.org/board/topic/149612-winntsetup-v2/ \"External link\")\n\u003e\n\u003e [http://www.911cd.net...showtopic\u003d24424](http://www.911cd.net/forums//index.php?showtopic\u003d24424 \"External link\")\n\u003e\n\u003e ![attachicon.gif](http://reboot.pro/public/style_images/neat/attachicon.gif)[W8U-SetupW7.png](http://reboot.pro/index.php?app\u003dcore\u0026module\u003dattach\u0026section\u003dattach\u0026attach_rel_module\u003dpost\u0026attach_id\u003d14093 \"\")\n\nThe reason that I want multiple installers on my USB drive is because I am often installing different OS\u0027s on my systems. This is because I do hardware testing in the OS, doing compatibility validation. I might have several different systems set up, and might change, or reinstall, the OS several times on a bad day. Since our testing is done with Ubuntu, openSuSE, Red Hat, and three or more versions of Windows, in both 32bit and 64bit versions of all of the above, being able to install them all from one thumb drive I can carry with me is useful.\n\nI think my idea of using EFI shell scripts is the best way for now, until there is a way to \"mount\" an ISO from UEFI. You can do this with GRUB2 via loopback, but loopback doesn\u0027t work for Windows and some flavors of Linux.\n\n"
    },
    {
      "id": "165962",
      "timestamp": "2013-01-16T18:23:48+00:00",
      "author": "wimb",
      "content": "\u003e The reason that I want multiple installers on my USB drive is because I am often installing different OS\u0027s on my systems.\n\nThat is exactly what you can do with the proposed strategy.\n\nBoot from USB and use WinNTSetup to Install all Windows versions using mounted ISO files.\n\n"
    },
    {
      "id": "165963",
      "timestamp": "2013-01-16T18:29:17+00:00",
      "author": "cyphersmith",
      "content": "\u003e That is exactly what you can do with the proposed strategy.\n\u003e\n\u003e Boot from USB and use WinNTSetup to Install all Windows versions using mounted ISO files.\n\nI apologize for being unclear. I never have more than one OS installed at a time unless I am testing virtualization, it doesn\u0027t help with the testing that I do and it can complicate things.\n\n"
    },
    {
      "id": "165964",
      "timestamp": "2013-01-16T18:59:20+00:00",
      "author": "wimb",
      "content": "The proposed strategy Installs one version of Windows at a time on drive of local harddisk and virtualization is not used.\n\n"
    },
    {
      "id": "160227",
      "timestamp": "2012-09-10T23:24:07+00:00",
      "author": "cyphersmith",
      "content": "Hi,  \n\nOk, I am trying to create a bootable thumb drive that will have the following features:\n\n* Boots in UEFI mode  \n  * I can get it to do this with an installation of GRUB (not GRUB-legacy)\n* Boots in standard BIOS mode (via the compatibility module in EFI)  \n  * This I can get GRUB to do\n* Can install multiple Linux distributions  \n  * Again, GRUB will do this, though I might have some problems with Fedora\n* Can install all versions of Windows 7 and 8  \n  * This is where I am running into problems\n  * Grub4Dos will not work for this, it runs in real mode, which I can\u0027t get into when in EFI mode\n  * I\u0027m not sure I can even get into Syslinux from GRUB, and I think it needs real mode as well\n  * Windows won\u0027t boot from a loop device, so I can\u0027t use loopback\n* Boot to a DOS prompt  \n  * I don\u0027t think this is possible, since a DOS prompt needs real mode\n\n\u003cbr /\u003e\n\nMy current thought is that I can get this working if I can find a way to mount the ISO\u0027s in a way that Windows can understand. This is what the thumb drive I currently use does, but it won\u0027t boot to UEFI since I am using Syslinux, which doesn\u0027t boot to UEFI (actually, I\u0027m technically using grub4dos and WinFira, with Syslinux being the bootloader).  \n\nI know that I can boot to a Windows installation if it\u0027s extracted to the root, but the problem with this is that only one Windows OS can be set up this way at a time, since it needs to be in the root. If GRUB had file manipulation capabilities, then I might be able to make this would work, but I don\u0027t think it does. Obviously, I could do this with a script in an OS, but I would rather not. This installation will be used by multiple people so I need to keep it as simple as I can.   \n"
    },
    {
      "id": "160336",
      "timestamp": "2012-09-13T16:49:22+00:00",
      "author": "sbaeder",
      "content": "Have you looked more at the [RMPrepUSB site](http://www.rmprepusb.com/ \"External link\")? He is also active here, but there are a lot of good tutorials on his site!!!  \n\nSee especially #43 [http://www.rmprepusb...ials/firawiniso](http://www.rmprepusb.com/tutorials/firawiniso \"External link\") While more oriented to grub4dos, you may be able to extrapolate and use the techniques with grub  \n\n![:cheers:](http://reboot.pro/public/style_emoticons/default/cheers.gif)  \nScott   \n"
    },
    {
      "id": "160338",
      "timestamp": "2012-09-13T17:06:07+00:00",
      "author": "Wonko the Sane",
      "content": "May I dare to ask WHY is actual UEFI booting needed?  \n\nAs a workaround (maybe useful, maybe not ![:unsure:](http://reboot.pro/public/style_emoticons/default/unsure.png)):  \n[http://xpcboot.weebly.com/](http://xpcboot.weebly.com/ \"External link\")  \n[http://pete.akeo.ie/...-usb-stick.html](http://pete.akeo.ie/2011/07/creating-bootable-uefi-duet-usb-stick.html \"External link\")  \nor use a hybrid GPT/MBR disk, like:  \n[http://www.rodsbooks.com/gdisk/](http://www.rodsbooks.com/gdisk/ \"External link\")  \n[http://www.rodsbooks...isk/hybrid.html](http://www.rodsbooks.com/gdisk/hybrid.html \"External link\")  \n\n![:cheers:](http://reboot.pro/public/style_emoticons/default/cheers.gif)  \nWonko   \n"
    },
    {
      "id": "160339",
      "timestamp": "2012-09-13T17:49:38+00:00",
      "author": "cyphersmith",
      "content": "\u003e Have you looked more at the [RMPrepUSB site](http://www.rmprepusb.com/ \"External link\")? He is also active here, but there are a lot of good tutorials on his site!!!  \n\u003e\n\u003e See especially #43 [http://www.rmprepusb...ials/firawiniso](http://www.rmprepusb.com/tutorials/firawiniso \"External link\") While more oriented to grub4dos, you may be able to extrapolate and use the techniques with grub  \n\u003e\n\u003e ![:cheers:](http://reboot.pro/public/style_emoticons/default/cheers.gif)  \n\u003e Scott  \n\nI actually have a thumb drive set up using those instructions, it\u0027s just not UEFI capable. The problem that I am running into is mounting a Windows ISO in GRUB. The tools for doing that all seem to require being in real mode, which is not available from GRUB in UEFI mode.  \n\n\u003e May I dare to ask WHY is actual UEFI booting needed?\n\nI work in a hardware validation lab at Intel. Specifically, we do platform compatibility validation. This means we are often installing OS\u0027s onto our systems. Because UEFI is becoming more prevalent (especially with the changes introduced in Windows 8), some of those installs MUST be done with UEFI enabled to ensure that everything works right. Putting all of the images onto one thumb drive that I can boot from would be really useful. I can do that right now, using the thumb drive I created with instructions from RMPrepUSB. Except that that thumb drive won\u0027t boot to UEFI, which means that I have to have separate media for UEFI, which kinda makes the thumb drive redundant since installation disks can be used for both standard installs and UEFI installs.  \n\n\u003e As a workaround (maybe useful, maybe not ![:unsure:](http://reboot.pro/public/style_emoticons/default/unsure.png)):  \n\u003e [http://xpcboot.weebly.com/](http://xpcboot.weebly.com/ \"External link\")  \n\u003e [http://pete.akeo.ie/...-usb-stick.html](http://pete.akeo.ie/2011/07/creating-bootable-uefi-duet-usb-stick.html \"External link\")  \n\u003e or use a hybrid GPT/MBR disk, like:  \n\u003e [http://www.rodsbooks.com/gdisk/](http://www.rodsbooks.com/gdisk/ \"External link\")  \n\u003e [http://www.rodsbooks...isk/hybrid.html](http://www.rodsbooks.com/gdisk/hybrid.html \"External link\")  \n\u003e\n\u003e ![:cheers:](http://reboot.pro/public/style_emoticons/default/cheers.gif)  \n\u003e Wonko  \n\nI\u0027ll take a look at those websites.   \n\n**Edited by cyphersmith, 13 September 2012 - 05:50 PM.**\n"
    },
    {
      "id": "160344",
      "timestamp": "2012-09-13T19:41:23+00:00",
      "author": "sbaeder",
      "content": "Sounds more like you might want to look at [ISOStick](http://reboot.pro/15475/ \"\")(or the [Zalman](http://reboot.pro/14006/ \"\")USB drive container), where they allow you to have a LOT of ISO\u0027s on the storage, and select one that then is emulated out on the USB as if it was a physical DVD/CD...  \n\nSeems like Intel could afford something like either of these...:smile:  \n\n![:cheers:](http://reboot.pro/public/style_emoticons/default/cheers.gif)  \nScott   \n"
    },
    {
      "id": "160353",
      "timestamp": "2012-09-13T20:53:40+00:00",
      "author": "cyphersmith",
      "content": "\u003e Sounds more like you might want to look at [ISOStick](http://reboot.pro/15475/ \"\")(or the [Zalman](http://reboot.pro/14006/ \"\")USB drive container), where they allow you to have a LOT of ISO\u0027s on the storage, and select one that then is emulated out on the USB as if it was a physical DVD/CD...  \n\u003e\n\u003e Seems like Intel could afford something like either of these... :smile:  \n\u003e\n\u003e ![:cheers:](http://reboot.pro/public/style_emoticons/default/cheers.gif)  \n\u003e Scott  \n\nI have to say that I was unaware of the ISOStick, or the Zalman case. I would prefer the ISOStick, personally, but I haven\u0027t finished that thread, so I don\u0027t know if it\u0027s generally available yet. I\u0027m looking into it.  \nEDIT: There is one other reason that I\u0027m looking into methods using GRUB. We just bought 64GB USB 3.0 thumb drives for the whole team. I would like to use those so that we don\u0027t have to purchase more equipment.   \n\n**Edited by cyphersmith, 13 September 2012 - 09:33 PM.**\n"
    },
    {
      "id": "160356",
      "timestamp": "2012-09-14T00:55:50+00:00",
      "author": "sbaeder",
      "content": "Good point, and it\u0027s always good to know if there are other ways to do the job...I\u0027m no \"grub\" expert, but will be interested to see what you came up with.   \n"
    },
    {
      "id": "160361",
      "timestamp": "2012-09-14T07:53:16+00:00",
      "author": "Wonko the Sane",
      "content": "Very good. :smile:  \n\nThe given answer translates nicely to \"I\u0027m doing this for fun and to learn new things\". ![:w00t:](http://reboot.pro/public/style_emoticons/default/w00t.gif)  \n(reasons that **Wonko** fully approves of ![:thumbup:](http://reboot.pro/public/style_emoticons/default/thumbup.gif))  \n\nI mean, the burden of having two different USB sticks is unbearable, not only if you have to carry them with you, but all the space they occupy in the lab.... ![:ph34r:](http://reboot.pro/public/style_emoticons/default/scared9.gif):wink:  \n![:rofl:](http://reboot.pro/public/style_emoticons/default/roll1.gif)  \n\n\u003cbr /\u003e\n\n\u003cbr /\u003e\n\nAnother thing, maybe useful or maybe not, that you could probably make use of is the grub24dos:  \n~~http://reboot.pro/13282/~~   \n~~https://sourceforge.net/projects/grub24dos~~   \n\nnow renamed/evolved to grub2win:  \n\u003chttp://reboot.pro/17454/\u003e   \n[http://sourceforge.n...jects/grub2win/](http://sourceforge.net/projects/grub2win/ \"External link\")  \n\nAs it may allow better \"interchange\" between the various pieces of the puzzle.  \n\n\u003cbr /\u003e\n\n![:cheers:](http://reboot.pro/public/style_emoticons/default/cheers.gif)  \nWonko   \n"
    },
    {
      "id": "160519",
      "timestamp": "2012-09-17T20:51:00+00:00",
      "author": "cyphersmith",
      "content": "\u003e Very good. :smile:  \n\u003e\n\u003e The given answer translates nicely to \"I\u0027m doing this for fun and to learn new things\". ![:w00t:](http://reboot.pro/public/style_emoticons/default/w00t.gif)  \n\u003e (reasons that **Wonko** fully approves of ![:thumbup:](http://reboot.pro/public/style_emoticons/default/thumbup.gif))  \n\u003e\n\u003e I mean, the burden of having two different USB sticks is unbearable, not only if you have to carry them with you, but all the space they occupy in the lab.... ![:ph34r:](http://reboot.pro/public/style_emoticons/default/scared9.gif) :wink:  \n\u003e ![:rofl:](http://reboot.pro/public/style_emoticons/default/roll1.gif)  \n\u003e\n\u003e \u003cbr /\u003e\n\u003e\n\u003e \u003cbr /\u003e\n\u003e\n\u003e Another thing, maybe useful or maybe not, that you could probably make use of is the grub24dos:  \n\u003e ~~\u003chttp://reboot.pro/13282/\u003e~~   \n\u003e ~~[https://sourceforge....jects/grub24dos](https://sourceforge.net/projects/grub24dos \"External link\")~~   \n\u003e\n\u003e now renamed/evolved to grub2win:  \n\u003e \u003chttp://reboot.pro/17454/\u003e  \n\u003e [http://sourceforge.n...jects/grub2win/](http://sourceforge.net/projects/grub2win/ \"External link\")  \n\u003e\n\u003e As it may allow better \"interchange\" between the various pieces of the puzzle.  \n\u003e\n\u003e \u003cbr /\u003e\n\u003e\n\u003e ![:cheers:](http://reboot.pro/public/style_emoticons/default/cheers.gif)  \n\u003e Wonko  \n\nWell, I took a look at grub4win, and I don\u0027t think I can get it to work. I think it works from the Windows bootloader, but I don\u0027t think that the Windows bootloader, but I\u0027m not sure that you can get the Windows bootloader on a thumb drive to actually have a proper BCD menu from a thumb drive that doesn\u0027t have its RMB flipped so it\u0027s not seen as a removable drive . And I don\u0027t know if you actually can flip the RMB bit on the drive I have (it\u0027s a Lexar Triton USB 3.0 drive). The only thread I saw about doing that with this drive wasn\u0027t very encouraging (the drive was made unuseable).   \n"
    },
    {
      "id": "160522",
      "timestamp": "2012-09-17T22:31:42+00:00",
      "author": "cdob",
      "content": "\u003e I work in a hardware validation lab at Intel.\nAsk your coworkers to integrate ISO file mount at BIOS/UEFI.  \nBoot a Intel motherboard and select a ISO file at a USB stick.  \n\nWell´next step would be a agreement at hardware and software manufacturer.  \nThat\u0027s a suggestion to all manufacturers.  \nAssume a config file /efi/boot/mount  \nThe UEFI writes ISO file name to config file /efi/boot/mount and OS read the config file.  \n\n\u003e but I\u0027m not sure that you can get the Windows bootloader on a thumb drive to actually have a proper BCD menu from a thumb drive that doesn\u0027t have its RMB flipped so it\u0027s not seen as a removable drive .\nThe BCD menu works fine at a removable drive, at least at BIOS.  \n\nShould work at UEFI too [Walkthrough: Boot Windows PE from a UEFI-based Hard Disk](http://technet.microsoft.com/en-us/library/hh265131(v\u003dws.10).aspx \"External link\")  \nTry it. Does BCD works at UEFI at a removable drive?   \n"
    },
    {
      "id": "160526",
      "timestamp": "2012-09-17T22:52:39+00:00",
      "author": "cyphersmith",
      "content": "\u003e Ask your coworkers to integrate ISO file mount at BIOS/UEFI.  \n\u003e Boot a Intel motherboard and select a ISO file at a USB stick.  \n\u003e\n\u003e Well´next step would be a agreement at hardware and software manufacturer.  \n\u003e That\u0027s a suggestion to all manufacturers.  \n\u003e Assume a config file /efi/boot/mount  \n\u003e The UEFI writes ISO file name to config file /efi/boot/mount and OS read the config file.  \n\u003e\n\u003e \u003cbr /\u003e\n\u003e\n\u003e The BCD menu works fine at a removable drive, at least at BIOS.  \n\u003e\n\u003e Should work at UEFI too [Walkthrough: Boot Windows PE from a UEFI-based Hard Disk](http://technet.microsoft.com/en-us/library/hh265131(v\u003dws.10).aspx \"External link\")  \n\u003e Try it. Does BCD works at UEFI at a removable drive?  \n\nIt\u0027s going to take me a bit to go through the information at that link. it looks like good information.  \nMounting the ISO from EFI would be nice. That should actually be doable. An EFI program should be able to be written which will do exactly that. In fact, a lot can be done in EFI before really even hitting the bootloarder. I just don\u0027t have the knowledge myself to write it. Shoot, it can probably be set up to let the user choose the ISO to mount, mount it, then hand things over to whichever disk is mounted. Windows would likely still require a driver such as FiraDisk to see the drive, but that can be integrated into the ISO. Though I wouldn\u0027t be able to do it for Win8 x64 (or probably Server 2012 x64) because of the change that MS did to the signing method with it.   \n"
    },
    {
      "id": "160532",
      "timestamp": "2012-09-18T04:33:58+00:00",
      "author": "cdob",
      "content": "\u003e Mounting the ISO from EFI would be nice.\n\nIs this a requirement? Do you require a ISO file?  \nCan you use another approach?   \n"
    },
    {
      "id": "160534",
      "timestamp": "2012-09-18T07:52:04+00:00",
      "author": "Wonko the Sane",
      "content": "\u003e ... but I don\u0027t think that the Windows bootloader, but I\u0027m not sure that you can get the Windows bootloader on a thumb drive to actually have a proper BCD menu from a thumb drive that doesn\u0027t have its RMB flipped so it\u0027s not seen as a removable drive .   \nWell, it works, besides USB sticks (Removable or FIxed) even from floppies:  \n[http://www.multiboot....uk/floppy.html](http://www.multibooters.co.uk/floppy.html \"External link\")  \n\nJust for the record, for MBR devices only Windows, and only NT based Windows AFAIK care about the Removable or Fixed status of a USB stick, and they ONLY do in the \"protected mode\" part, and the only issue is that only first partition (actually the partition which address is in first partition entry in the partition table) is mounted/mountale/accessed (unless you use a filter driver).  \nWhat happens with GPT is what you should actually test and know. ![:unsure:](http://reboot.pro/public/style_emoticons/default/unsure.png)  \n\n![:cheers:](http://reboot.pro/public/style_emoticons/default/cheers.gif)  \nWonko   \n"
    },
    {
      "id": "160552",
      "timestamp": "2012-09-18T17:12:14+00:00",
      "author": "cyphersmith",
      "content": "\u003e Is this a requirement? Do you require a ISO file?  \n\u003e Can you use another approach?  \n\nCertainly, but one of the problems with Windows is that the install must be in the root directory. This is not the case for an ISO.  \n\n\u003e Well, it works, besides USB sticks (Removable or FIxed) even from floppies:  \n\u003e [http://www.multiboot....uk/floppy.html](http://www.multibooters.co.uk/floppy.html \"External link\")  \n\u003e\n\u003e Just for the record, for MBR devices only Windows, and only NT based Windows AFAIK care about the Removable or Fixed status of a USB stick, and they ONLY do in the \"protected mode\" part, and the only issue is that only first partition (actually the partition which address is in first partition entry in the partition table) is mounted/mountale/accessed (unless you use a filter driver).  \n\u003e What happens with GPT is what you should actually test and know. ![:unsure:](http://reboot.pro/public/style_emoticons/default/unsure.png)  \n\u003e\n\u003e ![:cheers:](http://reboot.pro/public/style_emoticons/default/cheers.gif)  \n\u003e Wonko  \n\nI think you\u0027re right here. I hadn\u0027t thought of doing this using a GPT rather than an MBR. Since I don\u0027t think that an OS that can\u0027t recognize a GPT will be required, I could set up a GPT on the thumb drive and chainload each Windows OS install from its own partition. Assuming that Windows won\u0027t complain about that. A similar thing could be done for the various Linux distros, though they wouldn\u0027t need to have their own partitions. Of course, those can be ISOs (though some distros make that difficult).   \n"
    },
    {
      "id": "160553",
      "timestamp": "2012-09-18T17:39:35+00:00",
      "author": "Wonko the Sane",
      "content": "Well, for the record, we have by now several ways to boot (and install) Windows NT based systems from a .iso or from \"non-iso\", as well we have ways to have a multi-partitioned MBR working allright (by simply changing the parition order or anyway writing the partition table on-the-fly with grub4dos or similar tools) that is using BIOS.  \nBesides the several methods listed here:  \n[http://www.msfn.org/...ndows-from-usb/](http://www.msfn.org/board/forum/157-install-windows-from-usb/ \"External link\")  \n**Steve6375** has several tutorials on his site [http://www.rmprepusb.com/](http://www.rmprepusb.com/ \"External link\")  \n\nHow these method are \"portable\" to UEFI (and since I cannot say how grub4dos behaves with either UEFI or GPT) and to have them working with grub2 (or similar) is actually the object of this topic, what I can provide (at the most) is info on how to do these things on \"normal\" BIOS/MBR, but all the rest is up to you, only trying to help you follow Mikhail Kalashnikov\u0027s ![:w00t:](http://reboot.pro/public/style_emoticons/default/w00t.gif) advice ![:smiling9:](http://reboot.pro/public/style_emoticons/default/smiling9.gif):  \n\u003chttp://reboot.pro/15298/#entry136216\u003e  \n\n![:cheers:](http://reboot.pro/public/style_emoticons/default/cheers.gif)  \nWonko   \n"
    },
    {
      "id": "160588",
      "timestamp": "2012-09-19T20:57:28+00:00",
      "author": "cdob",
      "content": "\u003e but one of the problems with Windows is that the install must be in the root directory.\nRoot directory from which part?  \nUse several partitions and flip MBR data on the fly. No idea at EFI mode.  \n\nVHD images are supported out of the box.  \nYou may wrap installation files inside a VHD image.  \nAs for USB stick: there are several VHD files.  \nAs for windows install: root directory is used still.  \nA windows 7 example \u003chttp://reboot.pro/14755/#entry131133\u003e  \n\nHowever native VHD mounting requires a NTFS partition.  \nDoes EFI read NTFS partition? Most likely a addional FAT partiton is required.  \nBack to another multi partition approach. Should be possible at removable drive still.  \n\n\u003cbr /\u003e\n\n\u003e I hadn\u0027t thought of doing this using a GPT rather than an MBR. Since I don\u0027t think that an OS that can\u0027t recognize a GPT will be required, I could set up a GPT on the thumb drive and chainload each Windows OS install from its own partition.\nYes, GPT at USB would be another approach.  \n\nSample: Configure BIOS/MBR-Based Hard Disk Partitions by Using Windows PE and DiskPart  \n[http://technet.micro...y/hh825677.aspx](http://technet.microsoft.com/en-us/library/hh825677.aspx \"External link\")  \n\nSample: Configure UEFI/GPT-Based Hard Drive Partitions by Using Windows PE and DiskPart  \n[http://technet.micro...y/hh825686.aspx](http://technet.microsoft.com/en-us/library/hh825686.aspx \"External link\")  \n\nIdea:  \nAdd Windows and \\*nix to EFI System Partition  \nLet EFI bootmanger select between both. There is no need to chainload a bootmager.   \n"
    },
    {
      "id": "160690",
      "timestamp": "2012-09-22T10:32:13+00:00",
      "author": "cdob",
      "content": "\u003e However native VHD mounting requires a NTFS partition.  \n\u003e Does EFI read NTFS partition? Most likely a addional FAT partiton is required.  \n\u003e Back to another multi partition approach. Should be possible at removable drive still.\n\nWindows and EFI share first partition limitation.  \n\nGiven a removable USB stick at MBR mode: [http://en.wikipedia....ter_boot_record](http://en.wikipedia.org/wiki/Master_boot_record \"External link\")  \nFAT16 first partiton - MBR offset +446 - bootmgr and \\\\boot\\\\  \nNTFS second partiton - MBR offset +462 - VHD image  \n\nWindows mount first partiton only at a removable stick. \u003chttp://reboot.pro/16274/\u003e  \nException: a previous partition types 0x00 is ignored. The next partiton entry is mounted.  \nBootmgr dosn\u0027t detect \\\\boot\\\\bcd at 0x00 partition type.  \n\nUEFI searches first partition to auto-detect a OS loader. [http://en.wikipedia....mware_Interface](http://en.wikipedia.org/wiki/Unified_Extensible_Firmware_Interface \"External link\")  \nUEFI finds a file /EFI/BOOT/BOOTx64.EFI at a FAT 0x06 partiton type.  \nContrary a partition type 0x00 is ignored: file /EFI/BOOT/BOOTx64.EFI is not found  \n\n\u003cbr /\u003e\n\n\u003cbr /\u003e\n\nGiven a removable USB stick at MBR mode:  \nNTFS first partiton - MBR offset +446  \nFAT16 second partiton - MBR offset +462  \n\nFAT16 partiton type set to 0xEF  \n[http://en.wikipedia....ystem_partition](http://en.wikipedia.org/wiki/EFI_System_partition \"External link\")  \nAt EFI mode file /EFI/BOOT/BOOTx64.EFI is not found here. EFI boot is missing  \nEFI partiton type 0xEF is ignored.  \n\n\u003cbr /\u003e\n\nUEFI MBR mode and native VHD volumes are a riddle still.  \n\n\u003cbr /\u003e\n\nOr goto GPT at USB?   \n"
    },
    {
      "id": "160794",
      "timestamp": "2012-09-26T19:57:20+00:00",
      "author": "cyphersmith",
      "content": "\u003e Windows and EFI share first partition limitation.  \n\u003e\n\u003e Given a removable USB stick at MBR mode: [http://en.wikipedia....ter_boot_record](http://en.wikipedia.org/wiki/Master_boot_record \"External link\")  \n\u003e FAT16 first partiton - MBR offset +446 - bootmgr and boot  \n\u003e NTFS second partiton - MBR offset +462 - VHD image  \n\u003e\n\u003e Windows mount first partiton only at a removable stick. \u003chttp://reboot.pro/16274/\u003e  \n\u003e Exception: a previous partition types 0x00 is ignored. The next partiton entry is mounted.  \n\u003e Bootmgr dosn\u0027t detect bootbcd at 0x00 partition type.  \n\u003e\n\u003e UEFI searches first partition to auto-detect a OS loader. [http://en.wikipedia....mware_Interface](http://en.wikipedia.org/wiki/Unified_Extensible_Firmware_Interface \"External link\")  \n\u003e UEFI finds a file /EFI/BOOT/BOOTx64.EFI at a FAT 0x06 partiton type.  \n\u003e Contrary a partition type 0x00 is ignored: file /EFI/BOOT/BOOTx64.EFI is not found  \n\u003e\n\u003e \u003cbr /\u003e\n\u003e\n\u003e \u003cbr /\u003e\n\u003e\n\u003e Given a removable USB stick at MBR mode:  \n\u003e NTFS first partiton - MBR offset +446  \n\u003e FAT16 second partiton - MBR offset +462  \n\u003e\n\u003e FAT16 partiton type set to 0xEF  \n\u003e [http://en.wikipedia....ystem_partition](http://en.wikipedia.org/wiki/EFI_System_partition \"External link\")  \n\u003e At EFI mode file /EFI/BOOT/BOOTx64.EFI is not found here. EFI boot is missing  \n\u003e EFI partiton type 0xEF is ignored.  \n\u003e\n\u003e \u003cbr /\u003e\n\u003e\n\u003e UEFI MBR mode and native VHD volumes are a riddle still.  \n\u003e\n\u003e \u003cbr /\u003e\n\u003e\n\u003e Or goto GPT at USB?  \n\nSo I ran into a problem with using GPT on the thumb drive.Windows cannot boot to a GPT drive if you\u0027re using BIOS instead of EFI. I think, however, that I can get around this using Hybrid MBR\u0027s. Though I think that I might need to change partition order on the fly (since a removable disk is only supposed to have one partition).  \n\nI haven\u0027t done this yet, gonna try today, but here\u0027s what I\u0027m thinking will work. Boot to grub. In the menu, there should be the following choices:\n\n* EFI Windows 7 x64\n* EFI Windows 8 x64\n* Non-EFI Windows 7 x64\n* Non-EFI Windows 8 x64\n* Non-EFI Windows 7 x86\n* Non-EFI Windows 8 x86\n* Various linux distros\n\nTo do this, I will use GPT with hybrid MBR\u0027s. One for each of the 64-bit Windows installations, and one for the rest of the Windows installations. The Linux installations, I think, don\u0027t need to be in a hybrid MBR, though they can. The thing I am trying to figure out right now is how to set up the grub.cfg.   \n"
    },
    {
      "id": "165931",
      "timestamp": "2013-01-16T01:52:07+00:00",
      "author": "cyphersmith",
      "content": "\u003e So I ran into a problem with using GPT on the thumb drive.Windows cannot boot to a GPT drive if you\u0027re using BIOS instead of EFI. I think, however, that I can get around this using Hybrid MBR\u0027s. Though I think that I might need to change partition order on the fly (since a removable disk is only supposed to have one partition).  \n\u003e\n\u003e I haven\u0027t done this yet, gonna try today, but here\u0027s what I\u0027m thinking will work. Boot to grub. In the menu, there should be the following choices:\n\u003e\n\u003e * EFI Windows 7 x64\n\u003e * EFI Windows 8 x64\n\u003e * Non-EFI Windows 7 x64\n\u003e * Non-EFI Windows 8 x64\n\u003e * Non-EFI Windows 7 x86\n\u003e * Non-EFI Windows 8 x86\n\u003e * Various linux distros\n\u003e To do this, I will use GPT with hybrid MBR\u0027s. One for each of the 64-bit Windows installations, and one for the rest of the Windows installations. The Linux installations, I think, don\u0027t need to be in a hybrid MBR, though they can. The thing I am trying to figure out right now is how to set up the grub.cfg.\n\nThis didn\u0027t work for me. I couldn\u0027t get Windows to see the partitions. I am running out of ideas.\n\nIf I can modify the directory structure while I was in GRUB or possible before then, I could probably do it. Then I could have each Windows OS in a sub-directory, delete whatever is currently in the root and copy the version that is needed into the root. I could do this manually before doing the install, it\u0027s just less than elegant. Anyone know if this can be done by GRUB, or something else? I suspect it could be done within the EFI shell as a shell script, so it may be time to learn EFI shell scripting.\n\n"
    },
    {
      "id": "165932",
      "timestamp": "2013-01-16T02:07:07+00:00",
      "author": "Sha0",
      "content": "\u003e This didn\u0027t work for me. I couldn\u0027t get Windows to see the partitions. I am running out of ideas.\n\u003e\n\u003e If I can modify the directory structure while I was in GRUB or possible before then, I could probably do it. Then I could have each Windows OS in a sub-directory, delete whatever is currently in the root and copy the version that is needed into the root. I could do this manually before doing the install, it\u0027s just less than elegant. Anyone know if this can be done by GRUB, or something else? I suspect it could be done within the EFI shell as a shell script, so it may be time to learn EFI shell scripting.\n\nBy default, Windows will not provide the partitions for your USB flash storage device. You will need a filter driver, such as [**diskmod**](http://reboot.pro/topic/9461-page-file-in-usb-hard-disk/ \"\"). Hybrid MBR/GPT has some problems with older (U)EFI, so I\u0027d abandon that approach. For widest compatibility with (U)EFI and BIOS, I\u0027d suggest a plain MBR, with a **FAT** partition whose type code in the partition table is **0xEF**.\n\nIf you cannot use a disk filter driver, I\u0027d say you have to drop one of:\n\n* USB flash storage as the USB storage device\n* Multiple partitions on the USB storage device\n\n\u003cbr /\u003e\n\n"
    },
    {
      "id": "165935",
      "timestamp": "2013-01-16T05:59:31+00:00",
      "author": "wimb",
      "content": "UEFI Multiboot USB - Windows 8 and Linux Parted Magic  \n\n[http://reboot.pro/to...e-2#entry165182](http://reboot.pro/topic/17877-uefi-windows-8-bios-grub4dos-multiboot-usb-harddisk/page-2#entry165182 \"\")\n\nI used portable USB-harddisk with Standard MBR and FAT32 Boot + NTFS System partition\n\nAfter booting with Windows 8 from USB you can run WinNTSetup2\n\nand use R-mouse to mount Setup ISO and prepare drive for Install of Windows 7 or 8 or XP\n\n[http://www.msfn.org/...-winntsetup-v2/](http://www.msfn.org/board/topic/149612-winntsetup-v2/ \"External link\")\n\n[http://www.911cd.net...showtopic\u003d24424](http://www.911cd.net/forums//index.php?showtopic\u003d24424 \"External link\")\n\n\\[attachment\u003d14093:W8U-SetupW7.png\\]\n\n"
    },
    {
      "id": "165961",
      "timestamp": "2013-01-16T17:49:12+00:00",
      "author": "cyphersmith",
      "content": "\u003e By default, Windows will not provide the partitions for your USB flash storage device. You will need a filter driver, such as [**diskmod**](http://reboot.pro/topic/9461-page-file-in-usb-hard-disk/ \"\"). Hybrid MBR/GPT has some problems with older (U)EFI, so I\u0027d abandon that approach. For widest compatibility with (U)EFI and BIOS, I\u0027d suggest a plain MBR, with a **FAT** partition whose type code in the partition table is **0xEF**.\n\u003e\n\u003e If you cannot use a disk filter driver, I\u0027d say you have to drop one of:\n\u003e\n\u003e * USB flash storage as the USB storage device\n\u003e * Multiple partitions on the USB storage device\n\nI\u0027m not committed to multiple partitions, I\u0027m committed to multiple versions of Windows. If I can\u0027t boot them from ISO, which seems to be the case currently with UEFI, I have to find some other way to boot them. Multiple partitions was an idea because if the Windows ISO is extracted to a thumb drive it requires that it be in the root of the partition. Can the filter driver be loaded during install?\n\n\u003e UEFI Multiboot USB - Windows 8 and Linux Parted Magic  \n\u003e\n\u003e [http://reboot.pro/to...e-2#entry165182](http://reboot.pro/topic/17877-uefi-windows-8-bios-grub4dos-multiboot-usb-harddisk/page-2#entry165182 \"\")\n\u003e\n\u003e I used portable USB-harddisk with Standard MBR and FAT32 Boot + NTFS System partition\n\u003e\n\u003e After booting with Windows 8 from USB you can run WinNTSetup2 and use mounted ISO\n\u003e\n\u003e to prepare drive for Install of Windows 7 or 8 or XP\n\u003e\n\u003e [http://www.msfn.org/...-winntsetup-v2/](http://www.msfn.org/board/topic/149612-winntsetup-v2/ \"External link\")\n\u003e\n\u003e [http://www.911cd.net...showtopic\u003d24424](http://www.911cd.net/forums//index.php?showtopic\u003d24424 \"External link\")\n\u003e\n\u003e ![attachicon.gif](http://reboot.pro/public/style_images/neat/attachicon.gif)[W8U-SetupW7.png](http://reboot.pro/index.php?app\u003dcore\u0026module\u003dattach\u0026section\u003dattach\u0026attach_rel_module\u003dpost\u0026attach_id\u003d14093 \"\")\n\nThe reason that I want multiple installers on my USB drive is because I am often installing different OS\u0027s on my systems. This is because I do hardware testing in the OS, doing compatibility validation. I might have several different systems set up, and might change, or reinstall, the OS several times on a bad day. Since our testing is done with Ubuntu, openSuSE, Red Hat, and three or more versions of Windows, in both 32bit and 64bit versions of all of the above, being able to install them all from one thumb drive I can carry with me is useful.\n\nI think my idea of using EFI shell scripts is the best way for now, until there is a way to \"mount\" an ISO from UEFI. You can do this with GRUB2 via loopback, but loopback doesn\u0027t work for Windows and some flavors of Linux.\n\n"
    },
    {
      "id": "165962",
      "timestamp": "2013-01-16T18:23:48+00:00",
      "author": "wimb",
      "content": "\u003e The reason that I want multiple installers on my USB drive is because I am often installing different OS\u0027s on my systems.\n\nThat is exactly what you can do with the proposed strategy.\n\nBoot from USB and use WinNTSetup to Install all Windows versions using mounted ISO files.\n\n"
    },
    {
      "id": "165963",
      "timestamp": "2013-01-16T18:29:17+00:00",
      "author": "cyphersmith",
      "content": "\u003e That is exactly what you can do with the proposed strategy.\n\u003e\n\u003e Boot from USB and use WinNTSetup to Install all Windows versions using mounted ISO files.\n\nI apologize for being unclear. I never have more than one OS installed at a time unless I am testing virtualization, it doesn\u0027t help with the testing that I do and it can complicate things.\n\n"
    },
    {
      "id": "165964",
      "timestamp": "2013-01-16T18:59:20+00:00",
      "author": "wimb",
      "content": "The proposed strategy Installs one version of Windows at a time on drive of local harddisk and virtualization is not used.\n\n"
    },
    {
      "id": "165966",
      "timestamp": "2013-01-16T19:15:46+00:00",
      "author": "cyphersmith",
      "content": "\u003e The proposed strategy Installs one version of Windows at a time on drive of local harddisk and virtualization is not used.\n\nOk, I misunderstood what you were proposing. You\u0027re talking about booting Windows 8 on the thumb drive (NOT the installer). I hadn\u0027t thought of that. I think it would be easier than what I am proposing, and I could just create shortcuts on the desktop for each version of Windows. I hadn\u0027t considered that because I haven\u0027t done a \"live USB\" Windows install before.\n\n"
    },
    {
      "id": "165969",
      "timestamp": "2013-01-16T19:36:27+00:00",
      "author": "wimb",
      "content": "USB thumb drive does not have enough speed and may be too small to contain the Setup ISO files of all Windows versions that you want to use for Install.\n\nPortable USB-harddisk is more suitable for this purpose (much more speed and capacity).\n\n"
    },
    {
      "id": "165976",
      "timestamp": "2013-01-16T21:15:26+00:00",
      "author": "cyphersmith",
      "content": "\u003e USB thumb drive does not have enough speed and may be too small to contain the Setup ISO files of all Windows versions that you want to use for Install.\n\u003e\n\u003e Portable USB-harddisk is more suitable for this purpose (much more speed and capacity).\n\nMy final thumb drive will be a 64GB USB 3.0 thumb drive. Plenty fast, and enough room.\n\n"
    },
    {
      "id": "166020",
      "timestamp": "2013-01-17T09:42:10+00:00",
      "author": "Sha0",
      "content": "\u003e I\u0027m not committed to multiple partitions, I\u0027m committed to multiple versions of Windows.\n\nOk.\n\n\u003e If I can\u0027t boot them from ISO, which seems to be the case currently with UEFI, I have to find some other way to boot them.\n\n**(U)EFI** doesn\u0027t involve **INT 0x13** . That means that using **MEMDISK** or **GRUB4DOS** is out of the question. It would be possible to write a (U)EFI driver that can allow **.ISO**s to be attached as virtual optical discs, but I\u0027m not aware of anyone having written such a driver. (Hmmm...!)\n\n\u003e Multiple partitions was an idea because if the Windows ISO is extracted to a thumb drive it requires that it be in the root of the partition.\n\nIs that so? The **BCD** controls the paths and names of the files involved. It seems to me that it would be possible for you to extract the files to different directories, combine the BCDs of the various Windows .ISOs into a single BCD, change the paths and/or filenames accordingly, then use the EFI **BootMgr** to boot any of them. This wouldn\u0027t help you with your **Linux** stuff, though, but Linux should be more flexible, anyway.\n\n\u003e Can the filter driver be loaded during install?\n\nYes. If it\u0027s located on the first partition, you can install it, then remove and re-insert the USB flash storage device to obtain the other partitions.\n\n\u003e I think my idea of using EFI shell scripts is the best way for now, until there is a way to \"mount\" an ISO from UEFI. You can do this with GRUB2 via loopback, but loopback doesn\u0027t work for Windows and some flavors of Linux.\n\nWell I don\u0027t know which flavours of Linux you\u0027ve found that don\u0027t have loopback support, but there are at least three Windows drivers that are commonly referenced in these forums that can be used to provide a virtual optical disc from an .ISO: **WinVBlock** , **Firadisk** , **ImDisk**. You could load any of these from the USB flash storage device\u0027s partition and then mount the .ISO.\n\n"
    },
    {
      "id": "166091",
      "timestamp": "2013-01-18T05:54:52+00:00",
      "author": "cdob",
      "content": "\u003e Specifically, we do platform compatibility validation. This means we are often installing OS\u0027s onto our systems. Because UEFI is becoming more prevalent (especially with the changes introduced in Windows 8), some of those installs MUST be done with UEFI enabled to ensure that everything works right.\n\nWindows and EFI have restrictions.\n\nCan you clarify:\n\nDo you have any software restrictions?  \nCan you use drivers like diskmod, WinVBlock, Firadisk, ImDisk?  \nDo you use default windows ISO images?  \nWhich file size goes to the windows ISO images? Are all below 4 GB?  \nCan you edit the windows ISO images?  \nCan you edit the file boot.wim?\n\nWhich bootloader do you use? Can you choose a own first bootloader at USB drive? Do you have to use default OS bootloader, e.g. boot to bootmgr?\n\n"
    },
    {
      "id": "166129",
      "timestamp": "2013-01-18T18:40:08+00:00",
      "author": "cyphersmith",
      "content": "\u003e Windows and EFI have restrictions.\n\u003e\n\u003e Can you clarify:\n\u003e\n\u003e Do you have any software restrictions?  \n\u003e Can you use drivers like diskmod, WinVBlock, Firadisk, ImDisk?  \n\u003e Do you use default windows ISO images?  \n\u003e Which file size goes to the windows ISO images? Are all below 4 GB?  \n\u003e Can you edit the windows ISO images?  \n\u003e Can you edit the file boot.wim?\n\u003e\n\u003e Which bootloader do you use? Can you choose a own first bootloader at USB drive? Do you have to use default OS bootloader, e.g. boot to bootmgr?\n\nThe software I use must be legal, and legally obtained. In trying to get this to work, I have used Firadisk and ImDisk. And they work great, except with 64 bit Win8 (unless there\u0027s a way to turn off driver signing during installation). I don\u0027t think that most of them will work with UEFI, though. I have only seen them called from syslinux and grub4dos, not grub2, and those both require real mode, which isn\u0027t available with grub2 in UEFI.\n\nAs long as the drivers are open source, I can use them.\n\nI generally use default Windows ISO images.\n\nI have the tools to edit the ISO images, and boot.wim, but very little experience with doing so I had to add drivers to the Windows 7 image, for example, to test installing the OS via USB 3.0 since it doesn\u0027t have a native driver.\n\nI use bootmgr. Though I have tried grub2 for this project. I have also tried rEFInd, which is a boot manager, as are grub4dos and syslinux.\n\n"
    },
    {
      "id": "166140",
      "timestamp": "2013-01-19T01:35:16+00:00",
      "author": "cyphersmith",
      "content": "Ok, dbob\u0027s questions gave me an idea. At least, I think it was his questions. I haven\u0027t finished setting this up yet, but I did some research, and found that you can add additional versions of Windows to the install.wim file. Of course, with the number of versions of Windows that I am trying to use, that made the install.wim file too big to fit on a FAT32 drive. After some more research, I found that the install.wim file can be split into a number of .swm files, and that the Windows installer can boot to them. I tested it, and found that it was automatically booting to the original version of Windows in the install. More research time. Found out that the ei.cfg file that Windows 7 uses isn\u0027t there on Windows 8, and if it\u0027s put in on a Windows 8 install with the right parameters, it will allow you to choose which version of Windows to install, and it won\u0027t ask for a key until after the install is complete. So, here\u0027s the steps:\n\n1. I downloaded the Windows 8 ADK and installed it.\n2. I used the install disk for Windows 8 RTM 64 bit, to make sure that I would be at a starting point to do both normal and EFI installs. I extracted the ISO to the root directory of my thumb drive, which had been formatted as FAT32.\n3. I copied the install.wim file to a temporary directory on my hard drive.\n4. I then used DISM.exe to extract the Pro and standard installs for Windows 8 RTM 32 bit and put them into the 64 bit install, using information from [here](http://technet.microsoft.com/en-us/library/dd744382%28v\u003dws.10%29.aspx \"External link\") to figure out the commands.\n5. I also did this with Windows 7 SP1 32 and 64 bit.\n6. Then, I used DISM.exe to split the resulting install.wim into pieces, again using information from the site I mentioned above to figure out how to do it, putting the resulting files into the \\\\sources directory.\n\nThat\u0027s what I have done so far. I have tested this to do installs of Windows, and it works, except with a 32bit install in UEFI.\n\nMy next step will be to install grub, put Linux installs onto the thumb drive and create a menu to either boot the Windows installer or the Linux distributions I put onto it.\n\n"
    },
    {
      "id": "166177",
      "timestamp": "2013-01-19T19:22:13+00:00",
      "author": "Sha0",
      "content": "If you can boot **BootMgr** on **(U)EFI** and **BIOS** (which you obviously can), then as mentioned previously, you can have a **BCD** which allows you to boot whatever **boot.wim** file you want. Once the PE has booted, you can use one of the fine, open-source drivers that were mentioned to mount whatever **.ISO** you want. **WinVBlock** and **ImDisk** do not require **GRUB4DOS** in order to mount an .ISO from within Windows, but I can\u0027t say whether or not **Firadisk** does, or if Firadisk would require some changes to the BCD or **.WIM** file.\n\nOr, you can potentially use **GRUB**\u0027s loopback support to boot a BootMgr inside one of the .ISOs, then once again, use one of the Windows drivers from within the PE to mount the .ISO.\n\n"
    },
    {
      "id": "166238",
      "timestamp": "2013-01-20T21:14:57+00:00",
      "author": "cdob",
      "content": "There is plenty of space at a 64 GB flash.  \nWindows mount first partition only by default.  \nThere is no need to use a AIO approach, hence ISO file size should be below 4 GB.  \n\nA full installed Windows 8 can mount a ISO file.  \nAs far as I know it\u0027s not upported at default boot.wim.  \n\n[http://technet.micro...y/hh848706.aspx](http://technet.microsoft.com/en-us/library/hh848706.aspx \"External link\")  \nAdding Waik powershell to boot.wim may help, haven\u0027t done this so far.  \n\nHas anyone a solution to mount a ISO at windows 8 default boot.wim?  \n\nIdea:  \nUse a fat32 partition, size about 30 GB.  \nThis parttion holds boot files and windows install files.  \nThere are windows \\\\boot and \\\\efi files.  \nThis includes BIOS and EFI boot mode.  \nStore several windwows ISO images.  \nExtract several boot.wim and store them to the fat32 partition.  \nEdit boot\\\\bcd and \\\\efi\\\\microsoft\\\\boot\\\\bcd configuration file and adjust accordingly.  \n\\*nix files are at following patition(s).  \n\nExample:  \n\\\\bootmgr  \n\\\\bootmgr.efi  \n\\\\boot\\\\bcd  \n\\\\boot\\\\boot.sdi  \n\\\\efi\\\\microsoft\\\\boot\\\\bcd  \n\\\\efi\\\\boot\\\\bootx64.efi  \n\\\\boot\\\\ISO\\\\W7_SP1_x64.iso  \n\\\\boot\\\\ISO\\\\W7_SP1_x64.wim  \n\\\\boot\\\\ISO\\\\W7_SP1_x86.iso  \n\\\\boot\\\\ISO\\\\W7_SP1_x86.wim  \n\\\\boot\\\\ISO\\\\W8_x64.iso  \n\\\\boot\\\\ISO\\\\W8_x64.wim  \n\\\\boot\\\\ISO\\\\W8_x64.iso  \n\\\\boot\\\\ISO\\\\W8_x86.wim  \n\nIf need be, the default ISO files can be written to a DVD still.  \nTherefore the USB stick is a backup too.  \n\nAs sor testing purposes:  \nyou may use two Windows 7 boot.wim (default and with USB3 drivers) and connect to the same ISO file.  \n\nEdit the \\*.wim files: mount a .iso file to a drive.  \nImDisk can mount a .iso file [http://www.ltr-data....de.html/#ImDisk](http://www.ltr-data.se/opencode.html/#ImDisk \"External link\")  \nIt\u0027s open source, appropiate at a commercial environment. And there is a signed 64 bit driver.  \n\nIt is possible to define ISO file name at BCD too.  \n[http://www.911cd.net...showtopic\u003d23337](http://www.911cd.net/forums//index.php?showtopic\u003d23337 \"External link\")\n\n```\nbcdedit.exe /store \\boot\\bcd /set {default} LoadOptions \" ISO\u003d\\images\\W8_x64.iso\"\n```\n\n\u003cbr /\u003e\n\nNext step incorperate another bootloaders  \ne.g. rEFInd, syslinux, grub4dos  \n\nDo you write batches? Are you afraid about a black cmd window?  \nI\u0027m writing some batches currently.\n\n"
    },
    {
      "id": "166320",
      "timestamp": "2013-01-21T19:00:04+00:00",
      "author": "wimb",
      "content": "Windows 8 Recovery boot.wim can be used also.\n\nSuch USB-stick Recovery Drive can be made easily with few mouseclicks from Windows 8 Configuration \\\u003e Recovery Menu\n\nAfter booting with Win8 Recovery USB-stick then I used Advanced Options and Command prompt of ramdisk X:\n\nto Install XP on local harddisk by using WinNTSetup2 and via R-mouse mounted XP Setup ISO file.\n\nWinNTSetup2 can also be used in batch command mode if desired.\n\n[http://reboot.pro/to...e-2#entry166256](http://reboot.pro/topic/17877-uefi-windows-8-bios-grub4dos-multiboot-usb-harddisk/page-2#entry166256 \"\")\n\n\u003e In Recovery environment using command prompt, I can launch notepad and via File open get Explorer browser GUI  \n\u003e and can launch with R-mouse menu as administrator any 64-bits program e.g. WinNTSetup2_x64.exe to Install any Windows version ......  \n\u003e by mounting with R-mouse any Windows Setup ISO file.\n\n"
    },
    {
      "id": "166733",
      "timestamp": "2013-01-28T17:30:05+00:00",
      "author": "cdob",
      "content": "@cyphersmith  \n\nDo you have to support UEFI Secure Boot?  \nI\u0027ve no UEFI Secure Boot hardware.  \n\nShim by Matthew Garrett  \n[http://mjg59.dreamwidth.org/17542.html](http://mjg59.dreamwidth.org/17542.html \"External link\")  \n\nThere are Fedora and Ubuntu approaches:  \n[https://fedoraprojec...wiki/Secureboot](https://fedoraproject.org/wiki/Secureboot \"External link\")  \n[https://help.ubuntu.com/community/UEFI](https://help.ubuntu.com/community/UEFI \"External link\")  \n\nUEFI Secure Multi Boot is another challenge.  \nHow to keep chain of trust at one USB with Fedora and Ubuntu?  \nBooted the shim loader: how to validate Windows 8 bootx64.efi?  \n\nFedora 18 DVD: [http://download.fedo...ive-Desktop.iso](http://download.fedoraproject.org/pub/fedora/linux/releases/18/Live/x86_64/Fedora-18-x86_64-Live-Desktop.iso \"External link\")  \nboot\\\\EFI\\\\bootx64.efi 1370230 bytes  \nboot\\\\EFI\\\\grubx64.efi 826246 bytes  \n\n[http://www.nic.funet...fc18.x86_64.rpm](http://www.nic.funet.fi/pub/mirrors/fedora.redhat.com/pub/fedora/linux/updates/18/x86_64/shim-0.2-3.3.fc18.x86_64.rpm \"External link\")  \nboot\\\\EFI\\\\fedora\\\\shim.efi 1370230 bytes  \n\n[http://www.nic.funet...fc18.x86_64.rpm](http://www.nic.funet.fi/pub/mirrors/fedora.redhat.com/pub/fedora/linux/updates/18/x86_64/grub2-efi-2.00-15.fc18.x86_64.rpm \"External link\")  \nboot\\\\EFI\\\\fedora\\\\gcdx64.efi 826246 bytes  \n\nConfig file \\\\EFI\\\\BOOT\\\\grub.cfg is used.  \n\nFedora dosn\u0027t support loopback, copy grub2 modules to EFI\\\\BOOT\\\\x86_64-efi and insert a \u0027insmod loopback\u0027  \nDoes this break chain of trust?   \n"
    },
    {
      "id": "166750",
      "timestamp": "2013-01-28T21:00:04+00:00",
      "author": "cyphersmith",
      "content": "\u003e @cyphersmith  \n\u003e\n\u003e Do you have to support UEFI Secure Boot?  \n\u003e I\u0027ve no UEFI Secure Boot hardware.  \n\u003e\n\u003e Shim by Matthew Garrett  \n\u003e [http://mjg59.dreamwidth.org/17542.html](http://mjg59.dreamwidth.org/17542.html \"External link\")  \n\u003e\n\u003e There are Fedora and Ubuntu approaches:  \n\u003e [https://fedoraprojec...wiki/Secureboot](https://fedoraproject.org/wiki/Secureboot \"External link\")  \n\u003e [https://help.ubuntu.com/community/UEFI](https://help.ubuntu.com/community/UEFI \"External link\")  \n\u003e\n\u003e UEFI Secure Multi Boot is another challenge.  \n\u003e How to keep chain of trust at one USB with Fedora and Ubuntu?  \n\u003e Booted the shim loader: how to validate Windows 8 bootx64.efi?  \n\u003e\n\u003e Fedora 18 DVD: [http://download.fedo...ive-Desktop.iso](http://download.fedoraproject.org/pub/fedora/linux/releases/18/Live/x86_64/Fedora-18-x86_64-Live-Desktop.iso \"External link\")  \n\u003e boot\\\\EFI\\\\bootx64.efi 1370230 bytes  \n\u003e boot\\\\EFI\\\\grubx64.efi 826246 bytes  \n\u003e\n\u003e [http://www.nic.funet...fc18.x86_64.rpm](http://www.nic.funet.fi/pub/mirrors/fedora.redhat.com/pub/fedora/linux/updates/18/x86_64/shim-0.2-3.3.fc18.x86_64.rpm \"External link\")  \n\u003e boot\\\\EFI\\\\fedora\\\\shim.efi 1370230 bytes  \n\u003e\n\u003e [http://www.nic.funet...fc18.x86_64.rpm](http://www.nic.funet.fi/pub/mirrors/fedora.redhat.com/pub/fedora/linux/updates/18/x86_64/grub2-efi-2.00-15.fc18.x86_64.rpm \"External link\")  \n\u003e boot\\\\EFI\\\\fedora\\\\gcdx64.efi 826246 bytes  \n\u003e\n\u003e Config file \\\\EFI\\\\BOOT\\\\grub.cfg is used.  \n\u003e\n\u003e Fedora dosn\u0027t support loopback, copy grub2 modules to EFI\\\\BOOT\\\\x86_64-efi and insert a \u0027insmod loopback\u0027  \n\u003e Does this break chain of trust?\n\nI don\u0027t think we\u0027ll be doing much validation of Secure Boot, though it is possible. However, I\u0027ll only have one OS installed at any one time, so I don\u0027t know that it will cause me problems. I need to take a closer look at that, though.\n\n"
    },
    {
      "id": "169310",
      "timestamp": "2013-03-13T22:02:37+00:00",
      "author": "cyphersmith",
      "content": "So, I found out about some firmware modifications that can be done on the thumb drive I\u0027m using which allows for the creation of an optical partition on the thumb drive. I also found software on the controller manufacturer\u0027s website that can burn any image to that partition that you want. This made life much easier. I am still using a basic grub4dos menu on the regular partition on the drive, but that\u0027s mostly for DOS booting and easier installation of OS\u0027s in Legacy mode.\n\nThe controller on my thumb drive is the Innostor IS902E, and I found AIBurn.exe on the Innostor website. To modify the firmware options, I used a tool that we received from Innostor, so I don\u0027t think this is a workable option for other people as I don\u0027t think that tool is generally available.\n\nI do have one other question. I can\u0027t find any grub4dos menu entry examples for either OpenSuSE 12.2 or Fedora 18, anyone know how to set them up?\n\n"
    },
    {
      "id": "169312",
      "timestamp": "2013-03-13T22:35:45+00:00",
      "author": "steve6375",
      "content": "If you are booting from a writeable storage medium (flash or hdd) that has the 4th ptn entry free in the partition table, then this grub4dos will work for nearly all linux isos.\n\n```\ntitle xxx.iso\npartnew (hd0,3) 0x00 /_ISO/Linux/xxx.iso\nmap  /_ISO/Linux/xxx.iso (0xff)\nmap --hook \nroot (0xff) \nchainloader (0xff) \n```\n\n\u003cbr /\u003e\n\n"
    },
    {
      "id": "169449",
      "timestamp": "2013-03-15T23:31:32+00:00",
      "author": "cyphersmith",
      "content": "\u003e If you are booting from a writeable storage medium (flash or hdd) that has the 4th ptn entry free in the partition table, then this grub4dos will work for nearly all linux isos.\n\u003e\n\u003e ```\n\u003e title xxx.iso\n\u003e partnew (hd0,3) 0x00 /_ISO/Linux/xxx.iso\n\u003e map  /_ISO/Linux/xxx.iso (0xff)\n\u003e map --hook \n\u003e root (0xff) \n\u003e chainloader (0xff) \n\u003e ```\n\u003e\n\u003e That did Ubuntu better than the method I was using, but the Fedora 18 Live CD image didn\u0027t like it. I get some mount errors, and when I look at the journalctl, it appears that it is trying to read an area of the partition that doesn\u0027t exist, so it errors out, dropping me at the emergency console.\n\n"
    },
    {
      "id": "169457",
      "timestamp": "2013-03-16T10:23:05+00:00",
      "author": "steve6375",
      "content": "That is strange? On a real system (not a VM) it works fine with Fedora-17-i686-Live-SoaS.iso ???\n\nDid you test on a real system or a VM?\n\n"
    },
    {
      "id": "169459",
      "timestamp": "2013-03-16T11:15:55+00:00",
      "author": "laddanator",
      "content": "\u003cbr /\u003e\n\n\u003e If you are booting from a writeable storage medium (flash or hdd) that has the 4th ptn entry free in the partition table, then this grub4dos will work for nearly all linux isos.\n\n\u003cbr /\u003e\n\nBut not from a (U)EFI machine? Grub4dos is not supported, correct?\n\n"
    },
    {
      "id": "169713",
      "timestamp": "2013-03-19T18:25:39+00:00",
      "author": "cyphersmith",
      "content": "\u003e That is strange? On a real system (not a VM) it works fine with Fedora-17-i686-Live-SoaS.iso ???\n\u003e\n\u003e Did you test on a real system or a VM?\n\nReal system. I was using Fedora-18-x86_64-Live-Desktop.iso.\n\n"
    },
    {
      "id": "169717",
      "timestamp": "2013-03-19T21:54:12+00:00",
      "author": "wimb",
      "content": "\u003e I do have one other question. I can\u0027t find any grub4dos menu entry examples for either OpenSuSE 12.2 or Fedora 18, anyone know how to set them up?\n\nIn case of Fedora-18 then the LABEL of the drive must be given in the boot command  \n[http://www.911cd.net...ndpost\\\u0026p\u003d173226](http://www.911cd.net/forums//index.php?showtopic\u003d25262\u0026view\u003dfindpost\u0026p\u003d173226 \"External link\")  \n[http://www.911cd.net...ndpost\\\u0026p\u003d173227](http://www.911cd.net/forums//index.php?showtopic\u003d25262\u0026view\u003dfindpost\u0026p\u003d173227 \"External link\")  \nBooting in BIOS mode with Fedora LiveOS folder on USB partition with LABEL 2_BOOT  \nthen we can use Grub4dos with entry in menu.lst  \n\u003e title Fedora-18 LIVE USB 2_BOOT  \n\u003e find --set-root /LiveOS/vmlinuz0  \n\u003e kernel /LiveOS/vmlinuz0 root\u003dlive:LABEL\u003d2_BOOT ro rd.live.image quiet rhgb  \ninitrd /LiveOS/initrd0.img  \nUEFI Secure Multi-Boot of Fedora-18 and Windows 8 is possible using Grub2 Menu  \n[http://www.911cd.net...ndpost\\\u0026p\u003d173242](http://www.911cd.net/forums//index.php?showtopic\u003d25262\u0026view\u003dfindpost\u0026p\u003d173242 \"External link\")  \n![:cheers:](https://reboot.pro/public/style_emoticons/default/cheers.gif)\n\n"
    },
    {
      "id": "169718",
      "timestamp": "2013-03-19T22:01:37+00:00",
      "author": "steve6375",
      "content": "This is my menu for Fedora 17 with persistence - it uses UUID instead of LABEL\n\n#Extract the \\\\LiveOS files to the USB drive  \n#Copy the vmlinuz0 and initrd0.img files from the \\\\isolinux folder to the USB \\\\LiveOS folder  \n#For persistency, use the RMPrepUSB Make Ext2FS button and copy the file to USB drive \\\\LiveOS folder  \n# See www.rmprepusb.com Tutorial 67 for details  \n\n```\ntitle FEDORA + PERSISTENCY\nuuid () \u003e nul\nset UUID\u003d%?%\necho %UUID%\nif not exist /LiveOS/overlay-LIVE-%UUID% echo WARNING: Changes will not be remembered unless a /LiveOS/overlay-LIVE-%UUID% ext2 file is created! \u0026\u0026 pause\nkernel /liveos/vmlinuz0 root\u003dlive:UUID\u003d%UUID% rootfstype\u003dauto rw liveimg overlay\u003dUUID\u003d%UUID% quiet  rhgb rd.luks\u003d0 rd.md\u003d0 rd.dm\u003d0 xdriver\u003dvesa nomodeset\ninitrd /liveos/initrd0.img\n```\n\n\u003cbr /\u003e\n\n"
    }
  ]
}