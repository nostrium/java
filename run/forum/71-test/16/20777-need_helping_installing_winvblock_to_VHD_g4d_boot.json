{
  "id": "20777",
  "title": "need helping installing winvblock to VHD (g4d boot)",
  "isPinned": false,
  "isFirstTopic": false,
  "isLocked": false,
  "tags": [],
  "forumNotes": [
    {
      "id": "195724",
      "timestamp": "2015-10-04T12:22:01+00:00",
      "author": "ndog37",
      "content": "I have been at my computer all day trying to get this to work and want to cry\n\nThe frustrating thing, is that it used to work in the past, and now i can\u0027t figure out why it doesnt work.\n\nI was hoping someone who actually knows how to install winvblock into offline windows XP could look at what is wrong with my script\n\nI keep getting STOP 7b.\n\nThis computer I am testing on currently is set to native IDE and does not need an extra driver\n\nI am using\n\n- winvblock from wimb IMG_XP\\\\WinVBlock_Install\n\n- grub4dos 0.4.6a\n\n- windows xp wim file, tested several wims which are working ok with normal install, (not to fixed VHD)\n\ninstall.cmd\n\n```\n@echo off\u0026cls\n\nset _wvbDir\u003d\\\\server\\dir\\IMG_XP\\WinVBlock_Install\nset _vhd\u003dd:\\wXP-7GB.vhd\n\necho.\necho Create 7 GB VHD - 913 cyliners, 255 heads, 63 sectors \u003d 14667345 * 512 \u003d 7509680640\ndel \"%_vhd%\" 2\u003enul\nfsutil file createnew \"%_vhd%\" 7509680640\n\necho.\necho Mount disk with winvblock\n\"%_wvbDir%\\winvblk.exe\" -cmd attach -m h -u \"%_vhd%\"\nping localhost -n 3 \u003enul\n\necho.\necho change disk letter to m:\nset _tmp\u003d%temp%\\dp.lst\nfor /f \"tokens\u003d2\" %%g in (\u0027echo list dis ^| diskpart ^| find \"716\"\u0027) do (\n  echo sel dis %%g \u003e\"%_tmp%\"\n  echo cre par pri \u003e\u003e\"%_tmp%\"\n  echo sel par 1 \u003e\u003e\"%_tmp%\"\n  echo ass letter\u003dM \u003e\u003e\"%_tmp%\"\n  )\ndiskpart /s \"%_tmp%\"\ndel \"%_tmp%\" 2\u003enul \u003enul\n\necho.\necho format m:\necho WARNING THIS WILL TAKE OVER 2~3 MINUTES TO START FORMATTING THE DRIVE!!!\nformat m: /fs:ntfs /v:WINXP /y\n\necho.\necho Use imagex to apply wim to m:\n\"\\\\server\\dir\\imagex(x86).exe\" /apply \"\\\\server\\dir\\winxp\\sysprep.wim\" 1 m:\n\necho.\necho Make m: bootable\n\"\\\\server\\dir\\bootsect(x86).exe\" /nt52 m: /force\n\necho.\necho fix_hdc.cmd - massstorage drivers into registry\n:: fix_hdc by cd0b - not neccesary as this computer uses native IDE\nREM start /wait \"\" \"\\\\server\\dir\\hdc_xp\\fix_hdc.cmd\" -t m:\\Windows\n\n\necho.\necho Install winvblock into registry\ncopy /y \"%_wvbDir%\\WVBlk32.sys\" \"m:\\Windows\\system32\\drivers\"\nreg UNLOAD HKLM\\SYSTEM_00 \u003enul 2\u003e\u00261\nreg LOAD HKLM\\SYSTEM_00 M:\\WINDOWS\\system32\\config\\SYSTEM \u003enul 2\u003e\u00261\nrem detect CurrentControlSet\nfor /f \"tokens\u003d3\" %%a in (\u0027reg.exe query \"HKLM\\SYSTEM_00\\Select\" /v \"Current\"\u0027) do set /a ControlSet\u003d%%a\nset ControlSet\u003d00000%ControlSet%\nset ControlSet\u003dControlSet%ControlSet:~-3%\necho. \u0026echo ControlSet \"%ControlSet%\" used.\n\necho.\necho --\u003d\u003d generate WinVBlock registry entries \u003d\u003d--\n (echo REGEDIT4\n  echo.\n  echo [HKEY_LOCAL_MACHINE\\SYSTEM_00\\%ControlSet%\\Enum\\Root\\WinVBlock]\n  echo [HKEY_LOCAL_MACHINE\\SYSTEM_00\\%ControlSet%\\Enum\\Root\\WinVBlock\\0000]\n  echo \"ConfigFlags\"\u003ddword:00000000\n  echo \"Legacy\"\u003ddword:00000000\n  echo \"DeviceReported\"\u003ddword:00000001\n  echo \"Service\"\u003d\"WinVBlock\"\n  echo \"Capabilities\"\u003ddword:00000000\n  echo \"ClassGUID\"\u003d\"{4D36E97B-E325-11CE-BFC1-08002BE10318}\"\n  echo \"Class\"\u003d\"SCSIAdapter\"\n  echo \"Driver\"\u003d\"{4D36E97B-E325-11CE-BFC1-08002BE10318}\\\\0001\"\n  echo \"Mfg\"\u003d\"WinVBlock\"\n  echo \"DeviceDesc\"\u003d\"WinVBlock Bus\"\n  echo \"ParentIdPrefix\"\u003d\"1\u00262509509\u00260\"\n  echo [HKEY_LOCAL_MACHINE\\SYSTEM_00\\%ControlSet%\\Enum\\Root\\WinVBlock\\0000\\LogConf]\n  echo [HKEY_LOCAL_MACHINE\\SYSTEM_00\\%ControlSet%\\Enum\\Root\\WinVBlock\\0000\\Control]\n  echo \"ActiveService\"\u003d\"WinVBlock\"\n  echo.\n  echo [HKEY_LOCAL_MACHINE\\SYSTEM_00\\%ControlSet%\\Services\\WinVBlock]\n  echo \"DisplayName\"\u003d\"WinVBlock\"\n  echo \"Group\"\u003d\"SCSI miniport\"\n  echo \"Type\"\u003ddword:00000001\n  echo \"Start\"\u003ddword:00000000\n  echo \"Group\"\u003d\"SCSI miniport\"\n  echo \"ErrorControl\"\u003ddword:00000001\n  echo \"PdoDone\"\u003ddword:00000001\n  echo \"Tag\"\u003ddword:00000022\n  echo.\n  echo [HKEY_LOCAL_MACHINE\\SYSTEM_00\\%ControlSet%\\Services\\WinVBlock\\Enum]\n  echo \"0\"\u003d\"Root\\\\WinVBlock\\\\0000\"\n  echo \"Count\"\u003ddword:00000001\n  echo \"NextInstance\"\u003ddword:00000001\n  echo.\n  echo.\n  echo [HKEY_LOCAL_MACHINE\\SYSTEM_00\\%ControlSet%\\Control\\Class\\{4D36E97B-E325-11CE-BFC1-08002BE10318}]\n  echo \"LegacyAdapterDetection\"\u003ddword:00000000\n  echo \"Class\"\u003d\"SCSIAdapter\"\n  echo @\u003d\"SCSI and RAID controllers\"\n  echo \"Installer32\"\u003d\"SysSetup.Dll,ScsiClassInstaller\"\n  echo \"Icon\"\u003d\"-10\"\n  echo \"LegacyInfOption\"\u003d\"SCSI\"\n  echo.\n  echo.\n )\u003e\"%temp%\\install_winvblock.reg\"\n\necho.\necho --\u003d\u003d import registry key (as SYSTEM) \u003d\u003d--\n:: bartPE - does not require psexec to import permissions\n\"%~dp0PsExec.exe\" -i -s /accepteula reg import \"%temp%\\install_winvblock.reg\"\n\"%~dp0PsExec.exe\" -i -s /accepteula reg add \"HKLM\\SYSTEM_00\\%ControlSet%\\Enum\\Root\\WinVBlock\\0000\" /v \"CompatibleIDs\" /t REG_MULTI_SZ /d \"DETECTEDInternal\\WVBlk32\\0DETECTED\\WVBlk32\\0\" /f\n\"%~dp0PsExec.exe\" -i -s /accepteula reg add \"HKLM\\SYSTEM_00\\%ControlSet%\\Services\\WinVBlock\" /v \"ImagePath\" /t REG_EXPAND_SZ /d \"System32\\Drivers\\WVBlk32.Sys\" /f\n\npause\n\n:: unload registry\nreg UNLOAD HKLM\\SYSTEM_00 \u003enul 2\u003e\u00261\n\necho.\necho Unmount disk\nping localhost -n 5 \u003enul\n\"%_wvbDir%\\winvblk.exe\" -cmd detach -d 1\n```\n\nmenu.lst\n\n```\ntitle wXP-7GB.vhd - WinVBlock driver - 7000 MB\nfind --set-root --ignore-floppies /wXP-7GB.vhd\nmap /wXP-7GB.vhd (hd0)\nmap --hook\nroot (hd0,0)\nchainloader /ntldr\n```\n\nI am just continually tweaking the registry script to import the correct settings for winvblock, but it simply refuses to work. Ah make me crazy...... Maybe somelike like shao or wonko can help i will be so grateful.\n\n"
    },
    {
      "id": "195725",
      "timestamp": "2015-10-04T13:14:19+00:00",
      "author": "Wonko the Sane",
      "content": "Well, I guess you need somehow to explicit the \"correct settings for WinVblock\".\n\nI am not sure there is an actual verified record of them. ![:dubbio:](https://reboot.pro/public/style_emoticons/default/dubbio.gif)\n\nIn any case, since the idea is that of modifying an offline Registry, you could use an offline registry tool (it won\u0027t in any way solve the issue if the settigns are \"wrong\", but at least you won\u0027t have to \"translate\" to SYSTEM_00 or whatever):\n\n[http://reboot.pro/to...fline-registry/](http://reboot.pro/topic/11312-offline-registry/ \"\")\n\nAnother \"random\" thought (again not an answer to your question ![:(](https://reboot.pro/public/style_emoticons/default/sad.png)), would Integratedrv work with Winvblock? MSSTmake seemingly doesn\u0027t:\n\n[http://www.msfn.org/...p-v3851/page-10](http://www.msfn.org/board/topic/149612-winntsetup-v3851/page-10 \"External link\")\n\n[http://reboot.pro/to...d-boot-from-it/](http://reboot.pro/topic/18107-integratedrv-install-xp-2003-to-a-usb-30-disk-and-boot-from-it/ \"\")\n\nBut what about installing \"normally\" the Winvblock through setup before capturing the .wim?\n\n![:duff:](https://reboot.pro/public/style_emoticons/default/duff.gif)\n\nWonko\n\n"
    },
    {
      "id": "195740",
      "timestamp": "2015-10-06T09:42:17+00:00",
      "author": "ndog37",
      "content": "Hi Wonko  \n\nThanks for your suggestion.  \n\nI rebuilt the windows XP ISO with ryanvm, installed fresh to a VMware, installed winvblock, syspreped, shutdown, injected the universal HAL driver and re captured the wim file.  \n\nI then ran the above process, without the modifying the registry, however it still throws the 7b error.  \n\nMy next steps will be to use a vanilla windows XP, and if that fails, to locate a different winvblock version.  \n\nWill keep you posted  \n\nedit:  \ntried older winvblock driver and installed with sc create method which failed too   \n\n**Edited by ndog37, 06 October 2015 - 10:09 AM.**\n"
    },
    {
      "id": "195764",
      "timestamp": "2015-10-07T16:49:13+00:00",
      "author": "Wonko the Sane",
      "content": "For the sake of the experiment, use Qemu instead of VmWare (it is slower, but it uses more standard hardware and you need not to inject the \"Standard dual PCI IDE controller\" as that is what is natively used).\n\nAlso, from your post it is not clear (to me at least) if you actually tested a copy of the (working) \"original\" against the one created by applying the .wim to a new .vhd.\n\nI mean, why don\u0027t you simply try creating a \"universal\" XP .img (or VHD) using wimb\u0027s tool and check what (different) settings in the Registry (related to Winvblock or to other drivers/whatever) it creates when compared to the one created through your procedure?\n\n[http://reboot.pro/to...-and-windows-7/](http://reboot.pro/topic/9830-universal-hdd-image-files-for-xp-and-windows-7/ \"\")\n\n![:duff:](https://reboot.pro/public/style_emoticons/default/duff.gif)\n\nWonko\n\n"
    }
  ]
}