{
  "id": "18586",
  "title": "Strange Boot Issues from NTFS UFDs",
  "isPinned": false,
  "isFirstTopic": false,
  "isLocked": false,
  "tags": [],
  "forumNotes": [
    {
      "id": "172976",
      "timestamp": "2013-05-31T17:54:36+00:00",
      "author": "mr-roboto",
      "content": "Folks:  \nI\u0027ve made some puzzling observations recently and seek advise/comments/insight from those who ***might\u0027ve*** encountered similar events. I have a bootable DVD called Superdisc. It\u0027s an ongoing project that integrates several DOS floppy images, Live Linux distros, and WinPE on a single bootable SYSLINUX-based platform. The current incarnation works perfectly from DVD. However, I just realized I didn\u0027t have a bootable USB tool kit, so I copied the contents of the current Superdisc to an existing NTFS-formatted flash drive. I made the UFD bootable using syslinux.exe (4.06) and rebooted my PC. The newly bootable UFD worked immediately as expected and all went well until I started testing the Live Linuxes. Knoppix 7.05 worked normally. PartedMagic (12_25_2012) worked but it took **ten minutes** to load initrd.img after which everything else behaved normally. Kaspersky Rescue Disk 10.3 took much longer than normal to boot, then froze w/ a kernel panic early in the initialization process ! PCLinuxOS 2.6.38 + 3.2.18 started to boot normally then failed, unable to locate the media containing the compressed file system. Really freaky !  \nUsing HashCheck, I made a checksum file using the Superdisc folders of the components (from the DVD) that failed and checked the UFD against that checksum file. To my surprise, there were some random mismatches in the data files (ie. the virus defs) for the Kaspersky Rescue Disc, but the (critical) compressed images for the OSes test as sound, even after multiple tests.  \nRecently, I created a couple Windows 7 installation UFDs, using WinUSB 2.0 (it formats a UFD, transfers the Win7/Vista installation files from an ISO, and makes the UFD bootable.) My Win7 distribution media is configured to perform an unattended install, the script for which has been in use for several years. However, using these new UFDs has produced inconsistent results. Running the distribution media from DVD under VMWare works every time, while an installation from one of the new UFDs (on a client PC) works normally for the 1st two phases of Windows 7 setup. After entering the username at the start of the final (third) phase of Windows setup, my GUIRUNONCE script doesn\u0027t ***always*** execute ! The progress bar on the dialog keeps moving but the script itself doesn\u0027t launch (normally, the dialogs from the various programs in GUIRUNONCE would appear in no more that thirty secs.) After five mins, no joy. Upon reboot, the folder containing the script and programs are on the hard drive, they\u0027re just never executed.  \nI\u0027ve had decent success with bootable UFDs in the past. I used and swore by PE2USB for bootable BartPE/WinPE UFDs, but that was limited to 2GB FAT32 media. Much more recently, I\u0027ve been using PCLinuxOS UFDs, formatted as a ext2 partition for days at a time. I can\u0027t be sure that the two aforementioned \"problems\" are caused by the same issue. Obviously, I suspect some sort of data corruption, but I\u0027ve distributed my activities across several UFDs (all Sandisks), most are less than six months old.  \nAnyway, I\u0027m curious what are the experiences of others in this area. I can\u0027t expect anyone to \"come to the rescue\" with a solution out of the blue. A discussion and constructive suggestions are welcome. TIA...  \n\n"
    },
    {
      "id": "172983",
      "timestamp": "2013-06-01T01:42:55+00:00",
      "author": "ilko",
      "content": "\u003e PartedMagic (12_25_2012) worked but it took ten minutes to load initrd.img\n\nDoes the system support boot in USB 2.0 mode?Try loading PLoP as first step, next boot your stuff.\n\n\u003e Kaspersky Rescue Disk 10.3 took much longer than normal to boot\n\nditto\n\n\u003e then froze w/ a kernel panic early in the initialization process\n\nhow is its file structure created? It requires some modifications to be launched from USB-HD media. Search reboot.pro, there are several topics.\n\n\u003e PCLinuxOS 2.6.38 + 3.2.18 started to boot normally then failed, unable to locate the media containing the compressed file system\n\nHow is it placed in the UFD? Flat file structure, single ISO and kernel loaded with \"cheat\" parameters so the ISO is searched for, or...?\n\n\u003e Using HashCheck, I made a checksum file using the Superdisc folders of the components (from the DVD) that failed and checked the UFD against that checksum file. To my surprise, there were some random mismatches in the data files (ie. the virus defs) for the Kaspersky Rescue Disc\n\nThis should not happen obviously. Find out what\u0027s going wrong- faulty hardware, UFD, RAM, whatever...\n\n\u003e After entering the username at the start of the final (third) phase of Windows setup, my GUIRUNONCE script doesn\u0027t always execute !\n\nHow are these commands executed? Do they expect a source or script on the UFD? Is the UFD involved at all at this step?\n\n"
    },
    {
      "id": "173067",
      "timestamp": "2013-06-02T18:47:53+00:00",
      "author": "mr-roboto",
      "content": "\u003e Does the system support boot in USB 2.0 mode?Try loading PLoP as first step, next boot your stuff.  \n\u003e\n\u003e how is its file structure created? It requires some modifications to be launched from USB-HD media. Search reboot.pro, there are several topics.  \n\u003e\n\u003e How is it placed in the UFD? Flat file structure, single ISO and kernel loaded with \"cheat\" parameters so the ISO is searched for, or...?\nProblem 1 solution: SYSLINUX 4.06 (pos beyond, haven\u0027t tested beyond 4.06) appears to have issues with its NTFS support, at least that\u0027s my current hypothesis. By taking the same media and reformatting the drive to FAT32, everything works ! PCLinuxOS and Kaspersky Rescue both boot from FAT32 UFDs.  \n\nI \"believe\" whatever mechanism used to hand off the filesystem **from** the SYSLINUX bootloader **to** the selected OS has imperfections that cause some OSes to fail. Will refer this matter to the SYSLINUX mail list to pursue this further.  \n\nThis is a snapshot of the main menu from the current incarnation of SuperDisc 2:  \n[![Super_Disc_2_1_Jun_Screen_Snapshot.jpg](http://s19.postimg.org/5uynwonzz/Super_Disc_2_1_Jun_Screen_Snapshot.jpg)](http://postimg.org/image/5uynwonzz/ \"External link\")  \n\u003e After entering the username at the start of the final (third) phase of Windows 7 setup, my GUIRUNONCE script doesn\u0027t always execute !\n\nProblem 2: This was caused by a different issue and a solution isn\u0027t immediately on the horizon. I have two customized Win 7 distribution DVDs, \\[obviously\\] x86 and x64. I can test my x86 media on both of my PCs, under VMWare Workstation, but not the x64 media (my P4 and Core 2 Duo don\u0027t support x64 guests.) Using custom INI files for something called WinToolkit, I was able to get a working setup for my x86 media and I manually edited the x64 INI files, to generate ***effectively identical*** x64 distribution media. Didn\u0027t work out that way.  \n\nMy hypothesis explaining the problem is one or more files derails completion of the setup process bec of the NTFS alt data streams, which causes Windows to block **recently downloaded programs** from executing straight away. So I have to go back to square one and reconstruct my media from cleared sources, then find a x64 test bed to explicitly test the new media.  \n\nAnyway, that\u0027s it for now. Thanks for the use of the brain cells....   \n"
    },
    {
      "id": "173068",
      "timestamp": "2013-06-02T19:00:22+00:00",
      "author": "Wonko the Sane",
      "content": "AFAIK NTFS support in Syslinux is still experimental, and AFAICR the 5.x version (that might have a better support for NTFS) \"sucks BIG\" for a number of othere reasons:\n\n[http://reboot.pro/to...ux-please-test/](http://reboot.pro/topic/15086-experimental-ntfs-support-for-syslinux-please-test/ \"\")\n\n[http://reboot.pro/to...odern-syslinux/](http://reboot.pro/topic/17943-layout-of-modern-syslinux/ \"\")\n\n**BUT** in your case it could be the actual distro\u0027s you used that have invalid (or poor) NTFS support.\n\nYou can try with grub4dos direct mapping the .iso to 4th partiton entry ....\n\n![:cheers:](http://reboot.pro/public/style_emoticons/default/cheers.gif)\n\nWonko\n\n"
    },
    {
      "id": "173074",
      "timestamp": "2013-06-03T09:01:16+00:00",
      "author": "steve6375",
      "content": "I have seen issues with some linux distros not liking NTFS USBs on booting (but can read NTFS once booted).\n\nTry Easy2Boot. Most of these NTFS problems just disappear because Easy2Boot creates a new CDFS partition and so the 2nd stage boot loader sees the CDFS partition and loads the 2nd stage boot files from there and not from the NTFs USB drive.\n\n"
    },
    {
      "id": "173075",
      "timestamp": "2013-06-03T09:32:07+00:00",
      "author": "Wonko the Sane",
      "content": "\u003e Try Easy2Boot. Most of these NTFS problems just disappear because Easy2Boot creates a new CDFS partition and so the 2nd stage boot loader sees the CDFS partition and loads the 2nd stage boot files from there and not from the NTFs USB drive.\n\nI.e. install a completely different menu system (BTW nice) in order to test if a single write to the UFD partiion table solves the problem.\n\nCome on :smile:, mr-roboto seems to be the kind of guy that wants to know what he is doing (as opposed to run an auto-magic app).\n\nIn any case, starting here is the relevant info about the method/approach:\n\n[http://reboot.pro/to...brided/?p\u003d88531](http://reboot.pro/topic/9916-grub4dos-isohybrided/?p\u003d88531 \"\")\n\n![:cheers:](http://reboot.pro/public/style_emoticons/default/cheers.gif)\n\nWonko\n\n"
    },
    {
      "id": "173139",
      "timestamp": "2013-06-05T01:29:49+00:00",
      "author": "halikus",
      "content": "From either NTFS USB or CD i find [syslinux-4.06.zip](https://www.kernel.org/pub/linux/utils/boot/syslinux/4.xx/syslinux-4.06.zip \"External link\") and grub4dos-0.4.5c-2013-05-21 both work. After lots of testing, i found that specific combination worked the best for NTFS, although some things, like an extracted Linux distro, might only boot from fat32.\n\n"
    },
    {
      "id": "173253",
      "timestamp": "2013-06-08T18:45:05+00:00",
      "author": "mr-roboto",
      "content": "\u003e I.e. install a completely different menu system (BTW nice) in order to test if a single write to the UFD partiion table solves the problem.  \n\u003e\n\u003e Come on :smile:, mr-roboto seems to be the kind of guy that wants to know what he is doing (as opposed to run an auto-magic app).  \n\u003e\n\u003e In any case, starting here is the relevant info about the method/approach:  \n\u003e [http://reboot.pro/to...brided/?p\u003d88531](http://reboot.pro/topic/9916-grub4dos-isohybrided/?p\u003d88531 \"\")  \n\u003e\n\u003e \u003cbr /\u003e\n\u003e\n\u003e ![:cheers:](http://reboot.pro/public/style_emoticons/default/cheers.gif)  \n\u003e Wonko\n\nMy dear Wonko, you are correct. I **do** favor the hands-on approach of \"rolling my own\" bootable media, as you probably recall my \"stickied\" [Superdisc](http://www.msfn.org/board/topic/94398-super-disc-multi-boot-project-cddvd-using-isolinux/ \"External link\") topic on MSFN. However, this isn\u0027t the 1st issue I\u0027ve encountered that\u0027s made me think of **my own** helper app, a la Easy2Boot, SARDU, etc. Having said that, I\u0027ll definitely take up **steve6375** on his suggestion to try E2B, as it has some capabilities that can\u0027t be realized using SYSLINUX at all. My 1st impression the E2B web page is that regardless of doing it yourself (as in the case of SuperDisc) or using E2B, this stuff quickly demands the skills **and** experience of an expert.  \n\nSeveral years ago, you tried valiantly to get me up to speed w/ GRUB4DOS over on the 911CD forum. At that time, my development environment was much more limited than now, so it was easier to choose SYSLINUX over G4D and that effort ultimately led to the SuperDisc project on MSFN. Maybe it\u0027s time to revisit that decision.  \n\n**@halikus** : If I understand your post, you\u0027re using SYSLINUX **and** G4D integrated on your project(s) ? Definitely, not my preference. One or the other, but not both. But thanks for the heads-up.  \n\nAnyway, thanks to all for the use of their eyeballs+grey matter....   \n"
    },
    {
      "id": "173256",
      "timestamp": "2013-06-08T19:05:09+00:00",
      "author": "steve6375",
      "content": "\u003e My 1st impression the E2B web page is that regardless of doing it yourself (as in the case of SuperDisc) or using E2B, this stuff quickly demands the skills **and** experience of an expert.\n\nI was afraid of it looking \u0027too complicated\u0027 when for most things it really isn\u0027t. For 99% of **ALL**linux ISOs you can just copy over the ISO.\n\nSame for Windows Install ISOs (though granted XP install requires two boots and the use of F6 if you are using an unmodified ISO on an AHCI system).\n\nThe rest of the E2B documentation is how to get \u0027odd\u0027 things going like Hirens or Ophcrack or how to boot 6 different linux ISOs all with separate persistence files - something that I don\u0027t think any other method can do... and also how to modify the menu to get it how you want it (again something that I don\u0027t think the other contenders even document).\n\n"
    },
    {
      "id": "173260",
      "timestamp": "2013-06-08T19:43:59+00:00",
      "author": "Wonko the Sane",
      "content": "\u003e One or the other, but not both. But thanks for the heads-up.\n\nWhy? ![:w00t:](http://reboot.pro/public/style_emoticons/default/w00t.gif)\n\nIf you have both a set of spanners and some locking pliers in your toolbox you can undo MORE nuts! :wink:\n\n![:cheers:](http://reboot.pro/public/style_emoticons/default/cheers.gif)\n\nWonko\n\n"
    },
    {
      "id": "173261",
      "timestamp": "2013-06-08T21:40:20+00:00",
      "author": "mr-roboto",
      "content": "\u003e I was afraid of it looking \u0027too complicated\u0027 when for most things it really isn\u0027t. For 99% of **ALL** linux ISOs you can just copy over the ISO.\n\u003e\n\u003e Same for Windows Install ISOs (though granted XP install requires two boots and the use of F6 if you are using an unmodified ISO on an AHCI system).\n\u003e\n\u003e The rest of the E2B documentation is how to get \u0027odd\u0027 things going like Hirens or Ophcrack or how to boot 6 different linux ISOs all with separate persistence files - something that I don\u0027t think any other method can do... and also how to modify the menu to get it how you want it (again something that I don\u0027t think the other contenders even document).\n\n**@steve6375** : I think you misconstrue my comment. I\u0027ve done dozens of iterations of bootables like the project shown in the SuperDisc bootsplash above. **That\u0027s easy now.** I\u0027m sure I can get up to speed w/ E2B and a comparable project in less than a day. Experience has taught me that until you\u0027ve got two or three projects in the bag, take your time, and try not to skip any steps....\n\n"
    },
    {
      "id": "173263",
      "timestamp": "2013-06-09T00:32:07+00:00",
      "author": "mr-roboto",
      "content": "\u003e Why? ![:w00t:](http://reboot.pro/public/style_emoticons/default/w00t.gif)\n\u003e\n\u003e If you have both a set of spanners and some locking pliers in your toolbox you can undo MORE nuts! :wink:\n\u003e\n\u003e ![:cheers:](http://reboot.pro/public/style_emoticons/default/cheers.gif)\n\u003e\n\u003e Wonko\n\n**@Wonko** : I prefer the analogy of the utility knife vs the Swiss Army knife. I have both, but only travel w/ the utility knife bec I never **use** anything beyond the primary blade. Earlier incarnations of my SuperDiscs have included everything on the bootsplash shown above **plus** WinPE/BartPE **and** three different editions of XP. And I\u0027ve never **perceived** that SYSLINUX alone inhibited my work, in any way. But I am committed to getting up to speed w/ G4D at last....\n\n"
    }
  ]
}