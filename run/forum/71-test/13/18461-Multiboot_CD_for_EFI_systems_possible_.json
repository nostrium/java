{
  "id": "18461",
  "title": "Multi-boot CD for EFI systems possible ?",
  "isPinned": false,
  "isFirstTopic": false,
  "isLocked": false,
  "tags": [],
  "forumNotes": [
    {
      "id": "171387",
      "timestamp": "2013-04-23T11:35:47+00:00",
      "author": "sanbarrow",
      "content": "I have 3 different Boot-CDs that work on EFI-systems : WinPE 3, Ubuntu 64 and ESXi 5.1  \n\nI would like to combine all 3 into one Iso but dont see a way to do that.  \n\nI create the isos with 3 different efi.img files and as the efi.imgs are used as boot-images it looks like there is no chance to combine them into one.  \n\nAm I missing something ?  \n\nUlli\n\n"
    },
    {
      "id": "171402",
      "timestamp": "2013-04-23T15:55:52+00:00",
      "author": "Wonko the Sane",
      "content": "\u003e I have 3 different Boot-CDs that work on EFI-systems : WinPE 3, Ubuntu 64 and ESXi 5.1  \n\u003e\n\u003e I would like to combine all 3 into one Iso but dont see a way to do that.  \n\u003e\n\u003e I create the isos with 3 different efi.img files and as the efi.imgs are used as boot-images it looks like there is no chance to combine them into one.  \n\u003e\n\u003e Am I missing something ?  \n\u003e\n\u003e Ulli\n\nCan you detail how exactly are you making a single .iso now?\n\nWhich program do you use to make the .iso?\n\nWith which settings/command line?\n\nHow is (approximately) the size of each?\n\nWhich \"main\" bootmanager are you using (presuming you are using a no-emulation CD/DVD bootsector)?\n\nWhat exactly is a \"efi.img\" and how exactly you make them?\n\n![:cheers:](http://reboot.pro/public/style_emoticons/default/cheers.gif)\n\nWonko\n\n"
    },
    {
      "id": "171415",
      "timestamp": "2013-04-23T19:24:04+00:00",
      "author": "cdob",
      "content": "\u003e I create the isos with 3 different efi.img files and as the efi.imgs are used as boot-images it looks like there is no chance to combine them into one.\nWhy do you like to combine efi images?  \n\nChoose a bootloader and chainload the other OS. Ubuntu uses grub2 at UEFI mode.  \n\nboot\\\\grub\\\\grub.cfg\n\n```\nmenuentry \"Windows\" {\n  chainloader /efi/microsoft/boot/cdboot_noprompt.efi\n}\n```\n\nFile names are case sensitive.  \n\nHowever I get a Windows Boot Manager error:  \nStatus: 0xc000000e  \nInfo: A required device isn\u0027t connected or can\u0027t be accessed.  \n\nSomething is false or missing.  \n\nWell, bcd file is processed at last   \n"
    },
    {
      "id": "171464",
      "timestamp": "2013-04-24T18:06:58+00:00",
      "author": "cdob",
      "content": "As for testing purposes:  \nWindows 8 installation files copied to a folder.  \nUbuntu files copied to the same folder.  \n\nEFI multi boot catalog. No idea it this is supported at all.\n\n```\nmkisofs.exe -iso-level 3 -N -D -d -relaxed-filenames -allow-multidot -udf -r -hide boot.catalog -hide-udf boot.catalog -eltorito-platform efi -no-emul-boot -b boot/grub/efi.img -eltorito-alt-boot -eltorito-platform efi -no-emul-boot -b efi/microsoft/boot/efisys.bin -o \\EFImulti.iso .\n```\n\n\u003cbr /\u003e\n\nVMware Player 5 with EFI boot:  \n\nEFI CDRom boot selects first El Torito EFI boot catalog entry /boot/grub/efi.img  \n\n\u003cbr /\u003e\n\nEFI Internal Shell:  \n\nblk2 contains mapped floppy image /boot/grub/efi.img  \n\u0027blk2:\\\\\\\u003e \\\\efi\\\\boot\\\\bootx64.efi\u0027 boots grub2  \nChainloading windows fails: Windows Boot Manager Status: 0xc000000e  \n\nblk3 contains mapped floppy image /boot/grub/efi.img  \n\u0027blk2:\\\\\\\u003e \\\\EFI\\\\BOOT\\\\BOOTX64.EFI\u0027 boots Windows 8 installation.  \n\nIt\u0027s possible to create a multi EFI boot DVD, however EFI shell is required.  \n\nConclution:  \nWindows 8 boots from CDRom device, it\u0027s not file system or similar.  \n\nbcd file refers to device \u0027ramdisk\u003d\\[boot\\]\\\\sources\\\\boot.wim\u0027  \n\nchainloader /efi/microsoft/boot/cdboot_noprompt.efi dosn\u0027t match \\[boot\\] requirements.   \n"
    },
    {
      "id": "171473",
      "timestamp": "2013-04-24T21:50:35+00:00",
      "author": "sanbarrow",
      "content": "\u003e Can you detail how exactly are you making a single .iso now?\n\u003e\n\u003e Which program do you use to make the .iso?\n\u003e\n\u003e With which settings/command line?\n\u003e\n\u003e How is (approximately) the size of each?\n\u003e\n\u003e Which \"main\" bootmanager are you using (presuming you are using a no-emulation CD/DVD bootsector)?\n\u003e\n\u003e What exactly is a \"efi.img\" and how exactly you make them?\n\u003e\n\u003e ![:cheers:](http://reboot.pro/public/style_emoticons/default/cheers.gif)\n\u003e\n\u003e Wonko\n\nI use mkisofs with a command like this  \n\nmkisofs-3.01a06.exe -l -v -iso-level 4 -l -J -joliet-long -R -volid %Volume_Name% -sysid \"\" -A \"EFIMAGE\" -V Efi-LIVE -c BOOT.CAT -eltorito-platform \"x86\" -b isolinux/isolinux.bin -no-emul-boot -boot-load-size 4 -boot-info-table -eltorito-alt-boot -eltorito-platform \"efi\" -b boot/grub/efi.img -no-emul-boot -input-charset utf-8 -o linux.iso linux\n\nThat one is for the Ubuntu64 CD.  \n\nFor the ESXi-CDs I use  \nmkisofs-3.01a06.exe -l -no-iso-translate -sysid \"\" -A \"ESXIMAGE\" -V ESXi-LIVE -c BOOT.CAT -eltorito-platform \"x86\" -b ISOLINUX.BIN -no-emul-boot -boot-load-size 4 -boot-info-table -eltorito-alt-boot -eltorito-platform \"efi\" -b EFIBOOT.IMG -no-emul-boot -input-charset utf-8 -o esxi55-1043421.iso esxi55-1043421  \n\nThe ESXi CDs are about 150 MBs and the Linux CDs vary between 300 MBs and 1100 Mbs.  \n\nThe efi.img files use a fat12 filesystem with a directory structure like this for ESXi  \nEFI  \nEFI\\\\BOOT  \nEFI\\\\DRIVERS  \nEFI\\\\BOOT\\\\BOOTIA32.EFI  \nEFI\\\\BOOT\\\\BOOTx64.EFI  \nEFI\\\\DRIVERS\\\\ISO9660IA32.EFI  \nEFI\\\\DRIVERS\\\\ISO9660x64.EFI  \n\nand with this structure for Linux Ubuntu 64  \nEFI  \nEFI\\\\BOOT\\\\BOOTIA32.EFI  \nEFI\\\\BOOT\\\\BOOTx64.EFI  \n\nThe files BOOTIA32.EFI and BOOTx64.EFI are different for both images.  \n\nHere is some background info about those efi.img files  \n[http://bugs.centos.o...?id\u003d5387#c14163](http://bugs.centos.org/view.php?id\u003d5387#c14163 \"External link\")  \n\nFor booting from normal BIOS machines I use grub4dos as the bootmanager.  \nFor that case I use memdisk to load the ESXi images into RAM as they are quite small.  \n\nThe menu.lst I use for ESXi looks like  \n\niftitle \\[find --ignore-floppies /moa/esxi51-799733.iso\\] run ESXi 5.1 build 799733  \nfind --set-root --ignore-floppies /moa/esxi51-799733.iso  \nmap /moa/esxi51-799733.iso (0xff) \\|\\| map --mem /moa/esxi51-799733.iso (0xff)  \nmap --hook  \nchainloader (0xff)  \n\nThe Ubuntu 64 is loaded either as ISO - if it is the small version or in case it is a large one I use  \n\niftitle \\[find --ignore-floppies /casper/initrd.gz\\] Ubuntu 64 non-persistent  \nkernel /casper/vmlinuz noprompt cdrom-detect/try-usb\u003dtrue file\u003d/casper/custom.seed boot\u003dcasper initrd\u003d/casper/initrd.gz quiet --  \ninitrd /casper/initrd.gz  \n\niftitle \\[find --ignore-floppies /casper/initrd.gz\\] Ubuntu 64 persistent uses a casper-rw file  \nkernel /casper/vmlinuz noprompt cdrom-detect/try-usb\u003dtrue persistent file\u003d/casper/custom.seed boot\u003dcasper initrd\u003d/casper/initrd.gz quiet --  \ninitrd /casper/initrd.gz  \n\nBooting from BIOS systems works well.  \n\n\\\u003e\\\u003e Why do you like to combine efi images?  \n\nGood question - I assume I want to do this because I already have the options I want in the CD/DVD for BIOS machines - so I would regard having to use several CDs for an EFI-system as a step back.  \n\nFor now I would be happy if I could combine a 300 Mb Ubuntu ISO with one for ESXi.  \nI use both of them regularly when doing VMware recovery work - then I tell my customers to download one iso that can be used to boot into Linux and ESXi.  \n\n\\\u003e\\\u003e Choose a bootloader and chainload the other OS. Ubuntu uses grub2 at UEFI mode.  \n\nGood suggestion - I try that right now.\n\n"
    }
  ]
}