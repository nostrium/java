{
  "id": "18897",
  "title": "Can not get WinPE4x to boot from local partition",
  "isPinned": false,
  "isFirstTopic": false,
  "isLocked": false,
  "tags": [],
  "forumNotes": [
    {
      "id": "177147",
      "timestamp": "2013-09-16T20:23:20+00:00",
      "author": "briang",
      "content": "I built the WinPE using Win 8\u0027s ADK and the boot.wim boots fine via USB and/or DVD, but when I place it in a local partition, update my BCD file using the script below. It locks up! I can\u0027t figure this out for the life of me!! Any help is much appreciated. Im performing my testing in VMWare 9.\n\nCreateBCD Script:\n\n```\n@echo off\nsetlocal\n\nSET BCDEDIT\u003dbcdedit.exe\nSET BCDSTORE\u003dC:\\Boot\\BCD\nSET SDI_FILE\u003dboot.sdi\nSET WIM_File\u003dboot.wim\n\nattrib c:\\boot\\bcd -H -S\ndel c:\\boot\\bcd /F\n%BCDEDIT% /createstore c:\\boot\\bcd\n\necho.\necho Adding {BootMgr} entries\necho \u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\necho.\n\n%BCDEDIT% /store %BCDSTORE% /create {bootmgr}\n%BCDEDIT% /store %BCDSTORE% /set {bootmgr} description \"Boot Manager\"\n%BCDEDIT% /store %BCDSTORE% /set {bootmgr} device boot\n%BCDEDIT% /store %BCDSTORE% /set {bootmgr} timeout 20\n\necho.\necho Adding Ram Disk Options\necho \u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\n\n\nfor /f \"tokens\u003d3\" %%A in (\u0027%BCDEDIT% /store %BCDSTORE% /create /device\u0027) do set ramdisk\u003d%%A \n\n%BCDEDIT% /store %BCDSTORE% /set %ramdisk% ramdisksdidevice partition\u003dR:\n%BCDEDIT% /store %BCDSTORE% /set %ramdisk% ramdisksdipath \\boot\\boot.sdi \necho.\n\necho.\necho Adding Win 7\necho \u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\necho.\n\nfor /f \"Tokens\u003d3\" %%A in (\u0027%BCDEDIT% /store %BCDSTORE% /create /application osloader\u0027) do set GUID\u003d%%A\n\necho.\necho win7 guid\u003d%GUID%\necho.\n\n%BCDEDIT% /store %BCDSTORE% /set %GUID% device partition\u003dC:\n%BCDEDIT% /store %BCDSTORE% /set %GUID% systemroot \\Windows\n%BCDEDIT% /store %BCDSTORE% /set %GUID% osdevice partition\u003dC:\n%BCDEDIT% /store %BCDSTORE% /set %GUID% path \\Windows\\system32\\winload.exe\n%BCDEDIT% /store %BCDSTORE% /set %GUID% detecthal Yes\n%BCDEDIT% /store %BCDSTORE% /set %GUID% description \"Windows OS\"\n%BCDEDIT% /store %BCDSTORE% /displayorder %GUID%\n\necho.\necho Adding Win PE\necho \u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\necho.\n\nfor /f \"Tokens\u003d3\" %%A in (\u0027%BCDEDIT% /store %BCDSTORE% /create /application osloader\u0027) do set GUID\u003d%%A\n\necho.\necho win7 guid\u003d%GUID%\necho.\n\n%BCDEDIT% /store %BCDSTORE% /set %GUID% systemroot \\Windows\n%BCDEDIT% /store %BCDSTORE% /set %GUID% detecthal Yes\n%BCDEDIT% /store %BCDSTORE% /set %GUID% winpe Yes\n%BCDEDIT% /store %BCDSTORE% /set %GUID% osdevice ramdisk\u003d[R:]\\Sources\\boot.wim,%ramdisk%\n%BCDEDIT% /store %BCDSTORE% /set %GUID% device ramdisk\u003d[R:]\\Sources\\boot.wim,%ramdisk%\n%BCDEDIT% /store %BCDSTORE% /set %GUID% description \"Windows PE\"\n%BCDEDIT% /store %BCDSTORE% /displayorder %guid% /addlast\n\necho.\necho.\nendlocal\n```\n\nHere is the final output from my bcdedit /enum\n\n```\nWindows Boot Manager\n--------------------\nidentifier              {bootmgr}\ndevice                  boot\ndescription             Boot Manager\ndisplayorder            {bcd81e17-1fac-11e3-8484-000c29b4fa17}\n                        {bce66879-1fac-11e3-8484-000c29b4fa17}\ntimeout                 20\n\nWindows Boot Loader\n-------------------\nidentifier              {bcd81e17-1fac-11e3-8484-000c29b4fa17}\ndevice                  partition\u003dC:\npath                    \\Windows\\system32\\winload.exe\ndescription             Windows OS\nosdevice                partition\u003dC:\nsystemroot              \\Windows\ndetecthal               Yes\n\nWindows Boot Loader\n-------------------\nidentifier              {bce66879-1fac-11e3-8484-000c29b4fa17}\ndevice                  ramdisk\u003d[R:]\\Sources\\boot.wim,{bcd34c0a-1fac-11e3-8484-000c29b4fa17}\ndescription             Windows PE\nosdevice                ramdisk\u003d[R:]\\Sources\\boot.wim,{bcd34c0a-1fac-11e3-8484-000c29b4fa17}\nsystemroot              \\Windows\ndetecthal               Yes\nwinpe                   Yes\n\nDevice options\n--------------\nidentifier              {bcd34c0a-1fac-11e3-8484-000c29b4fa17}\nramdisksdidevice        partition\u003dR:\nramdisksdipath          \\boot\\boot.sdi\n\n```\n\n/Brian Gonzalez\n\n"
    },
    {
      "id": "177183",
      "timestamp": "2013-09-17T19:21:44+00:00",
      "author": "briang",
      "content": "Copying the C:\\\\bootmgr from WinPE4x to the Boot Partition (Win 7) worked like a charm.\n\n"
    }
  ]
}