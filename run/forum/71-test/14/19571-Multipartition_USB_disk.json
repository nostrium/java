{
  "id": "19571",
  "title": "Multipartition USB disk",
  "isPinned": false,
  "isFirstTopic": false,
  "isLocked": false,
  "tags": [],
  "forumNotes": [
    {
      "id": "182336",
      "timestamp": "2014-02-19T11:42:24+00:00",
      "author": "mraeryceos",
      "content": "I have an idea to have a particular multiboot situation with Grub or Syslinux on a USB flash drive.\n\nThere would be multiple partitions on the flash drive, with one partition having Windows XP installer, another having Windows 7 installer, another with YUMI for linux distributions, another for Hiren.\n\nCan the Windows boot sector (or whatever it is called) on the CD/DVD, be used on the PBR rather than the MBR?\n\nWhen one selects the partition one wants to boot into, from the Grub menu, then by a series of Grub commands:\n\n1) one would set the default partition Grub would boot into after an X second timeout ( see [https://www.gnu.org/...avedefault.html](https://www.gnu.org/software/grub/manual/legacy/savedefault.html \"External link\") )\n\n2) one would set the first partition on the USB flash drive (so Windows installer can find it\u0027s files) through Grub commands ( see [http://www.rmprepusb...ls/multipartufd](http://www.rmprepusb.com/tutorials/multipartufd \"External link\") )\n\nPossible?\n\n\u003e Not that it\u0027s impossible or too difficult, but why all the mess?\n\u003e\n\u003e WinSetupFromUSB and Easy2boot can handle just about any mix of sources in a single partition, why would you need to go into way more complicated setup with multiple partitions on a removable drive?\n\nBecause I want to keep the files of different Windows installers from mixing all together: it makes it easier to use folder comparison programs.\n\nBecause I don\u0027t want the files in an ISO. I have to keep recreating an ISO for no particular reason.\n\n\u003e \u003cbr /\u003e\n\u003e\n\u003e When you decide to edit contents of the disk, you\u0027d have to switch visible partition to Windows as well. Of course a filter driver or flipping the removable bit so Windows works with a fixed disk and all partitions is a way around, but again, is it really worth, unless you have something else in mind?\n\nI am already using the driver that shows all the partitions on the flash drive. Why not have this driver? It appears to be superior.\n\nFrom [http://www.winsetupfromusb.com/faq/](http://www.winsetupfromusb.com/faq/ \"External link\")\n\n\"\" 6. Are customized Windows sources supported?\n\nGenerally speaking- yes. Due to the numerous ways to customize XP for example, it\u0027s hard to test every kind of customization, hence severely modified sources may not install properly. In case of NT6 (Vista and above) customized source, as long as updates or hotfixes are integrated into install.wim and using postsetup.cmd script, which seeks for files on the system drive, rather than the source DVD, there should be no issues. \"\"\n\nI have this in setupcomplete.cmd:\n\nFOR %%i IN (C D E F G H I J K L N M O P Q R S T U V W X Y Z) DO IF EXIST %%i:\\\\$oem$\\\\UnattendedOOBE.xml SET DVDRoot\u003d%%i\n\nilko, on 14 Feb 2014, said:[![snapback.png](http://reboot.pro/public/style_images/metro/snapback.png)](http://reboot.pro/index.php?app\u003dforums\u0026module\u003dforums\u0026section\u003dfindpost\u0026pid\u003d182259 \"\")\n\u003e Not a perfect world... :smile:  \n\u003e\n\u003e Manufacturer has some basic guidelines, $OEM$ goes to \\\u003cDVD\\\u003e(USB)\\\\sources\\\\$OEM$. Setup, in PE phase, copies contents to destination drive. First reboot. $OEM$ is not needed and used any more, nor should be other folders/files on the DVD/USB. Custom scripts search their things in the already copied contents of $OEM$ to the destination drive, not on the DVD/USB. Nothing is broken, everyone is happy, there are some rules followed.  \n\u003e\n\u003e Of course, there are sources which are customized in a different way with different needs. One may not want to copy OEM content to the destination drive for some reason, shared OEM folder for several sources, big sized contents, place it elsewhere as in your case and explicitly search for it etc. Can such sources be easily added programatically in a multiboot scenario?  \n\u003e\n\u003e Unfortunately there has to be some trade off, a little user intervention and understanding what is what and how it works, second boot from USB, no multiboot, or some other limitation.\n\nThanks. I changed that part of my install method to copy contents to the drive (via $oem$ folders), and invoke from there, instead of the flash drive. Later I delete what was copied over. Now my custom windows installer is compatible with WinSetupFromUSB, and probably a lot of other multi-boot utilities.\n\nFor now I will live with having to create and copy an ISO every time I make a small change, rather than copying a couple small files over\n\n...or I may go with Rufus for one OS per USB flash drive\n\n...or I may go with Rufus in combination with multiple partitions, LOL.\n\nUpdate: Found out another drawback to using $oem$ folders as opposed to \"FOR %%i IN (C D E F G H I ...\". For mbr multipartitioned drives (destination for the Windows install), the drive letters are different during the first stage and the last stage of the Windows install. \\[primary1\\] \\[primary2\\] \\[primary3\\] \\[extended \\[logical-data\\]\\]\n\nThis is deal breaker, so I am again wanting to multi-partition a flash drive for the different OS installers. Any tips on how to set up Grub, etc?\n\n**Edited by mraeryceos, 19 February 2014 - 11:45 AM.**\n"
    },
    {
      "id": "182338",
      "timestamp": "2014-02-19T14:01:48+00:00",
      "author": "ilko",
      "content": "Put grub4dos MBR, grldr and menu.lst go to the first partition for example.\n\nEach entry in menu.lst uses Steve\u0027s script to change the visible partition to the desired one, root to it and chainload bootmgr in it.\n\nCreate default entry, which swaps HD order and chainloads MBR of the first internal disk. This is for unattended setups, if the second boot happens to be from USB again.\n\nCopy contents of each source to the corresponding partition, there is no need of external tools.\n\nIf you need UEFI support, I am not sure how it would behave, would it ignore the hidden/not first partitions.\n\n\u003e Update: Found out another drawback to using $oem$ folders as opposed to \"FOR %%i IN (C D E F G H I ...\". For mbr multipartitioned drives (destination for the Windows install), the drive letters are different during the first stage and the last stage of the Windows install. \\[primary1\\] \\[primary2\\] \\[primary3\\] \\[extended \\[logical-data\\]\\]\n\nHow does that affect you? Do custom script in PE phase interfere with custom script in last phase, sharing location?\n\nWhy wouldn\u0027t FOR %%i still pick up whatever you need, even though the drive letter has changed?\n\nYou better post all the custom scripts you have.\n\n"
    },
    {
      "id": "182345",
      "timestamp": "2014-02-19T20:18:57+00:00",
      "author": "mraeryceos",
      "content": "There is no custom script in the PE phase. $oem$ folders are copied over in the PE phase. This is standard Windows installer behavior.\n\n\\[primary1\\] \\[primary2\\] \\[primary3\\] \\[extended \\[logical-data\\]\\]\n\nI want to install Windows to partition 2. I \"hide\" partition1, and partition3 doesn\u0027t matter because it is EXT2. Hiding partition1 helps the logical partition be the letter D, when the system is up and running. However, the $oem$ folder \"D\" gets copied to primary2.\n\nI have instead been using FOR %%i instead, and then using an xcopy command to move files to the logical partition. For reasons I do not understand, FOR %%i does not work if the medium is the USB flash drive (unless I\u0027m using RUFUS, which is badass).\n\nnote: I am using the driver that shows all the partitions on the USB flash drive, in the system I use for development, not streamlined into the windows installer. I could streamline the driver, as I think FOR %%i might then work? Although with this driver, if the flash drive is treated as another hard drive (just guessing), I run into drive letter assignment issues (because I need drive D to be the logical partition. see [](http://en.wikipedia.org/wiki/Drive_letter_assignment#Order_of_assignment).%C2) The reason I want to do this, is that the user profiles are moved to the D: drive, via the Windows registry.\n\nI haven\u0027t even started to think what the solution would be for UEFI! Is there a way to make Windows not be stupid, and understand partitions rather than drive letters?\n\n**Edited by mraeryceos, 19 February 2014 - 08:41 PM.**\n"
    },
    {
      "id": "182346",
      "timestamp": "2014-02-20T00:33:17+00:00",
      "author": "ilko",
      "content": "\u003e There is no custom script in the PE phase. $oem$ folders are copied over in the PE phase. This is standard Windows installer behavior.\n\u003e\nSurely this is standard behaviour, no need to mention.\n\nYou say drive letters change during PE and the other phases without explaining why and how that affects you. If there is no custom script during PE phase, why would you care about drive letters in PE phase at all?\n\n\u003e \\[primary1\\] \\[primary2\\] \\[primary3\\] \\[extended \\[logical-data\\]\\]\n\u003e\n\u003e I want to install Windows to partition 2. I \"hide\" partition1, and partition3 doesn\u0027t matter because it is EXT2. Hiding partition1 helps the logical partition be the letter D, when the system is up and running. However, the $oem$ folder \"D\" gets copied to primary2.\n\nThis is weird. Did partition 2 get D letter indeed? Setup log files might give more clues what\u0027s happening.\n\nYou do need to post your custom scripts and $OEM$ folder structure as requested. There might be an error or something you are overlooking. Besides, it\u0027s much easier to look at them and find out what the intentions are, rather than keep asking you questions over and over to get clear picture of what you are doing.\n\n\u003e I have instead been using FOR %%i instead, and then using an xcopy command to move files to the logical partition. For reasons I do not understand, FOR %%i does not work if the medium is the USB flash drive (unless I\u0027m using RUFUS, which is badass).\n\nDitto, post your scripts, unless they are secret ones.\n\nNo clue why Rufus would help with FOR %%i search, posting them might help in clearing things up.\n\n\u003e note: I am using the driver that shows all the partitions on the USB flash drive, in the system I use for development, not streamlined into the windows installer. I could streamline the driver, as I think FOR %%i might then work? Although with this driver, if the flash drive is treated as another hard drive (just guessing), I run into drive letter assignment issues (because I need drive D to be the logical partition. see The reason I want to do this, is that the user profiles are moved to the D: drive, via the Windows registry.\n\nSince the USB stick will have primary partition on a fixed disk, it will get priority over logical partitions when assigning drive letters.  \n\u003e\n\u003e Is there a way to make Windows not be stupid, and understand partitions rather than drive letters?\n\nYou can try [mnt.exe](ftp://ftp.sac.sk/pub/sac/utildisk/unmnt10.zip \"External link\")\n\n```\nUsage: mnt.exe [-u | -z] [\u003cdrive\u003e: [\u003cDevice\u003e]]\nExamples: mnt.exe J: \\Dosdevices\\C:\\DOS\n          mnt.exe K: \\Device\\Harddisk0\\Partition1\n          mnt.exe -u L: (deletes current definition of L:)\n          mnt.exe -z M: (deletes all definitions of M:\n```\n\nYou\u0027d be interested in\n\u003e mnt.exe **K**: \\\\Device\\\\Harddisk**0**\\\\Partition**1**\n\u003e\nand when you finish\n\n\u003e mnt.exe -z M: (deletes all definitions of M:)\n\u003e\n\u003cbr /\u003e\n\n"
    },
    {
      "id": "182347",
      "timestamp": "2014-02-20T00:41:07+00:00",
      "author": "mraeryceos",
      "content": "\u003e Surely this is standard behaviour, no need to mention.\n\u003e\n\u003e You say drive letters change during PE and the other phases without explaining why and how that affects you. If there is no custom script during PE phase, why would you care about drive letters in PE phase at all?\n\nI wrote: \"the $oem$ folder \"D\" gets copied to primary2.\"\n\nSee: [http://unattended.ms...xp/view/web/18/](http://unattended.msfn.org/unattended.xp/view/web/18/ \"External link\") \" drive_letter - Represents the root of a particular volume on the system (e.g., \\\\$OEM$\\\\C represents the C: drive) and contains any files that WinXP Setup should copy to this partition during installation. \"\n\nI haven\u0027t read the rest of your post. Get back to you later.\n\n**Edited by mraeryceos, 20 February 2014 - 12:41 AM.**\n"
    },
    {
      "id": "182348",
      "timestamp": "2014-02-20T02:38:55+00:00",
      "author": "mraeryceos",
      "content": "c:\\\\windows\\\\panther\\\\setupact.log, shows $oem$ folders were copied without issue, to D:\\\\. And since I find the files on partition2, it can only be Windows intended behavior.\n\nI have conflicting motivations. While I want to solve this, I don\u0027t want to make it easier for people to be able to install Windows. I would rather people choose Linux. I\u0027m so tired of Windows crap, like this for example. So anyway, my install method works, but I don\u0027t want to reveal all the scripts. I want to focus on creating a multi-boot environment so that people can choose to boot into Linux as an alternate to Windows, and this I am more than willing to reveal. It would be helpful if I could have all the OS on one flash drive (with files accessible for easy editing -\\\u003e not in an ISO), but I can live without that.\n\nedit: While the installation is happening, during winpe stage, diskpart\u0027s \"list volume\" shows D is assigned to the logical partition! I see my files were copied to the D partition! Oh! The previous time, I created the NTFS partitions with an older partitioning software, and perhaps the NTFS version was not sufficient for Windows Installer to want to use it for anything. The previous time I formatted the C partition with the Windows installer, but may not have reformatted the D partition to the newer NTFS version.\n\n**Edited by mraeryceos, 20 February 2014 - 03:38 AM.**\n"
    },
    {
      "id": "182349",
      "timestamp": "2014-02-20T04:09:55+00:00",
      "author": "mraeryceos",
      "content": "\u003e \u003e I have instead been using FOR %%i instead, and then using an xcopy command to move files to the logical partition. For reasons I do not understand, FOR %%i does not work if the medium is the USB flash drive (unless I\u0027m using RUFUS, which is badass).\n\u003e\n\u003e Ditto, post your scripts, unless they are secret ones.\n\u003e\n\u003e No clue why Rufus would help with FOR %%i search, posting them might help in clearing things up.\n\nMaybe because Rufus doesn\u0027t put the files in an ISO?\n\n"
    },
    {
      "id": "182350",
      "timestamp": "2014-02-20T05:16:26+00:00",
      "author": "ilko",
      "content": "Or because it\u0027s unclear what are you **currently** using and which of your troubles apply to which method used in the past, just scattered thoughts and results, which are quite hard to follow, despite all the willingness to be helped with your issues.\n\n"
    },
    {
      "id": "182351",
      "timestamp": "2014-02-20T05:27:20+00:00",
      "author": "mraeryceos",
      "content": "Sorry I try to explain the best I can, believe it or not. I appreciate your altruism!\n\nMaybe creating an ISO every time isn\u0027t such a bad idea, as I can keep track of my changes for when something goes wrong. I will continue to use WinSetupFromUSB for now.\n\n"
    },
    {
      "id": "182669",
      "timestamp": "2014-03-08T01:32:18+00:00",
      "author": "mraeryceos",
      "content": "Two complaints:\n\nWinSetupFromUSB is really really slow installing XP, compared to Rufus (even though Rufus is on a slower flash drive). I\u0027ve heard complaints in other forums about this.\n\nWinSetupFromUSB uses ISOs, so installers and boot disks can\u0027t reliably access their files needed from the USB drive. For example, Hiren\u0027s Boot CD could not load the custom menu, unless I inserted the Hiren CD simultaneous to the USB flash drive.\n\nSo I would still like to figure out a way to use a multipartitioned USB flash drive as an alternative. Or just use Rufus and buy more flash drives :-/\n\nSo, ilko, if you don\u0027t mind, I would like input from others, since you are not interested in using multiple partitions.\n\n**Edited by mraeryceos, 08 March 2014 - 01:33 AM.**\n"
    },
    {
      "id": "182670",
      "timestamp": "2014-03-08T01:58:20+00:00",
      "author": "ilko",
      "content": "I\u0027d first clear up your misunderstandings and yet again wrong conclusions based mostly on lack of information and for some reason, which is still unclear to me why, negative attitude since the starting point.\n\n\u003e WinSetupFromUSB is really really slow installing XP, compared to Rufus (even though Rufus is on a slower flash drive). I\u0027ve heard complaints in other forums about this.\n\u003e\nIn later versions FAT32 is used by default for UEFI compatibility if option to auto format is used as it is. And XP Setup could be horribly slow when launched that way on FAT32. Ask Microsoft what they had done to the poor FAT32 driver.\n\nSome speed tests:\n\n[http://www.msfn.org/...d-on-usb-stick/](http://www.msfn.org/board/topic/125116-fat16-vs-fat32-vs-ntfs-speed-on-usb-stick/ \"External link\")\n\nFAQ:\n\nwww.winsetupfromusb.com/faq/#faq13\n\nIf XP setup was used with WinSetupFromUSB on FAT32 and Rufus on NTFS, then results will be different for sure. Compare apples with apples.\n\nYour only escape with FAT32 is to install it from grub4dos emulated CD and Firadisk/WinVBlock drivers as Easy2Boot and recent YUMI versions do.\n\n\u003e WinSetupFromUSB uses ISOs, so installers and boot disks can\u0027t reliably access their files needed from the USB drive. For example, Hiren\u0027s Boot CD could not load the custom menu, unless I inserted the Hiren CD simultaneous to the USB flash drive.\n\u003e\nHiren Cd is not supported in any way since it\u0027s warez, the rest is just yet another wrong generalization. Good luck putting contents of multiple ISOs in the same partition with overlapping files and folders...\n\n\u003e So, ilko, if you don\u0027t mind, I would like input from others, since you are not interested in using multiple partitions.\n\u003e\nOthers are not prohibited to write in here, besides, you haven\u0027t yet noticed or simply ignored the ideas already put in post #2 about multiple partitions, ideas which have nothing to do with WinSetupFromUSB...\n\nDuh, seriously, why all the negativism...\n\n"
    },
    {
      "id": "182671",
      "timestamp": "2014-03-08T03:31:39+00:00",
      "author": "mraeryceos",
      "content": "Yes, you have made it clear that you do not want a multi-partitioned USB drive. Thanks for clarifying this, yet again.\n\n"
    },
    {
      "id": "182673",
      "timestamp": "2014-03-08T06:57:17+00:00",
      "author": "Zoso",
      "content": "I miss Wonko! LOL   \n"
    },
    {
      "id": "182681",
      "timestamp": "2014-03-08T11:51:47+00:00",
      "author": "Wonko the Sane",
      "content": "\u003e I miss Wonko! LOL\n\n\u003cbr /\u003e\n\nBut Wonko ***is*** here.  \nOnly he is limiting his contributions to factual statements and highlighting self-evident truths.  \n\n++Factual statements++ :  \nLast time I counted them (and limiting to the tools developed and posted on reboot.pro, 911cd.net and msfn.org) there were ++no less than 5++ fully or mostly automated methods:\n\n* Wimb\u0027s USB_MultiBoot.cmd\n* Ilko\u0027s WinSetupFromUSB (actually two of them a \"legacy\" one and the current one which uses a different approach)\n* Wimb\u0027s U_XP_SET and connected tools\n* Akeo\u0027s Rufus\n* Steve6375\u0027s Easy2boot\n\nALL of them pretty well documented, and ++no less than 5++ complete tutorials or manual methods using flat files, .iso or .img in virtual disks, pre-booting to another OS, etc., etc.:  \n[http://www.msfn.org/...ndows-from-usb/](http://www.msfn.org/board/forum/157-install-windows-from-usb/ \"External link\")  \nto which we may add the nice, though possibly less-known, Galapo\u0027s OfflineSysPrep ![:thumbup:](http://reboot.pro/public/style_emoticons/default/thumbup.gif) approach:   \n[http://www.911cd.net...hp?showforum\u003d43](http://www.911cd.net/forums//index.php?showforum\u003d43 \"External link\")  \nand a number of tools to help in the process, among which I would mention JFX\u0027s Winntsetup:  \n[http://www.msfn.org/...winntsetup-v33/](http://www.msfn.org/board/topic/149612-winntsetup-v33/ \"External link\")  \n\nUnlike the good ol\u0027 times :smile::  \n[http://www.msfn.org/...l-from-usb-key/](http://www.msfn.org/board/topic/61384-how-to-bootinstall-from-usb-key/ \"External link\")  \nthere are now lot of choices, an incredible amount of related knowledge/info on the matter, and most if not all of these are public.  \n\n++Self-evident truths++ :  \nAll the mentioned (and non-mentioned) developers and contributors, while belonging mainly to the \"evil\" windows world, disclosed all (or the most relevant parts) of their methods/tools publicly, discussed them, adapted them interactively with final users and other contributors, all with the scope of making it easier to install Windows from USB or more generally explore new, strange ways to deal with the final scope which is ***\"making Windows install from USB or other media easier or more convenient\"*** .  \n\nSet aside the evident *whining* ![:ph34r:](http://reboot.pro/public/style_emoticons/default/scared9.gif), it is \"queer\" that someone belonging to the \"good\" Linux world would actually make this statement, and in any case the scope seems very different:  \n\u003e While I want to solve this, **I ++don\u0027t want to make it easier++ for people to be able to install Windows** . I would rather people choose Linux. I\u0027m so tired of Windows crap, like this for example. So anyway, my install method works, **but ++I don\u0027t want to reveal++all the scripts**. I want to focus on creating a multi-boot environment so that people can choose to boot into Linux as an alternate to Windows, and this I am more than willing to reveal.\n\n\u003cbr /\u003e\n\n\u003cbr /\u003e\n\n![:duff:](http://reboot.pro/public/style_emoticons/default/duff.gif)  \n\nWonko\n\n"
    },
    {
      "id": "182685",
      "timestamp": "2014-03-08T17:23:35+00:00",
      "author": "mraeryceos",
      "content": "It\u0027s true I DON\u0027T WANT TO REVEAL ALL THE SCRIPTS. I DON\u0027T WANT TO MAKE WINDOWS EASIER TO INSTALL. Ok, now we got that out of the way. I am free to talk about Windows XP. China, and the rest of the world, is having trouble with 7, not XP.\n\nThis morning, I tried to re-install XP on my HP DV8000 CTO laptop (last time I used a Macbook Pro, circa late 2006, and Rufus did fine). This time, Windows Setup via Rufus couldn\u0027t find itself on the USB drive (I used the same OS I sent you, Akeo), as in, Windows Setup asked for the CD, because it said that I was using the upgrade version. I then tried WinSetupFromUSB, and proceeded with the installation, but got a black screen on reboot. I reformatted the partition, and tried again with a CD, but got the same black screen.\n\nI forgot to back up the MBR, but fortunately, Boot Doctor (from Gparted on Hiren) was able to recover the MBR after I pointed it to the Crunchbang partition.\n\nXP is nlited, and has most of the driverpacks. Wait... I remember adding some files. Maybe that threw off the Rufus install. The root of the XP Setup now has:\n\nWIN51  \nWIN51IP  \nWIN51IP.SP1  \nWIN51IP.SP2  \nWIN51IP.SP3  \nWIN51IS.SP1  \nWINXP.PRO\n\nI thought more was better. I am not home now. I will try again removing the extra \"marker\" files I added.\n\nHowever, I don\u0027t think this has anything to do with the black screen I got from the CD and WinSetupFromUSB, though I could be wrong. Oh... I also used the SP3 kernel on SP2 source. This works if I switch the kernel on an already installed system, but maybe the installer doesn\u0027t like it. I will check when I get home.\n\n...I need some plain method to work, before I consider trying multiple partitions.\n\n**Edited by mraeryceos, 08 March 2014 - 05:36 PM.**\n"
    },
    {
      "id": "182694",
      "timestamp": "2014-03-09T04:07:48+00:00",
      "author": "Zoso",
      "content": "\u003e But Wonko ***is*** here.  \n\u003e\n\u003e ![:duff:](http://reboot.pro/public/style_emoticons/default/duff.gif)  \n\u003e\n\u003e Wonko\nHey Wonko! I thought you quit.. glad thats not the case. I was reading this thread (that is apparently a continuation from somewhere) and Ilko\u0027s posts started to remind me of a certain sane one! LOL somebodies gotta keep things straight around here.. actualy, Ilko is doing a pretty good job with it here.  \n\nbut dont limit yourself too much Wonko because that tends to limit me and all the others including the lurkers who learn so much from you here.  \n\n\u003cbr /\u003e\n\nmraeryceos, sorry to intrude on your thread like this. hope you get it worked out. if so I hope you will reconsider and Care to Share.   \n"
    }
  ]
}