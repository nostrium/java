{
  "id": "21421",
  "title": "how to grub2 efi savedefault?",
  "isPinned": false,
  "isFirstTopic": false,
  "isLocked": false,
  "tags": [],
  "forumNotes": [
    {
      "id": "202345",
      "timestamp": "2017-02-19T11:40:52+00:00",
      "author": "ndog37",
      "content": "It seems grub2.efi for a boot manager is not popular on reboot.pro forums, and I\u0027m having problems getting what should be a simple question answered. I don\u0027t have linux installed and am booting various other stuff, using grub2 efi, since it works well and boots all the stuffs.\n\nWith grub4dos it is easy you simply need a few files on the root partition so you can remember the last booted item and boot from it eg\n\ngrldr\n\nmenu.lst\n\ndefault\n\nmenu.lst\n\n```\ntimeout 3\ndefault /default\n\ntitle Boot - XP-1.vhd (7GB)\nsavedefault\nhide (hd0,0)\nhide (hd0,1)\nfind --set-root --ignore-floppies /XP-1.vhd\nmap /XP-1.vhd (hd0)\nmap --hook\nroot (hd0,0)\nchainloader /ntldr\n\ntitle Boot - OSX\nsavedefault\nhide (hd0,1)\nunhide (hd0,0)\nparttype (hd0,0) 0xAF\nrootnoverify (hd0,0)\nmakeactive\nchainloader --force +1\n\ntitle Boot - NT6\nsavedefault\nhide (hd0,0)\nunhide (hd0,1)\nparttype (hd0,1) 0x07\nrootnoverify (hd0,1)\nmakeactive\nchainloader /bootmgr\n```\n\nWhich seems fairly simple and straight forward, however with grub2 efi it seems that everyone has in their mind you have to recompile and rebuild it everytime under your linux OS, however I do not have a linux OS or desire having one, I simple want to modify the text file grub.cfg and have an option to savedefault\n\nthis is my current grub.cfg which is working great with only the 3 files required but I want to be able to boot the last booted option everytime\n\n/EFI/Boot/BOOTX64.efi\n\n/EFI/Boot/grubx64.efi\n\n/EFI/Boot/grub.cfg\n\n```\nset default\u003d\"0\"\n\nfunction load_video {\n  insmod efi_gop\n  insmod efi_uga\n  insmod video_bochs\n  insmod video_cirrus\n  insmod all_video\n}\n\nload_video\nset gfxpayload\u003dkeep\n\ninsmod gzio\ninsmod part_gpt\n\nset timeout\u003d4\n\n\nmenuentry \"Windows 7 UEFI\" {\ninsmod chain\nsearch --file --no-floppy --set\u003droot /efi/Microsoft/win7/bootmgfw.efi\nchainloader (${root})/efi/Microsoft/win7/bootmgfw.efi\n}\n\nmenuentry \"OSX Clover\" {\n# Clover insists that bootx64.efi sits in /efi/boot and looks for /efi/clover/cloverx64.efi\ninsmod chain\nsearch --file --no-floppy --set\u003droot /efi/Boot/BOOTX64.clover.efi\nchainloader (${root})/efi/Boot/BOOTX64.clover.efi\n}\n\n# clonezilla live partition\n#search --file --set\u003dCLZDRV --no-floppy /clonezilla/live/vmlinuz\n#echo $(CLZDRV) # will show hd0,gpt1 - not useful for clonezilla\n# hint: cat /proc/cmdline - check clonezilla parameters\n# hint: user:user pass:live\n\nmenuentry \u0027Clonezilla Restore\u0027 --class gnu-linux --class gnu --class os {\nset CLZDRV\u003dsda1\nset CLZDIR\u003d/clonezilla/live\nset BUPDRV\u003dsda2\nset BUPDIR\u003d/clonezilla/images\nset BOPT\u003d\"boot\u003dlive quiet union\u003doverlay keyboard-layouts\u003dNONE locales\u003den_US.UTF-8\"\nset RUN\u003d\"ocs_live_run\u003d\\\"ocs-live-general\\\" live-media-path\u003d$CLZDIR bootfrom\u003d/dev/$CLZDRV toram\u003dfilesystem.squashfs ocs_live_batch\u003dyes\"\nset PRERUN\u003d\"ocs_prerun\u003d\\\"mount /dev/$BUPDRV /mnt\\\" ocs_prerun1\u003d\\\"mount --bind /mnt/$BUPDIR /home/partimag/\\\"\"\nset RUN1\u003d\"ocs_live_run\u003d\\\"ocs-sr --batch -scr -t -k -p reboot restoreparts ask_user ask_user\\\"\"\nlinuxefi /clonezilla/live/vmlinuz $BOPT $RUN $PRERUN $RUN1\ninitrdefi /clonezilla/live/initrd.img\n}\n\nmenuentry \u0027Clonezilla Create\u0027 --class gnu-linux --class gnu --class os {\nset CLZDRV\u003dsda1\nset CLZDIR\u003d/clonezilla/live\nset BUPDRV\u003dsda2\nset BUPDIR\u003d/clonezilla/images\nset BOPT\u003d\"boot\u003dlive union\u003doverlay keyboard-layouts\u003dNONE locales\u003den_US.UTF-8\"\nset RUN\u003d\"ocs_live_run\u003d\\\"ocs-live-general\\\" live-media-path\u003d$CLZDIR bootfrom\u003d/dev/$CLZDRV toram\u003dfilesystem.squashfs ocs_live_batch\u003dyes\"\nset PRERUN\u003d\"ocs_prerun\u003d\\\"mount /dev/$BUPDRV /mnt\\\" ocs_prerun1\u003d\\\"mount --bind /mnt/$BUPDIR /home/partimag/\\\"\"\nset RUN1\u003d\"ocs_live_run\u003d\\\"ocs-sr --batch -q -nogui -z2p -i 2048 -fsck -scs -senc -rm-win-swap-hib -p choose saveparts ask_user ask_user\\\"\"\nlinuxefi /clonezilla/live/vmlinuz $BOPT $RUN $PRERUN $RUN1\ninitrdefi /clonezilla/live/initrd.img\n}\n\nmenuentry \u0027Wimboot test\u0027 {\ninsmod chain\nsearch --file --set\u003droot --no-floppy /wimboot/bootmgr\nset cmdline\u003d\"initrdfile\u003d/wimboot/bootmgr,/wimboot/BCD,/wimboot/boot.sdi,/wimboot/snip/boot.wim pause\"\nchainloader (${root})/wimboot/wimboot $cmdline\n}\n\n### http://forum.ipxe.org/showthread.php?tid\u003d8112\n### http://forum.ipxe.org/showthread.php?tid\u003d8193\u0026pid\u003d13354#pid13354\nmenuentry \"iPXE\"{\n  search --no-floppy --set\u003droot -f /clonezilla/live/ipxe.efi\n  chainloader (${root})/clonezilla/live/ipxe.efi + 1\n}\n```\n\nAnyway I have tried searching and googling, and trying a few different things, it seems all the searches involve recompiling grub in ubuntu which I obviously do not have. Hopefully someone knows a quick and easy way to make this happen. Fingers crossed.\n\nEg\n\nwhich file to save where\n\nthe command under grub2 to load the default\n\nthe command under grub2 to save the default\n\nand a working example would be awesome\n\n"
    },
    {
      "id": "202348",
      "timestamp": "2017-02-19T13:28:25+00:00",
      "author": "Wonko the Sane",
      "content": "You won\u0027t probably like this answer. (provided that it classifies as an answer) ![:dubbio:](http://reboot.pro/public/style_emoticons/default/dubbio.gif)\n\nCheck:  \n[https://www.gnu.org/...vironment-block](https://www.gnu.org/software/grub/manual/grub.html#Environment-block \"External link\")\n\n[https://www.gnu.org/...ml#load_005fenv](https://www.gnu.org/software/grub/manual/grub.html#load_005fenv \"External link\")\n\n[https://www.gnu.org/...ml#save_005fenv](https://www.gnu.org/software/grub/manual/grub.html#save_005fenv \"External link\")\n\n[https://www.gnu.org/...e-configuration](https://www.gnu.org/software/grub/manual/grub.html#Simple-configuration \"External link\")\n\nThe file is (should be) by default /boot/grub/grubenv, it is clear that to use it you need the command:  \nset default\u003d\"saved\"\n\nthen you need in each entry a:\n\nsavedefault\n\ncommand.\n\nOr maybe save_env? ![:unsure:](http://reboot.pro/public/style_emoticons/default/unsure.png)\\*like\\*:\n\n```\n\n\" saved_entry\u003d${chosen}\nsave_env saved_entry \"\n```\n\n(it seems that savedefault is not among the \"official\" commands) ![:dubbio:](http://reboot.pro/public/style_emoticons/default/dubbio.gif)\n\nSee this:\n\n[https://ubuntuforums...d.php?t\u003d1417361](https://ubuntuforums.org/showthread.php?t\u003d1417361 \"External link\")\n\n![:duff:](http://reboot.pro/public/style_emoticons/default/duff.gif)\n\nWonko\n\n"
    },
    {
      "id": "202350",
      "timestamp": "2017-02-19T14:36:40+00:00",
      "author": "steve6375",
      "content": "Place the 1024 byte file **grubenv**on \\\\boot\\\\grub\n\nuse\n\nsave_env fred\n\nto save the current value of fred\n\nuse load_env to load all variables from it (e.g. at beginning of code)\n\nload_env fred will load fred\n\nlist_env will list all variables in the file\n\nif you use\n\n```\nset fred\u003dhello\nunset fred\nsave_env fred\nload_env fred\n```\n\nthen the variable fred will exist but be empty \u003d \"\" !!\n\n**Edited by steve6375, 19 February 2017 - 04:26 PM.**\n"
    },
    {
      "id": "202357",
      "timestamp": "2017-02-20T08:34:41+00:00",
      "author": "ndog37",
      "content": "Thanks wonko and steve6375\n\ngot it working :smile:\n\nand simply you can use $1 as the option to save\n\n/EFI/Boot/grubx64.efi\n\n/EFI/Boot/BOOTX64.EFI\n\n/EFI/Boot/grubenv - 1024 bytes\n\n/EFI/Boot/grub.cfg\n\n```\nload_env default\n\nfunction load_video {\n  insmod efi_gop\n  insmod efi_uga\n  insmod video_bochs\n  insmod video_cirrus\n  insmod all_video\n}\n\nload_video\nset gfxpayload\u003dkeep\ninsmod gzio\ninsmod part_gpt\n\nset timeout\u003d15\n\n\nmenuentry \"Windows\" {\nset default\u003d$1\nsave_env default\ninsmod chain\nset root\u003d\u0027(hd0,gpt1)\u0027\nchainloader /EFI/Microsoft/Boot/bootmgfw.efi\n}\n\n# clonezilla live partition\n#search --file --set\u003dCLZDRV --no-floppy /clonezilla/live/vmlinuz\n#echo $(CLZDRV) # will show hd0,gpt1 - not useful for clonezilla\n# hint: cat /proc/cmdline - check clonezilla parameters\n# hint: user:user pass:live\nmenuentry \u0027Clonezilla Restore\u0027 --class gnu-linux --class gnu --class os {\nset default\u003d$1\nsave_env default\nset CLZDRV\u003dsda1\nset CLZDIR\u003d/clonezilla/live\nset BUPDRV\u003dsda2\nset BUPDIR\u003d/clonezilla/images\nset BOPT\u003d\"boot\u003dlive quiet union\u003doverlay keyboard-layouts\u003dNONE locales\u003den_US.UTF-8\"\nset RUN\u003d\"ocs_live_run\u003d\\\"ocs-live-general\\\" live-media-path\u003d$CLZDIR bootfrom\u003d/dev/$CLZDRV toram\u003dfilesystem.squashfs ocs_live_batch\u003dyes\"\nset PRERUN\u003d\"ocs_prerun\u003d\\\"mount /dev/$BUPDRV /mnt\\\" ocs_prerun1\u003d\\\"mount --bind /mnt/$BUPDIR /home/partimag/\\\"\"\nset RUN1\u003d\"ocs_live_run\u003d\\\"ocs-sr --batch -scr -t -k -p reboot restoreparts ask_user ask_user\\\"\"\nlinuxefi /clonezilla/live/vmlinuz $BOPT $RUN $PRERUN $RUN1\ninitrdefi /clonezilla/live/initrd.img\n}\nmenuentry \u0027Clonezilla Create\u0027 --class gnu-linux --class gnu --class os {\nset default\u003d$1\nsave_env default\nset CLZDRV\u003dsda1\nset CLZDIR\u003d/clonezilla/live\nset BUPDRV\u003dsda2\nset BUPDIR\u003d/clonezilla/images\nset BOPT\u003d\"boot\u003dlive union\u003doverlay keyboard-layouts\u003dNONE locales\u003den_US.UTF-8\"\nset RUN\u003d\"ocs_live_run\u003d\\\"ocs-live-general\\\" live-media-path\u003d$CLZDIR bootfrom\u003d/dev/$CLZDRV toram\u003dfilesystem.squashfs ocs_live_batch\u003dyes\"\nset PRERUN\u003d\"ocs_prerun\u003d\\\"mount /dev/$BUPDRV /mnt\\\" ocs_prerun1\u003d\\\"mount --bind /mnt/$BUPDIR /home/partimag/\\\"\"\nset RUN1\u003d\"ocs_live_run\u003d\\\"ocs-sr --batch -q -nogui -z2p -i 2048 -fsck -scs -senc -rm-win-swap-hib -p choose saveparts ask_user ask_user\\\"\"\nlinuxefi /clonezilla/live/vmlinuz $BOPT $RUN $PRERUN $RUN1\ninitrdefi /clonezilla/live/initrd.img\n}\n\n### http://forum.ipxe.org/showthread.php?tid\u003d8112\n### http://forum.ipxe.org/showthread.php?tid\u003d8193\u0026pid\u003d13354#pid13354\nmenuentry \"iPXE\"{\nset default\u003d$1\nsave_env default\n  search --no-floppy --set\u003droot -f /clonezilla/live/ipxe.efi\n  chainloader (${root})/clonezilla/live/ipxe.efi + 1\n}\n\nmenuentry \u0027UBT-small.vhd\u0027 --class  ubuntu {\nset default\u003d$1\nsave_env default\ninsmod gzio\ninsmod part_msdos\ninsmod part_gpt\ninsmod ext2\ninsmod ntfs\ninsmod probe\nset vhdfile\u003d\"/ubt/UBT-small.vhd\"\nset root\u003d(hd0,gpt2)\nprobe -u --set\u003duuid $root\nloopback loop0 $vhdfile\nlinux (loop0,1)/vmlinuz root\u003dUUID\u003d$uuid rw kloop\u003d$vhdfile kroot\u003d/dev/mapper/loop0p1\ninitrd (loop0,1)/initrd.img\n}\n\n```\n\n\u003cbr /\u003e\n\n"
    },
    {
      "id": "202363",
      "timestamp": "2017-02-20T21:41:19+00:00",
      "author": "steve6375",
      "content": "If it helps, I have written up some notes and links [here](http://www.rmprepusb.com/tutorials/grub2_tutorial137 \"External link\") about grub2.\n\n"
    },
    {
      "id": "202370",
      "timestamp": "2017-02-21T09:03:06+00:00",
      "author": "ndog37",
      "content": "Thanks Steve\n\nIts great to be able to use grub2 as a boot loader without linux installed and I still have yet to harness the full power of it. I wanted to use rEFInd instead, however there is no support for this product, and the forums are dead. at the moment I can\u0027t get clonezilla to load from it or wimboot, so I am stuck with grub2, which just works, but not as graphically fancy, or as nice installing on a macbook\n\n"
    }
  ]
}