{
  "id": "3593",
  "title": "NEW, experimental NTBOOTDD.SYS for USB booting",
  "isPinned": false,
  "isFirstTopic": false,
  "isLocked": false,
  "tags": [],
  "forumNotes": [
    {
      "id": "25941",
      "timestamp": "2007-12-06T19:57:02+00:00",
      "author": "was_jaclaz",
      "content": "User **FreddyV** down at 911CD is trying to write a USB device driver to be able to USB boot on motherboards that have no or defective USB booting support.  \n\nThe project is of course at it\u0027s beginning, but this is when anyone can help the most. ![:cheers:](http://reboot.pro/public/style_emoticons/default/cheers.gif)  \n\nPlease check this:  \n[http://www.911cd.net...showtopic\u003d20450](http://www.911cd.net/forums//index.php?showtopic\u003d20450 \"External link\")  \nSpecific post:  \n[http://www.911cd.net...o...20450\\\u0026st\u003d58](http://www.911cd.net/forums//index.php?showtopic\u003d20450\u0026st\u003d58 \"External link\")  \n\nAnd if you have the possibility to test and report, please do so.  \n\n![:cheers:](http://reboot.pro/public/style_emoticons/default/cheers.gif)  \n\njaclaz   \n"
    },
    {
      "id": "25960",
      "timestamp": "2007-12-07T10:20:17+00:00",
      "author": "ktp",
      "content": "Following are my reports:  \n\nContent of my bootable diskette:  \n\n```\na\u0026#58;\\ntldr\n\na\u0026#58;\\ntdectect.com\n\na\u0026#58;\\ntbootdd.sys\n\na\u0026#58;\\boot.ini\n```\n\n\u003cbr /\u003e\n\nContent of boot.ini  \n\n```\n\u0026#91;boot loader\u0026#93;\n\ntimeout\u003d-1\n\ndefault\u003dscsi\u0026#40;1\u0026#41;disk\u0026#40;0\u0026#41;rdisk\u0026#40;0\u0026#41;partition\u0026#40;1\u0026#41;\\windows\n\n\u0026#91;operating systems\u0026#93;\n\nscsi\u0026#40;1\u0026#41;disk\u0026#40;0\u0026#41;rdisk\u0026#40;0\u0026#41;partition\u0026#40;1\u0026#41;\\windows\u003d\u0026#34;ntbootdd.sys scsi 1\u0026#34;\n\nscsi\u0026#40;2\u0026#41;disk\u0026#40;0\u0026#41;rdisk\u0026#40;0\u0026#41;partition\u0026#40;1\u0026#41;\\windows\u003d\u0026#34;ntbootdd.sys scsi 2\u0026#34;\n\nscsi\u0026#40;3\u0026#41;disk\u0026#40;0\u0026#41;rdisk\u0026#40;0\u0026#41;partition\u0026#40;1\u0026#41;\\windows\u003d\u0026#34;ntbootdd.sys scsi 3\u0026#34;\n```\n\n\u003cbr /\u003e\n\nTo make bootable CD from the diskette image I used UltraISO.  \n\nI did some experimentations with VMware and real machine:  \n- VMware XP with NO USB controller present  \nvmware_xp_no_usb_ntbootdd.jpg  \n- VMware XP WITH USB controller present  \nvmware_xp_with_usb_ntbootdd.jpg  \n- VMWare Vista WITH USB controller present  \nvmware_vista_with_usb_ntbootdd.jpg  \n- Real machine (Phoenix Bios), no USB disabled. This machine is capable of USB booting, and has 4 built-in USB2 ports.  \nlaptop_l1_with_usb_ntbootdd.jpg  \n- Real machine (Insyde Bios), no USB disabled. This machine is capable of USB booting, and has 5 built-in USB2 ports.  \nlaptop_l2_with_usb_ntbootdd.jpg  \n\nMaybe specialists need to look at VMware capability (at least with latest version 6.xx).  \nIt detects on the fly my USB keys/HDD plugged inside the virtual machine.  \nUsing VMware maybe useful for testing function like ntbootdd.sys ?  \n\n\u003cbr /\u003e\n\nThat\u0027s all folks! :-)  \n\n#### Attached Thumbnails {#attach_wrap}\n\n* [![vmware_xp_no_usb_ntbootdd.jpg](http://reboot.pro/uploads/monthly_12_2007/post-3365-1197022669_thumb.jpg)](http://reboot.pro/uploads/monthly_12_2007/post-3365-1197022669.jpg \"vmware_xp_no_usb_ntbootdd.jpg - Size: 58.01KB\"){#ipb-attach-url-3822-0-19379100-1676066753}\n* [![vmware_xp_with_usb_ntbootdd.jpg](http://reboot.pro/uploads/monthly_12_2007/post-3365-1197022679_thumb.jpg)](http://reboot.pro/uploads/monthly_12_2007/post-3365-1197022679.jpg \"vmware_xp_with_usb_ntbootdd.jpg - Size: 59.72KB\"){#ipb-attach-url-3823-0-19395300-1676066753}\n* [![vmware_vista_with_usb_ntbootdd.jpg](http://reboot.pro/uploads/monthly_12_2007/post-3365-1197022688_thumb.jpg)](http://reboot.pro/uploads/monthly_12_2007/post-3365-1197022688.jpg \"vmware_vista_with_usb_ntbootdd.jpg - Size: 71.08KB\"){#ipb-attach-url-3824-0-19402200-1676066753}\n* [![laptop_l1_with_usb_ntbootdd.jpg](http://reboot.pro/uploads/monthly_12_2007/post-3365-1197022746_thumb.jpg)](http://reboot.pro/uploads/monthly_12_2007/post-3365-1197022746.jpg \"laptop_l1_with_usb_ntbootdd.jpg - Size: 160.36KB\"){#ipb-attach-url-3825-0-19407800-1676066753}\n* [![laptop_l2_with_usb_ntbootdd.jpg](http://reboot.pro/uploads/monthly_12_2007/post-3365-1197022755_thumb.jpg)](http://reboot.pro/uploads/monthly_12_2007/post-3365-1197022755.jpg \"laptop_l2_with_usb_ntbootdd.jpg - Size: 89.21KB\"){#ipb-attach-url-3826-0-19412600-1676066753}\n\n"
    },
    {
      "id": "25964",
      "timestamp": "2007-12-07T11:39:38+00:00",
      "author": "Brito",
      "content": "Excellent! ![:cheers:](http://reboot.pro/public/style_emoticons/default/cheers.gif)  \n\nDon\u0027t have a machine to try out but I might find some \"oldies\" back at work on monday.  \n\nThis means we can also use a CD with a floppy image emulation and call back to boot from USB? ![:cheers:](http://reboot.pro/public/style_emoticons/default/cheers.gif)  \n\nThis is a promissing work! ![:cheers:](http://reboot.pro/public/style_emoticons/default/cheers.gif)   \n"
    },
    {
      "id": "25983",
      "timestamp": "2007-12-08T10:47:29+00:00",
      "author": "Alexei",
      "content": "The idea FreddyV is implementing is very interesting (though I remember discussing ntbootdd option with jaclaz a while ago).  \nHowever, \"talk is cheap\" ![:cheers:](http://reboot.pro/public/style_emoticons/default/cheers.gif)  \nAnyway, I think FreddyV was hoping to make it fast any easy and, actually, combined two different tasks:  \n- implement universal standalone (i.e. OS independent) USB support  \n- make ntbootdd that would use it.  \nIf I were him, I would make *working* USB support in DOS and test it on verious PCs, having laxury of printing and runtime debugging.  \nThen I would port it to 32bit and make sure it\u0027s still working.  \nOnly after that I would make ntbootdd out of it to deal only with specific Win issues.  \n\nHowever, he might be able to overcome it all together. Good luck to him ![:cheers:](http://reboot.pro/public/style_emoticons/default/cheers.gif)  \n![:cheers:](http://reboot.pro/public/style_emoticons/default/cheers.gif)   \nAlexei   \n"
    },
    {
      "id": "25985",
      "timestamp": "2007-12-08T11:43:11+00:00",
      "author": "was_jaclaz",
      "content": "I see it also as a practical multiboot solution.  \n\nRight now, USB support is in BIOS (on most USB compatible machines), some need to change boot order in BIOS ***before*** booting from a stick, some have a F12 or similar option to change boot order on-the-fly.  \n\nIn both cases you need to ***remember*** enabling the boot option (unless you have set it \"by default\" in BIOS, not really advisable for security reasons).   \n\nBy using this driver (when hopefully it will be \"mature\" ![:cheers:](http://reboot.pro/public/style_emoticons/default/cheers.gif)) you shift the boot device selection to the BOOT.INI choices, i.e. at the time when you normally make your decision on a multiboot system, and most probably you might be able to use the \"signature\" syntax so that only a certain stick will be able to boot from USB, a small but useful precaution for the same security reasons. ![:cheers:](http://reboot.pro/public/style_emoticons/default/cheers.gif)  \n\njaclaz   \n"
    },
    {
      "id": "25992",
      "timestamp": "2007-12-08T14:12:38+00:00",
      "author": "Alexei",
      "content": "\u003e I see it also as a practical multiboot solution.  \n\u003e\n\u003e Right now, USB support is in BIOS (on most USB compatible machines), some need to change boot order in BIOS ***before*** booting from a stick, some have a F12 or similar option to change boot order on-the-fly.  \n\u003e\n\u003e In both cases you need to ***remember*** enabling the boot option (unless you have set it \"by default\" in BIOS, not really advisable for security reasons).   \n\u003e\n\u003e By using this driver (when hopefully it will be \"mature\" ![:cheers:](http://reboot.pro/public/style_emoticons/default/cheers.gif)) you shift the boot device selection to the BOOT.INI choices, i.e. at the time when you normally make your decision on a multiboot system, and most probably you might be able to use the \"signature\" syntax so that only a certain stick will be able to boot from USB, a small but useful precaution for the same security reasons. ![:cheers:](http://reboot.pro/public/style_emoticons/default/cheers.gif)  \n\u003e\n\u003e jaclaz\nI don\u0027t think it would work this way ![:cheers:](http://reboot.pro/public/style_emoticons/default/cheers.gif) As I understand, you meant booting from HDD, but using NTBOOTDD from the stick (if you place your NTBOOTDD on HDD it will be used for all bootings). However, you can probably do it by \"switching\" boot to stick\u0027s boot record, same way as booting DOS (or something similar).  \nHowever, anyway, it would be a problem with booting speed, without USB 2.0 EHCI it\u0027s gonna be terribly slow ![:cheers:](http://reboot.pro/public/style_emoticons/default/cheers.gif)   \nI would say, CD+USB boot is much more preferable, especially, if you boot small compressed NTFS ram-disk hard linked to the stick.  \n\nBTW, is there any chance to make something like \"Compressed NTFS CD hardlinked to the USB stick\"??? ![:cheers:](http://reboot.pro/public/style_emoticons/default/cheers.gif)  \n\n![:cheers:](http://reboot.pro/public/style_emoticons/default/cheers.gif)   \nAlexei   \n"
    },
    {
      "id": "25993",
      "timestamp": "2007-12-08T14:58:35+00:00",
      "author": "was_jaclaz",
      "content": "@Alexei  \nNo, AFAIK, NTBOOTDD.SYS is used ***only*** if \"scsi\" or \"signature\" syntax is used, never for \"multi\" one.  \n\nReference:  \n[http://support.micro...b;en-us;q102873](http://support.microsoft.com/default.aspx?scid\u003dkb;en-us;q102873 \"External link\")  \n\u003e Using SCSI() notation indicates that Windows NT will load a boot device driver and use that driver to access the boot partition.   \n\u003e\n\u003e On an x86-based computer, the device driver used is NTBOOTDD.SYS, which can be found in the root of the system drive (generally of drive C) and is a copy of the device driver for the drive controller in use.\n\n[http://support.micro...kb/227704/en-us](http://support.microsoft.com/kb/227704/en-us \"External link\")  \n\u003e The signature() syntax is equivalent to the scsi() syntax, but is used instead to support the Plug and Play architecture in Windows. Because Windows is a Plug and Play operating system, the SCSI controller number instance may vary each time you start Windows, especially if you add new SCSI controller hardware after Setup is finished.   \n\u003e\n\u003e Using the signature() syntax instructs Ntldr to locate the drive whose disk signature matches the value in the parentheses, no matter which SCSI controller number the drive is connected to.\n\njaclaz   \n"
    },
    {
      "id": "25996",
      "timestamp": "2007-12-08T16:33:54+00:00",
      "author": "Alexei",
      "content": "\u003e @Alexei  \n\u003e No, AFAIK, NTBOOTDD.SYS is used ***only*** if \"scsi\" or \"signature\" syntax is used, never for \"multi\" one.  \n\u003e\n\u003e Reference:  \n\u003e [http://support.micro...b;en-us;q102873](http://support.microsoft.com/default.aspx?scid\u003dkb;en-us;q102873 \"External link\")  \n\u003e\n\u003e \u003cbr /\u003e\n\u003e\n\u003e [http://support.micro...kb/227704/en-us](http://support.microsoft.com/kb/227704/en-us \"External link\")  \n\u003e\n\u003e \u003cbr /\u003e\n\u003e\n\u003e jaclaz\nIt seems, you\u0027re right. BTW, it\u0027s latest, November 1, 2006 version of this article.   \nI studied those issues 2-3 years ago, and as I remember, those details were not present.  \nBTW, do you know how signature syntax corresponds to signature bytes in the MBR?. An example would be nice ![:cheers:](http://reboot.pro/public/style_emoticons/default/cheers.gif)  \n![:cheers:](http://reboot.pro/public/style_emoticons/default/cheers.gif)   \nAlexei  \nPS  \nCan\u0027t \"regular\" USB driver (usbstor?) be used as NTBOOTDD and why?   \n"
    },
    {
      "id": "26001",
      "timestamp": "2007-12-08T19:07:03+00:00",
      "author": "was_jaclaz",
      "content": "\u003e It seems, you\u0027re right.\n\nYou actually ***doubted*** it? ![:cheers:](http://reboot.pro/public/style_emoticons/default/cheers.gif)  \n\n![:cheers:](http://reboot.pro/public/style_emoticons/default/cheers.gif)  \n\nCannot say if the info was already there in the past, but I can guarantee that that info is correct at least dating back to NT 4.00.  \n\n\u003e BTW, do you know how signature syntax corresponds to signature bytes in the MBR?. An example would be nice\n\nYep, sure, read here (same info is also used for \\\\DosDevices Registry key):  \nPosts:  \n[http://www.911cd.net...o...181\\\u0026st\u003d1891](http://www.911cd.net/forums//index.php?showtopic\u003d14181\u0026st\u003d1891 \"External link\")  \nup to here:  \n[http://www.911cd.net...o...181\\\u0026st\u003d1896](http://www.911cd.net/forums//index.php?showtopic\u003d14181\u0026st\u003d1896 \"External link\")  \n\n[http://www.911cd.net...o...4181\\\u0026st\u003d594](http://www.911cd.net/forums//index.php?showtopic\u003d14181\u0026st\u003d594 \"External link\")  \nup to here:  \n[http://www.911cd.net...o...4181\\\u0026st\u003d637](http://www.911cd.net/forums//index.php?showtopic\u003d14181\u0026st\u003d637 \"External link\")  \n\n\u003cbr /\u003e\n\nEntire threads:  \n[http://www.911cd.net...showtopic\u003d20094](http://www.911cd.net/forums//index.php?showtopic\u003d20094 \"External link\")  \n[http://www.911cd.net...showtopic\u003d19663](http://www.911cd.net/forums//index.php?showtopic\u003d19663 \"External link\")  \n\nThese might interest you as well:  \n[http://www.911cd.net...showtopic\u003d13612](http://www.911cd.net/forums//index.php?showtopic\u003d13612 \"External link\")  \n[http://www.911cd.net...o...181\\\u0026st\u003d2045](http://www.911cd.net/forums//index.php?showtopic\u003d14181\u0026st\u003d2045 \"External link\")  \n\n\u003e Can\u0027t \"regular\" USB driver (usbstor?) be used as NTBOOTDD and why?\nNo, if you read \"around\" the linked posts in the HUGE XP from USB thread:  \n[http://www.911cd.net...showtopic\u003d14181](http://www.911cd.net/forums//index.php?showtopic\u003d14181 \"External link\")  \nyou\u0027ll see Dietmar\u0027s experiences with this approach (unfortunately ended in failure ![:cheers:](http://reboot.pro/public/style_emoticons/default/cheers.gif))  \n\nBasically, NTBOOTDD.SYS needs to be a \"monolithic\" driver, whilst the USB driver**(s)** are several files:  \nUSBSTOR.SYS  \nand  \nUSBHUB.SYS  \nand/or  \nUSBHUB20.SYS  \nand either of:  \nUSBEHCI.SYS  \nUSBOHCI.SYS  \nUSBUHCI.SYS  \nand maybe some more.  \n\nand till today noone has found a way to \"combine\" them together.   \n\nSome related posts (actually pointers inside the HUGE thread):  \n[http://www.911cd.net...o...181\\\u0026st\u003d1192](http://www.911cd.net/forums//index.php?showtopic\u003d14181\u0026st\u003d1192 \"External link\")  \n[http://www.911cd.net...o...181\\\u0026st\u003d1242](http://www.911cd.net/forums//index.php?showtopic\u003d14181\u0026st\u003d1242 \"External link\")  \n\n\u003cbr /\u003e\n\n\u003cbr /\u003e\n\n![:cheers:](http://reboot.pro/public/style_emoticons/default/cheers.gif)  \n\njaclaz   \n"
    }
  ]
}