{
  "id": "7473",
  "title": "Convert partition image into (bootable) disk image",
  "isPinned": false,
  "isFirstTopic": false,
  "isLocked": false,
  "tags": [],
  "forumNotes": [
    {
      "id": "62752",
      "timestamp": "2009-03-19T13:59:28+00:00",
      "author": "dennis123123",
      "content": "Hi, can anyone tell me how I can convert a raw partition image into a disk image (mbr,partition table,etc)?  \n\nIt sounds really easy, though I dont know of a simple solution ![:good:](http://reboot.pro/public/style_emoticons/default/good.gif)   \n"
    },
    {
      "id": "62759",
      "timestamp": "2009-03-19T14:23:26+00:00",
      "author": "was_jaclaz",
      "content": "You create a MBR for it.  \n\nSee here:  \n[http://www.boot-land...?showtopic\u003d3191](http://www.boot-land.net/forums/?showtopic\u003d3191 \"External link\")  \n\nThan you will need possibly to correct some data in the bootsector of the partitin image (hidden sectors).  \n\nSee if you can get the hang of MBRbatch, then we\u0027ll talk about fixing the hidded bootsectors.  \n\njaclaz   \n"
    },
    {
      "id": "62784",
      "timestamp": "2009-03-19T17:33:54+00:00",
      "author": "dennis123123",
      "content": "Ahh, Jaclaz to the rescue ![^_^](http://reboot.pro/public/style_emoticons/default/happy.png)   \n\nI\u0027ve extracted your batch file, and the associated cmd apps, and (I think) i\u0027ve created an MBR with the command:  \n\n```\nmbrbatch CREATE test.mbr\n```\n\n\u003cbr /\u003e\n\nNow I assume I need some kind of partition table? Heres hoping you have a file such as \"partitiontablebatch.cmd\" ![^_^](http://reboot.pro/public/style_emoticons/default/happy.png)  \nUnless I am overlooking the obvious ![:good:](http://reboot.pro/public/style_emoticons/default/good.gif)  \n\nBTW, I probably should have mentioned, its an NTFS partition image.   \n"
    },
    {
      "id": "62803",
      "timestamp": "2009-03-19T23:57:15+00:00",
      "author": "was_jaclaz",
      "content": "One step at the time, my young padawan. ![:good:](http://reboot.pro/public/style_emoticons/default/good.gif)  \n\nYou have CREATEd a new MBR with the right code but NO data in it.  \n\nNow you need to EDIT it to add the data.  \n\nTo do so you first need to know which data is inside the partition bootsector.  \n\nFirst thing you will need to either mount the partition image with VDK.EXE or however extract from it it\u0027s first sector(s).  \nYou will need 1 sector for FAT16 or FAT32 and 16 sectors for NTFS.  \n\nThen get this app:  \n[http://www.roadkil.n...php?ProgramID\u003d3](http://www.roadkil.net/program.php?ProgramID\u003d3 \"External link\")  \n\nand see if the data you can read with it makes sense.  \n\nIf yes, post a screenshot or the data you can read.  \n\njaclaz   \n"
    },
    {
      "id": "62834",
      "timestamp": "2009-03-20T08:34:41+00:00",
      "author": "dennis123123",
      "content": "I see ![:good:](http://reboot.pro/public/style_emoticons/default/good.gif)  \n\nOk, I ripped out 16 sectors with WinHex, fed them into Boot Build 1.0, and it gives me all the data.  \n\nGeometry is 240/63 (which mbrbatch didnt seem to like)  \nHidden sectors 63  \n\nA problem I have found is that I tried using mbrbatch to EDIT test.mbr, and at the end it crashed with \"cannot find echooo.com\", even though it is present in the directory. I realise that it is a 16bit executable, and I intentionally removed 16 bit support from my installation to improve system stability :S Maybe I will need to set up a VM with a stock XP installation (or Windows95 ![^_^](http://reboot.pro/public/style_emoticons/default/happy.png) )   \n"
    },
    {
      "id": "62837",
      "timestamp": "2009-03-20T08:55:48+00:00",
      "author": "was_jaclaz",
      "content": "\u003e I see ![^_^](http://reboot.pro/public/style_emoticons/default/happy.png)  \n\u003e\n\u003e Ok, I ripped out 16 sectors with WinHex, fed them into Boot Build 1.0, and it gives me all the data.  \n\u003e\n\u003e Geometry is 240/63 (which mbrbatch didnt seem to like)  \n\u003e Hidden sectors 63  \n\u003e\n\u003e A problem I have found is that I tried using mbrbatch to EDIT test.mbr, and at the end it crashed with \"cannot find echooo.com\", even though it is present in the directory. I realise that it is a 16bit executable, and I intentionally removed 16 bit support from my installation to improve system stability :S Maybe I will need to set up a VM with a stock XP installation (or Windows95 ![:good:](http://reboot.pro/public/style_emoticons/default/good.gif) )\n\nWell, if you have Winhex or a similar hex editor with MBR template, you actually don\u0027t need MBRBatch (nor Boot Builder) ![^_^](http://reboot.pro/public/style_emoticons/default/happy.png).  \n\nThe 240/63 is not a \"normal\" geometry. ![^_^](http://reboot.pro/public/style_emoticons/default/happy.png)  \n\nWhat was the origin of the partition?  \n\nTo calculate CHS/LBA values use my small spreadsheet here:  \n[http://www.boot-land...?showtopic\u003d2959](http://www.boot-land.net/forums/?showtopic\u003d2959 \"External link\")  \n\nYou need to decide if you want to \"keep\" the current partition \"offset\" or \"convert it to \"default\" placement as first partition, creating a \"standard\" entry in MBR at 0/1/1 n/239/63 (setting hidden sectors to 63 or keep the current \"offset\" (if different).  \n\nIn the first case you need to add together the MBR+62_empty_ sectors+partition_image in a single file, in the second MBR+62_empty_ sectors+\\\u003cneeded_number_of_empty_sectors+partition_image.  \n\nThen, there might be a problem (if it\u0027s a bootable NT/2K/XP image) about Disk Signature, you will need to get the data from Registry inside the image, see here:  \n[http://www.911cd.net...showtopic\u003d19663](http://www.911cd.net/forums//index.php?\u0026showtopic\u003d19663 \"External link\")  \n\n\u003cbr /\u003e\n\njaclaz   \n"
    },
    {
      "id": "62841",
      "timestamp": "2009-03-20T09:59:52+00:00",
      "author": "dennis123123",
      "content": "It came from a VM raw image that I was experimenting with on Linux (to run Windows in a VM from).  \n\nOk, so I can use WinHex or similar to recreate the MBR partition table entries. Now I am puzzled about several of the entries. How do I calculate the values for the Start C/H/S and End C/H/S values? Start sector Im guessing is just 64 (mbr+62empty\u003d63) and end is just the final sector of the disk image. if this is right, its just the head and cylinder values that I have no idea about ![:good:](http://reboot.pro/public/style_emoticons/default/good.gif)  \n\nEDIT: hmm looking at some other MBRs in WinHex, I see that start CHS is 1/1/0, end head and sector is the disk geometry? So its just the end cylinder value that puzzles me if I am right now ![^_^](http://reboot.pro/public/style_emoticons/default/happy.png)  \n\nThanks for the help so far!   \n"
    },
    {
      "id": "62872",
      "timestamp": "2009-03-20T16:39:02+00:00",
      "author": "was_jaclaz",
      "content": "\u003e Ok, so I can use WinHex or similar to recreate the MBR partition table entries. Now I am puzzled about several of the entries. How do I calculate the values for the Start C/H/S and End C/H/S values? Start sector Im guessing is just 64 (mbr+62empty\u003d63) and end is just the final sector of the disk image. if this is right, its just the head and cylinder values that I have no idea about ![:good:](http://reboot.pro/public/style_emoticons/default/good.gif)\n\nYou would save some time if you actually read replies and do what is suggested in them:  \n\u003e To calculate CHS/LBA values use my small spreadsheet here:  \n\u003e [http://www.boot-land...?showtopic\u003d2959](http://www.boot-land.net/forums/?showtopic\u003d2959 \"External link\")\n\nCHS start for a \"first\" partition is 0/1/1: Winhex may use a different order in it\u0027s template, similar to the way data is written in hex.  \n\nLBA \"start sector\" should be read as \"sectors before\", in other words, you count NOT the sector on which it starts (64) but how many sectors are BEFORE that (63).  \n\n**ALL** of the above is pretty much clear if you ยง@รง#ing read ![^_^](http://reboot.pro/public/style_emoticons/default/happy.png) the referenced thread and play a bit with the given spreadsheet.  \n\nThis said, another thing that you may want to ***try*** , **IF** it\u0027s allright having the image as a \"first partition\", is to simply add together:  \n\n* MBR (with empty partition table, as created by MBRBATCH or MBRFIX\n* 62 empty, 00\u0027ed sectors\n* your partition image\n\n\u003cbr /\u003e\n\nthen create an APPROPRIATE .pln file:  \n[http://www.forensicf...m...sc\\\u0026start\u003d38](http://www.forensicfocus.com/index.php?name\u003dForums\u0026file\u003dviewtopic\u0026t\u003d1489\u0026postdays\u003d0\u0026postorder\u003dasc\u0026start\u003d38 \"External link\")  \n\nAnd mount the composite image with VDK.EXE.  \n\nThen, run TESTDISK on it:  \n[http://www.cgsecurit...g/wiki/TestDisk](http://www.cgsecurity.org/wiki/TestDisk \"External link\")  \n\nRemember that NTFS stores a copy of the bootsector at the end of the volume, so if you change data in the \"first one\", you will need to update also the \"second copy\".  \n\njaclaz   \n"
    }
  ]
}