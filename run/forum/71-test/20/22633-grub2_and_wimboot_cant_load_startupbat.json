{
  "id": "22633",
  "title": "grub2 and wimboot can\u0027t load startup.bat",
  "isPinned": false,
  "isFirstTopic": false,
  "isLocked": false,
  "tags": [],
  "forumNotes": [
    {
      "id": "221307",
      "timestamp": "2022-05-29T15:05:49+00:00",
      "author": "jakub.j",
      "content": "Hello.\n\nI have USB 3.0 pendrive with installed grub2 bios. I have wimboot files from this site:\n\n[https://rmprepusb.co...-grub2grub4dos/](https://rmprepusb.com/tutorials/145-install-windows-directly-from-an-iso-file-using-ipxe-wimboot-mbruefi-grub2grub4dos/ \"External link\")\n\nThat is my function to boot Windows with wimboot:\n\n\u003e function wimboot {  \n\u003e loopback loop $iso  \n\u003e echo Using /sources/boot.wim...  \n\u003e set installiso\u003d$iso  \n\u003e save_env installiso\n\u003e\n\u003e linux16 /wimboot/wimboot  \n\u003e initrd16 \\\\  \n\u003e newc:bootmgr:(loop)/bootmgr \\\\  \n\u003e newc:winpeshl.ini:/wimboot/winpeshl.ini \\\\  \n\u003e newc:null.cfg:/wimboot/null.cfg \\\\  \n\u003e newc:startup.bat:/$folder/startup.bat \\\\  \n\u003e newc:boot.wim:(loop)/sources/boot.wim \\\\  \n\u003e newc:bcd:(loop)/boot/bcd \\\\  \n\u003e newc:boot.sdi:(loop)/boot/boot.sdi  \n\u003e drivemap -s hd0 hd1  \n\u003e boot  \n\u003e }\n\nAnd example entry to select in menu:\n\n\u003e if cpuid -l; then  \n\u003e\n\u003e menuentry \"Windows 8.1 2021 64bit\" {\n\u003e\n\u003e if \\[ \"$grub_platform\" \u003d \"pc\" \\]; then  \n\u003e set folder\u003d\"W864\"  \n\u003e set iso\u003d\"/Windows/$folder.iso\"  \n\u003e wimboot  \n\u003e fi\n\u003e\n\u003e if \\[ \"$grub_platform\" \u003d \"efi\" \\]; then  \n\u003e echo Nothing to do  \n\u003e fi  \n\u003e }\n\u003e\n\u003e fi\n\nMy problem:\n\nWindows 10 32-bit and 64-bit work correctly, but Windows 7 SP1 (both versions with USB3 drivers) and Windows 8.1 can\u0027t find startup.bat:\n\nERROR -- could not find \\\\W864\\\\startup.bat on any drive!\n\nThis is W10 bat file (works):\n\n\u003e @echo off  \n\u003e TITLE %\\~dpnx0 (WIMBOOT startup.bat)  \n\u003e wpeinit.exe  \n\u003e REM prevent wpeinit from running again  \n\u003e ren X:\\\\windows\\\\system32\\\\wpeinit.exe wpeinit.exe.old  \n\u003e for %%I in (C D E F G H I J K L M N O P Q R S T U V W X Y Z) do if exist %%I:\\\\W1064\\\\startup.bat set USBDRIVE\u003d%%I:  \n\u003e IF \"%USBDRIVE%\"\u003d\u003d\"\" (  \n\u003e echo ERROR -- could not find \\\\W1064\\\\startup.bat on any drive!  \n\u003e @echo on  \n\u003e for %%I in (C D E F G H I J K L M N O P Q R S T U V W X Y Z) do if exist %%I:\\\\W1064\\\\startup.bat set USBDRIVE\u003d%%I:  \n\u003e pause  \n\u003e goto :EOF  \n\u003e )  \n\u003e color 1f  \n\u003e cls  \n\u003e @echo FOUND USB DRIVE AT DRIVE %USBDRIVE%  \n\u003e SET BIT\u003d32  \n\u003e if \"%PROCESSOR_ARCHITECTURE%\"\u003d\u003d\"AMD64\" SET BIT\u003d64  \n\u003e FOR /L %%A IN (0,1,5000) DO ECHO NOTHING \\\u003e nul  \n\u003e cd /d %USBDRIVE%\\\\  \n\u003e set MYISO\u003d/Windows/W1064.iso  \n\u003e echo MYISO sets as %MYISO%  \n\u003e echo Looking for X:\\\\Windows\\\\System32\\\\null.cfg contents...  \n\u003e for /f \"tokens\u003d1,2 delims\u003d\u003d\" %%a in (\u0027find \"installiso\u003d\" X:\\\\Windows\\\\System32\\\\null.cfg\u0027) do set isopath\u003d%%b  \n\u003e REM change linux forward slash to Windows backslash  \n\u003e set string1\u003d%isopath:/\u003d\\\\%  \n\u003e if exist \"%USBDRIVE%%string1%\" set MYISO\u003d%string1%  \n\u003e if not exist \"%USBDRIVE%%MYISO%\" if exist X:\\\\Windows\\\\System32\\\\null.cfg type X:\\\\Windows\\\\System32\\\\null.cfg  \n\u003e if not exist \"%USBDRIVE%%MYISO%\" echo ERROR: Can\u0027t find %USBDRIVE%%MYISO% \\\u0026\\\u0026 pause \\\u0026\\\u0026 goto :EOF  \n\u003e if exist \"%USBDRIVE%%MYISO%\" echo Loading %USBDRIVE%%MYISO%...  \n\u003e REM Load ISO using ImDisk  \n\u003e TITLE LOAD WINDOWS ISO USING IMDISK  \n\u003e call \\\\wimboot\\\\imdisk\\\\IMDISK_install.cmd  \n\u003e call \\\\wimboot\\\\imdisk\\\\IMDISK_instiso.cmd  \n\u003e REM Find mounted DVD drive  \n\u003e set DVDDRIVE\u003d  \n\u003e FOR %%D IN (A B C D E F G H I J K L M N O P Q R S T U V W X Y Z) DO (  \n\u003e DIR %%D:\\\\SOURCES\\\\install.\\* \\\u003e nul 2\\\u003e\\\u00261 \\\u0026\\\u0026 (call set DVDDRIVE\u003d%%D:) \\\u0026\\\u0026 echo FOUND %%D:\\\\SOURCES\\\\install.\\*  \n\u003e )  \n\u003e FOR %%D IN (A B C D E F G H I J K L M N O P Q R S T U V W X Y Z) DO (  \n\u003e DIR %%D:\\\\SOURCES\\\\x86\\\\install.\\* \\\u003e nul 2\\\u003e\\\u00261 \\\u0026\\\u0026 (call set DVDDRIVE\u003d%%D:) \\\u0026\\\u0026 echo FOUND %%D:\\\\SOURCES\\\\x86\\\\install.\\*  \n\u003e )  \n\u003e FOR %%D IN (A B C D E F G H I J K L M N O P Q R S T U V W X Y Z) DO (  \n\u003e DIR %%D:\\\\SOURCES\\\\x64\\\\install.\\* \\\u003e nul 2\\\u003e\\\u00261 \\\u0026\\\u0026 (call set DVDDRIVE\u003d%%D:) \\\u0026\\\u0026 echo FOUND %%D:\\\\SOURCES\\\\x64\\\\install.\\*  \n\u003e )  \n\u003e FOR %%D IN (A B C D E F G H I J K L M N O P Q R S T U V W X Y Z) DO (  \n\u003e DIR %%D:\\\\x86\\\\SOURCES\\\\install.\\* \\\u003e nul 2\\\u003e\\\u00261 \\\u0026\\\u0026 (call set DVDDRIVE\u003d%%D:) \\\u0026\\\u0026 echo FOUND %%D:\\\\x86\\\\SOURCES\\\\install.\\*  \n\u003e )  \n\u003e FOR %%D IN (A B C D E F G H I J K L M N O P Q R S T U V W X Y Z) DO (  \n\u003e DIR %%D:\\\\x64\\\\SOURCES\\\\install.\\* \\\u003e nul 2\\\u003e\\\u00261 \\\u0026\\\u0026 (call set DVDDRIVE\u003d%%D:) \\\u0026\\\u0026 echo FOUND %%D:\\\\x64\\\\SOURCES\\\\install.\\*  \n\u003e )  \n\u003e :ENDSEARCH  \n\u003e IF \"%DVDDRIVE%\"\u003d\u003d\"\" echo WARNING: VIRTUAL DRIVE DRIVE NOT FOUND!  \n\u003e IF \"%DVDDRIVE%\"\u003d\u003d\"\" echo WARNING: install.\\* not found on any mounted volume.  \n\u003e IF \"%DVDDRIVE%\"\u003d\u003d\"\" pause  \n\u003e echo.  \n\u003e IF NOT \"%DVDDRIVE%\"\u003d\u003d\"\" echo ISO FILE MOUNTED AS %DVDDRIVE%  \n\u003e ver \\| find \" 10.\" \\\u0026\\\u0026 set WINVER\u003d10  \n\u003e ver \\| find \" 6.2.\" \\\u0026\\\u0026 set WINVER\u003d8  \n\u003e ver \\| find \" 6.3.\" \\\u0026\\\u0026 set WINVER\u003d8  \n\u003e ver \\| find \" 6.1.\" \\\u0026\\\u0026 set WINVER\u003d7  \n\u003e echo.  \n\u003e set R\u003d  \n\u003e set S\u003d  \n\u003e set M\u003d  \n\u003e if exist X:\\\\sources\\\\recovery\\\\startrep.exe if \"%WINVER%\"\u003d\u003d\"7\" echo REPAIR (startrep.exe) found \\\u0026 set S\u003d1  \n\u003e if exist X:\\\\sources\\\\recovery\\\\recenv.exe echo RECOVERY ENVIRONMENT (recenv.exe) found \\\u0026 set R\u003d1  \n\u003e if exist X:\\\\sources\\\\recovery\\\\tools\\\\MSDartTools.exe echo MSDaRT (MSDartTools.exe) found \\\u0026 set M\u003d1  \n\u003e :REPAIR  \n\u003e echo.  \n\u003e echo \\*\\*\\*\\*\\*\\*\\*\\*\\*\\* REPAIR WINDOWS? \\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*  \n\u003e echo.  \n\u003e if \"%S%\"\u003d\u003d\"1\" echo S \u003d Repair Windows (Startup Repair)  \n\u003e if \"%R%\"\u003d\u003d\"1\" echo R \u003d Recover Windows (Startup Repair, System Restore, etc.)  \n\u003e if \"%M%\"\u003d\u003d\"1\" echo M \u003d MSDaRT (Microsoft Diagnostics)  \n\u003e echo N \u003d Install Windows (Windows Setup)  \n\u003e echo.  \n\u003e if \"%R%\"\u003d\u003d\"1\" if not \"%WINVER%\"\u003d\u003d\"7\" echo NOTE: Startup Repair may crash for Win8/10!  \n\u003e echo.  \n\u003e set /P ASK\u003d\"Choose an option (press \\[ENTER\\] or N to Install Windows)? : \"  \n\u003e if /I \"%ASK%\"\u003d\u003d\"R\" start /w X:\\\\sources\\\\recovery\\\\recenv.exe  \n\u003e if /I \"%ASK%\"\u003d\u003d\"S\" start /w X:\\\\sources\\\\recovery\\\\startrep.exe  \n\u003e if /I \"%ASK%\"\u003d\u003d\"M\" start /w X:\\\\sources\\\\recovery\\\\tools\\\\MSDartTools  \n\u003e REM startnet.cmd normally only contains wpeinit.exe, custom ISOs may contain other commands, so try to run them  \n\u003e if exist X:\\\\WINDOWS\\\\SYSTEM32\\\\startnet.cmd call cmd /c X:\\\\WINDOWS\\\\SYSTEM32\\\\startnet.cmd  \n\u003e if not exist X:\\\\WINDOWS\\\\SYSTEM32\\\\startup.bat exit  \n\u003e IF \"%DVDDRIVE%\"\u003d\u003d\"\" cmd  \n\u003e MODE CON COLS\u003d30 LINES\u003d2  \n\u003e echo DO NOT CLOSE THIS WINDOW  \n\u003e REM X:\\\\Sources\\\\setup.exe /Unattend:%E2BDRIVE%\\\\AutoUnattend.xml  \n\u003e REM X:\\\\Setup.exe will allow the repair option, X:\\\\Sources\\\\Setup.exe will directly run Setup  \n\u003e X:\\\\setup.exe\n\nAnd W8 bat (fails):\n\n\u003e @echo off  \n\u003e TITLE %\\~dpnx0 (WIMBOOT startup.bat)  \n\u003e wpeinit.exe  \n\u003e REM prevent wpeinit from running again  \n\u003e ren X:\\\\windows\\\\system32\\\\wpeinit.exe wpeinit.exe.old  \n\u003e for %%I in (C D E F G H I J K L M N O P Q R S T U V W X Y Z) do if exist %%I:\\\\W864\\\\startup.bat set USBDRIVE\u003d%%I:  \n\u003e IF \"%USBDRIVE%\"\u003d\u003d\"\" (  \n\u003e echo ERROR -- could not find \\\\W864\\\\startup.bat on any drive! \\\u003c-- Fails here  \n\u003e @echo on  \n\u003e for %%I in (C D E F G H I J K L M N O P Q R S T U V W X Y Z) do if exist %%I:\\\\W864\\\\startup.bat set USBDRIVE\u003d%%I:  \n\u003e pause  \n\u003e goto :EOF  \n\u003e )  \n\u003e color 1f  \n\u003e cls  \n\u003e @echo FOUND USB DRIVE AT DRIVE %USBDRIVE%  \n\u003e SET BIT\u003d32  \n\u003e if \"%PROCESSOR_ARCHITECTURE%\"\u003d\u003d\"AMD64\" SET BIT\u003d64  \n\u003e FOR /L %%A IN (0,1,5000) DO ECHO NOTHING \\\u003e nul  \n\u003e cd /d %USBDRIVE%\\\\  \n\u003e set MYISO\u003d/Windows/W864.iso  \n\u003e echo MYISO sets as %MYISO%  \n\u003e echo Looking for X:\\\\Windows\\\\System32\\\\null.cfg contents...  \n\u003e for /f \"tokens\u003d1,2 delims\u003d\u003d\" %%a in (\u0027find \"installiso\u003d\" X:\\\\Windows\\\\System32\\\\null.cfg\u0027) do set isopath\u003d%%b  \n\u003e REM change linux forward slash to Windows backslash  \n\u003e set string1\u003d%isopath:/\u003d\\\\%  \n\u003e if exist \"%USBDRIVE%%string1%\" set MYISO\u003d%string1%  \n\u003e if not exist \"%USBDRIVE%%MYISO%\" if exist X:\\\\Windows\\\\System32\\\\null.cfg type X:\\\\Windows\\\\System32\\\\null.cfg  \n\u003e if not exist \"%USBDRIVE%%MYISO%\" echo ERROR: Can\u0027t find %USBDRIVE%%MYISO% \\\u0026\\\u0026 pause \\\u0026\\\u0026 goto :EOF  \n\u003e if exist \"%USBDRIVE%%MYISO%\" echo Loading %USBDRIVE%%MYISO%...  \n\u003e REM Load ISO using ImDisk  \n\u003e TITLE LOAD WINDOWS ISO USING IMDISK  \n\u003e call \\\\wimboot\\\\imdisk\\\\IMDISK_install.cmd  \n\u003e call \\\\wimboot\\\\imdisk\\\\IMDISK_instiso.cmd  \n\u003e REM Find mounted DVD drive  \n\u003e set DVDDRIVE\u003d  \n\u003e FOR %%D IN (A B C D E F G H I J K L M N O P Q R S T U V W X Y Z) DO (  \n\u003e DIR %%D:\\\\SOURCES\\\\install.\\* \\\u003e nul 2\\\u003e\\\u00261 \\\u0026\\\u0026 (call set DVDDRIVE\u003d%%D:) \\\u0026\\\u0026 echo FOUND %%D:\\\\SOURCES\\\\install.\\*  \n\u003e )  \n\u003e FOR %%D IN (A B C D E F G H I J K L M N O P Q R S T U V W X Y Z) DO (  \n\u003e DIR %%D:\\\\SOURCES\\\\x86\\\\install.\\* \\\u003e nul 2\\\u003e\\\u00261 \\\u0026\\\u0026 (call set DVDDRIVE\u003d%%D:) \\\u0026\\\u0026 echo FOUND %%D:\\\\SOURCES\\\\x86\\\\install.\\*  \n\u003e )  \n\u003e FOR %%D IN (A B C D E F G H I J K L M N O P Q R S T U V W X Y Z) DO (  \n\u003e DIR %%D:\\\\SOURCES\\\\x64\\\\install.\\* \\\u003e nul 2\\\u003e\\\u00261 \\\u0026\\\u0026 (call set DVDDRIVE\u003d%%D:) \\\u0026\\\u0026 echo FOUND %%D:\\\\SOURCES\\\\x64\\\\install.\\*  \n\u003e )  \n\u003e FOR %%D IN (A B C D E F G H I J K L M N O P Q R S T U V W X Y Z) DO (  \n\u003e DIR %%D:\\\\x86\\\\SOURCES\\\\install.\\* \\\u003e nul 2\\\u003e\\\u00261 \\\u0026\\\u0026 (call set DVDDRIVE\u003d%%D:) \\\u0026\\\u0026 echo FOUND %%D:\\\\x86\\\\SOURCES\\\\install.\\*  \n\u003e )  \n\u003e FOR %%D IN (A B C D E F G H I J K L M N O P Q R S T U V W X Y Z) DO (  \n\u003e DIR %%D:\\\\x64\\\\SOURCES\\\\install.\\* \\\u003e nul 2\\\u003e\\\u00261 \\\u0026\\\u0026 (call set DVDDRIVE\u003d%%D:) \\\u0026\\\u0026 echo FOUND %%D:\\\\x64\\\\SOURCES\\\\install.\\*  \n\u003e )  \n\u003e :ENDSEARCH  \n\u003e IF \"%DVDDRIVE%\"\u003d\u003d\"\" echo WARNING: VIRTUAL DRIVE DRIVE NOT FOUND!  \n\u003e IF \"%DVDDRIVE%\"\u003d\u003d\"\" echo WARNING: install.\\* not found on any mounted volume.  \n\u003e IF \"%DVDDRIVE%\"\u003d\u003d\"\" pause  \n\u003e echo.  \n\u003e IF NOT \"%DVDDRIVE%\"\u003d\u003d\"\" echo ISO FILE MOUNTED AS %DVDDRIVE%  \n\u003e ver \\| find \" 10.\" \\\u0026\\\u0026 set WINVER\u003d10  \n\u003e ver \\| find \" 6.2.\" \\\u0026\\\u0026 set WINVER\u003d8  \n\u003e ver \\| find \" 6.3.\" \\\u0026\\\u0026 set WINVER\u003d8  \n\u003e ver \\| find \" 6.1.\" \\\u0026\\\u0026 set WINVER\u003d7  \n\u003e echo.  \n\u003e set R\u003d  \n\u003e set S\u003d  \n\u003e set M\u003d  \n\u003e if exist X:\\\\sources\\\\recovery\\\\startrep.exe if \"%WINVER%\"\u003d\u003d\"7\" echo REPAIR (startrep.exe) found \\\u0026 set S\u003d1  \n\u003e if exist X:\\\\sources\\\\recovery\\\\recenv.exe echo RECOVERY ENVIRONMENT (recenv.exe) found \\\u0026 set R\u003d1  \n\u003e if exist X:\\\\sources\\\\recovery\\\\tools\\\\MSDartTools.exe echo MSDaRT (MSDartTools.exe) found \\\u0026 set M\u003d1  \n\u003e :REPAIR  \n\u003e echo.  \n\u003e echo \\*\\*\\*\\*\\*\\*\\*\\*\\*\\* REPAIR WINDOWS? \\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*  \n\u003e echo.  \n\u003e if \"%S%\"\u003d\u003d\"1\" echo S \u003d Repair Windows (Startup Repair)  \n\u003e if \"%R%\"\u003d\u003d\"1\" echo R \u003d Recover Windows (Startup Repair, System Restore, etc.)  \n\u003e if \"%M%\"\u003d\u003d\"1\" echo M \u003d MSDaRT (Microsoft Diagnostics)  \n\u003e echo N \u003d Install Windows (Windows Setup)  \n\u003e echo.  \n\u003e if \"%R%\"\u003d\u003d\"1\" if not \"%WINVER%\"\u003d\u003d\"7\" echo NOTE: Startup Repair may crash for Win8/10!  \n\u003e echo.  \n\u003e set /P ASK\u003d\"Choose an option (press \\[ENTER\\] or N to Install Windows)? : \"  \n\u003e if /I \"%ASK%\"\u003d\u003d\"R\" start /w X:\\\\sources\\\\recovery\\\\recenv.exe  \n\u003e if /I \"%ASK%\"\u003d\u003d\"S\" start /w X:\\\\sources\\\\recovery\\\\startrep.exe  \n\u003e if /I \"%ASK%\"\u003d\u003d\"M\" start /w X:\\\\sources\\\\recovery\\\\tools\\\\MSDartTools  \n\u003e REM startnet.cmd normally only contains wpeinit.exe, custom ISOs may contain other commands, so try to run them  \n\u003e if exist X:\\\\WINDOWS\\\\SYSTEM32\\\\startnet.cmd call cmd /c X:\\\\WINDOWS\\\\SYSTEM32\\\\startnet.cmd  \n\u003e if not exist X:\\\\WINDOWS\\\\SYSTEM32\\\\startup.bat exit  \n\u003e IF \"%DVDDRIVE%\"\u003d\u003d\"\" cmd  \n\u003e MODE CON COLS\u003d30 LINES\u003d2  \n\u003e echo DO NOT CLOSE THIS WINDOW  \n\u003e REM X:\\\\Sources\\\\setup.exe /Unattend:%E2BDRIVE%\\\\AutoUnattend.xml  \n\u003e REM X:\\\\Setup.exe will allow the repair option, X:\\\\Sources\\\\Setup.exe will directly run Setup  \n\u003e X:\\\\setup.exe\n\nFiles with wimboot is on second (NTFS) partition:\n\n/W732/startup.bat\n\n/W764/startup.bat (and more folders for W8 and W10)\n\n/Windows/Windows_ISOs (W732.iso, W764.iso etc.)\n\n/wimboot/wimboot\n\n/wimboot/null.cfg\n\n/wimboot/Imdisk\n\n/wimboot/winpeshl.ini\n\n\u003e \\[LaunchApps\\]  \n\u003e startup.bat\n\n**Edited by jakub.j, 29 May 2022 - 03:06 PM.**\n"
    },
    {
      "id": "221308",
      "timestamp": "2022-05-29T15:30:03+00:00",
      "author": "steve6375",
      "content": "Can windows setup see the usb drive?   \n"
    },
    {
      "id": "221309",
      "timestamp": "2022-05-29T15:58:43+00:00",
      "author": "jakub.j",
      "content": "I can\u0027t check it by diskpart because i can only \"Press any key to reboot...\". I will test another isos.\n\n"
    },
    {
      "id": "221311",
      "timestamp": "2022-05-29T16:03:58+00:00",
      "author": "steve6375",
      "content": "Run diskpart from startup.bat to display all drives.  \nI suspect usb 3 drivers are missing from win7/8  \n\n(  \necho List Disk  \n) \\| diskpart  \npause   \n"
    },
    {
      "id": "221313",
      "timestamp": "2022-05-29T18:30:10+00:00",
      "author": "jakub.j",
      "content": "Diskpart in Windows 7 x64 show all disks. On USB i have dwo 0 partition (zero is number). Booting from USB 2.0 not working. Change ISO of Windows 8.1 don\u0027t work too. My version of Windows 7 should includes USB 3 drivers: [https://basewin.pl/7mod1](https://basewin.pl/7mod1 \"External link\")\n\n"
    },
    {
      "id": "221315",
      "timestamp": "2022-05-29T18:44:48+00:00",
      "author": "steve6375",
      "content": "So you are saying that you boot to the Win7 x64 Setup from ISO and perform a Diskpart command and the USB drive is listed?\n\nDoes it have a drive letter?\n\nSo why not do a dir command on the USB drive?\n\nshow a screenshot here...\n\n"
    },
    {
      "id": "221318",
      "timestamp": "2022-05-30T19:00:17+00:00",
      "author": "jakub.j",
      "content": "On USB i have 3 partitions: bootloader grub2 in FAT32, isos in ntfs and unpacked WIN10XPE in FAT32.\n\nThis is after normal boot:\n\n[https://1drv.ms/u/s!...VhM6KA?e\u003dgFK9DU](https://1drv.ms/u/s!AvrMwn71LL5EheEon2ZDV7wSVhM6KA?e\u003dgFK9DU \"External link\")\n\nThis is diskpart:\n\n[https://1drv.ms/u/s!...tUWkLg?e\u003dFcmgG1](https://1drv.ms/u/s!AvrMwn71LL5EheEnPqfa_WuWtUWkLg?e\u003dFcmgG1 \"External link\")\n\nWell... I can select #0 partiton but... Which #0?\n\n"
    },
    {
      "id": "221319",
      "timestamp": "2022-05-30T19:30:51+00:00",
      "author": "steve6375",
      "content": "The USB drive seems to be corrupt?\n\nCan you use Drive Info - 0 with RMPrepUSB.exe to view the data in sector LBA0 and look at the partition table?\n\nIt does not seem right.\n\nDid you try a Dir command to list the ISO file on the USB drive?\n\nIf it is a Removable flash drive, Windows 7/8 will only \u0027see\u0027 the first partition, but Windows 10 will see all partitions.\n\nSo to work under win7/8 you need to ensure that the ISO and start.bat, etc. are on the first partition in the MBR partition table.\n\n"
    },
    {
      "id": "221320",
      "timestamp": "2022-05-31T17:21:35+00:00",
      "author": "jakub.j",
      "content": "Yes, it is removable flash drive. I moved startup.bat files to first partition with grub:\n\n[https://1drv.ms/u/s!...9yPesw?e\u003dO20azA](https://1drv.ms/u/s!AvrMwn71LL5EheEvVMBvwFJC9yPesw?e\u003dO20azA \"External link\")\n\nStartup.bat work, but can\u0027t see ISO file. I can\u0027t move iso files of Windows because size is more than 4 Gb (too big for FAT32 file system).\n\n"
    },
    {
      "id": "221321",
      "timestamp": "2022-05-31T17:49:53+00:00",
      "author": "steve6375",
      "content": "Yes, as I said, there is something wrong with the partition table on your usb drive.  \nThere should not be two partition 0s.  \nPlease use rmprepusb drive info and show the MBR contents.   \n"
    },
    {
      "id": "221323",
      "timestamp": "2022-06-01T07:36:35+00:00",
      "author": "Wonko the Sane",
      "content": "\u003e If it is a Removable flash drive, Windows 7/8 will only \u0027see\u0027 the first partition, but Windows 10 will see all partitions.\n\u003e\n\u003e So to work under win7/8 you need to ensure that the ISO and start.bat, etc. are on the first partition in the MBR partition table.\n\n@jakub.j\n\nOtherwise you need to add/install/integrate a special filter driver that allows Windows 7 to see removable drives as fixed (and thus see the second partition).\n\nThere are a few of these drivers, namely cfadisk.sys, dummy.sys and most recent/should work fine on 7, this one (diskmod by karyonix):\n\n[http://reboot.pro/in...?showtopic\u003d9461](http://reboot.pro/index.php?showtopic\u003d9461 \"\")\n\nwhich has also other features.\n\n![:duff:](http://reboot.pro/public/style_emoticons/default/duff.gif)\n\nWonko\n\n"
    },
    {
      "id": "221325",
      "timestamp": "2022-06-01T17:46:00+00:00",
      "author": "alacran",
      "content": "Additional info about diskmod.sys filter driver by karyonix, Including the signed version from paraglider.:\n\nDownload page: [diskmod 0.0.2.2](http://reboot.pro/index.php?app\u003ddownloads\u0026showfile\u003d617 \"\")\n\nSupport topic: [http://reboot.pro/in...showtopic\u003d22249](http://reboot.pro/index.php?showtopic\u003d22249 \"\")\n\nalacran\n\n"
    },
    {
      "id": "221326",
      "timestamp": "2022-06-01T18:14:00+00:00",
      "author": "jakub.j",
      "content": "This is from disk info:\n\n\u003e COMMAND LINE: DRIVE\u003d2 USBINFO USBSTART\u003d0 SURE  \n\u003e RMPARTUSB v2.1.753 ©2022 RM Education plc \\[SSi\\]  \n\u003e \u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d  \n\u003e Accessing Drive 2 - \"SanDisk Ultra USB 30\" (61,530,439,680 bytes)  \n\u003e Sector at LBA 0  \n\u003e \u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d SECTOR DATA \u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d  \n\u003e \\[Sector 0\\] 0MB  \n\u003e 0000 EB 63 90 5C 80 00 20 39 - FF FF 00 00 00 00 00 00 .c.\\\\.. 9 ........  \n\u003e 0010 00 00 00 00 00 00 00 00 - 00 00 00 00 00 00 00 00 ........ ........  \n\u003e 0020 00 00 00 00 00 00 00 00 - 00 00 00 00 00 00 00 00 ........ ........  \n\u003e 0030 00 00 00 00 00 00 00 00 - 00 00 00 00 00 00 00 00 ........ ........  \n\u003e 0040 00 00 00 00 00 00 00 00 - 00 00 00 00 00 00 00 00 ........ ........  \n\u003e 0050 00 00 00 00 00 00 00 00 - 00 00 00 80 01 00 00 00 ........ ........  \n\u003e 0060 00 00 00 00 FF FA 90 90 - F6 C2 80 74 05 F6 C2 70 ........ ...t...p  \n\u003e 0070 74 02 B2 80 EA 79 7C 00 - 00 31 C0 8E D8 8E D0 BC t....y\\|. .1......  \n\u003e 0080 00 20 FB A0 64 7C 3C FF - 74 02 88 C2 52 BE 80 7D . ..d\\|\\\u003c. t...R..}  \n\u003e 0090 E8 17 01 BE 05 7C B4 41 - BB AA 55 CD 13 5A 52 72 .....\\|.A ..U..ZRr  \n\u003e 00A0 3D 81 FB 55 AA 75 37 83 - E1 01 74 32 31 C0 89 44 \u003d..U.u7. ..t21..D  \n\u003e 00B0 04 40 88 44 FF 89 44 02 - C7 04 10 00 66 8B 1E 5C .@.D..D. ....f..\\\\  \n\u003e 00C0 7C 66 89 5C 08 66 8B 1E - 60 7C 66 89 5C 0C C7 44 \\|f.\\\\.f.. \\`\\|f.\\\\..D  \n\u003e 00D0 06 00 70 B4 42 CD 13 72 - 05 BB 00 70 EB 76 B4 08 ..p.B..r ...p.v..  \n\u003e 00E0 CD 13 73 0D 5A 84 D2 0F - 83 D8 00 BE 8B 7D E9 82 ..s.Z... .....}..  \n\u003e 00F0 00 66 0F B6 C6 88 64 FF - 40 66 89 44 04 0F B6 D1 .f....d. @f.D....  \n\u003e 0100 C1 E2 02 88 E8 88 F4 40 - 89 44 08 0F B6 C2 C0 E8 .......@ .D......  \n\u003e 0110 02 66 89 04 66 A1 60 7C - 66 09 C0 75 4E 66 A1 5C .f..f.\\`\\| f..uNf.\\\\  \n\u003e 0120 7C 66 31 D2 66 F7 34 88 - D1 31 D2 66 F7 74 04 3B \\|f1.f.4. .1.f.t.;  \n\u003e 0130 44 08 7D 37 FE C1 88 C5 - 30 C0 C1 E8 02 08 C1 88 D.}7.... 0.......  \n\u003e 0140 D0 5A 88 C6 BB 00 70 8E - C3 31 DB B8 01 02 CD 13 .Z....p. .1......  \n\u003e 0150 72 1E 8C C3 60 1E B9 00 - 01 8E DB 31 F6 BF 00 80 r...\\`... ...1....  \n\u003e 0160 8E C6 FC F3 A5 1F 61 FF - 26 5A 7C BE 86 7D EB 03 ......a. \\\u0026Z\\|..}..  \n\u003e 0170 BE 95 7D E8 34 00 BE 9A - 7D E8 2E 00 CD 18 EB FE ..}.4... }.......  \n\u003e 0180 47 52 55 42 20 00 47 65 - 6F 6D 00 48 61 72 64 20 GRUB .Ge om.Hard  \n\u003e 0190 44 69 73 6B 00 52 65 61 - 64 00 20 45 72 72 6F 72 Disk.Rea d. Error  \n\u003e 01A0 0D 0A 00 BB 01 00 B4 0E - CD 10 AC 3C 00 75 F4 C3 ........ ...\\\u003c.u..  \n\u003e 01B0 00 00 00 00 00 00 00 00 - 40 54 DE 59 00 00 80 22 ........ @T.Y...\"  \n\u003e 01C0 23 00 0B 9B 02 29 80 08 - 00 00 90 2A 0A 00 00 9D #....).. ...\\*....  \n\u003e 01D0 05 29 07 FE FF FF 90 33 - 0A 00 99 61 D5 06 00 FE .).....3 ...a....  \n\u003e 01E0 FF FF 07 FE FF FF C0 BF - E9 06 00 00 40 00 00 00 ........ ....@...  \n\u003e 01F0 00 00 00 00 00 00 00 00 - 00 00 00 00 00 00 55 AA ........ ......U.  \n\u003e \\[Sector 1\\] 0MB  \n\u003e 0200 52 56 BE 1B 81 E8 39 01 - 5E BF F4 81 66 8B 2D 83 RV....9. \\^...f.-.  \n\u003e 0210 7D 08 00 0F 84 E2 00 80 - 7C FF 00 74 46 66 8B 1D }....... \\|..tFf..  \n\u003e 0220 66 8B 4D 04 66 31 C0 B0 - 7F 39 45 08 7F 03 8B 45 f.M.f1.. .9E....E  \n\u003e 0230 08 29 45 08 66 01 05 66 - 83 55 04 00 C7 04 10 00 .)E.f..f .U......  \n\u003e 0240 89 44 02 66 89 5C 08 66 - 89 4C 0C C7 44 06 00 70 .D.f.\\\\.f .L..D..p  \n\u003e 0250 50 C7 44 04 00 00 B4 42 - CD 13 0F 82 AF 00 BB 00 P.D....B ........  \n\u003e 0260 70 EB 66 66 8B 45 04 66 - 09 C0 0F 85 97 00 66 8B p.ff.E.f ......f.  \n\u003e 0270 05 66 31 D2 66 F7 34 88 - 54 0A 66 31 D2 66 F7 74 .f1.f.4. T.f1.f.t  \n\u003e 0280 04 88 54 0B 89 44 0C 3B - 44 08 7D 79 8B 04 2A 44 ..T..D.; D.}y..\\*D  \n\u003e 0290 0A 39 45 08 7F 03 8B 45 - 08 29 45 08 66 01 05 66 .9E....E .)E.f..f  \n\u003e 02A0 83 55 04 00 8A 54 0D C0 - E2 06 8A 4C 0A FE C1 08 .U...T.. ...L....  \n\u003e 02B0 D1 8A 6C 0C 5A 52 8A 74 - 0B 50 BB 00 70 8E C3 31 ..l.ZR.t .P..p..1  \n\u003e 02C0 DB B4 02 CD 13 72 46 8C - C3 8E 45 0A 58 C1 E0 05 .....rF. ..E.X...  \n\u003e 02D0 01 45 0A 60 1E C1 E0 03 - 89 C1 31 FF 31 F6 8E DB .E.\\`.... ..1.1...  \n\u003e 02E0 FC F3 A5 1F BE 23 81 E8 - 57 00 61 83 7D 08 00 0F .....#.. W.a.}...  \n\u003e 02F0 85 24 FF 83 EF 0C E9 16 - FF BE 25 81 E8 42 00 5A .$...... ..%..B.Z  \n\u003e 0300 EA 00 82 00 00 BE 28 81 - E8 36 00 EB 06 BE 2D 81 ......(. .6....-.  \n\u003e 0310 E8 2E 00 BE 32 81 E8 28 - 00 EB FE 6C 6F 61 64 69 ....2..( ...loadi  \n\u003e 0320 6E 67 00 2E 00 0D 0A 00 - 47 65 6F 6D 00 52 65 61 ng...... Geom.Rea  \n\u003e 0330 64 00 20 45 72 72 6F 72 - 00 BB 01 00 B4 0E CD 10 d. Error ........  \n\u003e 0340 46 8A 04 3C 00 75 F2 C3 - 00 00 00 00 00 00 00 00 F..\\\u003c.u.. ........  \n\u003e 0350 00 00 00 00 00 00 00 00 - 00 00 00 00 00 00 00 00 ........ ........  \n\u003e 0360 00 00 00 00 00 00 00 00 - 00 00 00 00 00 00 00 00 ........ ........  \n\u003e 0370 00 00 00 00 00 00 00 00 - 00 00 00 00 00 00 00 00 ........ ........  \n\u003e 0380 00 00 00 00 00 00 00 00 - 00 00 00 00 00 00 00 00 ........ ........  \n\u003e 0390 00 00 00 00 00 00 00 00 - 00 00 00 00 00 00 00 00 ........ ........  \n\u003e 03A0 00 00 00 00 00 00 00 00 - 00 00 00 00 00 00 00 00 ........ ........  \n\u003e 03B0 00 00 00 00 00 00 00 00 - 00 00 00 00 00 00 00 00 ........ ........  \n\u003e 03C0 00 00 00 00 00 00 00 00 - 00 00 00 00 00 00 00 00 ........ ........  \n\u003e 03D0 00 00 00 00 00 00 00 00 - 00 00 00 00 00 00 00 00 ........ ........  \n\u003e 03E0 00 00 00 00 00 00 00 00 - 00 00 00 00 00 00 00 00 ........ ........  \n\u003e 03F0 00 00 00 00 02 00 00 00 - 00 00 00 00 71 00 20 08 ........ ....q. .  \n\u003e \u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d END OF SECTOR DATA \u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d  \n\u003e Disk Signature bytes (1B8h-1BBh) \u003d 40 54 DE 59  \n\u003e Partition 1 SIZE\u003d325,32MiB Type: 0B FAT32 (2047GB max) \\*ACTIVE\\*  \n\u003e START POS \u003d CYL:0 HD:34 SEC:35 END POS \u003d CYL:41 HD:155 SEC:2  \n\u003e START (LBA) \u003d 2,176 (00000880) SIZE (LBA) \u003d 666,256 (000A2A90) \\[End\u003d668,431\\]  \n\u003e Partition 2 SIZE\u003d55980,2MiB Type: 07 NTFS\\\\exFAT  \n\u003e START POS \u003d CYL:41 HD:157 SEC:5 END POS \u003d CYL:1023 HD:254 SEC:63  \n\u003e START (LBA) \u003d 668,560 (000A3390) SIZE (LBA) \u003d 114,647,449 (06D56199) \\[End\u003d115,316,008\\]  \n\u003e Partition 3 SIZE\u003d2048MiB Type: 07 NTFS\\\\exFAT  \n\u003e START POS \u003d CYL:1023 HD:254 SEC:63 END POS \u003d CYL:1023 HD:254 SEC:63  \n\u003e START (LBA) \u003d 115,982,272 (06E9BFC0) SIZE (LBA) \u003d 4,194,304 (00400000) \\[End\u003d120,176,575\\]  \n\u003e Partition 4 SIZE\u003d0MiB Type: 00  \n\u003e START POS \u003d CYL:0 HD:0 SEC:0 END POS \u003d CYL:0 HD:0 SEC:0  \n\u003e START (LBA) \u003d 0 (00000000) SIZE (LBA) \u003d 0 (00000000)  \n\u003e P1 Start\u003d2,176 (1,114,112 bytes) End\u003d668,431 (342,236,672 bytes)  \n\u003e P2 Start\u003d668,560 (342,302,720 bytes) End\u003d115,316,008 (59,041,796,096 bytes)  \n\u003e P3 Start\u003d115,982,272 (59,382,923,264 bytes) End\u003d120,176,575 (61,530,406,400 bytes)  \n\u003e Drive 2 SanDisk Ultra USB 30 F/W Rev.\u003d100 Serial No.\u003d01011e70 \\[ bytes \u003d 30 31 30 31 31 65 37 30 \\]  \n\u003e Reported size 61,530,439,680 bytes (57.3046GiB) Last LBA 120,176,639  \n\u003e RMPrepUSB Max 61,516,869,120 bytes (57.2920GiB) Last LBA 120,150,134  \n\nI will check diskmod.\n\n"
    },
    {
      "id": "221327",
      "timestamp": "2022-06-01T18:30:06+00:00",
      "author": "steve6375",
      "content": "Ok, well the first ptn is the fat ptn so that explains why winpe 7/8 will not see the NTFS partition with the iso files   \nYou can use the tab in rmprepusb to reorder partition 2 and swap it with partition 1. It will set the accessible ptn.   \n"
    },
    {
      "id": "221342",
      "timestamp": "2022-06-06T18:36:22+00:00",
      "author": "jakub.j",
      "content": "Diskmod doesn\u0027t work on my USB Drive. In rmprepusb use Set Windows accessible partition and everything works.\n\n"
    },
    {
      "id": "221356",
      "timestamp": "2022-06-11T12:00:36+00:00",
      "author": "jakub.j",
      "content": "I have problem with swapping partition - i can\u0027t boot grub2 in uefi ![:(](http://reboot.pro/public/style_emoticons/default/sad.png). I install diskmod 0.0.2.2 and usb drive is view as hard drive, but Windows 7 installer can\u0027t find volume with iso files so it can\u0027t find startup.bat too.\n\n"
    },
    {
      "id": "221357",
      "timestamp": "2022-06-11T15:10:39+00:00",
      "author": "steve6375",
      "content": "Does win7 have the diskmod driver applied also?³   \n"
    },
    {
      "id": "221358",
      "timestamp": "2022-06-11T15:21:01+00:00",
      "author": "Wonko the Sane",
      "content": "\u003e I have problem with swapping partition - i can\u0027t boot grub2 in uefi ![:(](http://reboot.pro/public/style_emoticons/default/sad.png). I install diskmod 0.0.2.2 and usb drive is view as hard drive, but Windows 7 installer can\u0027t find volume with iso files so it can\u0027t find startup.bat too.\n\nYou can *try* installing it \"on the fly\" from the ramdisk in the running setup PE, see cdob\u0027s post here:\n\n[http://reboot.pro/in...c\u003d9461\\\u0026p\u003d176975](http://reboot.pro/index.php?showtopic\u003d9461\u0026p\u003d176975 \"\")\n\n![:duff:](http://reboot.pro/public/style_emoticons/default/duff.gif)\n\nWonko\n\n"
    },
    {
      "id": "221359",
      "timestamp": "2022-06-12T01:03:52+00:00",
      "author": "alacran",
      "content": "@ jakub.j\n\nAlso if you prefer, you can install dikmod to 7 and 8.x boot.wim files.\n\nPlease see this [topic](http://reboot.pro/topic/22256-make-your-old-win7-or-win8x-based-winpes-capables-to-access-a-multipartitioned-usb-stick-sd-or-microsd/ \"\") about installing diskmod to my old WinPEs\n\nalacran\n\n"
    },
    {
      "id": "221360",
      "timestamp": "2022-06-12T11:33:13+00:00",
      "author": "jakub.j",
      "content": "\u003e Does win7 have the diskmod driver applied also?³\n\nYes, but it didn\u0027t work\n\n\u003e You can *try* installing it \"on the fly\" from the ramdisk in the running setup PE, see cdob\u0027s post here:\n\u003e\n\u003e [http://reboot.pro/in...c\u003d9461\\\u0026p\u003d176975](http://reboot.pro/index.php?showtopic\u003d9461\u0026p\u003d176975 \"\")\n\u003e\n\u003e ![:duff:](http://reboot.pro/public/style_emoticons/default/duff.gif)\n\u003e\n\u003e Wonko\n\nHmm... I never do that\n\n\u003e @ jakub.j\n\u003e\n\u003e Also if you prefer, you can install dikmod to 7 and 8.x boot.wim files.\n\u003e\n\u003e Please see this [topic](http://reboot.pro/topic/22256-make-your-old-win7-or-win8x-based-winpes-capables-to-access-a-multipartitioned-usb-stick-sd-or-microsd/ \"\") about installing diskmod to my old WinPEs\n\u003e\n\u003e alacran\n\nNow works. Thank you. I got to know new program to edit Windows iso files NTLite :smile:\n\n"
    }
  ]
}