{
  "id": "22250",
  "title": "USB 3.0 Combo: UEFI_MULTI + Wimboot VHDs + agFM + E2B + AIO Boot (Optional).",
  "isPinned": false,
  "isFirstTopic": false,
  "isLocked": false,
  "tags": [],
  "forumNotes": [
    {
      "id": "213996",
      "timestamp": "2020-03-01T11:14:19+00:00",
      "author": "alacran",
      "content": "I want to share with you the procedure to create a Combo USB 3.0 stick (I used a fast 32 GB MicroSD + a USB 3.0 adapter) with UEFI_MULTI + Wimboot VHDs + agFM + E2B, with the hope it can be of some use for some of you, info to also add AIO Boot is available on post No. 2:\n\n**It is better to make all this procedure on Win10 since from version 1703 it is capable to handle multipartitioned USB sticks.**\n\n1.- Download last version de E2B (from **steve6375** site) and install it on a spare USB device, and DO NOT add any other files yet, for info and download see: [http://reboot.pro/to...e-3#entry213991](http://reboot.pro/topic/22232-a1ives-grub2-and-file-manager-has-great-uefi-support/page-3#entry213991 \"\")  \n\n2.- Make a copy of all content into your E2B NTFS partition on a folder (named E2B) on your internal HD, you may also delete grldr file since it will no longer be required.  \n\n3.- Delete all partitions on the USB you are going to use for this procedure, (format it as MBR) and create a first Primary **active** partition FAT-32 (I used UEFI_MULTI as label for it) of 1 GB minimum (just in case), or bigger if you also want to include AIO Boot too, (see info on following post), a second primary FAT-32 100 MB partition (labeled AGFM) and a third primary partition NTFS of the remaining size of your USB device (Its label is E2B-NTFS).  \n\n4.- Copy all content of folder named E2B to your E2B-NTFS partition.  \n\n5.- Download last version of agFM_download_files.zip (from **steve6375** site) and expand it on a folder on your internal HD and latter copy all content of the folder to AGFM partition (this is to avoid fragmentation), for info and download see: [http://reboot.pro/to...e-3#entry213991](http://reboot.pro/topic/22232-a1ives-grub2-and-file-manager-has-great-uefi-support/page-3#entry213991 \"\")  \n\n6.- Copy/move grub_filemanager.mnu from AGFM partition to E2B-NTFS partition \\\u003e\\\u003e\\\u003e _ISO\\\\MAINMENU folder.  \n\n7.- Copy to E2B-NTFS partition \\\u003e\\\u003e\\\u003e _ISO\\\\WINPE all your WIM files and they will be available to boot from E2B, or optionaly (as I did to avoid E2B complain about the version of bootmgr when booting them), create on the root of E2B-NTFS a folder named WinPE and copy there your WIM files and boot them directly from Windows bootmanager.  \n\n8.- Download [UEFI_MULTI](http://reboot.pro/files/file/279-uefi-multi-make-multi-boot-usb-drive/ \"\") (from **wimb** ) and once expanded on a folder on your HD, run it and select E2B-NTFS volume as System Drive and UEFI_MULTI volume as Boot Drive, select the location on E2B-NTFS of your desired WIM file and follow the instructions of the program, once it finish all files and folders required to boot it will be created into UEFI_MULTI partition, repeat this procedure for all the WIM files you want to boot directly from Windows bootmanager (on Bios Legacy and UEFI).  \n\n9.- On UEFI_MULTI partition open file menu.lst and before this line: \" iftitle \\[ls (hd0,0)/images\\] ISO Linux Menu - (hd0,0)/images \", add the following lines:\n\nSuggested addition to menu.lst  \nSpoiler  \n\u003cbr /\u003e\n\n```\ntitle Boot Manager Menu - Win 7/8/10 VHD and WIM from this USB device\nfind --set-root /menu_Linux.lst\nchainloader /bootmgr\n\ntitle Boot Win 7/8/10 from first internal disk\nchainloader (hd1,0)/bootmgr\n\niftitle [if exist /vhds.lst] VHDs menu\nfind --set-root /vhds.lst\nconfigfile /vhds.lst\n \niftitle [if exist (hd0,1)/e2b.ico || if exist (hd0,2)/e2b.ico] E2B Menu - Load E2B menu\nfind --set-root /e2b.ico\nconfigfile /menu.lst\n\niftitle [if exist (hd0,1)/grubfm.iso || if exist (hd0,2)/grubfm.iso] Grub2 File Manager (agFM)\\nBoot a file using grub2\nsplashimage --animated\u003d0\nmap --unmap\u003d0:03 \u003e nul\nmap --unhook\nfind --set-root /grubfm.iso || pause ERROR: Cannot find /grubfm.iso!\nmap /grubfm.iso (0xff) || map --mem /grubfm.iso (0xff)\nmap --hook\nchainloader (0xff)\nboot\n\niftitle [if exist (hd0,2)/_ISO/WINPE/7pe_amd64_E.iso] Boot 7pe_amd64_E.iso - On (hd0,2)/_ISO/WINPE/7pe_amd64_E.iso\nmap (hd0,2)/_ISO/WINPE/7pe_amd64_E.iso (0xff)\nmap --hook\nroot (0xff)\nchainloader (0xff)\n\niftitle [if exist (hd0,2)/_ISO/WINPE/7pe_x86_E.iso] Boot 7pe_x86_E.iso - On (hd0,2)/_ISO/WINPE/7pe_x86_E.iso\nmap (hd0,2)/_ISO/WINPE/7pe_x86_E.iso (0xff)\nmap --hook\nroot (0xff)\nchainloader (0xff)\n\ntitle Reboot\nreboot\n\ntitle Turn Off\nhalt\n\n```\n\n\u003cbr /\u003e\n\n\u003cbr /\u003e\n\nYou are free to edit according to your needs. Also attached a file with the autorun.inf and the .ico I used for this partition.\n\n\u003cbr /\u003e\n\n10.- Download and expand [VHD_WIMBOOT](http://reboot.pro/topic/21977-vhd-wimboot-apply-and-capture-of-wim-files-for-os-in-vhd/ \"\") (from **wimb** ), a PDF file with instructions is included on download, and create your Wimboot VHD(s) on E2B-NTFS partition, all required editions/additions/changes to Bios legacy and UEFI BCDs (located on the UEFI_MULTI partition and also into the Wimboot VHD itself) will be created automatically, additionally the entry on menu.lst to Ramboot the VHD also will be created, but it is better to verify and modify it, if required, since on this case we are using a USB device with 3 partitions.  \n\n11.- Now you can add on E2B-NTFS partition \\\u003e\\\u003e\\\u003e _ISO subfolders your desired Widows and Linux Isos, or Wim files, under its respective subfolder as usual.  \n\n12.- As there are some buggy versions of grub4dos 0.46a I replaced on UEFI_MULTI grldr and grldr.mbr with those from version 2019-09-09 (last good known) to avoid issues about non contiguous files.  \n\n**Booting the USB device** - If you reboot from your USB device and press F7, F8 or F9, etc (I have at home PCs with all the tree mentioned) in acordance with your MB manufacturer the **Overwrite Boot Menu** will appear, if the firmware of the PC is/has UEFI active your USB device will appear twice, the first USB UEFI option (from top to bottom of the list) should be to boot from UEFI_MULTI and the other to boot from AGFM partition. On Bios-Legacy/MBR PCs and also on UEFI PCs when CSM is active you will see an option to boot your USB device (as Bios Legacy) without the word UEFI on it.  \n\n**NOTE**: It is very possible with this layout some of E2B features may not work, I can\u0027t tell you wich featues don\u0027t work as I never rename the .iso extensions or use Image Partitions, or changed partitions order because I usually don\u0027t like to do it. But since the fourth (hd0,3) partition is not in use I assume Partnew can be used if required.\n\nI\u0027m not able to test wich E2B featues don\u0027t work, as for OS installs I use WinNTSetup because it gives me many more useful options (then there is no need to use Image Partitions), and also have several other compressed self extractable programs I run using PStart located on the root of the USB first partition, available to all WinPE WIMs and VHDs, for more info about portables, see this thread: [Free portable programs executable from PE.](http://reboot.pro/topic/21455-free-portable-programs-executable-from-pe/ \"\")\n\n**EDIT-1:** See post No. 18 for useful links to handle multipartitioned devices on OS versions older than Win10 v1703: [http://reboot.pro/to...al/#entry214092](http://reboot.pro/topic/22250-usb-30-combo-uefi-multi-wimboot-vhds-agfm-e2b-aio-boot-optional/#entry214092 \"\")\n\n**Edit-2:** See [post No.19](http://reboot.pro/topic/22250-usb-30-combo-uefi-multi-wimboot-vhds-agfm-e2b-aio-boot-optional/#entry214094 \"\") for a link to an alternative procedure developed by wimb, wich makes possible to do all this in only two partitions, and my comments after testing it.\n\nalacran  \n\n#### Attached Files {#attach_wrap}\n\n* [![Attached File](http://reboot.pro/public/style_extra/mime_types/zip.gif)](http://reboot.pro/index.php?s\u003d063fd65e9ee858cc49f807cb26b9cac2\u0026app\u003dcore\u0026module\u003dattach\u0026section\u003dattach\u0026attach_id\u003d17016 \"Download attachment\") [**UEFI_MULTI.zip**](http://reboot.pro/index.php?s\u003d063fd65e9ee858cc49f807cb26b9cac2\u0026app\u003dcore\u0026module\u003dattach\u0026section\u003dattach\u0026attach_id\u003d17016 \"Download attachment\") **630bytes** 581 downloads\n\n"
    },
    {
      "id": "213997",
      "timestamp": "2020-03-01T20:54:26+00:00",
      "author": "alacran",
      "content": "If you also want to add AIO Boot (Optional) on your USB Combo, it is very easy, Just make your UEFI_MULTI partition bigger since the begining, I can\u0027t tell you how big it needs to be since I don\u0027t know what Linux Live distros you are going to put here, then just follow instructions on this post from **wimb**:\n\n\u003e **How to make USB Drive booting with various AIO Linux versions in BIOS and in UEFI Secure mode**  \n\u003e 1. Make **FAT32 USB Drive** (Max \u003d 32 GB) booting with Microsoft **Boot Manager Menu**  \n\u003e [**Microsoft Media Creation Tool**](https://www.microsoft.com/en-us/software-download/windows10 \"External link\") (Architecture both 32 and 64 bits) Or Other Format Tool can be used  \n\u003e 2. Download and Unpack [**AIOBoot-v0.9.8.17.7z**](https://sourceforge.net/projects/aioboot/ \"External link\") - Don\u0027t use Extractor and Don\u0027t Overwrite existing Microsoft files  \n\u003e Unpack and Copy content of folder AIOBoot-v0.9.8.17 to FAT32 USB Drive, but keep existing Microsoft Boot files  \n\u003e 3. Use **UEFI_MULTI** to Add **Grub2** EFI Manager of **Linux Mint,** which fixes AIO Boot for booting in BIOS and UEFI Secure mode  \n\u003e 4. On USB run **AIOCreator.exe** - Select Integration Linux OS and your Linux ISO [linuxmint-19-cinnamon-64bit-v2.iso](https://linuxmint.com/download.php \"External link\") - preferred  \n\u003e 5. **Boot from USB** after beep via F8 menu in UEFI or in BIOS mode with Grub2 menu and Select your Linux OS\n\n[http://reboot.pro/to...e-5#entry208639](http://reboot.pro/topic/18182-uefi-multi-make-multi-boot-usb-drive/page-5#entry208639 \"\")\n\nAfter doing all as suggested, just run AIOCreator.exe from UEFI_MULTI partition and start adding your files.\n\nalacran\n\n"
    },
    {
      "id": "214002",
      "timestamp": "2020-03-02T19:54:48+00:00",
      "author": "Rootman",
      "content": "I\u0027ve tweaked my USB boot drives over the years, currently I have a simpler setup than yours but still gets me MBR and EFI boot off the same drive. .\n\nFirst I have a 30-100GB NTFS first partition, smaller on thumb drives larger on multi TB USB HDDs. I have Easy2Boot and all my payload files on this partition.\n\nSecond I have a 5 GB FAT32 second partition. I have agFM installed on this drive. There is some issue with certain brands seeing and booting to this second fat32 partition, but all the PCs I use seem to see it fine.\n\nI can boot to Easy2Boot in MBR and boot to all my ISO and wim files.\n\nI can boot and select the second partition and boot via EFI to agFM. All of my ISO files will boot under either. I dropped all the .imgPTN files I had created because agFM worked so well and let me EFI boot to the same ISO files directly.\n\nFor the rest of the drive I have it setup as a NTFS data partition. For my work drives, just a plain partition, for my personal drives, a VeraCrypt encrypted partition.\n\n"
    },
    {
      "id": "214003",
      "timestamp": "2020-03-02T21:05:34+00:00",
      "author": "alacran",
      "content": "@ Rootman\n\nThat is standard procedure suggested by **steve6375.**\n\nVery nice but that approach wich by the way I already tested before making this Combo, is not capable to filedisk boot Wimboot VHDs (on Bios + UEFI + UEFI with CSM mode active) or Ramboot Wimboot VHDs (on Bios + UEFI with CSM mode active).\n\nWindows boot manager and BCD editions are required for filedisk boot Wimboot VHDs, and also E2B always complain about Win10 bootmgr.\n\nAdditionally SVBus driver install + grub4dos edit is required for Ramboot Wimboot VHDs, and on E2B as grub4dos menues are made on the fly it is not easy to modify them.\n\nBut this part of your post looks very intersting to me:\n\n\u003e I dropped all the .imgPTN files I had created because agFM worked so well and let me EFI boot to the same ISO files directly.\n\nThen if we loose the capavility to use .imgPTN files on E2B with the approach I use on this topic it is not a big deal, since as you are confirming it is not required anymore as I was thinking when I wrote this on the first post:\n\n\u003e I\u0027m not able to test wich E2B featues don\u0027t work, as for OS installs I use WinNTSetup because it gives me many more useful options (then there is no need to use Image Partitions)\n\nAs we all allready know, NOT ALL can be booted with a single approach then as more options we have is better.\n\n**The approach on this topic adds another option to boot (Wimboot VHDs) and of course it is the user decision to do it the way he/she needs/likes better.**\n\nalacran\n\n"
    },
    {
      "id": "214009",
      "timestamp": "2020-03-04T12:14:38+00:00",
      "author": "Rootman",
      "content": "Yes, I quite agree, you need to do what your needs dictate. For years I had my drives setup as a \u0027do it all\u0027 boot drive with several boot tools on them and found I simply didn\u0027t need it all. So I simplified and went with the straight approach. It gets me all I need - especially with agFM available now.\n\nTo be honest I got frustrated with maintaining it all and just simplified with this straight approach, and for me, it\u0027s all I need. I even went as far as setting up all my drives the same way, even the \\\u003e 2TB GPT drives which cannot boot E2B via MBR. I have the payloads on that NTFS partition so it gets copied to the GPT drives anyway. I have my main USB thumb drive the way I want and then use SyncBack Pro to copy the MBR and EFI files to folders on my systems HDD, from there to all the other USB thumb / HDDs. Again, it makes it simpler. I\u0027ve got 6 guys I work with and this makes it dead stupid to maintain. I simply just ignore the NTFS partition of these GPT drives. In fact in those drives I labeled then via autorun.inf as \u0027DUMMY - WILL NOT BOOT MBR\u0027 and even put a printed label on them stating the same. Invariably one of my guys will try to boot from it via MBR anyway.\n\nJust for everyone else: E2B and agFM still support .imgPTN, I just don\u0027t need them as I was booting the straight contents of the ISO anyway.\n\nIt\u0027s cool to see all the many ways people come up with to make their tools so flexible. I enjoy reading about it. I\u0027ve picked up quite a few things too.\n\n"
    },
    {
      "id": "214028",
      "timestamp": "2020-03-06T09:52:58+00:00",
      "author": "alacran",
      "content": "Just in case some one wants to try this layout on his/hers USB device, this are some pictures of my last build on a fast 32 GB MicroSD + USB 3.0 adapter.\n\n**1.-Drive-Partitions:** Where H:, I: and J. are USB device partitions. (this time UEFI_MULTI partition is 2 GB to add aditional folders), and at the end of the device there is 1 GB unformated  \n\n**2.-UEFI_MULTI-Partition:** MBR or UEFI + CSM active, and UEFI secure boot bootable partition, **inmune to firmware changes as it uses Windows bootmanager** , where is locate the main menu.lst capable to load agFM and E2B on MBR or UEFI + CSM mode active PCs. Please open the spoiler under No. 9 on first post for my updated additions to menu.lst  \n\n**3.-agFM-Partition:** UEFI bootable partition, for **as long as there is no change on UEFI firmware to black list it on secure boot** , then when this happend it will be nessesary to disable the stupid secure boot. Wich by the way was named that way just to create a false sence of security to induce the user to use it.  \n\n**4.-E2B NTFS partition:** On _ISO directory there are some WinPE.iso and Linux Live.iso and some other tools,bootables by E2B and agFM, on folder WimPE there are some WimPE.wim files bootables by agFM or directly by Windows botmanager, on the root I have some fixed size 1.5 GB Wimboot VHDs diskboot bootables directly by Windows botmanager + same VHDs LZ4 compressed for faster grub4dos Rambooting,\n\nlz4_compressor can be downloaded here: [http://reboot.pro/fi...lz4-compressor/](http://reboot.pro/files/file/612-lz4-compressor/ \"\")  \n\n**5.-Wimboot-folder:** Contain the WIM source files required for the Wimboot VHDs, and also contain .ffu images to faster rebuild any of Wimboot VHDs just in case, for more info see: [http://reboot.pro/to...ate-ffu-images/](http://reboot.pro/topic/22182-capture-and-apply-windows-full-flash-update-ffu-images/ \"\")and for Download: [http://reboot.pro/fi...-mount-service/](http://reboot.pro/files/file/576-dism-mount-service/ \"\")\n\n**Into directory CD** located on the root of E2B NTFS partition I have separated folders with my own made AIO ESD files including unattend.xml, and $oem$ files for each one. Wich can be used for installing the OS by means of [WinNTSetup](https://msfn.org/board/topic/149612-winntsetup-v40/ \"External link\"), you may see this topic to make your AIOs see: [http://reboot.pro/to...l-oss-from-usb/](http://reboot.pro/topic/21852-make-your-own-updated-x86x64-esds-to-install-oss-from-usb/ \"\")\n\nalacran  \n\n#### Attached Thumbnails {#attach_wrap}\n\n* [![1.-Drive-Partitions.png](http://reboot.pro/uploads/monthly_03_2020/post-26560-0-18957100-1583484738_thumb.png)](http://reboot.pro/uploads/monthly_03_2020/post-26560-0-18957100-1583484738.png \"1.-Drive-Partitions.png - Size: 165.47KB\"){#ipb-attach-url-17010-0-97230400-1676066390}\n* [![2.-UEFI_MULTI-Partition.png](http://reboot.pro/uploads/monthly_03_2020/post-26560-0-08227800-1583484752_thumb.png)](http://reboot.pro/uploads/monthly_03_2020/post-26560-0-08227800-1583484752.png \"2.-UEFI_MULTI-Partition.png - Size: 150.41KB\"){#ipb-attach-url-17011-0-97240700-1676066390}\n* [![3.-agFM-Partition.png](http://reboot.pro/uploads/monthly_03_2020/post-26560-0-32580600-1583484764_thumb.png)](http://reboot.pro/uploads/monthly_03_2020/post-26560-0-32580600-1583484764.png \"3.-agFM-Partition.png - Size: 148.63KB\"){#ipb-attach-url-17012-0-97246800-1676066390}\n* [![4.-NTFS_partition.png](http://reboot.pro/uploads/monthly_03_2020/post-26560-0-22778000-1583484780_thumb.png)](http://reboot.pro/uploads/monthly_03_2020/post-26560-0-22778000-1583484780.png \"4.-NTFS_partition.png - Size: 153.95KB\"){#ipb-attach-url-17013-0-97251900-1676066390}\n* [![5.-Wimboot-folder.png](http://reboot.pro/uploads/monthly_03_2020/post-26560-0-16765100-1583484802_thumb.png)](http://reboot.pro/uploads/monthly_03_2020/post-26560-0-16765100-1583484802.png \"5.-Wimboot-folder.png - Size: 119.33KB\"){#ipb-attach-url-17014-0-97256400-1676066390}\n\n"
    },
    {
      "id": "214053",
      "timestamp": "2020-03-07T09:57:47+00:00",
      "author": "wimb",
      "content": "Thanks for all the useful info.\n\nI would like to use a1ive\u0027s grub2 and File Manager in my Multi-Boot USB drives made with USB_FORMAT and UEFI_MULTI.\n\nWhat files on what location and what menu additions are minimally needed to implement the new grub2 and File Manager ?\n\nI see already your addition to menu.lst for grubfm.iso which is clear to me.\n\nBut in general the new grub2 downloads contain a lot of files which I don\u0027t know how to implement yet .....\n\n"
    },
    {
      "id": "214054",
      "timestamp": "2020-03-07T11:31:03+00:00",
      "author": "a1ive",
      "content": "\u003e Thanks for all the useful info.\n\u003e\n\u003e I would like to use a1ive\u0027s grub2 and File Manager in my Multi-Boot USB drives made with USB_FORMAT and UEFI_MULTI.\n\u003e\n\u003e What files on what location and what menu additions are minimally needed to implement the new grub2 and File Manager ?\n\u003e\n\u003e I see already your addition to menu.lst for grubfm.iso which is clear to me.\n\u003e\n\u003e But in general the new grub2 downloads contain a lot of files which I don\u0027t know how to implement yet .....\n\nYou can download it from [https://github.com/a...anager/releases](https://github.com/a1ive/grub2-filemanager/releases \"External link\")\n\nFor Legacy BIOS/MBR-Booting, use grldr/menu.lst to map grubfm.iso.\n\nFor 64 bit UEFI-Booting, if you have grub2 installed on usb drive, edit grub.cfg to chainload grubfmx64.efi.\n\n"
    },
    {
      "id": "214055",
      "timestamp": "2020-03-07T13:01:02+00:00",
      "author": "wimb",
      "content": "\u003e You can download it from [https://github.com/a...anager/releases](https://github.com/a1ive/grub2-filemanager/releases \"External link\")\n\u003e\n\u003e For Legacy BIOS/MBR-Booting, use grldr/menu.lst to map grubfm.iso.\n\u003e\n\u003e For 64 bit UEFI-Booting, if you have grub2 installed on usb drive, edit grub.cfg to chainload grubfmx64.efi.\n\nThanks for your help :smile:\n\n**Download:** grubfm-en_US.7z from [https://github.com/a...anager/releases](https://github.com/a1ive/grub2-filemanager/releases \"External link\") - v7-beta2\n\nI have got now your grub2 + File Manager working for booting in BIOS and in UEFI mode on my USB made with [USB_FORMAT](http://reboot.pro/files/file/618-usb-format-tool/ \"\") and [UEFI_MULTI](http://reboot.pro/files/file/279-uefi-multi-make-multi-boot-usb-drive/ \"\")\n\nInitially UEFI Secure mode failed, but after disabling Secure boot then UEFI mode booting is OK. :smile:\n\n**Grub4dos menu.lst** entry used for booting in BIOS mode\n\n```\ntitle GrubFM\nfind --set-root /grubfm.iso\nmap --mem /grubfm.iso (0xff)\nmap --hook\nchainloader (0xff)\n\n```\n\n\u003d\n\n**Grub2** entry in **Boot\\\\grub\\\\grub.cfg** for booting in UEFI mode\n\n```\nmenuentry \"grubfm x64 EFI BootManager\" {\n  chainloader /efi/boot/grubfmx64.efi\n}\n\n```\n\nAdded files in FAT32 root: grubfm.iso ~~and loadfm~~ (loadfm not needed)\n\nAdded files in FAT32 EFI\\\\Boot grubfmx64.efi and grubfmia32.efi\n\n[![grubfm-2020-03-07_135917.jpg](http://reboot.pro/uploads/monthly_03_2020/post-9517-0-54812900-1583586029_thumb.jpg)](http://reboot.pro/uploads/monthly_03_2020/post-9517-0-54812900-1583586029.jpg \"grubfm-2020-03-07_135917.jpg - Size: 99.44KB\"){#ipb-attach-url-17020-0-97260900-1676066390} \u003d\u003d [![grubfm-2020-03-07_135710.jpg](http://reboot.pro/uploads/monthly_03_2020/post-9517-0-52351200-1583586041_thumb.jpg)](http://reboot.pro/uploads/monthly_03_2020/post-9517-0-52351200-1583586041.jpg \"grubfm-2020-03-07_135710.jpg - Size: 73.67KB\"){#ipb-attach-url-17021-0-97268700-1676066390}\n\n"
    },
    {
      "id": "214056",
      "timestamp": "2020-03-07T22:49:00+00:00",
      "author": "alacran",
      "content": "I was thinking in trying to do same thing, but you were faster, so **Congratulations my friend**, I\u0027m sure this will add to UEFI_MULTI an improved capability to deal with Linux Live Isos.\n\n**I will try this approach and test it, it seems very promising to me.**\n\nLast month there was a firmware update (KB 4524244 for Win10 and KB 4502496 for Win8.1) that is the possible cause agFM not booing on UEFI + Secure Boot, but there were big troubles with this update mainly on HP PCs, and it was removed for now, following some relevant parts of the info:\n\n\u003e Here\u0027s the problem. KB 4524244 and KB 4502496 add the old Kaspersky Rescue Disk routine to your PC\u0027s Secure Boot Forbidden Signature Database, so it won\u0027t be recognized as a Microsoft-approved app. But, for reasons that aren\u0027t at all clear, monkeying around with the UEFI Secure Boot restrictions broke other programs --- most notably the boot routine for HP PCs with Ryzen processors. **There may be other collateral damage.**\n\u003e\n\u003e Microsoft has [yanked the patch](https://www.askwoody.com/2020/microsoft-pulls-kb-4524244-the-infamous-uefi-patch-from-the-catalog/ \"External link\"). It won\u0027t be pushed onto your machine. You can\u0027t even download it from the Update Catalog.\n\u003e\n\u003e If you installed the update and your machine won\u0027t boot (yet another good reason to [avoid installing patches right away](https://www.computerworld.com/article/3402718/the-case-against-knee-jerk-installation-of-windows-patches.html \"External link\"), eh?), Microsoft has details for restoring your PC to health in the [KB article](https://support.microsoft.com/en-us/help/4524244/security-update-for-windows-10-february-11-2020 \"External link\") (which now mentions Win10 version 1909) and on the [Windows Release Information Status page](https://docs.microsoft.com/en-us/windows/release-information/status-windows-10-1909#392msgdesc \"External link\"). **The instructions tell you how to uninstall the patch.** For machines with the \"Reset this PC\" bug, Microsoft also recommends that you follow the uninstall with a run of Reset this PC. I have no idea why uninstalling the patch and running Reset restores machines to a working state, but apparently it does.\n\n**NOTE:** Red remarks are mine.\n\nSource: [https://www.computer...kb-4524244.html](https://www.computerworld.com/article/3528302/the-mess-behind-microsoft-s-yanked-uefi-patch-kb-4524244.html \"External link\")\n\nalacran\n\n"
    },
    {
      "id": "214057",
      "timestamp": "2020-03-07T23:47:23+00:00",
      "author": "alacran",
      "content": "Hope uninstalling KB 4524244 can help to make agFM bootable from UEFI + Secure Boot again.\n\nHere is info from MS to uninstall the KB 4524244 (it is the usual way to uninstall updates, but this info may be usefull for some non advanced users):\n\n\u003e **You might encounter issues with KB4524244**  \n\u003e You might encounter issues trying to install or after installing [KB4524244](https://support.microsoft.com/help/4524244 \"External link\").  \n\u003e **Affected platforms:**\n\u003e\n\u003e * Client: Windows 10, version 1909; Windows 10, version 1903; Windows 10, version 1809; Windows 10 Enterprise LTSC 2019; Windows 10, version 1803; Windows 10, version 1709; Windows 10 Enterprise LTSC 2016; Windows 10, version 1607; Windows 10 Enterprise LTSC 2015; Windows 8.1\n\u003e * Server: Windows Server, version 1909; Windows Server, version 1903; Windows Server, version 1809; Windows Server 2019; Windows Server, version 1803; Windows Server, version 1709 ; Windows Server 2016; Windows Server 2012 R2; Windows Server 2012\n\u003e\n\u003e **Workaround:** To help a sub-set of affected devices, the standalone security update ([KB4524244](https://support.microsoft.com/help/4524244 \"External link\")) has been removed and will not re-offered from Windows Update, Windows Server Update Services (WSUS) or Microsoft Update Catalog. **Note** This does not affect any other update, including Latest Cumulative Updates (LCUs), Monthly Rollups or Security Only updates.  \n\u003e **If this update is installed and you are experiencing issues, you can uninstall this update.**\n\u003e\n\u003e 1. Select the start button or Windows Desktop Search and type **update history** and select **View your Update history**.\n\u003e 2. On the **Settings/View update history** dialog window, Select **Uninstall Updates**.\n\u003e 3. On the **Installed Updates** dialog window, find and select [KB4524244](https://support.microsoft.com/help/4524244 \"External link\") and select the **Uninstall** button.\n\u003e 4. Restart your device.\n\u003e\n\u003e **Next steps:**We are working on an improved version of this update in coordination with our partners and will release it in a future update.\n\nNote: Red remarks are mine.\n\nSource: [https://docs.microso...1909#392msgdesc](https://docs.microsoft.com/en-us/windows/release-information/status-windows-10-1909#392msgdesc \"External link\")\n\nalacran\n\n"
    },
    {
      "id": "214058",
      "timestamp": "2020-03-08T00:22:52+00:00",
      "author": "a1ive",
      "content": "\u003e Thanks for your help :smile:\n\u003e\n\u003e **Download:** grubfm-en_US.7z from [https://github.com/a...anager/releases](https://github.com/a1ive/grub2-filemanager/releases \"External link\") - v7-beta2\n\u003e\n\u003e I have got now your grub2 + File Manager working for booting in BIOS and in UEFI mode on my USB made with [USB_FORMAT](http://reboot.pro/files/file/618-usb-format-tool/ \"\") and [UEFI_MULTI](http://reboot.pro/files/file/279-uefi-multi-make-multi-boot-usb-drive/ \"\")\n\u003e\n\u003e Initially UEFI Secure mode failed, but after disabling Secure boot then UEFI mode booting is OK. :smile:\n\u003e\n\u003e **Grub4dos menu.lst** entry used for booting in BIOS mode\n\u003e\n\u003e ```\n\u003e title GrubFM\n\u003e find --set-root /grubfm.iso\n\u003e map --mem /grubfm.iso (0xff)\n\u003e map --hook\n\u003e chainloader (0xff)\n\u003e\n\u003e ```\n\u003e\n\u003e \u003d\n\u003e\n\u003e **Grub2** entry in **Boot\\\\grub\\\\grub.cfg** for booting in UEFI mode\n\u003e\n\u003e ```\n\u003e menuentry \"grubfm x64 EFI BootManager\" {\n\u003e   chainloader /efi/boot/grubfmx64.efi\n\u003e }\n\u003e\n\u003e ```\n\u003e\n\u003e Added files in FAT32 root: grubfm.iso and loadfm\n\u003e\n\u003e Added files in FAT32 EFI\\\\Boot grubfmx64.efi and grubfmia32.efi\n\u003e\n\u003e ![attachicon.gif](http://reboot.pro/public/style_images/metro/attachicon.gif)[grubfm-2020-03-07_135917.jpg](http://reboot.pro/index.php?app\u003dcore\u0026module\u003dattach\u0026section\u003dattach\u0026attach_rel_module\u003dpost\u0026attach_id\u003d17020 \"\") \u003d\u003d ![attachicon.gif](http://reboot.pro/public/style_images/metro/attachicon.gif)[grubfm-2020-03-07_135710.jpg](http://reboot.pro/index.php?app\u003dcore\u0026module\u003dattach\u0026section\u003dattach\u0026attach_rel_module\u003dpost\u0026attach_id\u003d17021 \"\")\n\nActually, file \"loadfm\" is not necessary when booting with GRUB4DOS under BIOS. \"loadfm\" is a \"grub.exe\" with embeded menu.\n\n"
    },
    {
      "id": "214060",
      "timestamp": "2020-03-08T07:36:52+00:00",
      "author": "wimb",
      "content": "For UEFI Secure booting of Linux ISO files (Ubuntu, Knoppix Or Linux Mint) I am using\n\nin folder EFI\\\\Boot files **bootx64.efi** and **grubx64.efi** of Linux Mint. That works quite well but not to boot the a1ive File Manager.\n\nThe Secure Boot chain is broken when using grubfmx64.efi for the new grub2 File Manager.\n\nI have downloaded grub2-latest.tar.gz of [a1ive from github](https://github.com/a1ive/grub/releases \"External link\")\n\nAfter extract to folder grub then I have run **build_grub.bat** which makes **grubx64.efi** and **grubia32.efi** and **core.img**\n\nBut I am still missing then **bootx64.efi** for a1ive grub2.\n\nI don\u0027t know how to make the UEFI Secure Boot chain working for a1ive grub2\n\n"
    },
    {
      "id": "214061",
      "timestamp": "2020-03-08T08:03:34+00:00",
      "author": "alacran",
      "content": "Just to let you know I was able to UEFI boot (with secure boot disabled) agFM from my UEFI_MULTI USB device, to make things easier for this test I started with another 32 GB MicroSD + the USB 3.0 adapter, where it had previously installed UEFI_MULTI files/folders + AIO Boot on first primary active Fat-32 partition and a second NTFS partition with only two VHDs installed on compact mode.\n\nSo grub2 was already available, just copied grubfm.iso to FAT32 root and grubfmx64.efi + grubfmia32.efi to FAT32 EFI\\\\Boot and edited menu.lst and Boot\\\\grub\\\\grub.cfg\n\nNow agFM can be CSM/MBR loaded from grub4dos or boot on a UEFI (with secure boot disabled) environment from grub2.\n\nGood, and it was very easy to run this test.\n\nalacran\n\n"
    },
    {
      "id": "214062",
      "timestamp": "2020-03-08T08:06:34+00:00",
      "author": "a1ive",
      "content": "\u003e For UEFI Secure booting of Linux ISO files (Ubuntu, Knoppix Or Linux Mint) I am using\n\u003e\n\u003e in folder EFI\\\\Boot files **bootx64.efi** and **grubx64.efi** of Linux Mint. That works quite well but not to boot the a1ive File Manager.\n\u003e\n\u003e The Secure Boot chain is broken when using grubfmx64.efi for the new grub2 File Manager.\n\u003e\n\u003e I have downloaded grub2-latest.tar.gz of [a1ive from github](https://github.com/a1ive/grub/releases \"External link\")\n\u003e\n\u003e After extract to folder grub then I have run **build_grub.bat** which makes **grubx64.efi** and **grubia32.efi** and **core.img**\n\u003e\n\u003e But I am still missing then **bootx64.efi** for a1ive grub2.\n\u003e\n\u003e I don\u0027t know how to make the UEFI Secure Boot chain working for a1ive grub2\n\nTo bypass secure boot, you need Red Hat shim signed efi and modified preloader.\n\nSee [https://github.com/V...SecureBoot-Disk](https://github.com/ValdikSS/Super-UEFIinSecureBoot-Disk \"External link\")and [https://github.com/a...nager/issues/69](https://github.com/a1ive/grub2-filemanager/issues/69 \"External link\")\n\n**Edited by a1ive, 08 March 2020 - 08:07 AM.**\n"
    },
    {
      "id": "214063",
      "timestamp": "2020-03-08T13:06:07+00:00",
      "author": "wimb",
      "content": "\u003e To bypass secure boot, you need Red Hat shim signed efi and modified preloader.\n\u003e\n\u003e See [https://github.com/V...SecureBoot-Disk](https://github.com/ValdikSS/Super-UEFIinSecureBoot-Disk \"External link\")and [https://github.com/a...nager/issues/69](https://github.com/a1ive/grub2-filemanager/issues/69 \"External link\")\n\nThank you, It works quite well :smile:\n\nThe **Super-UEFIinSecureBoot-Disk_minimal_v3.zip** Release was downloaded and Extracted twice (zip and img) with 7z\n\nThen the folder **EFI** and the **ENROLL_THIS_KEY_IN_MOKMANAGER.cer** Certificate were copied to my USB FAT32 Boot drive, where the original EFI\\\\Boot folder was renamed previously.\n\nI added to EFI\\\\BOOT the File Manager files **grubfmx64.efi** and **grubfmia32.efi** and my **org-bootx64.efi** for Windows Boot Manager\n\nI added to EFI\\\\grub my grub2 Boot Menu files **grub.cfg** and **grub_Linux.cfg**\n\nAfter booting in UEFI Secure mode from USB then I used the MokManager to Add ENROLL_THIS_KEY_IN_MOKMANAGER.cer to the firmware\n\nNow I can boot in UEFI Secure mode from USB and select in grub.cfg menu the **a1ive File Manager** or the Linux ISO files or Windows Boot Manager (with PE WIM and VHD options)\n\nAll are booting now in UEFI Secure Mode :smile:\n\n[![Shim-2020-03-08_123743.jpg](http://reboot.pro/uploads/monthly_03_2020/post-9517-0-96560400-1583672674_thumb.jpg)](http://reboot.pro/uploads/monthly_03_2020/post-9517-0-96560400-1583672674.jpg \"Shim-2020-03-08_123743.jpg - Size: 123.16KB\"){#ipb-attach-url-17024-0-97288100-1676066390} \u003d\u003d [![Shim-2020-03-08_123840.jpg](http://reboot.pro/uploads/monthly_03_2020/post-9517-0-30697100-1583672661_thumb.jpg)](http://reboot.pro/uploads/monthly_03_2020/post-9517-0-30697100-1583672661.jpg \"Shim-2020-03-08_123840.jpg - Size: 109.72KB\"){#ipb-attach-url-17023-0-97281800-1676066390} \u003d\u003d [![Shim-2020-03-08_123923.jpg](http://reboot.pro/uploads/monthly_03_2020/post-9517-0-39568900-1583672651_thumb.jpg)](http://reboot.pro/uploads/monthly_03_2020/post-9517-0-39568900-1583672651.jpg \"Shim-2020-03-08_123923.jpg - Size: 82.28KB\"){#ipb-attach-url-17022-0-97275400-1676066390}\n\n"
    },
    {
      "id": "214073",
      "timestamp": "2020-03-09T23:51:03+00:00",
      "author": "alacran",
      "content": "Good, also working here.\n\nalacran\n\n"
    },
    {
      "id": "214092",
      "timestamp": "2020-03-13T17:54:00+00:00",
      "author": "alacran",
      "content": "This are some useful links related to the use of multipartitioned devices:\n\nAdd capability to reed/write on all USB stick partitions to your old already created WinPEs: [http://reboot.pro/to...-sd-or-microsd/](http://reboot.pro/topic/22256-make-your-old-win7-or-win8x-based-winpes-capables-to-access-a-multipartitioned-usb-stick-sd-or-microsd/ \"\")\n\nDiskmod Script, to include diskmod in your new WinPE builds: [http://reboot.pro/to...-diskmodscript/](http://reboot.pro/topic/22258-diskmodscript/ \"\")\n\nDiskmod, to install diskmod on your running OS or VHD, on versions before Win10 v1703: \u003chttp://reboot.pro/topic/22249-diskmod/\u003e\n\nalacran\n\n"
    },
    {
      "id": "214094",
      "timestamp": "2020-03-14T03:37:31+00:00",
      "author": "alacran",
      "content": "After reading the post from wimb about USB_FORMAT-30.zip and USB_FORMAT-30-addon.zip, and follow intructions on the post: [http://reboot.pro/to...l/#entry214087](http://reboot.pro/topic/22254-usb-format-tool/#entry214087%C2%A0 \"\")\n\n**I tested that approach and this are my comments:**\n\n**Wimb\u0027s approach is better than my proposed procedure on first post. I strongly recommend it, because it is faster and easier.**\n\nNow all files/folders required to boot the USB device on MBR/CSM and also on UEFI machines are located on first partition, so there is no need of a partition dedicated to locate A1ve grub2 filemanager (agFM) anymore.\n\nNow all the user files can be booted by means of Windows bootmanager and agFM.\n\nIf the user really requires to add E2B files/folders, they can be copied to U-BOOT or U-NTFS, depending of user files size, only remember FAT-32 maximum file size is \\\u003c 4 GB (almost 4 GB), **just taking care to not overwrite any file, if that is the case,** if selecting U-BOOT as target partition, previously rename E2B menu.lst to e2b.lst and make sure to have an entry for it on your menu.lst\n\nThe optional addition of AIO Boot seams now superfluous to me, after testing extensively agFM. Nevertheless I recognize the AIO Boot author hard work, and admit it was very useful until agFM came to take its place.\n\n@ wimb:\n\n**Congratulations for the development of new USB_FORMAT-30 + USB_FORMAT-30-addon and Thanks, you made my life easier.**\n\nI hope this topic had been at least useful to give you the idea to include agFM in your kit of tools. If that was the case.\n\nalacran\n\n"
    },
    {
      "id": "214103",
      "timestamp": "2020-03-14T14:37:46+00:00",
      "author": "wimb",
      "content": "\u003e **Congratulations for the development of new USB_FORMAT-30 + USB_FORMAT-30-addon and Thanks, you made my life easier.**\n\u003e\n\u003e I hope this topic had been at least useful to give you the idea to include agFM in your kit of tools. If that was the case.\n\u003e\nThank you for testing [USB_FORMAT-30](http://reboot.pro/files/file/618-usb-format-tool/ \"\") and for your approval and kind words :smile:\n\nYour topic has indeed inspired me to create USB_FORMAT-30 and later also to Add agFM to it as addon.\n\nThe concept is working quite well now and is indeed very handy to make\n\n**USB Multi-Boot of Linux ISO + Windows 10 VHD + Win10XPE in BIOS Or UEFI Secure mode**\n\n![:cheers:](https://reboot.pro/public/style_emoticons/default/cheers.gif)\n\n"
    },
    {
      "id": "214174",
      "timestamp": "2020-03-29T12:26:05+00:00",
      "author": "ktp",
      "content": "@wimb  \nJust to mention:  \nWith USB_FORMAT-30, the a1ive file manager (agFM UEFI x64/ia32) curiously display \"Secure boot: Enabled\" on F1 press  \nalthough that is not true. The latest agFM binaries (beta 4 in Github [https://github.com/a...es/tag/v7-beta4](https://github.com/a1ive/grub2-filemanager/releases/tag/v7-beta4 \"External link\")) do not have this problem.  \n\n"
    },
    {
      "id": "214175",
      "timestamp": "2020-03-29T13:02:44+00:00",
      "author": "wimb",
      "content": "\u003e With USB_FORMAT-30, the a1ive file manager (agFM UEFI x64/ia32) curiously display \"Secure boot: Enabled\" on F1 press  \n\u003e although that is not true. The latest agFM binaries (beta 4 in Github [https://github.com/a...es/tag/v7-beta4](https://github.com/a1ive/grub2-filemanager/releases/tag/v7-beta4 \"External link\")) do not have this problem.\n\u003e\nIn my case the machine has UEFI Secure boot enabled and the F1 Display is then OK, so I was not aware of this error.\n\nThanks for sharing info that v7-beta4 has solved this issue with possible wrong display of Secure boot status.\n\n"
    },
    {
      "id": "214882",
      "timestamp": "2020-05-31T06:54:56+00:00",
      "author": "devdevadev",
      "content": "It\u0027s looking there are two approaches of using UEFI_MULTI.  \n\n[http://reboot.pro/to...al/#entry214094](http://reboot.pro/topic/22250-usb-30-combo-uefi-multi-wimboot-vhds-agfm-e2b-aio-boot-optional/#entry214094 \"\")  \nIn agFM approach FAT32 PTN1 is boot partition.  \n\n[http://reboot.pro/to...-10#entry214811](http://reboot.pro/topic/18182-uefi-multi-make-multi-boot-usb-drive/page-10#entry214811 \"\")  \nIn Ventoy Approach FAT32 PTN2 is Boot Partition.  \n\nAfter Ventoy addition in UEFI_MULTI, What partition layout will be used so that can enjoy both agFM and Ventoy using UEFI_MULTI in same USB Drive ? Currently what partition layout you are using in your Combo USB drive ?   \n"
    },
    {
      "id": "214912",
      "timestamp": "2020-05-31T17:03:33+00:00",
      "author": "alacran",
      "content": "Use the second you mentioned but using new [UEFI_MULTI version](http://reboot.pro/topic/18182-uefi-multi-make-multi-boot-usb-drive/page-11#entry214862 \"\"), and just add [grubfm_multiarch.iso](https://github.com/a1ive/grub2-filemanager/releases \"External link\") to the root of first partition NTFS.\n\nalacran\n\n"
    }
  ]
}