{
  "id": "8691",
  "title": "Boot full XP from second partition of removable USB key",
  "isPinned": false,
  "isFirstTopic": false,
  "isLocked": false,
  "tags": [],
  "forumNotes": [
    {
      "id": "74339",
      "timestamp": "2009-08-12T12:50:31+00:00",
      "author": "ktp",
      "content": "Today I have this experimentation I would like to share with you.  \n\nI have an USB key (so seen as removable HDD by default, without Hitachi microfilter), with single partition.   \nIt can boot UBCD4Win and full XP (prepared with USBoot [http://www.usboot.org](http://www.usboot.org \"External link\") ).  \nI use grub4dos in MBR to boot the key (UBCD4Win/full XP).  \n\nI create another USB key, put Hitachi microfilter to it, then I can partition it into 2 primary partitions.  \nFirst active partition contains UBCD4Win, second partition contains the copy of full XP (Windows, Documents and settings, Program Files).   \nboot.ini in first partition has been modified to point to the second partition (partition(2)).  \n\nResult:  \n- UBCD4Win boots fine from first partition.  \n- Full XP boots fine from second partition (surprise!, this XP does not have Hitachi microfilter applied).   \nIt recognizes the first partition too!  \n\nBut there is a problem: right click on any file in Explorer causes popup: Title: Application Error. Content: Application corrupt.  \nSo for me this XP is not usable.  \n\nI suppress the first partition (so now the key has single partition as my first USB key) and boot again:  \nbut same right click error.  \n\nNote: of course there is no problem if in all the above procedures I use a non-removable disk (USB HDD) instead of the removable USB key (no fixed disk flag set by the controller).  \n\nStrange?   \n"
    },
    {
      "id": "74530",
      "timestamp": "2009-08-14T09:25:06+00:00",
      "author": "ktp",
      "content": "Wow!  \nFinally problem solved! There is nothing to do with the boot process on second partition, it is a bad deduction by me :-(. The problem is with explorer.exe. I usually use Total Commander and right click on files, very rarely right click on directories.   \n\nThis morning I fortunately right click on a directory and it works, but not right click on file(s) (Total commander would crash after popup about Application corrupt). I then use explorer.exe instead of Total Commander and right click: OK on directory, crash on file (explorer.exe disappears then restarts automatically).   \n\nI then use the excellent ShellExView from Nirsoft:  \n[http://www.nirsoft.n...s/shexview.html](http://www.nirsoft.net/utils/shexview.html \"External link\")  \n\nIt displays among other thing the right click menu (Shell Extension context menu) installed by other applications. By disabling/re-enabling each one through trials, I found the culprit application. Re-installing it fixes the problem.  \n\nNow I can continue to build my USB key with two partitions: first one (public) has UBCD4Win and other utilities, the other partition contains full XP with personal data, encrypted with TrueCrypt. I hope that this will work (TrueCrypt invokes ntdlr, and in boot.ini I will add entry for grub4dos, then in menu.lst an entry for starting UBCD4win).  \n\nAll\u0027s well that ends well!   \n"
    },
    {
      "id": "74535",
      "timestamp": "2009-08-14T09:56:26+00:00",
      "author": "was_jaclaz",
      "content": "\u003e Result:  \n\u003e - UBCD4Win boots fine from first partition.  \n\u003e - Full XP boots fine from second partition ***(surprise!, this XP does not have Hitachi microfilter applied)***.\nFrom the booted XP on second partition of the stick:  \nCan you open disk management and post a screenshot?  \nAnd possibly run this:  \nddlistW  \n[http://www.boot-land...?showtopic\u003d8219](http://www.boot-land.net/forums/index.php?showtopic\u003d8219 \"External link\")  \nand post output ?  \n\nAdditionally, I would really like to see the .reg export of HKEY_LOCAL_MACHINE\\\\SYSTEM\\\\MountedDevices of that XP system.  \n\n\u003e By disabling/re-enabling each one through trials, I found the culprit application. Re-installing it fixes the problem.\nAre you going to tell us ***WHICH*** app created the problem or this secret will be accessible only after thirty years from today? :wink: ![:frusty:](http://reboot.pro/public/style_emoticons/default/frusty.gif)   \n\n![:unsure:](http://reboot.pro/public/style_emoticons/default/unsure.png)  \n\njaclaz   \n"
    },
    {
      "id": "74538",
      "timestamp": "2009-08-14T10:15:59+00:00",
      "author": "ktp",
      "content": "@jaclaz  \nJust a quick answer.  \nI can provide you with all required data, but I miss \u0027dd\u0027 utility. Is it in VSS SDK ?   \n"
    },
    {
      "id": "74542",
      "timestamp": "2009-08-14T10:36:58+00:00",
      "author": "was_jaclaz",
      "content": "\u003e @jaclaz  \n\u003e Just a quick answer.  \n\u003e I can provide you with all required data, but I miss \u0027dd\u0027 utility. Is it in VSS SDK ?\n\nNo, it\u0027s on John Newbigin\u0027s site:  \n[http://www.chrysocome.net/dd](http://www.chrysocome.net/dd \"External link\")  \nunless he throwed it away together with empty cola cans :wink::  \n[http://uranus.chrysocome.net/coke.htm](http://uranus.chrysocome.net/coke.htm \"External link\")  \n\n![:frusty:](http://reboot.pro/public/style_emoticons/default/frusty.gif)  \n\njaclaz   \n"
    },
    {
      "id": "74551",
      "timestamp": "2009-08-14T11:10:58+00:00",
      "author": "ktp",
      "content": "Here is the disk management scren capture:  \n[![Posted Image](http://img193.imageshack.us/img193/2233/diskmgmtxpusb2ndpartiti.th.jpg)](http://img193.imageshack.us/i/diskmgmtxpusb2ndpartiti.jpg/ \"External link\")  \n\nThe USB key is 16GB-size, and is the second hard disk. It is seen as non-removable disk.  \n\n\u003cbr /\u003e\n\nddlistw output:  \n\n```\n\u003eddlistw\n\nDrives by drive letter\u0026#58;\n\nc\u0026#58; 1,2 FIX \\Volume{ea1d9780-8723-11de-968c-806d6172696f} \\HarddiskVolume2\n\nd\u0026#58; 0,1 FIX \\Volume{25991011-858b-11de-988c-806d6172696f} \\HarddiskVolume3\n\ne\u0026#58; 0,2 FIX \\Volume{25991012-858b-11de-988c-806d6172696f} \\HarddiskVolume4\n\nf\u0026#58; x,x CDR \\Volume{25991013-858b-11de-988c-806d6172696f} \\CdRom0\n\ng\u0026#58; 1,1 FIX \\Volume{8fbcb8c0-8591-11de-988e-00e09873cc58} \\HarddiskVolume1\n\nh\u0026#58; 2,1 FIX \\Volume{6ffaff10-88ba-11de-9690-005056c00008} \\HarddiskVolume8\n\nPress any key to continue . . .\n\n \n\nDrives by connection\u0026#58;\n\nd\u0026#58; 0,1 FIX \\Volume{25991011-858b-11de-988c-806d6172696f} \\HarddiskVolume3\n\ne\u0026#58; 0,2 FIX \\Volume{25991012-858b-11de-988c-806d6172696f} \\HarddiskVolume4\n\ng\u0026#58; 1,1 FIX \\Volume{8fbcb8c0-8591-11de-988e-00e09873cc58} \\HarddiskVolume1\n\nc\u0026#58; 1,2 FIX \\Volume{ea1d9780-8723-11de-968c-806d6172696f} \\HarddiskVolume2\n\nh\u0026#58; 2,1 FIX \\Volume{6ffaff10-88ba-11de-9690-005056c00008} \\HarddiskVolume8\n\nf\u0026#58; x,x CDR \\Volume{25991013-858b-11de-988c-806d6172696f} \\CdRom0\n\nPress any key to continue . . .\n```\n\n\u003cbr /\u003e\n\nMountedDevices keys in registry:  \n\n```\nWindows Registry Editor Version 5.00\n\n \n\n\u0026#91;HKEY_LOCAL_MACHINE\\SYSTEM\\MountedDevices\u0026#93;\n\n\u0026#34;\\\\??\\\\Volume{7f4e4d34-6be2-11de-975f-806d6172696f}\u0026#34;\u003dhex\u0026#58;5c,00,3f,00,3f,00,5c,\\\n\n  00,46,00,44,00,43,00,23,00,47,00,45,00,4e,00,45,00,52,00,49,00,43,00,5f,00,\\\n\n  46,00,4c,00,4f,00,50,00,50,00,59,00,5f,00,44,00,52,00,49,00,56,00,45,00,23,\\\n\n  00,36,00,26,00,31,00,34,00,33,00,35,00,62,00,32,00,65,00,32,00,26,00,30,00,\\\n\n  26,00,30,00,23,00,7b,00,35,00,33,00,66,00,35,00,36,00,33,00,30,00,64,00,2d,\\\n\n  00,62,00,36,00,62,00,66,00,2d,00,31,00,31,00,64,00,30,00,2d,00,39,00,34,00,\\\n\n  66,00,32,00,2d,00,30,00,30,00,61,00,30,00,63,00,39,00,31,00,65,00,66,00,62,\\\n\n  00,38,00,62,00,7d,00\n\n\u0026#34;\\\\??\\\\Volume{7f4e4d35-6be2-11de-975f-806d6172696f}\u0026#34;\u003dhex\u0026#58;5c,00,3f,00,3f,00,5c,\\\n\n  00,49,00,44,00,45,00,23,00,43,00,64,00,52,00,6f,00,6d,00,4e,00,45,00,43,00,\\\n\n  56,00,4d,00,57,00,61,00,72,00,5f,00,56,00,4d,00,77,00,61,00,72,00,65,00,5f,\\\n\n  00,49,00,44,00,45,00,5f,00,43,00,44,00,52,00,31,00,30,00,5f,00,5f,00,5f,00,\\\n\n  5f,00,5f,00,5f,00,5f,00,5f,00,5f,00,5f,00,5f,00,5f,00,5f,00,5f,00,5f,00,31,\\\n\n  00,2e,00,30,00,30,00,5f,00,5f,00,5f,00,5f,00,23,00,33,00,30,00,33,00,31,00,\\\n\n  33,00,30,00,33,00,30,00,33,00,30,00,33,00,30,00,33,00,30,00,33,00,30,00,33,\\\n\n  00,30,00,33,00,30,00,33,00,30,00,33,00,30,00,33,00,30,00,33,00,30,00,33,00,\\\n\n  30,00,33,00,30,00,33,00,30,00,33,00,30,00,33,00,31,00,33,00,30,00,23,00,7b,\\\n\n  00,35,00,33,00,66,00,35,00,36,00,33,00,30,00,64,00,2d,00,62,00,36,00,62,00,\\\n\n  66,00,2d,00,31,00,31,00,64,00,30,00,2d,00,39,00,34,00,66,00,32,00,2d,00,30,\\\n\n  00,30,00,61,00,30,00,63,00,39,00,31,00,65,00,66,00,62,00,38,00,62,00,7d,00\n\n\u0026#34;\\\\DosDevices\\\\A\u0026#58;\u0026#34;\u003dhex\u0026#58;5c,00,3f,00,3f,00,5c,00,46,00,44,00,43,00,23,00,47,00,\\\n\n  45,00,4e,00,45,00,52,00,49,00,43,00,5f,00,46,00,4c,00,4f,00,50,00,50,00,59,\\\n\n  00,5f,00,44,00,52,00,49,00,56,00,45,00,23,00,36,00,26,00,31,00,34,00,33,00,\\\n\n  35,00,62,00,32,00,65,00,32,00,26,00,30,00,26,00,30,00,23,00,7b,00,35,00,33,\\\n\n  00,66,00,35,00,36,00,33,00,30,00,64,00,2d,00,62,00,36,00,62,00,66,00,2d,00,\\\n\n  31,00,31,00,64,00,30,00,2d,00,39,00,34,00,66,00,32,00,2d,00,30,00,30,00,61,\\\n\n  00,30,00,63,00,39,00,31,00,65,00,66,00,62,00,38,00,62,00,7d,00\n\n\u0026#34;\\\\DosDevices\\\\D\u0026#58;\u0026#34;\u003dhex\u0026#58;e2,59,5e,52,00,7e,00,00,00,00,00,00\n\n\u0026#34;\\\\??\\\\Volume{7f4e4d37-6be2-11de-975f-806d6172696f}\u0026#34;\u003dhex\u0026#58;3a,3e,10,25,00,7e,00,\\\n\n  00,00,00,00,00\n\n\u0026#34;\\\\DosDevices\\\\C\u0026#58;\u0026#34;\u003dhex\u0026#58;15,54,d0,42,00,7e,8a,f5,01,00,00,00\n\n\u0026#34;\\\\??\\\\Volume{945cb94a-6bd8-11de-8fe5-806d6172696f}\u0026#34;\u003dhex\u0026#58;5c,00,3f,00,3f,00,5c,\\\n\n  00,49,00,44,00,45,00,23,00,43,00,64,00,52,00,6f,00,6d,00,48,00,4c,00,2d,00,\\\n\n  44,00,54,00,2d,00,53,00,54,00,5f,00,44,00,56,00,44,00,52,00,41,00,4d,00,5f,\\\n\n  00,47,00,53,00,41,00,2d,00,55,00,32,00,30,00,4e,00,5f,00,5f,00,5f,00,5f,00,\\\n\n  5f,00,5f,00,5f,00,5f,00,5f,00,5f,00,5f,00,5f,00,5f,00,5f,00,5f,00,5f,00,48,\\\n\n  00,52,00,30,00,35,00,5f,00,5f,00,5f,00,5f,00,23,00,33,00,30,00,33,00,31,00,\\\n\n  33,00,30,00,33,00,30,00,33,00,30,00,33,00,30,00,33,00,30,00,33,00,30,00,33,\\\n\n  00,30,00,33,00,30,00,33,00,30,00,33,00,30,00,33,00,30,00,33,00,30,00,33,00,\\\n\n  30,00,33,00,30,00,33,00,30,00,33,00,30,00,33,00,31,00,33,00,30,00,23,00,7b,\\\n\n  00,35,00,33,00,66,00,35,00,36,00,33,00,30,00,64,00,2d,00,62,00,36,00,62,00,\\\n\n  66,00,2d,00,31,00,31,00,64,00,30,00,2d,00,39,00,34,00,66,00,32,00,2d,00,30,\\\n\n  00,30,00,61,00,30,00,63,00,39,00,31,00,65,00,66,00,62,00,38,00,62,00,7d,00\n\n\u0026#34;\\\\??\\\\Volume{f8abf60e-6dcc-11de-a510-806d6172696f}\u0026#34;\u003dhex\u0026#58;e1,36,d0,e0,00,7e,00,\\\n\n  00,00,00,00,00\n\n\u0026#34;\\\\??\\\\Volume{59910ec2-7bff-11de-a515-000c296b6295}\u0026#34;\u003dhex\u0026#58;25,89,08,6e,00,7e,00,\\\n\n  00,00,00,00,00\n\n\u0026#34;\\\\DosDevices\\\\E\u0026#58;\u0026#34;\u003dhex\u0026#58;e2,59,5e,52,00,fe,ea,08,05,00,00,00\n\n\u0026#34;\\\\??\\\\Volume{25991010-858b-11de-988c-806d6172696f}\u0026#34;\u003dhex\u0026#58;f7,7d,40,70,00,7e,00,\\\n\n  00,00,00,00,00\n\n\u0026#34;\\\\??\\\\Volume{25991011-858b-11de-988c-806d6172696f}\u0026#34;\u003dhex\u0026#58;e2,59,5e,52,00,7e,00,\\\n\n  00,00,00,00,00\n\n\u0026#34;\\\\??\\\\Volume{25991012-858b-11de-988c-806d6172696f}\u0026#34;\u003dhex\u0026#58;e2,59,5e,52,00,fe,ea,\\\n\n  08,05,00,00,00\n\n\u0026#34;\\\\??\\\\Volume{25991013-858b-11de-988c-806d6172696f}\u0026#34;\u003dhex\u0026#58;5c,00,3f,00,3f,00,5c,\\\n\n  00,49,00,44,00,45,00,23,00,43,00,64,00,52,00,6f,00,6d,00,51,00,53,00,49,00,\\\n\n  5f,00,43,00,44,00,52,00,57,00,23,00,44,00,56,00,44,00,5f,00,53,00,42,00,57,\\\n\n  00,2d,00,32,00,34,00,32,00,5f,00,5f,00,5f,00,5f,00,5f,00,5f,00,5f,00,5f,00,\\\n\n  5f,00,5f,00,5f,00,5f,00,5f,00,5f,00,5f,00,5f,00,5f,00,5f,00,5f,00,5f,00,55,\\\n\n  00,58,00,30,00,38,00,5f,00,5f,00,5f,00,5f,00,23,00,35,00,26,00,32,00,63,00,\\\n\n  35,00,39,00,34,00,39,00,36,00,65,00,26,00,30,00,26,00,30,00,2e,00,30,00,2e,\\\n\n  00,30,00,23,00,7b,00,35,00,33,00,66,00,35,00,36,00,33,00,30,00,64,00,2d,00,\\\n\n  62,00,36,00,62,00,66,00,2d,00,31,00,31,00,64,00,30,00,2d,00,39,00,34,00,66,\\\n\n  00,32,00,2d,00,30,00,30,00,61,00,30,00,63,00,39,00,31,00,65,00,66,00,62,00,\\\n\n  38,00,62,00,7d,00\n\n\u0026#34;\\\\DosDevices\\\\F\u0026#58;\u0026#34;\u003dhex\u0026#58;5c,00,3f,00,3f,00,5c,00,49,00,44,00,45,00,23,00,43,00,\\\n\n  64,00,52,00,6f,00,6d,00,51,00,53,00,49,00,5f,00,43,00,44,00,52,00,57,00,23,\\\n\n  00,44,00,56,00,44,00,5f,00,53,00,42,00,57,00,2d,00,32,00,34,00,32,00,5f,00,\\\n\n  5f,00,5f,00,5f,00,5f,00,5f,00,5f,00,5f,00,5f,00,5f,00,5f,00,5f,00,5f,00,5f,\\\n\n  00,5f,00,5f,00,5f,00,5f,00,5f,00,5f,00,55,00,58,00,30,00,38,00,5f,00,5f,00,\\\n\n  5f,00,5f,00,23,00,35,00,26,00,32,00,63,00,35,00,39,00,34,00,39,00,36,00,65,\\\n\n  00,26,00,30,00,26,00,30,00,2e,00,30,00,2e,00,30,00,23,00,7b,00,35,00,33,00,\\\n\n  66,00,35,00,36,00,33,00,30,00,64,00,2d,00,62,00,36,00,62,00,66,00,2d,00,31,\\\n\n  00,31,00,64,00,30,00,2d,00,39,00,34,00,66,00,32,00,2d,00,30,00,30,00,61,00,\\\n\n  30,00,63,00,39,00,31,00,65,00,66,00,62,00,38,00,62,00,7d,00\n\n\u0026#34;\\\\??\\\\Volume{8fbcb8c0-8591-11de-988e-00e09873cc58}\u0026#34;\u003dhex\u0026#58;15,54,d0,42,00,7e,00,\\\n\n  00,00,00,00,00\n\n\u0026#34;\\\\DosDevices\\\\G\u0026#58;\u0026#34;\u003dhex\u0026#58;15,54,d0,42,00,7e,00,00,00,00,00,00\n\n\u0026#34;\\\\??\\\\Volume{13ad9640-85ac-11de-b473-806d6172696f}\u0026#34;\u003dhex\u0026#58;18,2e,07,c3,00,7e,00,\\\n\n  00,00,00,00,00\n\n\u0026#34;\\\\??\\\\Volume{a900c760-85e6-11de-b476-00221575eaba}\u0026#34;\u003dhex\u0026#58;5c,00,3f,00,3f,00,5c,\\\n\n  00,49,00,44,00,45,00,23,00,43,00,64,00,52,00,6f,00,6d,00,48,00,4c,00,2d,00,\\\n\n  44,00,54,00,2d,00,53,00,54,00,5f,00,44,00,56,00,44,00,52,00,41,00,4d,00,5f,\\\n\n  00,47,00,53,00,41,00,2d,00,55,00,32,00,30,00,4e,00,5f,00,5f,00,5f,00,5f,00,\\\n\n  5f,00,5f,00,5f,00,5f,00,5f,00,5f,00,5f,00,5f,00,5f,00,5f,00,5f,00,5f,00,48,\\\n\n  00,52,00,30,00,35,00,5f,00,5f,00,5f,00,5f,00,23,00,34,00,26,00,31,00,39,00,\\\n\n  39,00,61,00,63,00,62,00,61,00,33,00,26,00,30,00,26,00,30,00,2e,00,31,00,2e,\\\n\n  00,30,00,23,00,7b,00,35,00,33,00,66,00,35,00,36,00,33,00,30,00,64,00,2d,00,\\\n\n  62,00,36,00,62,00,66,00,2d,00,31,00,31,00,64,00,30,00,2d,00,39,00,34,00,66,\\\n\n  00,32,00,2d,00,30,00,30,00,61,00,30,00,63,00,39,00,31,00,65,00,66,00,62,00,\\\n\n  38,00,62,00,7d,00\n\n\u0026#34;\\\\??\\\\Volume{a900c761-85e6-11de-b476-00221575eaba}\u0026#34;\u003dhex\u0026#58;3a,19,a2,c3,00,10,10,\\\n\n  71,02,00,00,00\n\n\u0026#34;\\\\??\\\\Volume{a900c762-85e6-11de-b476-00221575eaba}\u0026#34;\u003dhex\u0026#58;3a,19,a2,c3,00,d4,1f,\\\n\n  02,0a,00,00,00\n\n\u0026#34;\\\\??\\\\Volume{a900c763-85e6-11de-b476-00221575eaba}\u0026#34;\u003dhex\u0026#58;3a,19,a2,c3,00,a0,96,\\\n\n  3a,0f,00,00,00\n\n\u0026#34;\\\\??\\\\Volume{ea1d9780-8723-11de-968c-806d6172696f}\u0026#34;\u003dhex\u0026#58;15,54,d0,42,00,7e,8a,\\\n\n  f5,01,00,00,00\n```\n\n\u003cbr /\u003e\n\nNow I think about after jaclaz\u0027s questions.  \nMy XP USB was prepared with USBoot ( [http://www.usboot.org](http://www.usboot.org \"External link\") ), and has option (thanks to USBoot)  \nto see removable USB keys as fixed disks. Also it has another option to have swap file on the  \nUSB key.  \nSo any USB key plugged into my booted XP is seen as fixed disk (very convenient).   \n"
    },
    {
      "id": "74553",
      "timestamp": "2009-08-14T11:25:03+00:00",
      "author": "was_jaclaz",
      "content": "\u003e Now I think about after jaclaz\u0027s questions.  \n\u003e My XP USB was prepared with USBoot ( [http://www.usboot.org](http://www.usboot.org \"External link\") ), and has option (thanks to USBoot)  \n\u003e to see removable USB keys as fixed disks. Also it has another option to have swap file on the  \n\u003e USB key.  \n\u003e So any USB key plugged into my booted XP is seen as fixed disk (very convenient).\n\nWhich translates to:  \n\u003e A Filter Driver ***IS*** installed.\n:wink:  \n\n\u003e g: 1,1 FIX \\\\Volume{8fbcb8c0-8591-11de-988e-00e09873cc58} \\\\HarddiskVolume1  \n\u003e c: 1,2 FIX \\\\Volume{ea1d9780-8723-11de-968c-806d6172696f} \\\\HarddiskVolume2\n\n\u003e \"\\\\\\\\DosDevices\\\\\\\\G:\"\u003dhex:15,54,d0,42,00,7e,00,00,00,00,00,00  \n\u003e \"\\\\\\\\DosDevices\\\\\\\\C:\"\u003dhex:15,54,d0,42,00,7e,8a,f5,01,00,00,00\n\n![:frusty:](http://reboot.pro/public/style_emoticons/default/frusty.gif)  \n\njaclaz   \n"
    }
  ]
}