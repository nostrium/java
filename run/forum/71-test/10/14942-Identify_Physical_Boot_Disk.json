{
  "id": "14942",
  "title": "Identify Physical Boot Disk",
  "isPinned": false,
  "isFirstTopic": false,
  "isLocked": false,
  "tags": [],
  "forumNotes": [
    {
      "id": "132675",
      "timestamp": "2011-07-10T05:49:50+00:00",
      "author": "Yun Qiu",
      "content": "I am trying to develop tool which will be able to get lits of boot.ini (XP), bootmgr (Vista) configuration files from all active boot partitions.  \nCan You help me to provide advice or some source code.   \nHow to get partittion table list? Should I read MBR ?  \nHow to get active boot device flag for partittion? Can I retrieve this information from partittion table?  \n\nI have discovered topics on subject how to identify boot partitions, which tells that I am facing a serious problem:  \n[http://www.osronline...cfm?link\u003d186705](http://www.osronline.com/showthread.cfm?link\u003d186705 \"External link\")  \n[http://mirror.href.c...mbr/bootini.htm](http://mirror.href.com/thestarman/asm/mbr/bootini.htm \"External link\")  \n\nAny other advice?  \n\nThanks.   \n"
    },
    {
      "id": "132683",
      "timestamp": "2011-07-10T09:27:46+00:00",
      "author": "steve6375",
      "content": "Can you explain why you need this list? What is the purpose of it?   \n"
    },
    {
      "id": "132687",
      "timestamp": "2011-07-10T11:04:52+00:00",
      "author": "Yun Qiu",
      "content": "I am developing boot tool and I have faced a problem.   \nI cant get it working as universal tool with all that versions and types of boot configurations.  \nThat\u0027s why I thought to make it for each version, not only XP, Vista, but for   \nall other configurations ntldr, bootmgr.  \nI cant make it working for all versions during the boot, but want to make it while install.  \nPlease, help me.   \n"
    },
    {
      "id": "132689",
      "timestamp": "2011-07-10T11:19:34+00:00",
      "author": "steve6375",
      "content": "As I understand you, you want to write a install tool that will install some sort of bootloader to a hard disk. The install tool will be running under the users OS.So what OS will this tool run under?   \n\nThe BIOS first controls what to boot from. Unfortunately this is very hard to find out what disk/device the user has set the BIOS to boot from.  \nYou may also want to consider UEFI booting as well as MBR booting?  \nNext, if we consider just MBR booting, you need to search all hard disks (and removable storage media?) for a partition table at block 0 of each device.  \nThen look for a valid MBR (should end in 55 AA at 1feh and 1ffh) and check that partition table is valid (bytes at 1be,1ce,1de,1ee should be 8xh or 00h).  \nIf one partition table entry has 08xh (e.g. 80h, 81h, 82h,83h etc.) then this partition entry should be the boot partition.  \nNow the MBR code in Block 0 may be normal MBR OS code which will then load the start of the active partition into memory and run it  \nOR  \nThe MBR may contain a boot loader (such as grub4dos, grub, grub2, syslinux, etc.) in which case you will need to look at the configuration file that determines what happens - this is often a menu that the user selects from.  \nAssuming you have a normal OS on the system and no special bootloaders (and no encrypted drives such as bitlocker or TrueCrypt) then you need to look at the config file for that OS.  \nFor XP/srv2003 it will be boot.ini. For Vista/Win7/SVR2K8 it will be (normally) \\\\boot\\\\BCD located on the boot partition (which may be a different partition to the OS partition).  \nThe BCD is in binary, so you will need to \u0027decrypt\u0027 it (if you are running Win7/Vista then you can use BcdEdit to list the contents).  \nHTH   \n"
    },
    {
      "id": "132690",
      "timestamp": "2011-07-10T11:34:59+00:00",
      "author": "Yun Qiu",
      "content": "Thanks for your quick reply.   \n"
    },
    {
      "id": "132693",
      "timestamp": "2011-07-10T11:55:17+00:00",
      "author": "Yun Qiu",
      "content": "Windows XP, Vista, Seven.  \n\nI also wanted to ask You, is there any way to check which bootloaders are installed without querying user ?  \n\nThanks.   \n"
    },
    {
      "id": "132707",
      "timestamp": "2011-07-10T15:51:11+00:00",
      "author": "steve6375",
      "content": "I would suggest you search for strings. As the Windows 7 boot partition is often type 27 (hidden) and not normally accessible as the first sector of a logical volume, I suggest you Open a handle using CreateFile on \\\\\\\\PhysicalDiskn first for physical raw reads and read in LBA 0 on each disk. Then look for known strings like grub, GRUB, GRU, etc. to see if this contains a special boot loader. If it does not and just contains the standard boot MBR code from XP/Vista/Win7 etc. then read the starting sector of the active partition and again look for strings like grub, GRU, grldr etc. Also look for NTLDR, BOOTMGR etc. which should tell you what boot file the boot loader is looking for.  \nNext look in the contents of boot.ini (if NTLDR in PBR) or BCD (if BOOTMGR in PBR), so you need to look there for the default OS partition which may not be the same one as the boot partition.  \n\nSee [http://www.multiboot...uk/bootmgr.html](http://www.multibooters.co.uk/bootmgr.html \"External link\")   \n"
    }
  ]
}